<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Operating System Chapter11 æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹ - Jungle&#39;s Blog</title><meta name="description" content="Welcome to Jungle&#39;s blog."><meta property="og:title" content="Operating System Chapter11 æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹" />
<meta property="og:description" content="Operating System $Nanjing\ University\rightarrow Yanyan\ Jiang\newline$ Overview å¤ä¹  æ“ä½œç³»ç»Ÿå†…æ ¸çš„å¯åŠ¨ï¼šCPU Reset â†’ Firmware â†’ Boot loader â†’ Kernel _start() â†’ &hellip; æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜ Q1: æ“ä½œç³»ç»Ÿå¯åŠ¨ååˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ Q2: æ“ä½œç³»ç»Ÿå¦‚ä½•ç®¡ç†ç¨‹åº (è¿›ç¨‹" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Jungle430.github.io/posts/operating-system/operating-system-chapter11/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-03T15:41:15+08:00" />
<meta property="article:modified_time" content="2023-05-03T15:41:15+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Operating System Chapter11 æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹"/>
<meta name="twitter:description" content="Operating System $Nanjing\ University\rightarrow Yanyan\ Jiang\newline$ Overview å¤ä¹  æ“ä½œç³»ç»Ÿå†…æ ¸çš„å¯åŠ¨ï¼šCPU Reset â†’ Firmware â†’ Boot loader â†’ Kernel _start() â†’ &hellip; æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜ Q1: æ“ä½œç³»ç»Ÿå¯åŠ¨ååˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ Q2: æ“ä½œç³»ç»Ÿå¦‚ä½•ç®¡ç†ç¨‹åº (è¿›ç¨‹"/>
<meta name="application-name" content="Jungle&#39;s blog">
<meta name="apple-mobile-web-app-title" content="Jungle&#39;s blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://Jungle430.github.io/posts/operating-system/operating-system-chapter11/" /><link rel="prev" href="https://Jungle430.github.io/posts/operating-system/support3/" /><link rel="stylesheet" href="/css/page.min.css"><link rel="stylesheet" href="/css/home.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Operating System Chapter11 æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/Jungle430.github.io\/posts\/operating-system\/operating-system-chapter11\/"
        },"genre": "posts","keywords": "Operating System","wordcount":  6932 ,
        "url": "https:\/\/Jungle430.github.io\/posts\/operating-system\/operating-system-chapter11\/","datePublished": "2023-05-03T15:41:15+08:00","dateModified": "2023-05-03T15:41:15+08:00","publisher": {
            "@type": "Organization",
            "name": "Jungle"},"author": {
                "@type": "Person",
                "name": "Jungle"
            },"description": ""
    }
    </script></head><body data-header-desktop="fixed" data-header-mobile="auto"><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Jungle&#39;s Blog">Jungle&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/">ğŸ“š æ–‡ç«  </a><a class="menu-item" href="/tags/">ğŸ·ï¸ æ ‡ç­¾ </a><a class="menu-item" href="/categories/">ğŸ—ƒï¸ åˆ†ç±» </a><a class="menu-item" href="/about/">ğŸ‘´ å…³äº </a><a class="menu-item" href="https://github.com/Jungle430" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-desktop">
                        <a href="#" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Jungle&#39;s Blog">Jungle&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-mobile">
                        <a href="#" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="#" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="">ğŸ“šæ–‡ç« </a><a class="menu-item" href="/tags/" title="">ğŸ·ï¸æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">ğŸ—ƒï¸åˆ†ç±»</a><a class="menu-item" href="/about/" title="">ğŸ‘´å…³äº</a><a class="menu-item" href="https://github.com/Jungle430" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><div class="menu-item"><a href="javascript:void(0);" class="theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div></div>
    </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single" data-toc="enable"><div class="single-card" ><h2 class="single-title animated flipInX">Operating System Chapter11 æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹</h2><div class="post-meta">
                <div class="post-meta-line"><span class="post-author"><a href="https://github.com/Jungle430" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Jungle</a></span>&nbsp;<span class="post-category">å‡ºç‰ˆäº  <a href="/categories/operating-system/"><i class="far fa-folder fa-fw"></i>Operating System</a></span></div>
                <div class="post-meta-line"><span><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2023-05-03">2023-05-03</time></span>&nbsp;<span><i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 6932 å­—</span>&nbsp;
                    <span><i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 14 åˆ†é’Ÿ</span>&nbsp;</div>
            </div>
            
            <hr><div class="details toc" id="toc-static"  data-kept="">
                    <div class="details-summary toc-title">
                        <span>ç›®å½•</span>
                        <span><i class="details-icon fas fa-angle-right"></i></span>
                    </div>
                    <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#æ“ä½œç³»ç»Ÿå¯åŠ¨ååˆ°åº•åšäº†ä»€ä¹ˆ">æ“ä½œç³»ç»Ÿå¯åŠ¨ååˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ</a>
      <ul>
        <li><a href="#ä»ç³»ç»Ÿå¯åŠ¨åˆ°ç¬¬ä¸€ä¸ªè¿›ç¨‹">ä»ç³»ç»Ÿå¯åŠ¨åˆ°ç¬¬ä¸€ä¸ªè¿›ç¨‹</a></li>
        <li><a href="#å®šåˆ¶æœ€å°çš„-linux">å®šåˆ¶æœ€å°çš„ Linux</a></li>
        <li><a href="#å˜é­”æœ¯æ—¶é—´åˆ°">å˜é­”æœ¯æ—¶é—´åˆ°</a></li>
        <li><a href="#ä¾‹å­noilinux-lite">ä¾‹å­ï¼šNOILinux-lite</a></li>
        <li><a href="#å°ç»“åº”ç”¨ç¨‹åºè§†è§’çš„æ“ä½œç³»ç»Ÿ">å°ç»“ï¼šåº”ç”¨ç¨‹åºè§†è§’çš„æ“ä½œç³»ç»Ÿ</a></li>
      </ul>
    </li>
    <li><a href="#fork">fork()</a>
      <ul>
        <li><a href="#æ“ä½œç³»ç»ŸçŠ¶æ€æœºçš„ç®¡ç†è€…">æ“ä½œç³»ç»Ÿï¼šçŠ¶æ€æœºçš„ç®¡ç†è€…</a></li>
        <li><a href="#çŠ¶æ€æœºç®¡ç†åˆ›å»ºçŠ¶æ€æœº">çŠ¶æ€æœºç®¡ç†ï¼šåˆ›å»ºçŠ¶æ€æœº</a></li>
        <li><a href="#fork-bomb">Fork Bomb</a></li>
        <li><a href="#ä»£ç è§£æ-fork-bomb">ä»£ç è§£æ: Fork Bomb</a></li>
        <li><a href="#è¿™æ¬¡ä½ ä»¬è®°ä½-fork-äº†">è¿™æ¬¡ä½ ä»¬è®°ä½ Fork äº†ï¼</a></li>
        <li><a href="#ç†è§£-fork-ä¹ é¢˜-1">ç†è§£ fork: ä¹ é¢˜ (1)</a></li>
        <li><a href="#ç†è§£-fork-ä¹ é¢˜-2">ç†è§£ fork: ä¹ é¢˜ (2)</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
                </div><div class="content" id="content"><h1 id="operating-system">Operating System</h1>
<p>$Nanjing\ University\rightarrow Yanyan\ Jiang\newline$</p>
<h2 id="overview">Overview</h2>
<ul>
<li>
<p>å¤ä¹ </p>
<ul>
<li>æ“ä½œç³»ç»Ÿå†…æ ¸çš„å¯åŠ¨ï¼š<code>CPU Reset</code> â†’ <code>Firmware</code> â†’ <code>Boot loader</code> â†’ <code>Kernel _start()</code> â†’ &hellip;</li>
</ul>
</li>
<li>
<p>æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜</p>
<ul>
<li>
<p><code>Q1</code>: æ“ä½œç³»ç»Ÿå¯åŠ¨ååˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ</p>
</li>
<li>
<p><code>Q2</code>: æ“ä½œç³»ç»Ÿå¦‚ä½•ç®¡ç†ç¨‹åº (è¿›ç¨‹)ï¼Ÿ</p>
</li>
</ul>
</li>
<li>
<p>æœ¬æ¬¡è¯¾ä¸»è¦å†…å®¹</p>
<ul>
<li>
<p>è™šæ‹ŸåŒ–ï¼šæ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹</p>
</li>
<li>
<p>è¿›ç¨‹ç®¡ç† <code>API</code></p>
</li>
</ul>
</li>
</ul>
<h2 id="æ“ä½œç³»ç»Ÿå¯åŠ¨ååˆ°åº•åšäº†ä»€ä¹ˆ">æ“ä½œç³»ç»Ÿå¯åŠ¨ååˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ</h2>
<h3 id="ä»ç³»ç»Ÿå¯åŠ¨åˆ°ç¬¬ä¸€ä¸ªè¿›ç¨‹">ä»ç³»ç»Ÿå¯åŠ¨åˆ°ç¬¬ä¸€ä¸ªè¿›ç¨‹</h3>
<ul>
<li>å›é¡¾ <a href="https://jyywiki.cn/pages/OS/2022/demos/thread-os.c" target="_blank" rel="noopener noreffer">thread-os.c</a> çš„åŠ è½½è¿‡ç¨‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;am.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;klib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;klib-macros.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define MAX_CPU 8
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">union</span> <span class="n">task</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">union</span> <span class="n">task</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span>      <span class="p">(</span><span class="o">*</span><span class="n">entry</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Context</span>    <span class="o">*</span><span class="n">context</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="kt">uint8_t</span> <span class="n">stack</span><span class="p">[</span><span class="mi">8192</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">Task</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Task</span> <span class="o">*</span><span class="n">currents</span><span class="p">[</span><span class="n">MAX_CPU</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="cp">#define current currents[cpu_current()]
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// user-defined tasks
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">locked</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">lock</span><span class="p">()</span>   <span class="p">{</span> <span class="k">while</span> <span class="p">(</span><span class="n">atomic_xchg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">locked</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">unlock</span><span class="p">()</span> <span class="p">{</span> <span class="n">atomic_xchg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">locked</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">func</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">lock</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Thread-%s on CPU #%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">cpu_current</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">unlock</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="k">volatile</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Task</span> <span class="n">tasks</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="p">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">func</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;B&#34;</span><span class="p">,</span> <span class="p">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">func</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;C&#34;</span><span class="p">,</span> <span class="p">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">func</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;D&#34;</span><span class="p">,</span> <span class="p">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">func</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;E&#34;</span><span class="p">,</span> <span class="p">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">func</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">Context</span> <span class="o">*</span><span class="nf">on_interrupt</span><span class="p">(</span><span class="n">Event</span> <span class="n">ev</span><span class="p">,</span> <span class="n">Context</span> <span class="o">*</span><span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">extern</span> <span class="n">Task</span> <span class="n">tasks</span><span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">current</span><span class="p">)</span> <span class="n">current</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tasks</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>          <span class="n">current</span><span class="o">-&gt;</span><span class="n">context</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">while</span> <span class="p">((</span><span class="n">current</span> <span class="o">-</span> <span class="n">tasks</span><span class="p">)</span> <span class="o">%</span> <span class="n">cpu_count</span><span class="p">()</span> <span class="o">!=</span> <span class="n">cpu_current</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">context</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">mp_entry</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">iset</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">yield</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">cte_init</span><span class="p">(</span><span class="n">on_interrupt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">LENGTH</span><span class="p">(</span><span class="n">tasks</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Task</span> <span class="o">*</span><span class="n">task</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">Area</span> <span class="n">stack</span>    <span class="o">=</span> <span class="p">(</span><span class="n">Area</span><span class="p">)</span> <span class="p">{</span> <span class="o">&amp;</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">context</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">task</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">task</span><span class="o">-&gt;</span><span class="n">context</span> <span class="o">=</span> <span class="n">kcontext</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">task</span><span class="o">-&gt;</span><span class="n">entry</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">task</span><span class="o">-&gt;</span><span class="n">next</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tasks</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">LENGTH</span><span class="p">(</span><span class="n">tasks</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">mpe_init</span><span class="p">(</span><span class="n">mp_entry</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ“ä½œç³»ç»Ÿä¼šåŠ è½½ â€œç¬¬ä¸€ä¸ªç¨‹åºâ€
<ul>
<li><code>RTFSC</code> (<code>latest Linux Kernel</code>)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">try_to_run_init_process</span><span class="p">(</span><span class="s">&#34;/sbin/init&#34;</span><span class="p">)</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">      <span class="o">!</span><span class="n">try_to_run_init_process</span><span class="p">(</span><span class="s">&#34;/etc/init&#34;</span><span class="p">)</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">      <span class="o">!</span><span class="n">try_to_run_init_process</span><span class="p">(</span><span class="s">&#34;/bin/init&#34;</span><span class="p">)</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">      <span class="o">!</span><span class="n">try_to_run_init_process</span><span class="p">(</span><span class="s">&#34;/bin/sh&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">panic</span><span class="p">(</span><span class="s">&#34;No working init found.  Try passing init= option to kernel. &#34;</span>
</span></span><span class="line"><span class="cl">	      <span class="s">&#34;See Linux Documentation/admin-guide/init.rst for guidance.&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>$\uparrow$å¦‚æœæ²¡æœ‰æŒ‡å®šå¯åŠ¨é€‰é¡¹ <code>init=</code>ï¼ŒæŒ‰ç…§ â€œé»˜è®¤åˆ—è¡¨â€ å°è¯•ä¸€éï¼Œå¦‚æœéƒ½ä¸è¡Œï¼Œå†…æ ¸å°±æ‹’ç»å¯åŠ¨(<code>panic</code>çš„éƒ¨åˆ†)</li>
<li><b>ä»æ­¤ä»¥åï¼Œ<code>Linux Kernel</code> å°±è¿›å…¥åå°ï¼Œæˆä¸º â€œä¸­æ–­/å¼‚å¸¸å¤„ç†ç¨‹åºâ€</b></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>jungleã‰¿LAPTOP-A7S3TAA4<span class="o">)</span>-<span class="o">[</span>/mnt/d/work <span class="k">for</span> vscode/chapter11<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ pstree             
</span></span><span class="line"><span class="cl">init<span class="o">(</span>Ubuntu-22.â”€â”¬â”€SessionLeaderâ”€â”€â”€Relay<span class="o">(</span>55<span class="o">)</span>â”€â”€â”€shâ”€â”€â”€shâ”€â”€â”€shâ”€â”€â”€nodeâ”€â”¬â”€nodeâ”€â”¬â”€zshâ”€â”€â”€pstree
</span></span><span class="line"><span class="cl">                â”‚                                                 â”‚      â””â”€11*<span class="o">[{</span>node<span class="o">}]</span>
</span></span><span class="line"><span class="cl">                â”‚                                                 â”œâ”€nodeâ”€â”¬â”€clangd.mainâ”€â”€â”€9*<span class="o">[{</span>clangd.main<span class="o">}]</span>
</span></span><span class="line"><span class="cl">                â”‚                                                 â”‚      â”œâ”€nodeâ”€â”€â”€6*<span class="o">[{</span>node<span class="o">}]</span>
</span></span><span class="line"><span class="cl">                â”‚                                                 â”‚      â”œâ”€nodeâ”€â”€â”€7*<span class="o">[{</span>node<span class="o">}]</span>
</span></span><span class="line"><span class="cl">                â”‚                                                 â”‚      â””â”€11*<span class="o">[{</span>node<span class="o">}]</span>
</span></span><span class="line"><span class="cl">                â”‚                                                 â”œâ”€nodeâ”€â”€â”€12*<span class="o">[{</span>node<span class="o">}]</span>
</span></span><span class="line"><span class="cl">                â”‚                                                 â””â”€10*<span class="o">[{</span>node<span class="o">}]</span>
</span></span><span class="line"><span class="cl">                â”œâ”€SessionLeaderâ”€â”€â”€Relay<span class="o">(</span>486<span class="o">)</span>â”€â”€â”€nodeâ”€â”€â”€6*<span class="o">[{</span>node<span class="o">}]</span>
</span></span><span class="line"><span class="cl">                â”œâ”€SessionLeaderâ”€â”€â”€Relay<span class="o">(</span>495<span class="o">)</span>â”€â”€â”€nodeâ”€â”€â”€6*<span class="o">[{</span>node<span class="o">}]</span>
</span></span><span class="line"><span class="cl">                â”œâ”€initâ”€â”€â”€<span class="o">{</span>init<span class="o">}</span>
</span></span><span class="line"><span class="cl">                â””â”€<span class="o">{</span>init<span class="o">(</span>Ubuntu-22.<span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>$\uparrow$ä¸Šé¢æ˜¯<code>wsl</code>çš„ï¼Œå’ŒçœŸæœºå¯åŠ¨æ–¹å¼ä¸å¤ªä¸€æ ·</li>
<li>æ‰¾äº†ä¸€å°<code>Ubuntu</code>è™šæ‹Ÿæœºï¼Œè¿™å›ä¸€æ ·äº†</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemdâ”€â”¬â”€ModemManagerâ”€â”€â”€2*<span class="o">[{</span>ModemManager<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€NetworkManagerâ”€â”€â”€2*<span class="o">[{</span>NetworkManager<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€ToDesk_Serviceâ”€â”€â”€13*<span class="o">[{</span>ToDesk_Service<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€VGAuthService
</span></span><span class="line"><span class="cl">        â”œâ”€accounts-daemonâ”€â”€â”€2*<span class="o">[{</span>accounts-daemon<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€acpid
</span></span><span class="line"><span class="cl">        â”œâ”€anacron
</span></span><span class="line"><span class="cl">        â”œâ”€avahi-daemonâ”€â”€â”€avahi-daemon
</span></span><span class="line"><span class="cl">        â”œâ”€bluetoothd
</span></span><span class="line"><span class="cl">        â”œâ”€colordâ”€â”€â”€2*<span class="o">[{</span>colord<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€cron
</span></span><span class="line"><span class="cl">        â”œâ”€cups-browsedâ”€â”€â”€2*<span class="o">[{</span>cups-browsed<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€cupsd
</span></span><span class="line"><span class="cl">        â”œâ”€dbus-daemon
</span></span><span class="line"><span class="cl">        â”œâ”€dockerdâ”€â”¬â”€containerdâ”€â”€â”€7*<span class="o">[{</span>containerd<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â””â”€8*<span class="o">[{</span>dockerd<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€fwupdâ”€â”€â”€4*<span class="o">[{</span>fwupd<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€gdm3â”€â”¬â”€gdm-session-worâ”€â”¬â”€gdm-wayland-sesâ”€â”¬â”€gnome-session-bâ”€â”€â”€2*<span class="o">[{</span>gnome-session-b<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚      â”‚                 â”‚                 â””â”€2*<span class="o">[{</span>gdm-wayland-ses<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚      â”‚                 â””â”€2*<span class="o">[{</span>gdm-session-wor<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚      â””â”€2*<span class="o">[{</span>gdm3<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€geoclueâ”€â”€â”€2*<span class="o">[{</span>geoclue<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€gnome-keyring-dâ”€â”€â”€3*<span class="o">[{</span>gnome-keyring-d<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€irqbalanceâ”€â”€â”€<span class="o">{</span>irqbalance<span class="o">}</span>
</span></span><span class="line"><span class="cl">        â”œâ”€2*<span class="o">[</span>kerneloops<span class="o">]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€networkd-dispat
</span></span><span class="line"><span class="cl">        â”œâ”€packagekitdâ”€â”€â”€2*<span class="o">[{</span>packagekitd<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€polkitdâ”€â”€â”€2*<span class="o">[{</span>polkitd<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€power-profiles-â”€â”€â”€2*<span class="o">[{</span>power-profiles-<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€rsyslogdâ”€â”€â”€3*<span class="o">[{</span>rsyslogd<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€rtkit-daemonâ”€â”€â”€2*<span class="o">[{</span>rtkit-daemon<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€snapdâ”€â”€â”€12*<span class="o">[{</span>snapd<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€switcheroo-contâ”€â”€â”€2*<span class="o">[{</span>switcheroo-cont<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€systemdâ”€â”¬â”€<span class="o">(</span>sd-pam<span class="o">)</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€at-spi2-registrâ”€â”€â”€2*<span class="o">[{</span>at-spi2-registr<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€dbus-daemon
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€dconf-serviceâ”€â”€â”€2*<span class="o">[{</span>dconf-service<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€evolution-addreâ”€â”€â”€5*<span class="o">[{</span>evolution-addre<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€evolution-calenâ”€â”€â”€8*<span class="o">[{</span>evolution-calen<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€evolution-sourcâ”€â”€â”€3*<span class="o">[{</span>evolution-sourc<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€2*<span class="o">[</span>gjsâ”€â”€â”€4*<span class="o">[{</span>gjs<span class="o">}]]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gnome-session-bâ”€â”¬â”€at-spi-bus-launâ”€â”¬â”€dbus-daemon
</span></span><span class="line"><span class="cl">        â”‚         â”‚                 â”‚                 â””â”€3*<span class="o">[{</span>at-spi-bus-laun<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”‚                 â”œâ”€evolution-alarmâ”€â”€â”€5*<span class="o">[{</span>evolution-alarm<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”‚                 â”œâ”€gsd-disk-utilitâ”€â”€â”€2*<span class="o">[{</span>gsd-disk-utilit<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”‚                 â”œâ”€update-notifierâ”€â”€â”€3*<span class="o">[{</span>update-notifier<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”‚                 â””â”€3*<span class="o">[{</span>gnome-session-b<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gnome-session-câ”€â”€â”€<span class="o">{</span>gnome-session-c<span class="o">}</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gnome-shellâ”€â”¬â”€Xwayland
</span></span><span class="line"><span class="cl">        â”‚         â”‚             â”œâ”€gjsâ”€â”€â”€5*<span class="o">[{</span>gjs<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”‚             â””â”€9*<span class="o">[{</span>gnome-shell<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gnome-shell-calâ”€â”€â”€5*<span class="o">[{</span>gnome-shell-cal<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gnome-terminal-â”€â”¬â”€bashâ”€â”€â”€pstree
</span></span><span class="line"><span class="cl">        â”‚         â”‚                 â””â”€3*<span class="o">[{</span>gnome-terminal-<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€goa-daemonâ”€â”€â”€3*<span class="o">[{</span>goa-daemon<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€goa-identity-seâ”€â”€â”€2*<span class="o">[{</span>goa-identity-se<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-a11y-settinâ”€â”€â”€3*<span class="o">[{</span>gsd-a11y-settin<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-colorâ”€â”€â”€3*<span class="o">[{</span>gsd-color<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-datetimeâ”€â”€â”€3*<span class="o">[{</span>gsd-datetime<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-housekeepinâ”€â”€â”€3*<span class="o">[{</span>gsd-housekeepin<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-keyboardâ”€â”€â”€3*<span class="o">[{</span>gsd-keyboard<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-media-keysâ”€â”€â”€3*<span class="o">[{</span>gsd-media-keys<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-powerâ”€â”€â”€3*<span class="o">[{</span>gsd-power<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-print-notifâ”€â”€â”€2*<span class="o">[{</span>gsd-print-notif<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-printerâ”€â”€â”€2*<span class="o">[{</span>gsd-printer<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-rfkillâ”€â”€â”€2*<span class="o">[{</span>gsd-rfkill<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-screensaverâ”€â”€â”€2*<span class="o">[{</span>gsd-screensaver<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-sharingâ”€â”€â”€3*<span class="o">[{</span>gsd-sharing<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-smartcardâ”€â”€â”€3*<span class="o">[{</span>gsd-smartcard<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-soundâ”€â”€â”€3*<span class="o">[{</span>gsd-sound<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-wacomâ”€â”€â”€3*<span class="o">[{</span>gsd-wacom<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gsd-xsettingsâ”€â”€â”€3*<span class="o">[{</span>gsd-xsettings<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gvfs-afc-volumeâ”€â”€â”€3*<span class="o">[{</span>gvfs-afc-volume<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gvfs-goa-volumeâ”€â”€â”€2*<span class="o">[{</span>gvfs-goa-volume<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gvfs-gphoto2-voâ”€â”€â”€2*<span class="o">[{</span>gvfs-gphoto2-vo<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gvfs-mtp-volumeâ”€â”€â”€2*<span class="o">[{</span>gvfs-mtp-volume<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gvfs-udisks2-voâ”€â”€â”€3*<span class="o">[{</span>gvfs-udisks2-vo<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gvfsdâ”€â”¬â”€gvfsd-trashâ”€â”€â”€2*<span class="o">[{</span>gvfsd-trash<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”‚       â””â”€2*<span class="o">[{</span>gvfsd<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gvfsd-fuseâ”€â”€â”€5*<span class="o">[{</span>gvfsd-fuse<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€gvfsd-metadataâ”€â”€â”€2*<span class="o">[{</span>gvfsd-metadata<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€ibus-portalâ”€â”€â”€2*<span class="o">[{</span>ibus-portal<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€ibus-x11â”€â”€â”€2*<span class="o">[{</span>ibus-x11<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€pipewireâ”€â”€â”€<span class="o">{</span>pipewire<span class="o">}</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€pipewire-media-â”€â”€â”€<span class="o">{</span>pipewire-media-<span class="o">}</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€pulseaudioâ”€â”€â”€3*<span class="o">[{</span>pulseaudio<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€shâ”€â”€â”€ibus-daemonâ”€â”¬â”€ibus-engine-libâ”€â”€â”€3*<span class="o">[{</span>ibus-engine-lib<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”‚                  â”œâ”€ibus-extension-â”€â”€â”€3*<span class="o">[{</span>ibus-extension-<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”‚                  â”œâ”€ibus-memconfâ”€â”€â”€2*<span class="o">[{</span>ibus-memconf<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”‚                  â””â”€2*<span class="o">[{</span>ibus-daemon<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€snap-storeâ”€â”€â”€6*<span class="o">[{</span>snap-store<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€snapd-desktop-iâ”€â”€â”€snapd-desktop-iâ”€â”€â”€3*<span class="o">[{</span>snapd-desktop-i<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€tracker-miner-fâ”€â”€â”€5*<span class="o">[{</span>tracker-miner-f<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€vmtoolsdâ”€â”€â”€3*<span class="o">[{</span>vmtoolsd<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€xdg-desktop-porâ”€â”€â”€5*<span class="o">[{</span>xdg-desktop-por<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€2*<span class="o">[</span>xdg-desktop-porâ”€â”€â”€3*<span class="o">[{</span>xdg-desktop-por<span class="o">}]]</span>
</span></span><span class="line"><span class="cl">        â”‚         â”œâ”€xdg-document-poâ”€â”¬â”€fusermount3
</span></span><span class="line"><span class="cl">        â”‚         â”‚                 â””â”€5*<span class="o">[{</span>xdg-document-po<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”‚         â””â”€xdg-permission-â”€â”€â”€2*<span class="o">[{</span>xdg-permission-<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€systemd-journal
</span></span><span class="line"><span class="cl">        â”œâ”€systemd-logind
</span></span><span class="line"><span class="cl">        â”œâ”€systemd-oomd
</span></span><span class="line"><span class="cl">        â”œâ”€systemd-resolve
</span></span><span class="line"><span class="cl">        â”œâ”€systemd-timesynâ”€â”€â”€<span class="o">{</span>systemd-timesyn<span class="o">}</span>
</span></span><span class="line"><span class="cl">        â”œâ”€systemd-udevd
</span></span><span class="line"><span class="cl">        â”œâ”€udisksdâ”€â”€â”€4*<span class="o">[{</span>udisksd<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€unattended-upgrâ”€â”€â”€<span class="o">{</span>unattended-upgr<span class="o">}</span>
</span></span><span class="line"><span class="cl">        â”œâ”€upowerdâ”€â”€â”€2*<span class="o">[{</span>upowerd<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€vmtoolsdâ”€â”€â”€3*<span class="o">[{</span>vmtoolsd<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â”œâ”€vmware-vmblock-â”€â”€â”€2*<span class="o">[{</span>vmware-vmblock-<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        â””â”€wpa_supplicant
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><b>æ“ä½œç³»ç»Ÿåªåˆ›å»ºæ ‘æ ¹ä¸Šé¢çš„è¿›ç¨‹ï¼Œå‰©ä¸‹æ‰€æœ‰çš„è¿›ç¨‹éƒ½æ˜¯ç”±æ ‘æ ¹ä¸Šçš„è¿›ç¨‹åˆ›å»ºçš„</b></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>jungleã‰¿LAPTOP-A7S3TAA4<span class="o">)</span>-<span class="o">[</span>/mnt/d/work <span class="k">for</span> vscode/chapter11<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ ls /sbin/init -l
</span></span><span class="line"><span class="cl">lrwxrwxrwx <span class="m">1</span> root root <span class="m">20</span> Sep <span class="m">10</span>  <span class="m">2022</span> /sbin/init -&gt; /lib/systemd/systemd
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>jungleã‰¿LAPTOP-A7S3TAA4<span class="o">)</span>-<span class="o">[</span>/mnt/d/work <span class="k">for</span> vscode/chapter11<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ ls /etc/init.d -l
</span></span><span class="line"><span class="cl">total <span class="m">88</span>
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">3740</span> Feb <span class="m">23</span>  <span class="m">2022</span> apparmor
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">2915</span> May <span class="m">10</span>  <span class="m">2022</span> apport
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">1175</span> Dec <span class="m">26</span>  <span class="m">2021</span> binfmt-support
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">1232</span> Nov <span class="m">23</span>  <span class="m">2021</span> console-setup.sh
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">3062</span> Mar <span class="m">18</span>  <span class="m">2021</span> cron
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">3152</span> Jun <span class="m">28</span>  <span class="m">2021</span> dbus
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">1748</span> Feb <span class="m">21</span>  <span class="m">2022</span> hwclock.sh
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">2638</span> Oct <span class="m">30</span>  <span class="m">2021</span> irqbalance
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">1479</span> Jul <span class="m">24</span>  <span class="m">2021</span> keyboard-setup.sh
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">2044</span> Jan  <span class="m">8</span>  <span class="m">2021</span> kmod
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">1386</span> Feb <span class="m">23</span>  <span class="m">2022</span> plymouth
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root  <span class="m">760</span> Feb <span class="m">23</span>  <span class="m">2022</span> plymouth-log
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root  <span class="m">959</span> Feb <span class="m">25</span>  <span class="m">2022</span> procps
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">4417</span> Oct <span class="m">12</span>  <span class="m">2022</span> rsync
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">1222</span> Feb <span class="m">18</span>  <span class="m">2021</span> screen-cleanup
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">6871</span> Mar  <span class="m">8</span>  <span class="m">2022</span> udev
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">2083</span> Sep <span class="m">19</span>  <span class="m">2021</span> ufw
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">1391</span> Feb <span class="m">19</span>  <span class="m">2021</span> unattended-upgrades
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">1306</span> Feb <span class="m">21</span>  <span class="m">2022</span> uuidd
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">2762</span> Oct <span class="m">19</span>  <span class="m">2021</span> x11-common
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>jungleã‰¿LAPTOP-A7S3TAA4<span class="o">)</span>-<span class="o">[</span>/mnt/d/work <span class="k">for</span> vscode/chapter11<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ ls /bin/sh -l
</span></span><span class="line"><span class="cl">lrwxrwxrwx <span class="m">1</span> root root <span class="m">4</span> Feb <span class="m">11</span> 05:35 /bin/sh -&gt; dash
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>ç¨‹åºï¼šçŠ¶æ€æœº</p>
<ul>
<li>
<p>C ä»£ç è§†è§’ï¼šè¯­å¥</p>
</li>
<li>
<p>æ±‡ç¼–/æœºå™¨ä»£ç è§†è§’ï¼šæŒ‡ä»¤</p>
</li>
<li>
<p>ä¸æ“ä½œç³»ç»Ÿäº¤äº’çš„æ–¹å¼ï¼š<code>syscall</code></p>
</li>
</ul>
</li>
</ul>
<h3 id="å®šåˆ¶æœ€å°çš„-linux">å®šåˆ¶æœ€å°çš„ Linux</h3>
<ul>
<li>
<p>æ²¡æœ‰å­˜å‚¨è®¾å¤‡ï¼Œåªæœ‰åŒ…å«ä¸¤ä¸ªæ–‡ä»¶çš„ â€œ<code>initramfs</code>â€</p>
</li>
<li>
<p><a href="https://box.nju.edu.cn/f/3f67e092e1ba441187d9/?dl=1" target="_blank" rel="noopener noreffer">linux-minimal.zip</a></p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ tree .
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">â”œâ”€â”€ bin
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ busybox <span class="o">(</span>å¯ä»¥åœ¨æˆ‘ä»¬çš„Linuxé‡Œç›´æ¥æ‰§è¡Œ<span class="o">)</span>
</span></span><span class="line"><span class="cl">â””â”€â”€ init
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åŠ ä¸Š <code>vmlinuz</code> (å†…æ ¸é•œåƒ) å°±å¯ä»¥åœ¨ <code>QEMU</code> é‡Œå¯åŠ¨äº†</li>
</ul>
<hr>
<ul>
<li>
<p>å¯ä»¥ç›´æ¥åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ·»åŠ é™æ€é“¾æ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶</p>
<ul>
<li>
<p><a href="https://jyywiki.cn/pages/OS/2022/demos/minimal.S" target="_blank" rel="noopener noreffer">minimal.S</a></p>
</li>
<li>
<p><a href="https://jyywiki.cn/pages/OS/2022/demos/logisim.c" target="_blank" rel="noopener noreffer">logisim.c</a></p>
</li>
</ul>
</li>
<li>
<p><code>Makefile</code></p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">initramfs</span> <span class="n">run</span> <span class="n">clean</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">$(</span><span class="nv">shell</span> <span class="nv">mkdir</span> -<span class="nv">p</span> <span class="nv">build</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">initramfs</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	@cd initramfs <span class="o">&amp;&amp;</span> find . -print0 <span class="p">|</span> cpio --null -ov --format<span class="o">=</span>newc <span class="p">|</span> gzip -9 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	  &gt; ../build/initramfs.cpio.gz
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">run</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	@qemu-system-x86_64 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	  -nographic <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	  -serial mon:stdio <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	  -m <span class="m">128</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	  -kernel vmlinuz <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	  -initrd build/initramfs.cpio.gz <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	  -append <span class="s2">&#34;console=ttyS0 quiet acpi=off&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">clean</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	@rm -rf build
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å®‰è£…<code>qemu</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install qemu
</span></span><span class="line"><span class="cl">sudo apt-get install qemu-system
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¿è¡Œ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">make run
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>è¿›å…¥<code>qemu</code> $\rightarrow$ <code>Ctrl a; c</code></p>
</li>
<li>
<p>æŸ¥çœ‹çŠ¶æ€</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sh: can<span class="s1">&#39;t access tty; job control turned off
</span></span></span><span class="line"><span class="cl"><span class="s1">/ # QEMU 6.2.0 monitor - type &#39;</span>help<span class="err">&#39;</span> <span class="k">for</span> more information
</span></span><span class="line"><span class="cl"><span class="o">(</span>qemu<span class="o">)</span> info registers 
</span></span><span class="line"><span class="cl"><span class="nv">RAX</span><span class="o">=</span>0001a94000000000 <span class="nv">RBX</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="nv">RCX</span><span class="o">=</span><span class="m">0000000000000001</span> <span class="nv">RDX</span><span class="o">=</span>0000000000000ca2
</span></span><span class="line"><span class="cl"><span class="nv">RSI</span><span class="o">=</span><span class="m">0000000000000087</span> <span class="nv">RDI</span><span class="o">=</span><span class="m">0000000000000087</span> <span class="nv">RBP</span><span class="o">=</span>ffffffffa3c03e28 <span class="nv">RSP</span><span class="o">=</span>ffffffffa3c03e08
</span></span><span class="line"><span class="cl"><span class="nv">R8</span> <span class="o">=</span>ffff88a5c781df80 <span class="nv">R9</span> <span class="o">=</span><span class="m">0000000000000200</span> <span class="nv">R10</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="nv">R11</span><span class="o">=</span><span class="m">0000000000000000</span>
</span></span><span class="line"><span class="cl"><span class="nv">R12</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="nv">R13</span><span class="o">=</span>ffffffffa3c13780 <span class="nv">R14</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="nv">R15</span><span class="o">=</span><span class="m">0000000000000000</span>
</span></span><span class="line"><span class="cl"><span class="nv">RIP</span><span class="o">=</span>ffffffffa30d564e <span class="nv">RFL</span><span class="o">=</span><span class="m">00000246</span> <span class="o">[</span>---Z-P-<span class="o">]</span> <span class="nv">CPL</span><span class="o">=</span><span class="m">0</span> <span class="nv">II</span><span class="o">=</span><span class="m">0</span> <span class="nv">A20</span><span class="o">=</span><span class="m">1</span> <span class="nv">SMM</span><span class="o">=</span><span class="m">0</span> <span class="nv">HLT</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">ES</span> <span class="o">=</span><span class="m">0000</span> <span class="m">0000000000000000</span> <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl"><span class="nv">CS</span> <span class="o">=</span><span class="m">0010</span> <span class="m">0000000000000000</span> ffffffff 00af9b00 <span class="nv">DPL</span><span class="o">=</span><span class="m">0</span> CS64 <span class="o">[</span>-RA<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">SS</span> <span class="o">=</span><span class="m">0018</span> <span class="m">0000000000000000</span> ffffffff 00cf9300 <span class="nv">DPL</span><span class="o">=</span><span class="m">0</span> DS   <span class="o">[</span>-WA<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">DS</span> <span class="o">=</span><span class="m">0000</span> <span class="m">0000000000000000</span> <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl"><span class="nv">FS</span> <span class="o">=</span><span class="m">0000</span> <span class="m">0000000000000000</span> <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl"><span class="nv">GS</span> <span class="o">=</span><span class="m">0000</span> ffff88a5c7800000 <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl"><span class="nv">LDT</span><span class="o">=</span><span class="m">0000</span> <span class="m">0000000000000000</span> <span class="m">00000000</span> <span class="m">00008200</span> <span class="nv">DPL</span><span class="o">=</span><span class="m">0</span> LDT
</span></span><span class="line"><span class="cl"><span class="nv">TR</span> <span class="o">=</span><span class="m">0040</span> fffffe0000003000 0000206f <span class="m">00008900</span> <span class="nv">DPL</span><span class="o">=</span><span class="m">0</span> TSS64-avl
</span></span><span class="line"><span class="cl"><span class="nv">GDT</span><span class="o">=</span>     fffffe0000001000 0000007f
</span></span><span class="line"><span class="cl"><span class="nv">IDT</span><span class="o">=</span>     fffffe0000000000 00000fff
</span></span><span class="line"><span class="cl"><span class="nv">CR0</span><span class="o">=</span><span class="m">80050033</span> <span class="nv">CR2</span><span class="o">=</span>0000000000e22c18 <span class="nv">CR3</span><span class="o">=</span>0000000003ca8000 <span class="nv">CR4</span><span class="o">=</span>000006f0
</span></span><span class="line"><span class="cl"><span class="nv">DR0</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="nv">DR1</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="nv">DR2</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="nv">DR3</span><span class="o">=</span><span class="m">0000000000000000</span> 
</span></span><span class="line"><span class="cl"><span class="nv">DR6</span><span class="o">=</span>00000000ffff0ff0 <span class="nv">DR7</span><span class="o">=</span><span class="m">0000000000000400</span>
</span></span><span class="line"><span class="cl"><span class="nv">EFER</span><span class="o">=</span>0000000000000d01
</span></span><span class="line"><span class="cl"><span class="nv">FCW</span><span class="o">=</span>037f <span class="nv">FSW</span><span class="o">=</span><span class="m">0000</span> <span class="o">[</span><span class="nv">ST</span><span class="o">=</span>0<span class="o">]</span> <span class="nv">FTW</span><span class="o">=</span><span class="m">00</span> <span class="nv">MXCSR</span><span class="o">=</span>00001f80
</span></span><span class="line"><span class="cl"><span class="nv">FPR0</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000</span> <span class="nv">FPR1</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000</span>
</span></span><span class="line"><span class="cl"><span class="nv">FPR2</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000</span> <span class="nv">FPR3</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000</span>
</span></span><span class="line"><span class="cl"><span class="nv">FPR4</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000</span> <span class="nv">FPR5</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000</span>
</span></span><span class="line"><span class="cl"><span class="nv">FPR6</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000</span> <span class="nv">FPR7</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000</span>
</span></span><span class="line"><span class="cl"><span class="nv">XMM00</span><span class="o">=</span>0000000000e20450 <span class="m">0000000000000400</span> <span class="nv">XMM01</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000000000000000</span>
</span></span><span class="line"><span class="cl"><span class="nv">XMM02</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000000000000000</span> <span class="nv">XMM03</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000000000000000</span>
</span></span><span class="line"><span class="cl"><span class="nv">XMM04</span><span class="o">=</span>ffffffffffffffff ffffffff00000000 <span class="nv">XMM05</span><span class="o">=</span><span class="m">0000000048094038</span> <span class="m">3028201810080072</span>
</span></span><span class="line"><span class="cl"><span class="nv">XMM06</span><span class="o">=</span>0000000000ff0000 000000ff00000000 <span class="nv">XMM07</span><span class="o">=</span><span class="m">0000000400000004</span> <span class="m">0000000400000004</span>
</span></span><span class="line"><span class="cl"><span class="nv">XMM08</span><span class="o">=</span>00000000008d93e0 00000000008d93e0 <span class="nv">XMM09</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000000000000000</span>
</span></span><span class="line"><span class="cl"><span class="nv">XMM10</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000000000000000</span> <span class="nv">XMM11</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000000000000000</span>
</span></span><span class="line"><span class="cl"><span class="nv">XMM12</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000000000000000</span> <span class="nv">XMM13</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000000000000000</span>
</span></span><span class="line"><span class="cl"><span class="nv">XMM14</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000000000000000</span> <span class="nv">XMM15</span><span class="o">=</span><span class="m">0000000000000000</span> <span class="m">0000000000000000</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å˜é­”æœ¯æ—¶é—´åˆ°">å˜é­”æœ¯æ—¶é—´åˆ°</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">c1</span><span class="o">=</span><span class="s2">&#34;arch ash base64 cat chattr chgrp chmod chown conspy cp cpio cttyhack date dd df dmesg dnsdomainname dumpkmap echo ed egrep false fatattr fdflush fgrep fsync getopt grep gunzip gzip hostname hush ionice iostat ipcalc kbd_mode kill link linux32 linux64 ln login ls lsattr lzop makemime mkdir mknod mktemp more mount mountpoint mpstat mt mv netstat nice nuke pidof ping ping6 pipe_progress printenv ps pwd reformime resume rev rm rmdir rpm run-parts scriptreplay sed setarch setpriv setserial sh sleep stat stty su sync tar touch true umount uname usleep vi watch zcat&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">c2</span><span class="o">=</span><span class="s2">&#34;[ [[ awk basename bc beep blkdiscard bunzip2 bzcat bzip2 cal chpst chrt chvt cksum clear cmp comm crontab cryptpw cut dc deallocvt diff dirname dos2unix dpkg dpkg-deb du dumpleases eject env envdir envuidgid expand expr factor fallocate fgconsole find flock fold free ftpget ftpput fuser groups hd head hexdump hexedit hostid id install ipcrm ipcs killall last less logger logname lpq lpr lsof lspci lsscsi lsusb lzcat lzma man md5sum mesg microcom mkfifo mkpasswd nc nl nmeter nohup nproc nsenter nslookup od openvt passwd paste patch pgrep pkill pmap printf pscan&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">c3</span><span class="o">=</span><span class="s2">&#34;pstree pwdx readlink realpath renice reset resize rpm2cpio runsv runsvdir rx script seq setfattr setkeycodes setsid setuidgid sha1sum sha256sum sha3sum sha512sum showkey shred shuf smemcap softlimit sort split ssl_client strings sum sv svc svok tac tail taskset tcpsvd tee telnet test tftp time timeout top tr traceroute traceroute6 truncate ts tty ttysize udhcpc6 udpsvd unexpand uniq unix2dos unlink unlzma unshare unxz unzip uptime users uudecode uuencode vlock volname w wall wc wget which who whoami whois xargs xxd xz xzcat yes&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> cmd in <span class="nv">$c1</span> <span class="nv">$c2</span> <span class="nv">$c3</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  /bin/busybox ln -s /bin/busybox /bin/<span class="nv">$cmd</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span><span class="line"><span class="cl">mkdir -p /proc <span class="o">&amp;&amp;</span> mount -t proc  none /proc
</span></span><span class="line"><span class="cl">mkdir -p /sys  <span class="o">&amp;&amp;</span> mount -t sysfs none /sys
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PS1</span><span class="o">=</span><span class="s1">&#39;(linux) &#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¯•è¯• <code>adb shell</code> (<a href="https://landley.net/toybox/" target="_blank" rel="noopener noreffer">toybox</a>)</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter11-1.png" title="/img/Operating System/chapter11-1.png" data-thumbnail="/img/Operating System/chapter11-1.png" data-sub-html="<h2>åˆ›å»ºé“¾æ¥ï¼Œåˆ›å»ºç›®å½•ï¼ŒæŒ‚è½½äº†ä¸€äº›å†…æ ¸çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå°†æ“ä½œç³»ç»Ÿä¸€äº›å†…éƒ¨çŠ¶æ€æš´éœ²ç»™åº”ç”¨ç¨‹åº -&gt; å˜æˆlinux</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/chapter11-1.png"
            data-srcset="/img/Operating%20System/chapter11-1.png, /img/Operating%20System/chapter11-1.png 1.5x, /img/Operating%20System/chapter11-1.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/chapter11-1.png" />
    </a><figcaption class="image-caption"><code>åˆ›å»ºé“¾æ¥ï¼Œåˆ›å»ºç›®å½•ï¼ŒæŒ‚è½½äº†ä¸€äº›å†…æ ¸çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå°†æ“ä½œç³»ç»Ÿä¸€äº›å†…éƒ¨çŠ¶æ€æš´éœ²ç»™åº”ç”¨ç¨‹åº -&gt; å˜æˆlinux</code></figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter11-2.png" title="/img/Operating System/chapter11-2.png" data-thumbnail="/img/Operating System/chapter11-2.png" data-sub-html="<h2>å‘½ä»¤ä¹Ÿå¯ä»¥ç”¨</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/chapter11-2.png"
            data-srcset="/img/Operating%20System/chapter11-2.png, /img/Operating%20System/chapter11-2.png 1.5x, /img/Operating%20System/chapter11-2.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/chapter11-2.png" />
    </a><figcaption class="image-caption"><code>å‘½ä»¤ä¹Ÿå¯ä»¥ç”¨</code></figcaption>
    </figure>
<ul>
<li>è¿‡ç¨‹</li>
</ul>
<div class="mermaid" id="id-1"></div>
<h3 id="ä¾‹å­noilinux-lite">ä¾‹å­ï¼šNOILinux-lite</h3>
<ul>
<li>
<p>2021 å¹´ï¼Œ<code>CCF</code> ä»¥è¿…é›·ä¸åŠæ©è€³ç›—é“ƒä¹‹åŠ¿å‘å¸ƒäº† <code>NOILinux 2.0</code></p>
<ul>
<li>
<p><code>Ubuntu 20.04 Desktop (x86-64 only)</code></p>
</li>
<li>
<p>çœŸå°±ä¸ç®¡é‚£äº› <code>32-bit</code> çš„è€çˆ·æœºå’Œè€çˆ·ç³»ç»Ÿçš„æ­»æ´»äº†ï¼Ÿ</p>
</li>
</ul>
</li>
<li>
<p>å’Œåˆšæ‰çš„ â€œæœ€å°â€ ç³»ç»Ÿä½†æœ¬è´¨ä¸€æ ·</p>
<ul>
<li>
<p>æœ‰æ›´å¤šè®¾å¤‡ (ç£ç›˜ã€ç½‘å¡ç­‰)</p>
</li>
<li>
<p><code>initramfs</code> é‡ŒæŒ‚è½½äº†ç£ç›˜</p>
</li>
<li>
<p>ç£ç›˜é‡Œå®‰è£…äº†æœ€å°‘çš„ç¼–è¯‘è¿è¡Œç¯å¢ƒ (<code>g++, ...</code>) å’Œä¸€ä¸ª<code>Web</code>æœåŠ¡</p>
</li>
<li>
<p><code>switch_root</code> (<code>pivot_root</code> ç³»ç»Ÿè°ƒç”¨) å®Œæˆ â€œå¯åŠ¨â€</p>
</li>
</ul>
</li>
</ul>
<h3 id="å°ç»“åº”ç”¨ç¨‹åºè§†è§’çš„æ“ä½œç³»ç»Ÿ">å°ç»“ï¼šåº”ç”¨ç¨‹åºè§†è§’çš„æ“ä½œç³»ç»Ÿ</h3>
<ul>
<li><code>Linux</code> æ“ä½œç³»ç»Ÿå¯åŠ¨æµç¨‹
<ul>
<li><code>CPU Reset</code> â†’ <code>Firmware</code> â†’ <code>Loader</code> â†’<code> Kernel _start()</code> â†’ ç¬¬ä¸€ä¸ªç¨‹åº <code>/bin/init</code> â†’ ç¨‹åº (çŠ¶æ€æœº) æ‰§è¡Œ + ç³»ç»Ÿè°ƒç”¨</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>
<p>æ“ä½œç³»ç»Ÿä¸º (æ‰€æœ‰) ç¨‹åºæä¾› <code>API</code></p>
<ul>
<li>
<p>è¿›ç¨‹ (çŠ¶æ€æœº) ç®¡ç†</p>
<ul>
<li><b><font color="red"><code>fork, execve, exit</code> - çŠ¶æ€æœºçš„åˆ›å»º/æ”¹å˜/åˆ é™¤ â† ä»Šå¤©çš„ä¸»é¢˜</font></b></li>
</ul>
</li>
<li>
<p>å­˜å‚¨ï¼ˆå†…å­˜ï¼‰ (åœ°å€ç©ºé—´) ç®¡ç†</p>
<ul>
<li><code>mmap</code> - è™šæ‹Ÿåœ°å€ç©ºé—´ç®¡ç†</li>
</ul>
</li>
<li>
<p>æ–‡ä»¶ (æ•°æ®å¯¹è±¡) ç®¡ç†</p>
<ul>
<li><code>open, close, read, write</code> - æ–‡ä»¶è®¿é—®ç®¡ç†
<ul>
<li><code>mkdir, link, unlink</code> - ç›®å½•ç®¡ç†</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="fork">fork()</h2>
<h3 id="æ“ä½œç³»ç»ŸçŠ¶æ€æœºçš„ç®¡ç†è€…">æ“ä½œç³»ç»Ÿï¼šçŠ¶æ€æœºçš„ç®¡ç†è€…</h3>
<ul>
<li>
<p>C ç¨‹åº = çŠ¶æ€æœº</p>
<ul>
<li>
<p>åˆå§‹çŠ¶æ€ï¼š<code>main(argc, argv)</code></p>
</li>
<li>
<p>ç¨‹åºå¯ä»¥ç›´æ¥åœ¨å¤„ç†å™¨ä¸Šæ‰§è¡Œ</p>
</li>
</ul>
</li>
<li>
<p><font color="red">è™šæ‹ŸåŒ–ï¼šæ“ä½œç³»ç»Ÿåœ¨ç‰©ç†å†…å­˜ä¸­ä¿å­˜å¤šä¸ªçŠ¶æ€æœºï¼ˆç®¡ç†å¥½å¤šä¸ªçŠ¶æ€æœºï¼Œæ¯ä¸€æ¬¡éƒ½å¯ä»¥é€‰æ‹©ä¸€ä¸ªçŠ¶æ€æœºæ‰§è¡Œä¸€æ­¥ï¼‰</font></p>
</li>
<li>
<p>é€šè¿‡<b>è™šæ‹Ÿå†…å­˜</b>å®ç°<b>æ¯æ¬¡ â€œæ‹¿å‡ºæ¥ä¸€ä¸ªæ‰§è¡Œâ€</b></p>
</li>
<li>
<p><b>ä¸­æ–­åè¿›å…¥æ“ä½œç³»ç»Ÿä»£ç ï¼Œâ€œæ¢ä¸€ä¸ªæ‰§è¡Œâ€</b></p>
</li>
</ul>
<div class="mermaid" id="id-2"></div>
<ul>
<li>
<p><font color="red"><b>é™¤äº†forkçš„è¿”å›å€¼<code>pid</code>ï¼Œå‰©ä¸‹çš„éƒ½ä¸€æ ·ï¼Œå¹¶ä¸”äº’ç›¸ç‹¬ç«‹ï¼ˆç¬¬ä¸€ä¸ªè¿›ç¨‹çš„æŒ‡é’ˆè®¿é—®ä¸äº†ç¬¬äºŒä¸ªè¿›ç¨‹çš„å†…å­˜ï¼‰</b></font></p>
</li>
<li>
<p><b>ä¹‹åè¿›å…¥å¹¶å‘çŠ¶æ€ï¼Œæ‰§è¡Œé‚£ä¸ªç”±æ“ä½œç³»ç»Ÿå†³å®š</b></p>
</li>
</ul>
<h3 id="çŠ¶æ€æœºç®¡ç†åˆ›å»ºçŠ¶æ€æœº">çŠ¶æ€æœºç®¡ç†ï¼šåˆ›å»ºçŠ¶æ€æœº</h3>
<blockquote>
<p>å¦‚æœè¦åˆ›å»ºçŠ¶æ€æœºï¼Œæˆ‘ä»¬åº”è¯¥æä¾›ä»€ä¹ˆæ ·çš„<code> API</code>ï¼Ÿ</p>
</blockquote>
<ul>
<li>
<p><code>UNIX</code> çš„ç­”æ¡ˆ: <code>fork</code></p>
<ul>
<li>åšä¸€ä»½çŠ¶æ€æœºå®Œæ•´çš„å¤åˆ¶ (å†…å­˜ã€å¯„å­˜å™¨ç°åœº)</li>
</ul>
</li>
<li>
<p><code>int fork();</code></p>
<ul>
<li>
<p>ç«‹å³å¤åˆ¶çŠ¶æ€æœº (å®Œæ•´çš„å†…å­˜)</p>
</li>
<li>
<p>æ–°åˆ›å»ºè¿›ç¨‹è¿”å› 0</p>
</li>
<li>
<p>æ‰§è¡Œ fork çš„è¿›ç¨‹è¿”å›å­è¿›ç¨‹çš„è¿›ç¨‹å·</p>
</li>
</ul>
</li>
</ul>
<h3 id="fork-bomb">Fork Bomb</h3>
<ul>
<li>
<p>æ¨¡æ‹ŸçŠ¶æ€æœºéœ€è¦èµ„æº</p>
<ul>
<li>
<p>åªè¦ä¸åœåœ°åˆ›å»ºè¿›ç¨‹ï¼Œç³»ç»Ÿè¿˜æ˜¯ä¼šæŒ‚æ‰çš„</p>
</li>
<li>
<p><code>Don't try it (or try it in docker)</code></p>
</li>
</ul>
</li>
</ul>
<h3 id="ä»£ç è§£æ-fork-bomb">ä»£ç è§£æ: Fork Bomb</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">:<span class="o">(){</span> :<span class="p">|</span>:<span class="p">&amp;</span><span class="o">}</span><span class="p">;</span>:   <span class="c1"># åˆšæ‰çš„ä¸€è¡Œç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">:<span class="o">()</span> <span class="o">{</span>         <span class="c1"># æ ¼å¼åŒ–ä¸€ä¸‹</span>
</span></span><span class="line"><span class="cl">  : <span class="p">|</span> : <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span><span class="p">;</span> :
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fork<span class="o">()</span> <span class="o">{</span>      <span class="c1"># bash: å…è®¸å†’å·ä½œä¸ºæ ‡è¯†ç¬¦â€¦â€¦</span>
</span></span><span class="line"><span class="cl">  fork <span class="p">|</span> fork <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span><span class="p">;</span> fork
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å…·ä½“è¿‡ç¨‹</li>
</ul>
<div class="mermaid" id="id-3"></div>
<h3 id="è¿™æ¬¡ä½ ä»¬è®°ä½-fork-äº†">è¿™æ¬¡ä½ ä»¬è®°ä½ Fork äº†ï¼</h3>
<ul>
<li>å› ä¸ºçŠ¶æ€æœºæ˜¯å¤åˆ¶çš„ï¼Œå› æ­¤æ€»èƒ½æ‰¾åˆ° â€œçˆ¶å­å…³ç³»â€
<ul>
<li>å› æ­¤æœ‰äº†è¿›ç¨‹æ ‘ (<code>pstree</code>)</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemd-+-accounts-daemon---2*<span class="o">[{</span>accounts-daemon<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        <span class="p">|</span>-agetty
</span></span><span class="line"><span class="cl">        <span class="p">|</span>-atd
</span></span><span class="line"><span class="cl">        <span class="p">|</span>-automount---2*<span class="o">[{</span>automount<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        <span class="p">|</span>-avahi-daemon---avahi-daemon
</span></span><span class="line"><span class="cl">        <span class="p">|</span>-cron
</span></span><span class="line"><span class="cl">        <span class="p">|</span>-dbus-daemon
</span></span><span class="line"><span class="cl">        <span class="p">|</span>-irqbalance---<span class="o">{</span>irqbalance<span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">|</span>-lxcfs---7*<span class="o">[{</span>lxcfs<span class="o">}]</span>
</span></span><span class="line"><span class="cl">        ...
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç†è§£-fork-ä¹ é¢˜-1">ç†è§£ fork: ä¹ é¢˜ (1)</h3>
<ul>
<li>è¯•ç€æ‹¿å‡ºä¸€å¼ çº¸ï¼Œå†™å‡ºä»¥ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœ
<ul>
<li><a href="https://jyywiki.cn/pages/OS/2022/demos/fork-demo.c" target="_blank" rel="noopener noreffer">fork-demo.c</a></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">pid_t</span> <span class="n">pid1</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">pid_t</span> <span class="n">pid2</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">pid_t</span> <span class="n">pid3</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello World from (%d, %d, %d)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">pid1</span><span class="p">,</span> <span class="n">pid2</span><span class="p">,</span> <span class="n">pid3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å‚è€ƒåŸæ¥çš„<code>OS</code>ä½œä¸š</li>
</ul>
<blockquote>
<p>Including the initial parent process, how many processes are created by the program shown in Figure 3.31?</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* fork a child process */</span>
</span></span><span class="line"><span class="cl">    <span class="n">fork</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* fork another child process */</span>
</span></span><span class="line"><span class="cl">    <span class="n">fork</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* and fork another */</span>
</span></span><span class="line"><span class="cl">    <span class="n">fork</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><div class="mermaid" id="id-4"></div>
$$
1+3+3+1=8
$$</p>
<h3 id="ç†è§£-fork-ä¹ é¢˜-2">ç†è§£ fork: ä¹ é¢˜ (2)</h3>
<p>é—®ä»¥ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœ</p>
<ul>
<li>ä¸€ä¸ªæ›´å¥½çš„ç‰ˆæœ¬: <a href="https://jyywiki.cn/pages/OS/2022/demos/fork-printf.c" target="_blank" rel="noopener noreffer">fork-printf.c</a>
<ul>
<li>ç”¨çŠ¶æ€æœºçš„è§†è§’å†è¯•ä¸€æ¬¡</li>
<li>è¯•ä¸€è¯•ï¼š<code>./a.out</code> v.s. <code>./a.out | cat</code></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">fork</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">wait</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info"><div class="post-info-tag"><span><a href="/tags/operating-system/">Operating System</a>
                </span></div><div class="post-info-line"><div class="post-info-mod">
                <span>æ›´æ–°äº 2023-05-03</span>
            </div><div class="post-info-mod"></div>
        </div><div class="post-info-share">
            <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter11/" data-title="Operating System Chapter11 æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹" data-hashtags="Operating System"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter11/" data-hashtag="Operating System"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Linkedin" data-sharer="linkedin" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter11/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° WhatsApp" data-sharer="whatsapp" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter11/" data-title="Operating System Chapter11 æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter11/" data-title="Operating System Chapter11 æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹"><i class="fab fa-line fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter11/" data-title="Operating System Chapter11 æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Myspace" data-sharer="myspace" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter11/" data-title="Operating System Chapter11 æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Blogger" data-sharer="blogger" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter11/" data-title="Operating System Chapter11 æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹" data-description=""><i class="fab fa-blogger fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° ç™¾åº¦" data-sharer="baidu" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter11/" data-title="Operating System Chapter11 æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹"><i data-svg-src="/lib/simple-icons/icons/baidu.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Evernote" data-sharer="evernote" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter11/" data-title="Operating System Chapter11 æ“ä½œç³»ç»Ÿä¸Šçš„è¿›ç¨‹"><i class="fab fa-evernote fa-fw"></i></a></span>
        </div></div><div class="post-nav"><a href="/posts/operating-system/support3/" class="prev" rel="prev" title="æ“ä½œç³»ç»Ÿâ€”â€”å†…å­˜ç®¡ç†"><i class="fas fa-angle-left fa-fw"></i>Previous Post</a></div></div>
</div></article></div>
            </main>
            <footer class="footer"><div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.105.0">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/khusika/FeelIt" target="_blank" rel="noopener noreffer" title="FeelIt 1.0.1"><i class="fas fa-hand-holding-heart fa-fw"></i> FeelIt</a>
        </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/Jungle430">Jungle</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
</div>
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker
        .register('/sw.min.js?version=0.0.1', { scope: '/' })
        .then(() => {
            console.info('Jungle\u0027s Blog\u00A0Service Worker Registered');
        }, err => console.error('Jungle\u0027s Blog\u00A0Service Worker registration failed: ', err));

    navigator.serviceWorker
        .ready
        .then(() => {
            console.info('Jungle\u0027s Blog\u00A0Service Worker Ready');
        });
}
</script>
</footer>
        </div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-chevron-up fa-fw"></i>
            </a></div><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.fill%2CArray.prototype.find%2CArray.from%2CIntersectionObserver%2CMath.sign%2CObject.assign%2CPromise%2CObject.entries%2Chtml5shiv%2CObject.values%2Cfetch%2CElement.prototype.after"></script><script src="/lib/autocomplete/autocomplete.min.js"></script><script src="/lib/lunr/lunr.min.js"></script><script src="/lib/lunr/lunr.stemmer.support.min.js"></script><script src="/lib/lunr/lunr.zh.min.js"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script src="/lib/katex/katex.min.js"></script><script src="/lib/katex/auto-render.min.js"></script><script src="/lib/katex/copy-tex.min.js"></script><script src="/lib/katex/mhchem.min.js"></script><script src="/lib/mermaid/mermaid.min.js"></script><script>window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":100},"comment":{},"data":{"id-1":"graph LR\nA(\"CPU Reset\")\nB(\"fireware\")\nC(\"loader\")\nD(\"OS\")\nE(\"init\")\nF(\"åˆ›é€ æ•´ä¸ªä¸–ç•Œ\")\nA--\u003eB--\u003eC--\u003eD--\u003eE--Syscall--\u003eF","id-2":"graph LR\nA(init)\nB(\"initï¼Œè¿”å›åˆ›å»ºè¿›ç¨‹çš„è¿›ç¨‹å·\")\nC(\"initï¼Œå­è¿›ç¨‹çš„è¿”å›å€¼æ˜¯0\")\nD(\"syscall\")\nA--fork--\u003eD\nD--\u003eB\nD--\u003eC","id-3":"graph TB\nA(fork)\nB(\"fork|fork\")\nC(\"fork|fork\")\nD(\"fork|fork\")\nA--\u003eB\nB--\u003eC\nB--\u003eD\nE(\"...\")\nF(\"...\")\nG(\"...\")\nH(\"...\")\nD--\u003eE\nD--\u003eF\nC--\u003eG\nC--\u003eH","id-4":"graph LR\nA(main)\nB(pid1)\nC(pid2)\nD(pid3)\nA----B\nA----C\nA----D\nE(pid2)\nF(pid3)\nB----E\nB----F\nG(pid3)\nC----G\nH(pid3)\nE----H"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":50}};</script><script src="/js/theme.min.js"></script></body></html>
