<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Linux x86 Program Start Up or - How the heck do we get to main()? - Jungle&#39;s Blog</title><meta name="description" content="Welcome to Jungle&#39;s blog."><meta property="og:title" content="Linux x86 Program Start Up or - How the heck do we get to main()?" />
<meta property="og:description" content="æ¦‚è¿° æ–‡ç« ä»‹ç»äº†X86ç³»ç»Ÿmainå‡½æ•°è°ƒç”¨å‰åçš„ä¸€äº›ç»†èŠ‚ï¼Œå¹¶é˜è¿°äº†Cç¨‹åºçš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ï¼Œä»¥åŠ.init,.fini,init_array" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Jungle430.github.io/posts/operating-system/support2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-04T15:47:02+08:00" />
<meta property="article:modified_time" content="2023-03-04T15:47:02+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Linux x86 Program Start Up or - How the heck do we get to main()?"/>
<meta name="twitter:description" content="æ¦‚è¿° æ–‡ç« ä»‹ç»äº†X86ç³»ç»Ÿmainå‡½æ•°è°ƒç”¨å‰åçš„ä¸€äº›ç»†èŠ‚ï¼Œå¹¶é˜è¿°äº†Cç¨‹åºçš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ï¼Œä»¥åŠ.init,.fini,init_array"/>
<meta name="application-name" content="Jungle&#39;s blog">
<meta name="apple-mobile-web-app-title" content="Jungle&#39;s blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://Jungle430.github.io/posts/operating-system/support2/" /><link rel="prev" href="https://Jungle430.github.io/posts/java/biginteger/" /><link rel="next" href="https://Jungle430.github.io/posts/operating-system/operating-system-chapter4/" /><link rel="stylesheet" href="/css/page.min.css"><link rel="stylesheet" href="/css/home.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Linux x86 Program Start Up or - How the heck do we get to main()?",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/Jungle430.github.io\/posts\/operating-system\/support2\/"
        },"genre": "posts","keywords": "Operating System, Linux","wordcount":  9339 ,
        "url": "https:\/\/Jungle430.github.io\/posts\/operating-system\/support2\/","datePublished": "2023-03-04T15:47:02+08:00","dateModified": "2023-03-04T15:47:02+08:00","publisher": {
            "@type": "Organization",
            "name": "Jungle"},"author": {
                "@type": "Person",
                "name": "Jungle"
            },"description": ""
    }
    </script></head><body data-header-desktop="fixed" data-header-mobile="auto"><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Jungle&#39;s Blog">Jungle&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/">ğŸ“š æ–‡ç«  </a><a class="menu-item" href="/tags/">ğŸ·ï¸ æ ‡ç­¾ </a><a class="menu-item" href="/categories/">ğŸ—ƒï¸ åˆ†ç±» </a><a class="menu-item" href="/about/">ğŸ‘´ å…³äº </a><a class="menu-item" href="https://github.com/Jungle430" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-desktop">
                        <a href="#" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Jungle&#39;s Blog">Jungle&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-mobile">
                        <a href="#" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="#" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="">ğŸ“šæ–‡ç« </a><a class="menu-item" href="/tags/" title="">ğŸ·ï¸æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">ğŸ—ƒï¸åˆ†ç±»</a><a class="menu-item" href="/about/" title="">ğŸ‘´å…³äº</a><a class="menu-item" href="https://github.com/Jungle430" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><div class="menu-item"><a href="javascript:void(0);" class="theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div></div>
    </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single" data-toc="enable"><div class="single-card" ><h2 class="single-title animated flipInX">Linux x86 Program Start Up or - How the heck do we get to main()?</h2><div class="post-meta">
                <div class="post-meta-line"><span class="post-author"><a href="https://github.com/Jungle430" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Jungle</a></span>&nbsp;<span class="post-category">å‡ºç‰ˆäº  <a href="/categories/operating-system/"><i class="far fa-folder fa-fw"></i>Operating System</a></span></div>
                <div class="post-meta-line"><span><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2023-03-04">2023-03-04</time></span>&nbsp;<span><i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 9339 å­—</span>&nbsp;
                    <span><i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 19 åˆ†é’Ÿ</span>&nbsp;</div>
            </div>
            
            <hr><div class="details toc" id="toc-static"  data-kept="">
                    <div class="details-summary toc-title">
                        <span>ç›®å½•</span>
                        <span><i class="details-icon fas fa-angle-right"></i></span>
                    </div>
                    <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#æ¦‚è¿°">æ¦‚è¿°</a></li>
    <li><a href="#è°ƒç”¨è¿‡ç¨‹åˆ†æ">è°ƒç”¨è¿‡ç¨‹åˆ†æ</a>
      <ul>
        <li><a href="#mainå‡½æ•°çš„è°ƒç”¨">mainå‡½æ•°çš„è°ƒç”¨</a>
          <ul>
            <li><a href="#ä»æˆ‘ä»¬ç»ˆç«¯æ•²å›è½¦åˆ°ç¨‹åºè¢«è½½å…¥æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆ">ä»æˆ‘ä»¬ç»ˆç«¯æ•²å›è½¦åˆ°ç¨‹åºè¢«è½½å…¥æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</a></li>
            <li><a href="#_start">_start()</a></li>
            <li><a href="#__libc_start_main">__libc_start_main</a></li>
            <li><a href="#ç¯å¢ƒå˜é‡å“ªé‡Œå»äº†">ç¯å¢ƒå˜é‡å“ªé‡Œå»äº†ï¼Ÿ</a></li>
            <li><a href="#__libc_csu_init">__libc_csu_init</a>
              <ul>
                <li><a href="#è¿™ä¸ªå‡½æ•°éƒ½åšäº†ä»€ä¹ˆ">è¿™ä¸ªå‡½æ•°éƒ½åšäº†ä»€ä¹ˆï¼Ÿ</a>
                  <ul>
                    <li><a href="#get_pc_truckå‡½æ•°">get_pc_truckå‡½æ•°</a></li>
                    <li><a href="#å‰©ä¸‹çš„å¾ªç¯åœ¨å¹²ä»€ä¹ˆ">å‰©ä¸‹çš„å¾ªç¯åœ¨å¹²ä»€ä¹ˆï¼Ÿ</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#_initå‡½æ•°åˆ†æ">_initå‡½æ•°åˆ†æ</a>
              <ul>
                <li><a href="#æºç ">æºç </a></li>
                <li><a href="#è°ƒç”¨">è°ƒç”¨</a></li>
                <li><a href="#_initå‡½æ•°èµ·å§‹äºå¸¸è§„çš„cå‡½æ•°è°ƒç”¨"><code>_init</code>å‡½æ•°èµ·å§‹äºå¸¸è§„çš„Cå‡½æ•°è°ƒç”¨</a></li>
              </ul>
            </li>
            <li><a href="#gmon_startå‡½æ•°åˆ†æ">gmon_startå‡½æ•°åˆ†æ</a>
              <ul>
                <li><a href="#ç”Ÿæˆprofilehttpsenwikipediaorgwikiprofiling_computer_programmingæ–‡ä»¶">ç”Ÿæˆ<a href="https://en.wikipedia.org/wiki/Profiling_(computer_programming)">profile</a>æ–‡ä»¶</a></li>
              </ul>
            </li>
            <li><a href="#frame_dummyå‡½æ•°åˆ†æ">frame_dummyå‡½æ•°åˆ†æ</a></li>
            <li><a href="#_do_global_ctors_aux-longrightarrow-finally-were-getting-constructive"><code>_do_global_ctors_aux</code> $\Longrightarrow$ Finally we&rsquo;re getting constructive!</a>
              <ul>
                <li><a href="#example">Example</a></li>
                <li><a href="#æºç -1">æºç </a></li>
                <li><a href="#å¯¹åº”çš„æ±‡ç¼–">å¯¹åº”çš„æ±‡ç¼–</a></li>
                <li><a href="#å‡½æ•°æœ€å¼€å§‹çš„éƒ¨åˆ†">å‡½æ•°æœ€å¼€å§‹çš„éƒ¨åˆ†</a></li>
                <li><a href="#å¾ªç¯ä¹‹å‰çš„è®¾ç½®">å¾ªç¯ä¹‹å‰çš„è®¾ç½®</a></li>
                <li><a href="#and-finally-the-epilogue">And finally the epilogue</a></li>
                <li><a href="#ä½¿ç”¨gdbæ£€æµ‹prog2">ä½¿ç”¨gdbæ£€æµ‹prog2</a></li>
              </ul>
            </li>
            <li><a href="#å›åˆ°__libc_csu_init__">å›åˆ°<code>__libc_csu_init__</code></a>
              <ul>
                <li><a href="#è¿™æ˜¯å¦ä¸€ä¸ªå‡½æ•°çš„å¾ªç¯è°ƒç”¨">è¿™æ˜¯å¦ä¸€ä¸ªå‡½æ•°çš„å¾ªç¯è°ƒç”¨</a></li>
              </ul>
            </li>
            <li><a href="#ç¨‹åºå°†è¿”å›__libc_start_main__">ç¨‹åºå°†è¿”å›<code>__libc_start_main__</code></a>
              <ul>
                <li><a href="#exitå‡½æ•°è¿è¡Œäº†æ›´å¤šçš„å¾ªç¯">exit()å‡½æ•°è¿è¡Œäº†æ›´å¤šçš„å¾ªç¯</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#è¿™ä¸ªç¨‹åºæŠŠä¸Šé¢æ‰€æœ‰çš„è¿‡ç¨‹è”ç³»äº†èµ·æ¥">è¿™ä¸ªç¨‹åºï¼ŒæŠŠä¸Šé¢æ‰€æœ‰çš„è¿‡ç¨‹è”ç³»äº†èµ·æ¥</a></li>
      </ul>
    </li>
    <li><a href="#å›é¡¾">å›é¡¾</a></li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
    <li><a href="#ç›¸å…³å‚è€ƒèµ„æ–™">ç›¸å…³å‚è€ƒèµ„æ–™</a></li>
  </ul>
</nav></div>
                </div><div class="content" id="content"><h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<ul>
<li>
<p>æ–‡ç« ä»‹ç»äº†X86ç³»ç»Ÿmainå‡½æ•°è°ƒç”¨å‰åçš„ä¸€äº›ç»†èŠ‚ï¼Œå¹¶é˜è¿°äº†Cç¨‹åºçš„<b>æ„é€ å‡½æ•°</b>å’Œ<b>ææ„å‡½æ•°</b>ï¼Œ<u>ä»¥åŠ<code>.init</code>,<code>.fini</code>,<code>init_array</code>å’Œ<code>fini_array</code>å„sectionç›¸å¯¹äºmainå‡½æ•°åŠå½¼æ­¤çš„æ‰§è¡Œé¡ºåºã€‚é—æ†¾çš„æ˜¯è¿™ç¯‡æ–‡ç« æ˜¯åŸºäº32ä½CPUæ¶æ„æ¥ç ”ç©¶çš„</u></p>
</li>
<li>
<p>æ–‡ç« å¯¹$debug$ <code>main</code>å‡½æ•°ä¹‹å‰çš„ä»£ç æœ‰ä¸€å®šçš„å¸®åŠ©æ•ˆæœ</p>
</li>
<li>
<p>ä¸»è¦ä»‹ç»äº†X86 ELFæ–‡ä»¶çš„åŠ¨æ€åŠ è½½è¿‡ç¨‹</p>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/support2-1.png" title="/img/Operating System/support2-1.png" data-thumbnail="/img/Operating System/support2-1.png" data-sub-html="<h2>æ€»ä½“æµç¨‹å›¾</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/support2-1.png"
            data-srcset="/img/Operating%20System/support2-1.png, /img/Operating%20System/support2-1.png 1.5x, /img/Operating%20System/support2-1.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/support2-1.png" />
    </a><figcaption class="image-caption">æ€»ä½“æµç¨‹å›¾</figcaption>
    </figure>
<h2 id="è°ƒç”¨è¿‡ç¨‹åˆ†æ">è°ƒç”¨è¿‡ç¨‹åˆ†æ</h2>
<h3 id="mainå‡½æ•°çš„è°ƒç”¨">mainå‡½æ•°çš„è°ƒç”¨</h3>
<ul>
<li>å…ˆå†™ä¸€ä¸ªæœ€ç®€å•çš„Cç¨‹åºprog1.c</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç¼–è¯‘ä¸€ä¸‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -ggdb -o prog1 prog1.c
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨ï¼š<code>-ggdb</code>çš„é€‰é¡¹ä½œç”¨ï¼šç”Ÿæˆ<code>gdb</code>ä¸“ç”¨çš„è°ƒè¯•ä¿¡æ¯ï¼Œä¼šæœ‰ä¸€äº›<code>gdb</code>ä¸“ç”¨çš„æ‰©å±•</p>
</blockquote>
<ul>
<li>ç„¶åæˆ‘ä»¬ç”¨objdumpåšä¸€ä¸‹åæ±‡ç¼–</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">objdump -d prog1 &gt; prog1.asm
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ä»æˆ‘ä»¬ç»ˆç«¯æ•²å›è½¦åˆ°ç¨‹åºè¢«è½½å…¥æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆ">ä»æˆ‘ä»¬ç»ˆç«¯æ•²å›è½¦åˆ°ç¨‹åºè¢«è½½å…¥æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h4>
<ul>
<li>å½“æˆ‘ä»¬ä»ç»ˆç«¯è¾“å…¥è¦è¿è¡Œçš„ç¨‹åºæˆ–è€…æ˜¯ä»æœ‰å…³çš„<code>gui</code>ç•Œé¢ç‚¹å‡»ç›¸å…³çš„buttonçš„æ—¶å€™ï¼Œ<b>shell</b>æˆ–è€…<b>gui</b>å°±ä¼šè°ƒç”¨<code>execve()</code>ã€‚è¿™é‡Œä¸æ˜¯æˆ‘ä»¬é‡ç‚¹å…³å¿ƒçš„åœ°æ–¹ï¼Œç®€å•æ¥è¯´ï¼Œexecve()ä¼šè®¾ç«‹ä¸€ä¸ªæ ˆï¼Œç„¶åå°†å‚æ•°<code>argc</code>ï¼Œ<code>argv</code>å’Œ<code>envp</code>å‹å…¥æ ˆä¸­ã€‚æ–‡ä»¶æè¿°ç¬¦0ï¼Œ1ï¼Œ2ï¼ˆstdin, stdoutå’Œstderrï¼‰ç”±ä¹‹å‰çš„shellè®¾ç½®ï¼ŒåŠ è½½å™¨ä¼šå¸®æˆ‘ä»¬å®Œæˆæœ‰å…³é‡å®šä½çš„è®¸å¤šå·¥ä½œï¼Œå½“æ‰€æœ‰æå®šä¹‹åï¼Œæ§åˆ¶æƒä¼šä¼ é€’ç»™<code>_start()</code></li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/support2-2.png" title="/img/Operating System/support2-2.png" data-thumbnail="/img/Operating System/support2-2.png" data-sub-html="<h2>shellè¾“å…¥man execveä¹‹åçš„å‡½æ•°å£°æ˜å’Œæ‰€åœ¨ä½ç½®</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/support2-2.png"
            data-srcset="/img/Operating%20System/support2-2.png, /img/Operating%20System/support2-2.png 1.5x, /img/Operating%20System/support2-2.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/support2-2.png" />
    </a><figcaption class="image-caption">shellè¾“å…¥<code>man execve</code>ä¹‹åçš„å‡½æ•°å£°æ˜å’Œæ‰€åœ¨ä½ç½®</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/support2-4.png" title="/img/Operating System/support2-4.png" data-thumbnail="/img/Operating System/support2-4.png" data-sub-html="<h2>evnp</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/support2-4.png"
            data-srcset="/img/Operating%20System/support2-4.png, /img/Operating%20System/support2-4.png 1.5x, /img/Operating%20System/support2-4.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/support2-4.png" />
    </a><figcaption class="image-caption"><code>evnp</code></figcaption>
    </figure>
<h4 id="_start">_start()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">080482e0 &lt;_start&gt;:
</span></span><span class="line"><span class="cl">80482e0:       31 ed                   xor    %ebp,%ebp
</span></span><span class="line"><span class="cl">80482e2:       5e                      pop    %esi
</span></span><span class="line"><span class="cl">80482e3:       89 e1                   mov    %esp,%ecx
</span></span><span class="line"><span class="cl">80482e5:       83 e4 f0                and    $0xfffffff0,%esp
</span></span><span class="line"><span class="cl">80482e8:       50                      push   %eax
</span></span><span class="line"><span class="cl">80482e9:       54                      push   %esp
</span></span><span class="line"><span class="cl">80482ea:       52                      push   %edx
</span></span><span class="line"><span class="cl">80482eb:       68 00 84 04 08          push   $0x8048400
</span></span><span class="line"><span class="cl">80482f0:       68 a0 83 04 08          push   $0x80483a0
</span></span><span class="line"><span class="cl">80482f5:       51                      push   %ecx
</span></span><span class="line"><span class="cl">80482f6:       56                      push   %esi
</span></span><span class="line"><span class="cl">80482f7:       68 94 83 04 08          push   $0x8048394
</span></span><span class="line"><span class="cl">80482fc:       e8 c3 ff ff ff          call   80482c4 &lt;__libc_start_main@plt&gt;
</span></span><span class="line"><span class="cl">8048301:       f4                      hlt
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä»»ä½•å€¼<code>xor</code>è‡ªèº«å¾—åˆ°çš„ç»“æœéƒ½æ˜¯0ã€‚æ‰€ä»¥<code>xor %ebp,%ebp</code>è¯­å¥ä¼šæŠŠ<code>%ebp</code>è®¾ç½®ä¸º0ã€‚ABIï¼ˆApplication Binary Interface specificationï¼‰æ¨èè¿™ä¹ˆåšï¼Œç›®çš„æ˜¯ä¸ºäº†æ ‡è®°æœ€å¤–å±‚å‡½æ•°çš„é¡µå¸§ï¼ˆframeï¼‰</li>
<li>æ¥ä¸‹æ¥ï¼Œä»æ ˆä¸­å¼¹å‡ºæ ˆé¡¶çš„å€¼ä¿å­˜åˆ°<code>%esi</code>ã€‚åœ¨æœ€å¼€å§‹çš„æ—¶å€™æˆ‘ä»¬æŠŠ<code>argc</code>ï¼Œ<code>argv</code>å’Œ<code>envp</code>æ”¾åˆ°äº†æ ˆé‡Œï¼Œæ‰€ä»¥ç°åœ¨çš„<code>pop</code>è¯­å¥ä¼šæŠŠ<code>argc</code>æ”¾åˆ°<code>%esi</code>ä¸­</li>
<li>è¿™é‡Œåªæ˜¯ä¸´æ—¶ä¿å­˜ä¸€ä¸‹ï¼Œç¨åæˆ‘ä»¬ä¼šæŠŠå®ƒå†æ¬¡å‹å›æ ˆä¸­</li>
<li>å› ä¸ºæˆ‘ä»¬å¼¹å‡ºäº†<code>argc</code>ï¼Œæ‰€ä»¥<code>%ebp</code>ç°åœ¨æŒ‡å‘çš„æ˜¯<code>argv</code>ã€‚<code>mov</code>æŒ‡ä»¤æŠŠ<code>argv</code>æ”¾åˆ°äº†<code>%ecx</code>ä¸­ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç§»åŠ¨æ ˆæŒ‡é’ˆ</li>
<li><u>ç„¶åï¼Œå°†æ ˆæŒ‡é’ˆå’Œä¸€ä¸ªå¯ä»¥æ¸…é™¤åå››ä½çš„æ©ç åš<code>and</code>æ“ä½œã€‚æ ¹æ®å½“å‰æ ˆæŒ‡é’ˆçš„ä½ç½®ä¸åŒï¼Œæ ˆæŒ‡é’ˆå°†ä¼šå‘ä¸‹ç§»åŠ¨0åˆ°15ä¸ªå­—èŠ‚ã€‚è¿™ä¹ˆåšï¼Œä¿è¯äº†ä»»ä½•æƒ…å†µä¸‹ï¼Œæ ˆæŒ‡é’ˆéƒ½æ˜¯16å­—èŠ‚çš„å¶æ•°å€å¯¹é½çš„ã€‚å¯¹é½çš„ç›®çš„æ˜¯ä¿è¯æ ˆä¸Šæ‰€æœ‰çš„å˜é‡éƒ½èƒ½å¤Ÿè¢«å†…å­˜å’Œcacheå¿«é€Ÿçš„è®¿é—®</u></li>
<li><u>è¦æ±‚è¿™ä¹ˆåšçš„æ˜¯SSEï¼Œå°±æ˜¯æŒ‡ä»¤éƒ½èƒ½åœ¨å•ç²¾åº¦æµ®ç‚¹æ•°ç»„ä¸Šå·¥ä½œçš„é‚£ä¸ª<b>ï¼ˆæ‰©å±•æŒ‡ä»¤é›†ï¼‰</b></u></li>
<li>ä¾‹å­ï¼šæŸæ¬¡è¿è¡Œæ—¶ï¼Œ<code>_start</code>å‡½æ•°åˆšè¢«è°ƒç”¨çš„æ—¶å€™ï¼Œ<code>%esp</code>å¤„äº<code>0xbffff770</code>ã€‚åœ¨æˆ‘ä»¬ä»æ ˆä¸Šå¼¹å‡º<code>argc</code>åï¼Œ<code>%esp</code>æŒ‡å‘<code>0xbffff774</code>ã€‚å®ƒå‘é«˜åœ°å€ç§»åŠ¨äº†ï¼ˆæ ˆå‘ä¸‹å¢é•¿ï¼‰ã€‚å½“å¯¹æ ˆæŒ‡é’ˆæ‰§è¡Œäº†<code>and</code>æ“ä½œåï¼Œæ ˆæŒ‡é’ˆå›åˆ°äº†<code>0xbffff770</code></li>
</ul>
<h4 id="__libc_start_main">__libc_start_main</h4>
<ul>
<li>ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠ<code>__libc_start_main</code>å‡½æ•°çš„å‚æ•°å‹å…¥æ ˆä¸­ã€‚ç¬¬ä¸€ä¸ªå‚æ•°<code>%eax</code>è¢«å‹å…¥æ ˆä¸­ï¼Œé‡Œé¢ä¿å­˜äº†æ— æ•ˆä¿¡æ¯ï¼ŒåŸå› æ˜¯ç¨åä¼šæœ‰ä¸ƒä¸ªå‚æ•°å°†è¢«å‹å…¥æ ˆä¸­ï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯16å­—èŠ‚å¯¹é½ï¼Œæ‰€ä»¥éœ€è¦ç¬¬å…«ä¸ªå‚æ•°ã€‚è¿™ä¸ªå€¼ä¹Ÿå¹¶ä¸ä¼šè¢«ç”¨åˆ°ã€‚<code>__libc_start_main</code>æ˜¯åœ¨é“¾æ¥çš„æ—¶å€™ä»glibcå¤åˆ¶è¿‡æ¥çš„ã€‚åœ¨glibcçš„ä»£ç ä¸­ï¼Œå®ƒä½äº<code>csu/libc-start.c</code>æ–‡ä»¶é‡Œã€‚<code>__libc_start_main</code>çš„å®šä¹‰å¦‚ä¸‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">__libc_start_main</span><span class="p">(</span>  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">main</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="o">*</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="o">*</span> <span class="n">ubp_av</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">init</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fini</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">rtld_fini</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="kt">void</span> <span class="p">(</span><span class="o">*</span> <span class="n">stack_end</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><figure><a class="lightgallery" href="/img/Operating%20System/support2-3.jpg" title="/img/Operating System/support2-3.jpg" data-thumbnail="/img/Operating System/support2-3.jpg" data-sub-html="<h2>å‚æ•°è¯´æ˜</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/support2-3.jpg"
            data-srcset="/img/Operating%20System/support2-3.jpg, /img/Operating%20System/support2-3.jpg 1.5x, /img/Operating%20System/support2-3.jpg 2x"
            data-sizes="auto"
            alt="/img/Operating System/support2-3.jpg" />
    </a><figcaption class="image-caption">å‚æ•°è¯´æ˜</figcaption>
    </figure>
<ul>
<li>__libc_csu_finiå‡½æ•°ä¹Ÿæ˜¯ä»glibcè¢«é“¾æ¥è¿›æˆ‘ä»¬ä»£ç çš„ï¼Œå®ƒçš„æºä»£ç ä½äºcsu/elf-init.cä¸­</li>
</ul>
<h4 id="ç¯å¢ƒå˜é‡å“ªé‡Œå»äº†">ç¯å¢ƒå˜é‡å“ªé‡Œå»äº†ï¼Ÿ</h4>
<ul>
<li>
<p>æˆ‘ä»¬å¹¶æ²¡æœ‰è·å–envpï¼ˆæ ˆé‡ŒæŒ‡å‘æˆ‘ä»¬ç¯å¢ƒå˜é‡çš„æŒ‡é’ˆï¼‰ï¼Ÿå®ƒå¹¶ä¸æ˜¯<code>__libc_start_main</code>å‡½æ•°çš„å‚æ•°ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“mainå‡½æ•°çš„åŸå‹å…¶å®æ˜¯<code>int main(int argc, char** argv, char** envp)</code>ã€‚æ‰€ä»¥ï¼Œåˆ°åº•æ€ä¹ˆå›äº‹ï¼Ÿ</p>
</li>
<li>
<p>å…¶å®ï¼Œ<code>__libc_start_main</code>å‡½æ•°ä¼šè°ƒç”¨<code>__libc_init_first</code>ï¼Œè¿™ä¸ªå‡½æ•°ä¼šä½¿ç”¨å†…éƒ¨ä¿¡æ¯å»æ‰¾åˆ°ç¯å¢ƒå˜é‡ï¼ˆå®é™…ä¸Šç¯å¢ƒå˜é‡å°±ä½äº<code>argv</code>çš„ç»ˆæ­¢å­—ç¬¦nullçš„åé¢ï¼‰ï¼Œç„¶åè®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡<code>__environ</code>ï¼Œè¿™ä¸ªå…¨å±€å˜é‡å¯ä»¥è¢«<code>__libc_start_main</code>å‡½æ•°å†…éƒ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼ŒåŒ…æ‹¬è°ƒç”¨mainå‡½æ•°æ—¶ã€‚å½“<code>envp</code>å»ºç«‹äº†ä¹‹åï¼Œ<code>__libc_start_main</code>å‡½æ•°ä¼šä½¿ç”¨ç›¸åŒçš„å°æŠ€å·§ï¼Œè¶Šè¿‡envpæ•°ç»„ä¹‹åçš„<code>NULL</code>å­—ç¬¦ï¼Œè·å–å¦ä¸€ä¸ªå‘é‡â€”â€”ELFè¾…åŠ©å‘é‡ï¼ˆåŠ è½½å™¨ä½¿ç”¨å®ƒç»™è¿›ç¨‹ä¼ é€’ä¸€äº›ä¿¡æ¯ï¼‰</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">__libc_init_first</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">arg0</span><span class="p">,</span> <span class="p">...)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">arg0</span><span class="p">,</span> <span class="o">**</span><span class="n">envp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">argv</span><span class="p">[</span><span class="n">argc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">__environ</span> <span class="o">=</span> <span class="n">envp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">__libc_init</span> <span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">envp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¿è¡Œç¨‹åºå‰ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡<code>LD_SHOW_AUXV=1</code>,å¯ä»¥æŸ¥çœ‹é‡Œé¢çš„å†…å®¹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ <span class="nv">LD_SHOW_AUXV</span><span class="o">=</span><span class="m">1</span> ./prog1
</span></span><span class="line"><span class="cl">AT_SYSINFO:      0xe62414
</span></span><span class="line"><span class="cl">AT_SYSINFO_EHDR: 0xe62000
</span></span><span class="line"><span class="cl">AT_HWCAP:    fpu vme de pse tsc msr pae mce cx8 apic
</span></span><span class="line"><span class="cl">             mtrr pge mca cmov pat pse36 clflush dts
</span></span><span class="line"><span class="cl">             acpi mmx fxsr sse sse2 ss ht tm pbe
</span></span><span class="line"><span class="cl">AT_PAGESZ:       <span class="m">4096</span>
</span></span><span class="line"><span class="cl">AT_CLKTCK:       <span class="m">100</span>
</span></span><span class="line"><span class="cl">AT_PHDR:         0x8048034
</span></span><span class="line"><span class="cl">AT_PHENT:        <span class="m">32</span>
</span></span><span class="line"><span class="cl">AT_PHNUM:        <span class="m">8</span>
</span></span><span class="line"><span class="cl">AT_BASE:         0x686000
</span></span><span class="line"><span class="cl">AT_FLAGS:        0x0
</span></span><span class="line"><span class="cl">AT_ENTRY:        0x80482e0
</span></span><span class="line"><span class="cl">AT_UID:          <span class="m">1002</span>
</span></span><span class="line"><span class="cl">AT_EUID:         <span class="m">1002</span>
</span></span><span class="line"><span class="cl">AT_GID:          <span class="m">1000</span>
</span></span><span class="line"><span class="cl">AT_EGID:         <span class="m">1000</span>
</span></span><span class="line"><span class="cl">AT_SECURE:       <span class="m">0</span>
</span></span><span class="line"><span class="cl">AT_RANDOM:       0xbff09acb
</span></span><span class="line"><span class="cl">AT_EXECFN:       ./prog1
</span></span><span class="line"><span class="cl">AT_PLATFORM:     i686
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>å„ç§å„æ ·çš„ä¿¡æ¯ã€‚<code>AT_ENTRY</code>æ˜¯<code>_start</code>çš„åœ°å€ï¼Œè¿˜æœ‰æˆ‘ä»¬çš„UIDã€æœ‰æ•ˆUIDå’ŒGID</p>
</li>
<li>
<p><b>__libc_start_mainåŠŸèƒ½æ€»ç»“</b></p>
<ul>
<li>å¤„ç†å…³äºsetuidã€setgidç¨‹åºçš„å®‰å…¨é—®é¢˜</li>
<li>å¯åŠ¨çº¿ç¨‹</li>
<li>æŠŠ<code>fini</code>å‡½æ•°å’Œ<code>rtld_fini</code>å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™<code>at_exit</code>è°ƒç”¨ï¼Œä½¿å®ƒä»¬åœ¨<code>at_exit</code>é‡Œè¢«è°ƒç”¨ï¼Œä»è€Œå®Œæˆç”¨æˆ·ç¨‹åºå’ŒåŠ è½½å™¨çš„è°ƒç”¨ç»“æŸä¹‹åçš„æ¸…ç†å·¥ä½œ</li>
<li>è°ƒç”¨å…¶<code>init</code>å‚æ•°</li>
<li>è°ƒç”¨<code>main</code>å‡½æ•°ï¼Œå¹¶æŠŠ<code>argc</code>å’Œ<code>argv</code>å‚æ•°ã€ç¯å¢ƒå˜é‡ä¼ é€’ç»™å®ƒ</li>
<li>è°ƒç”¨<code>exit</code>å‡½æ•°ï¼Œå¹¶å°†mainå‡½æ•°çš„è¿”å›å€¼ä¼ é€’ç»™å®ƒ</li>
</ul>
</li>
</ul>
<h4 id="__libc_csu_init">__libc_csu_init</h4>
<ul>
<li><code>__libc_start_main</code>å‡½æ•°çš„<code>init</code>å‚æ•°è¢«è®¾ç½®æˆäº†<code>__libc_csu_init</code>å‡½æ•°ï¼Œå®ƒä¹Ÿæ˜¯è¢«é“¾æ¥è¿›æˆ‘ä»¬ä»£ç çš„ã€‚å®ƒæ¥æºäºglibcæºä»£ç ä¸­çš„csu/elf-init.cã€‚å…¶Cä»£ç å¦‚ä¸‹ï¼ˆåŸä»£ç åªä¸è¿‡å¤šäº†ä¸€äº›#ifdefï¼‰ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">__libc_csu_init</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">_init</span> <span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">size_t</span> <span class="n">size</span> <span class="o">=</span> <span class="n">__init_array_end</span> <span class="o">-</span> <span class="n">__init_array_start</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="o">*</span><span class="n">__init_array_start</span> <span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">envp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>åŠŸèƒ½ï¼š<b>ç”¨æˆ·åº”ç”¨ç¨‹åºçš„æ„é€ å‡½æ•°</b></p>
</li>
<li>
<p><code>__libc_csu_init</code>å‡½æ•°ç›¸å½“é‡è¦ï¼Œå› ä¸ºå®ƒæ˜¯æˆ‘ä»¬<b>å¯æ‰§è¡Œç¨‹åºçš„æ„é€ å‡½æ•°</b></p>
<ul>
<li>ï¼Ÿï¼Ÿï¼Ÿè¿™ä¸æ˜¯C++ï¼Œå“ªé‡Œæ¥çš„æ„é€ å‡½æ•°ï¼Ÿï¼Ÿï¼Ÿ $\Longrightarrow$ æ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„æ¦‚å¿µå¹¶éå±äºC++ï¼Œå®ƒè¯ç”Ÿæ—©äºC++</li>
<li>å¯¹äºä»»æ„çš„å¯æ‰§è¡Œç¨‹åºéƒ½å¯ä»¥æœ‰ä¸€ä¸ªCå‡½æ•°çš„<b>æ„é€ å‡½æ•°</b><code>__libc_csu_init</code>å’ŒCå‡½æ•°çš„<b>ææ„å‡½æ•°</b><code>__libc_csu_fini</code>ã€‚<u>åœ¨æ„é€ å‡½æ•°å†…éƒ¨ï¼Œå¯æ‰§è¡Œç¨‹åºä¼šæ‰¾åˆ°å…¨å±€Cå‡½æ•°ç»„æˆçš„æ„é€ å‡½æ•°é›†ï¼Œå¹¶ä¸”è°ƒç”¨å®ƒä»¬</u>ã€‚ï¼ˆä»»ä½•ä¸€ä¸ªCç¨‹åºéƒ½æ˜¯å¯ä»¥æœ‰æ„é€ å‡½æ•°é›†çš„ï¼‰ $\Longrightarrow$ <u>the executable will look for global C level constructors and call any that it finds. It&rsquo;s possible for a C program to also have these</u>ï¼ˆåŸæ–‡ï¼‰</li>
</ul>
</li>
<li>
<p><code>__libc_csu_init</code>å‡½æ•°çš„åæ±‡ç¼–ä»£ç </p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">080483a0 &lt;__libc_csu_init&gt;:
</span></span><span class="line"><span class="cl"> 80483a0:       55                      push   %ebp
</span></span><span class="line"><span class="cl"> 80483a1:       89 e5                   mov    %esp,%ebp
</span></span><span class="line"><span class="cl"> 80483a3:       57                      push   %edi
</span></span><span class="line"><span class="cl"> 80483a4:       56                      push   %esi
</span></span><span class="line"><span class="cl"> 80483a5:       53                      push   %ebx
</span></span><span class="line"><span class="cl"> 80483a6:       e8 5a 00 00 00          call   8048405 &lt;__i686.get_pc_thunk.bx&gt;
</span></span><span class="line"><span class="cl"> 80483ab:       81 c3 49 1c 00 00       add    $0x1c49,%ebx
</span></span><span class="line"><span class="cl"> 80483b1:       83 ec 1c                sub    $0x1c,%esp
</span></span><span class="line"><span class="cl"> 80483b4:       e8 bb fe ff ff          call   8048274 &lt;_init&gt;
</span></span><span class="line"><span class="cl"> 80483b9:       8d bb 20 ff ff ff       lea    -0xe0(%ebx),%edi
</span></span><span class="line"><span class="cl"> 80483bf:       8d 83 20 ff ff ff       lea    -0xe0(%ebx),%eax
</span></span><span class="line"><span class="cl"> 80483c5:       29 c7                   sub    %eax,%edi
</span></span><span class="line"><span class="cl"> 80483c7:       c1 ff 02                sar    $0x2,%edi
</span></span><span class="line"><span class="cl"> 80483ca:       85 ff                   test   %edi,%edi
</span></span><span class="line"><span class="cl"> 80483cc:       74 24                   je     80483f2 &lt;__libc_csu_init+0x52&gt;
</span></span><span class="line"><span class="cl"> 80483ce:       31 f6                   xor    %esi,%esi
</span></span><span class="line"><span class="cl"> 80483d0:       8b 45 10                mov    0x10(%ebp),%eax
</span></span><span class="line"><span class="cl"> 80483d3:       89 44 24 08             mov    %eax,0x8(%esp)
</span></span><span class="line"><span class="cl"> 80483d7:       8b 45 0c                mov    0xc(%ebp),%eax
</span></span><span class="line"><span class="cl"> 80483da:       89 44 24 04             mov    %eax,0x4(%esp)
</span></span><span class="line"><span class="cl"> 80483de:       8b 45 08                mov    0x8(%ebp),%eax
</span></span><span class="line"><span class="cl"> 80483e1:       89 04 24                mov    %eax,(%esp)
</span></span><span class="line"><span class="cl"> 80483e4:       ff 94 b3 20 ff ff ff    call   *-0xe0(%ebx,%esi,4)
</span></span><span class="line"><span class="cl"> 80483eb:       83 c6 01                add    $0x1,%esi
</span></span><span class="line"><span class="cl"> 80483ee:       39 fe                   cmp    %edi,%esi
</span></span><span class="line"><span class="cl"> 80483f0:       72 de                   jb     80483d0 &lt;__libc_csu_init+0x30&gt;
</span></span><span class="line"><span class="cl"> 80483f2:       83 c4 1c                add    $0x1c,%esp
</span></span><span class="line"><span class="cl"> 80483f5:       5b                      pop    %ebx
</span></span><span class="line"><span class="cl"> 80483f6:       5e                      pop    %esi
</span></span><span class="line"><span class="cl"> 80483f7:       5f                      pop    %edi
</span></span><span class="line"><span class="cl"> 80483f8:       5d                      pop    %ebp
</span></span><span class="line"><span class="cl"> 80483f9:       c3                      ret
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="è¿™ä¸ªå‡½æ•°éƒ½åšäº†ä»€ä¹ˆ">è¿™ä¸ªå‡½æ•°éƒ½åšäº†ä»€ä¹ˆï¼Ÿ</h5>
<h6 id="get_pc_truckå‡½æ•°">get_pc_truckå‡½æ•°</h6>
<ul>
<li>è¯¥å‡½æ•°æ˜¯ç»™ä½ç½®æ— å…³ç ä½¿ç”¨çš„ã€‚è®¾ç½®å®ƒä»¬å¯ä»¥è®©ä½ç½®æ— å…³ç æ­£å¸¸å·¥ä½œã€‚ä¸ºäº†è®©å®ƒä»¬å·¥ä½œï¼ŒåŸºå€å¯„å­˜å™¨ï¼ˆ%ebpï¼‰éœ€è¦çŸ¥é“<code>GLOBAL_OFFSET_TABLE</code>ã€‚å…¶éƒ¨åˆ†ä»£ç å¦‚ä¸‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">push %ebx
</span></span><span class="line"><span class="cl">call __get_pc_thunk_bx
</span></span><span class="line"><span class="cl">add  $_GLOBAL_OFFSET_TABLE_,%ebx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">__get_pc_thunk_bx:
</span></span><span class="line"><span class="cl">movel (%esp),%ebx
</span></span><span class="line"><span class="cl">return
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>è¿‡ç¨‹åˆ†æ</p>
<ul>
<li>
<p>è°ƒç”¨<code>__get_pc_thunk_bx</code>æ—¶ï¼Œåƒæ‰€æœ‰å…¶ä»–å‡½æ•°è°ƒç”¨ä¸€æ ·ï¼Œå°†ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å‹å…¥æ ˆä¸­ï¼ˆè®¡ç»„ï¼šä¿å­˜ä¸Šä¸€çº§ç¨‹åºçš„<b>PC</b>ï¼‰ã€‚è¿™æ ·ï¼Œå½“å‡½æ•°è¿”å›æ—¶ï¼Œå°±ä¼šç»§ç»­æ‰§è¡Œä¸‹æ¡æŒ‡ä»¤</p>
</li>
<li>
<p>åœ¨<code>__get_pc_thunk_bx</code>ä¸­ï¼Œæˆ‘ä»¬å°†è¿”å›åœ°å€ä»æ ˆä¸­å¤åˆ¶åˆ°<code>%ebx</code>ä¸­ã€‚å½“è¿”å›çš„æ—¶å€™ï¼Œä¸‹æ¡æŒ‡ä»¤ä¼šæŠŠ<code>_GLOBAL_OFFSET_TABLE_</code>åŠ åˆ°<code>%ebx</code>ä¸Šå»ï¼ˆå‰3å¥ï¼‰</p>
</li>
<li>
<p>å…¶ä¸­<code>_GLOBAL_OFFSET_TABLE_</code>ä»£è¡¨äº†å½“å‰åœ°å€å’Œä½ç½®æ— å…³ç ä½¿ç”¨çš„<code>GOT(global offset table)</code>çš„å·®å€¼</p>
</li>
<li>
<p>åœ¨<code>GOT</code>ä¸­ä¿å­˜äº†æˆ‘ä»¬æƒ³è®¿é—®çš„å˜é‡çš„æŒ‡é’ˆçš„é›†åˆï¼Œ<b>å¹¶ä¸”æˆ‘ä»¬åªéœ€è¦çŸ¥é“æ•°æ®åœ¨è¿™ä¸ªè¡¨ä¸­çš„åç§»é‡å°±è¡Œ</b></p>
</li>
<li>
<p>åŠ è½½å™¨ä¼šä¸ºæˆ‘ä»¬ä¿®æ”¹è¿™ä¸ªè¡¨é‡Œé¢çš„åœ°å€ã€‚å¯¹äºå‡½æ•°æ¥è®²ï¼Œä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼çš„è¡¨ï¼ˆPLTï¼‰</p>
</li>
<li>
<p><u>æ±‡ç¼–é‡Œé¢è¿™ä¹ˆç¼–å†™å®åœ¨æ˜¯å¤ªçƒ¦äººäº†ï¼Œä½†æ˜¯ï¼Œåœ¨Cæˆ–è€…C++ä¸­ï¼Œä½ å¯ä»¥å°†-picå‚æ•°ä¼ é€’ç»™ç¼–è¯‘å™¨ï¼Œå®ƒå°†ä¼šè‡ªåŠ¨å¸®ä½ å®Œæˆè¿™ä¸ªå·¥ä½œ</u><b>ï¼ˆä½ çŸ¥é“ä½ ä¸ç”¨å…³å¿ƒè¿™ä¸ªäº‹æƒ…å°±å¯ä»¥äº†ï¼ˆmdå°±æ€•è‡ªå·±å†â„¢ï¸é’»ç‰›è§’å°–ï¼‰ï¼‰</b></p>
</li>
</ul>
</li>
<li>
<p>å’Œ64ä½æœ‰å…³çš„åŒºåˆ«</p>
</li>
</ul>
<blockquote>
<p><em>ä¸Šè¿°Â·get_pc_truckÂ·å‡½æ•°çš„ä¸»è¦ç›®çš„å…¶å®æ˜¯è·å–å˜é‡å¯¹åº”çš„GOTï¼Œä»¥é€šè¿‡å®ƒè·å–å˜é‡çœŸæ­£çš„å€¼ã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆå†™ï¼Œæ˜¯å› ä¸ºåœ¨32ä½ç³»ç»Ÿé‡Œï¼Œæ²¡æœ‰ç±»ä¼¼äºripçš„å¯„å­˜å™¨ï¼Œå› æ­¤å¹¶ä¸èƒ½ç›´æ¥è·å–å½“å‰æŒ‡ä»¤çš„åœ°å€ï¼Œè€Œåœ¨64ä½ç³»ç»Ÿé‡Œå°±ä¸ç”¨è¿™ç§å°æŠ€å·§äº†</em></p>
<ul>
<li>
<p>æœ‰å…³é˜…è¯»</p>
<ul>
<li>
<p><a href="https://blog.csdn.net/mw_nice/article/details/100022610" target="_blank" rel="noopener noreffer">ã€ŠLinuxä¸­çš„GOTå’ŒPLTåˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿã€‹</a> ï¼ˆåŸæ¥çš„åšå®¢å¯„äº†ï¼Œåœ¨CSDNæ‰¾åˆ°äº†è½¬è½½ï¼‰</p>
</li>
<li>
<p><a href="https://www.technovelty.org/linux/plt-and-got-the-key-to-code-sharing-and-dynamic-libraries.html" target="_blank" rel="noopener noreffer">ã€ŠPLT and GOT - the key to code sharing and dynamic librariesã€‹</a> ï¼ˆè‹±æ–‡åŸæ–‡ï¼‰</p>
</li>
</ul>
</li>
</ul>
</blockquote>
<h6 id="å‰©ä¸‹çš„å¾ªç¯åœ¨å¹²ä»€ä¹ˆ">å‰©ä¸‹çš„å¾ªç¯åœ¨å¹²ä»€ä¹ˆï¼Ÿ</h6>
<ul>
<li>ç°åœ¨æˆ‘ä»¬åªè¦è®°ä½ï¼š<b>ç¿»è¯‘çš„ä¸å¥½ï¼Œè¿™é‡Œå»ºè®®çœ‹åŸæ–‡</b></li>
</ul>
<blockquote>
<p>For now, just remember that it calls any C level initializers for our program.</p>
</blockquote>
<p>ä¸­æ–‡ç¿»è¯‘ç‰ˆï¼š</p>
<blockquote>
<p><b>å®ƒè°ƒç”¨äº†ç”¨æˆ·ç¨‹åºä¸­æ‰€æœ‰ç”¨Cä»£ç ç¼–å†™çš„<code>initializers</code></b></p>
</blockquote>
<ul>
<li>ä¸­æ–‡è¿™ä¸ªç‰ˆæœ¬å®¹æ˜“è®©äººçœ‹è·‘äº†ï¼Œè¿™ä¸ªCä»£ç ä¸ä¸€å®šæ˜¯è‡ªå·±ç¼–å†™çš„ï¼Œåªè¦æ˜¯<b>C level</b>çº§åˆ«çš„<b>initializers</b>ï¼ˆåé¢æœ‰é¢„å¤„ç†ï¼Œé“¾æ¥ï¼Œä¸­è¯‘å®¹æ˜“è®©äººçœ‹è·‘ï¼‰</li>
</ul>
<h4 id="_initå‡½æ•°åˆ†æ">_initå‡½æ•°åˆ†æ</h4>
<h5 id="æºç ">æºç </h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">08048274 &lt;_init&gt;:
</span></span><span class="line"><span class="cl"> 8048274:       55                      push   %ebp
</span></span><span class="line"><span class="cl"> 8048275:       89 e5                   mov    %esp,%ebp
</span></span><span class="line"><span class="cl"> 8048277:       53                      push   %ebx
</span></span><span class="line"><span class="cl"> 8048278:       83 ec 04                sub    $0x4,%esp
</span></span><span class="line"><span class="cl"> 804827b:       e8 00 00 00 00          call   8048280 &lt;_init+0xc&gt;
</span></span><span class="line"><span class="cl"> 8048280:       5b                      pop    %ebx
</span></span><span class="line"><span class="cl"> 8048281:       81 c3 74 1d 00 00       add    $0x1d74,%ebx        (.got.plt)
</span></span><span class="line"><span class="cl"> 8048287:       8b 93 fc ff ff ff       mov    -0x4(%ebx),%edx
</span></span><span class="line"><span class="cl"> 804828d:       85 d2                   test   %edx,%edx
</span></span><span class="line"><span class="cl"> 804828f:       74 05                   je     8048296 &lt;_init+0x22&gt;
</span></span><span class="line"><span class="cl"> 8048291:       e8 1e 00 00 00          call   80482b4 &lt;__gmon_start__@plt&gt;
</span></span><span class="line"><span class="cl"> 8048296:       e8 d5 00 00 00          call   8048370 &lt;frame_dummy&gt;
</span></span><span class="line"><span class="cl"> 804829b:       e8 70 01 00 00          call   8048410 &lt;__do_global_ctors_aux&gt;
</span></span><span class="line"><span class="cl"> 80482a0:       58                      pop    %eax
</span></span><span class="line"><span class="cl"> 80482a1:       5b                      pop    %ebx
</span></span><span class="line"><span class="cl"> 80482a2:       c9                      leave
</span></span><span class="line"><span class="cl"> 80482a3:       c3                      ret
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="è°ƒç”¨">è°ƒç”¨</h5>
<ul>
<li>å½“åŠ è½½å™¨å°†æ§åˆ¶æƒäº¤ç»™<code>_start</code>å‡½æ•°ä¹‹åï¼Œ<code>_start</code>å‡½æ•°å°†ä¼šè°ƒç”¨<code>__libc_start_main</code>å‡½æ•°ï¼Œ<code>__libc_start_main</code>å‡½æ•°ä¼šè°ƒç”¨<code>__libc_csu_init</code>å‡½æ•°, <code>__libc_csu_init</code>å‡½æ•°ä¼šè°ƒç”¨<code>_init</code>å‡½æ•°</li>
</ul>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Update<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>End in 2023-03-08 0:44</p>
<p>è¿™ç§çœŸğŸ”8ï¸âƒ£ğŸ‘¨çš„æ–‡ç« çœŸæ˜¯çœ‹ç‚¹å°±çœ‹ä¸ä¸‹å»äº†ï¼Œæ˜å¤©æ¦‚ç‡è®ºï¼Œå…ˆç¡</p>
<p>æŸ<a href="https://daonan233.github.io" target="_blank" rel="noopener noreffer">55</a>ä»Šå¤©ç©äº†5h âšªï¼Œæ™šä¸Šå¸è½½ä¹‹åğŸ è‡ªå·±æ˜¯<b>S</b>ğŸ…±ï¸ï¼Œåªèƒ½è¯´æ˜¯dinnerè¡Œä¸ºäº†å§</p>
</div>
        </div>
    </div>
<h5 id="_initå‡½æ•°èµ·å§‹äºå¸¸è§„çš„cå‡½æ•°è°ƒç”¨"><code>_init</code>å‡½æ•°èµ·å§‹äºå¸¸è§„çš„Cå‡½æ•°è°ƒç”¨</h5>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Update<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>Update in 2023-03-08 10:04</p>
<p>ç¡é†’äº†ï¼Œæ„Ÿè§‰çœ‹äº†èƒ½æœ‰ä¸€åŠå¤šäº†ï¼Œä»Šå¤©å†çœ‹ç‚¹</p>
</div>
        </div>
    </div>
<ul>
<li>
<p>å¦‚æœæƒ³è¦è¯¦ç»†äº†è§£Cå‡½æ•°è°ƒç”¨è§„èŒƒï¼Œè¯·é˜…è¯»<a href="http://dbp-consulting.com/tutorials/debugging/basicAsmDebuggingGDB.html" target="_blank" rel="noopener noreffer">ã€ŠBasic Assembler Debugging with GDBã€‹</a></p>
</li>
<li>
<p>å¤§è‡´è¿‡ç¨‹</p>
<ul>
<li>è°ƒç”¨è€…çš„åŸºå€å¯„å­˜å™¨ï¼ˆ<code>%ebp</code>ï¼‰ä¼šè¢«ä¿å­˜åˆ°æ ˆé‡Œ(8048274)</li>
<li>å½“å‰å‡½æ•°çš„åŸºå€å¯„å­˜å™¨ï¼ˆ<code>%ebp</code>ï¼‰ä¼š<b>æŒ‡å‘æ ˆé¡¶</b>(8048275)</li>
<li>ç„¶åï¼Œ<b>ä¿ç•™4ä¸ªå­—èŠ‚ç©ºé—´</b>(8048278) $\Longrightarrow$ <u>æ›´å¥½çš„è§£é‡Šæ˜¯pushä¹‹å<code>%esp</code>è¦sub $0x4 æ¥ä¿è¯æ ˆæŒ‡é’ˆä»ç„¶æŒ‡å‘æ ˆé¡¶ï¼ˆæ ˆå‘ä¸‹å¢é•¿ï¼‰</u></li>
<li>è¿™ä¸ªè¿‡ç¨‹å’Œè°ƒç”¨<code>get_pc_trunk</code>éå¸¸åƒ</li>
</ul>
</li>
<li>
<p>è¦å¤§è‡´äº†è§£ä¸€ä¸‹stackå’Œfunctionè°ƒç”¨çš„å…³ç³»ï¼Œé˜…è¯»æ–‡ç« <a href="https://blog.csdn.net/max_ii_min/article/details/116047509?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167824270516800182771276%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=167824270516800182771276&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-116047509-null-null.142%5ev73%5ewechat,201%5ev4%5eadd_ask,239%5ev2%5einsert_chatgpt&amp;utm_term=esp%E5%AF%84%E5%AD%98%E5%99%A8&amp;spm=1018.2226.3001.4187" target="_blank" rel="noopener noreffer">ã€Šæ±‡ç¼–-æ ˆå¸§-å¯„å­˜å™¨esp, ebpã€‹</a></p>
</li>
<li>
<p>å¦‚æœä½ ä»”ç»†çœ‹çš„è¯ï¼Œå‘ç°è°ƒç”¨çš„æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Ÿï¼Ÿï¼Ÿå•¥æ“ä½œï¼Ÿï¼Ÿï¼Ÿ</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> 804827b:       e8 00 00 00 00          call   8048280 &lt;_init+0xc&gt;
</span></span><span class="line"><span class="cl"> 8048280:       5b                      pop    %ebx
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç»™äººæ„Ÿè§‰è¿™å°±æ˜¯åœ¨é¡ºåºæ‰§è¡Œï¼Œä¸è¿‡ä½ è¦ç”¨å‡½æ•°è°ƒç”¨çš„å‹æ ˆå‡ºæ ˆæ¥å¹²ä»€ä¹ˆï¼Ÿ
<ul>
<li>$\Longrightarrow$ <b>å½“å‰çš„åœ°å€è¢«å‹å…¥äº†æ ˆä¸­ã€‚ç„¶åé€šè¿‡å¼¹å‡ºæ ˆæ“ä½œï¼ŒåˆæŠŠå®ƒæ”¾åˆ°äº†<code>%ebx</code>ä¸­ï¼Œä¹‹åå°±å¯ä»¥ç”¨å®ƒæ¥è®¾ç½®è®¿é—®å…¨å±€è®¿é—®è¡¨äº†(.got.plt)</b></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> 8048277:       53                      push   %ebx
</span></span><span class="line"><span class="cl"> 8048278:       83 ec 04                sub    $0x4,%esp
</span></span><span class="line"><span class="cl"> 804827b:       e8 00 00 00 00          call   8048280 &lt;_init+0xc&gt;
</span></span><span class="line"><span class="cl"> 8048280:       5b                      pop    %ebx
</span></span><span class="line"><span class="cl"> 8048281:       81 c3 74 1d 00 00       add    $0x1d74,%ebx        (.got.plt)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="gmon_startå‡½æ•°åˆ†æ">gmon_startå‡½æ•°åˆ†æ</h4>
<h5 id="ç”Ÿæˆprofilehttpsenwikipediaorgwikiprofiling_computer_programmingæ–‡ä»¶">ç”Ÿæˆ<a href="https://en.wikipedia.org/wiki/Profiling_%28computer_programming%29" target="_blank" rel="noopener noreffer">profile</a>æ–‡ä»¶</h5>
<ul>
<li><code>gmon_start</code>å‡½æ•°ã€‚å¦‚æœå®ƒæ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬è·³è¿‡å®ƒï¼Œä¸è°ƒç”¨å®ƒã€‚å¦åˆ™ï¼Œè°ƒç”¨å®ƒæ¥è®¾ç½®profilingã€‚è¯¥å‡½æ•°è°ƒç”¨ä¸€ä¸ªä¾‹ç¨‹å¼€å§‹profilingï¼Œå¹¶ä¸”è°ƒç”¨<code>at_exit</code>å»è°ƒç”¨å¦ä¸€ä¸ªç¨‹åºè¿è¡Œ,å¹¶ä¸”åœ¨è¿è¡Œç»“æŸçš„æ—¶å€™ç”Ÿæˆgmon.out</li>
</ul>
<blockquote>
<p><em>ä¸ºäº†ä¼˜åŒ–è½¯ä»¶ä¸­é¢‘ç¹è°ƒç”¨çš„éƒ¨åˆ†ï¼Œä»è€Œæé«˜ç¨‹åºæ•´ä½“æ‰§è¡Œçš„æ•ˆç‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨gccç¼–è¯‘çš„æ—¶å€™åŠ ä¸Š</em> <code>-pg</code><em>æ ‡å¿—ã€‚è¿™æ ·åœ¨ç¨‹åºè¿è¡Œç»“æŸçš„æ—¶å€™ä¼šç”Ÿæˆä¸€ä¸ªè®°å½•ç¨‹åºè¿è¡ŒçŠ¶æ€çš„æ–‡ä»¶å«åš</em><code>gmon.out</code><em>ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåä¸º</em><code>gprof</code><em>çš„GNU profilerå·¥å…·æ¥åˆ†æè¯¥æ–‡ä»¶ä»è€Œè·å¾—ç¨‹åºå„éƒ¨åˆ†çš„è¿è¡Œæ—¶é—´ï¼Œæ¥åæ˜ å…¶è¿è¡Œæ€§èƒ½</em></p>
<p>ç›¸å…³æ–‡ç« ï¼š<a href="https://developer.ibm.com/" target="_blank" rel="noopener noreffer">ã€ŠHome IBM Developerã€‹</a></p>
</blockquote>
<h4 id="frame_dummyå‡½æ•°åˆ†æ">frame_dummyå‡½æ•°åˆ†æ</h4>
<ul>
<li><u>æ— è®ºé‚£ç§æƒ…å†µï¼ˆå‰é¢å‡½æ•°çš„æ‰§è¡Œæƒ…å†µï¼‰</u>(åŸæ–‡æ˜¯In either case)ï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬å°†è°ƒç”¨<code>frame_dummy</code>å‡½æ•°</li>
<li><code>frame_dummy</code>å‡½æ•°çš„ç›®çš„æ˜¯è°ƒç”¨<code>__register_frame_info</code>å‡½æ•°ï¼Œä½†æ˜¯ï¼Œè°ƒç”¨<code>frame_dummy</code>æ˜¯ä¸ºäº†ç»™ä¸Šè¿°å‡½æ•°è®¾ç½®å‚æ•°ã€‚è¿™ä¹ˆåšçš„ç›®çš„æ˜¯ä¸ºäº†åœ¨å‡ºé”™æ—¶è®¾ç½®<code>unwinding stack frames</code> $\Longrightarrow$ ä¸æ˜¯æœ¬æ¬¡é‡ç‚¹ï¼Œæƒ³äº†è§£è¯·é˜…è¯»<a href="https://stackoverflow.com/questions/2331316/what-is-stack-unwinding" target="_blank" rel="noopener noreffer">ã€ŠWhat is stack unwinding?ã€‹</a></li>
</ul>
<h4 id="_do_global_ctors_aux-longrightarrow-finally-were-getting-constructive"><code>_do_global_ctors_aux</code> $\Longrightarrow$ Finally we&rsquo;re getting constructive!</h4>
<ul>
<li>å¦‚æœåœ¨è°ƒç”¨mainå‡½æ•°ä¹‹å‰ï¼Œä½ çš„ç¨‹åºå‡ºäº†é—®é¢˜ï¼Œä½ å¾ˆå¯èƒ½éœ€è¦çœ‹çœ‹è¿™ä¸ªå‡½æ•°ã€‚å½“ç„¶ï¼Œè¿™é‡Œå­˜æ”¾äº†å…¨å±€C++å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œä½†æ˜¯ï¼Œè¿™é‡Œä¹Ÿèƒ½å­˜æ”¾å…¶ä»–ä¸œè¥¿ã€‚</li>
</ul>
<h5 id="example">Example</h5>
<ul>
<li>æˆ‘ä»¬æŠŠprog1.cä¿®æ”¹ä¸ºprog2.c</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">__attribute__</span> <span class="p">((</span><span class="n">constructor</span><span class="p">))</span> <span class="n">a_constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><code>void __attribute__ ((constructor)) a_constructor()</code>ï¼šå®ƒå‘Šè¯‰GCCï¼šé“¾æ¥å™¨åº”è¯¥åœ¨<code>__do_global_ctors_aux</code>ä½¿ç”¨çš„è¡¨é‡Œåˆ›å»ºä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘è¿™é‡Œ</p>
</li>
<li>
<p><code>__FUNCTION__</code>è¢«ç¼–è¯‘å™¨æ›¿æ¢æˆäº†å½“å‰å‡½æ•°çš„åå­—</p>
</li>
<li>
<p>è¿è¡Œ</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ./prog2
</span></span><span class="line"><span class="cl">a_constructor
</span></span><span class="line"><span class="cl">main
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åç¼–è¯‘çœ‹ä¸€ä¸‹<code>_init</code>çš„æ±‡ç¼–ï¼ˆè‡ªå·±çš„Linuxä¸Šé¢ç¼–ä¸å‡ºæ¥çš„å¯ä»¥çœ‹ä¸€ä¸‹<a href="https://stackoverflow.com/questions/27900834/do-global-ctors-aux-not-shown-in-objdump" target="_blank" rel="noopener noreffer">ã€Š__do_global_ctors_aux not shown in objdumpã€‹</a>ï¼Œä¸è¿‡çœ‹æ–‡ç« å°±è¡Œäº†ï¼‰</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">08048290 &lt;_init&gt;:
</span></span><span class="line"><span class="cl"> 8048290:       55                      push   %ebp
</span></span><span class="line"><span class="cl"> 8048291:       89 e5                   mov    %esp,%ebp
</span></span><span class="line"><span class="cl"> 8048293:       53                      push   %ebx
</span></span><span class="line"><span class="cl"> 8048294:       83 ec 04                sub    $0x4,%esp
</span></span><span class="line"><span class="cl"> 8048297:       e8 00 00 00 00          call   804829c &lt;_init+0xc&gt;
</span></span><span class="line"><span class="cl"> 804829c:       5b                      pop    %ebx
</span></span><span class="line"><span class="cl"> 804829d:       81 c3 58 1d 00 00       add    $0x1d58,%ebx
</span></span><span class="line"><span class="cl"> 80482a3:       8b 93 fc ff ff ff       mov    -0x4(%ebx),%edx
</span></span><span class="line"><span class="cl"> 80482a9:       85 d2                   test   %edx,%edx
</span></span><span class="line"><span class="cl"> 80482ab:       74 05                   je     80482b2 &lt;_init+0x22&gt;
</span></span><span class="line"><span class="cl"> 80482ad:       e8 1e 00 00 00          call   80482d0 &lt;__gmon_start__@plt&gt;
</span></span><span class="line"><span class="cl"> 80482b2:       e8 d9 00 00 00          call   8048390 &lt;frame_dummy&gt;
</span></span><span class="line"><span class="cl"> 80482b7:       e8 94 01 00 00          call   8048450 &lt;__do_global_ctors_aux&gt;
</span></span><span class="line"><span class="cl"> 80482bc:       58                      pop    %eax
</span></span><span class="line"><span class="cl"> 80482bd:       5b                      pop    %ebx
</span></span><span class="line"><span class="cl"> 80482be:       c9                      leave
</span></span><span class="line"><span class="cl"> 80482bf:       c3                      ret
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸Šè¿°çš„åœ°å€å’Œprog1çš„åœ°å€ç•¥å¾®æœ‰æ‰€ä¸åŒã€‚<u>è¿™äº›æœ‰å·®å¼‚çš„åœ°å€ä¼¼ä¹ç›¸å¯¹äºprog1ç§»åŠ¨äº†28ä¸ªå­—èŠ‚</u>ã€‚<b>è¿™é‡Œï¼Œæœ‰ä¸¤ä¸ªå‡½æ•°ï¼š<code>&quot;a_constructor&quot;</code>ï¼ˆåŠ ä¸Šç»“æŸç¬¦ä¸€å…±14ä¸ªå­—èŠ‚ï¼‰ã€<code>&quot;main&quot;</code>ï¼ˆåŠ ä¸Šç»“æŸç¬¦ä¸€å…±5ä¸ªå­—èŠ‚ï¼‰å’Œä¸¤ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²<code>&quot;%s\n&quot;</code>ï¼ˆ2*4ä¸ªå­—èŠ‚ï¼ŒåŠ ä¸Šä¸€ä¸ª1å­—èŠ‚çš„æ¢è¡Œç¬¦å’Œç»ˆæ­¢ç¬¦ï¼‰ï¼Œæ‰€ä»¥14 + 5 + 4 + 4 = 27ï¼Ÿ ä¼¼ä¹è¿˜å·®ä¸€ä¸ª</b>ã€‚ä¸ç®¡æ€æ ·ï¼Œè¿™åªæ˜¯ä¸ªçŒœæƒ³ï¼Œæˆ‘å°±ä¸ä»”ç»†ç ”ç©¶äº†ã€‚ç„¶åæˆ‘ä»¬å°±è¦è·³å…¥åˆ°<code>__do_global_ctors_aux</code>å‡½æ•°ä¸­å»ï¼Œçœ‹çœ‹åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚</li>
</ul>
<h5 id="æºç -1">æºç </h5>
<ul>
<li>ä½äºGCCæºç ä¸­çš„gcc/crtstuff.cé‡Œ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">__do_global_ctors_aux</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">func_ptr</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">p</span> <span class="o">=</span> <span class="n">__CTOR_END__</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">*</span><span class="n">p</span> <span class="o">!=</span> <span class="p">(</span><span class="n">func_ptr</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">p</span><span class="o">--</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¦‚ä¸Šæ‰€ç¤ºï¼Œpçš„å€¼è¢«åˆå§‹åŒ–æˆ<code>__CTOR_END__</code>å‡å»ä¸€ä¸ªå­—èŠ‚ã€‚è¿™æ˜¯ä¸€ç§æŒ‡é’ˆç®—æ³•
<ul>
<li><b>å¦‚æœæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ-1è¡¨ç¤ºå‘ä¸Šç§»åŠ¨ä¸€ä¸ªæŒ‡é’ˆæˆ–è€…è¯´4ä¸ªå­—èŠ‚</b>ã€‚<u>We&rsquo;ll see that in the assembler as well. While the pointer doesn&rsquo;t have a value of -1 (cast to a pointer), we&rsquo;ll call the function we&rsquo;re pointing at, and then back the pointer up again</u></li>
<li>è¿™ä¸ªæŒ‡é’ˆæ•°ç»„èµ·å§‹äº-1ï¼Œå¹¶ä¸”åŒ…å«è‹¥å¹²ä¸ªå‡½æ•°æŒ‡é’ˆ</li>
</ul>
</li>
</ul>
<h5 id="å¯¹åº”çš„æ±‡ç¼–">å¯¹åº”çš„æ±‡ç¼–</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">08048450 &lt;__do_global_ctors_aux&gt;:
</span></span><span class="line"><span class="cl"> 8048450:       55                      push   %ebp
</span></span><span class="line"><span class="cl"> 8048451:       89 e5                   mov    %esp,%ebp
</span></span><span class="line"><span class="cl"> 8048453:       53                      push   %ebx
</span></span><span class="line"><span class="cl"> 8048454:       83 ec 04                sub    $0x4,%esp
</span></span><span class="line"><span class="cl"> 8048457:       a1 14 9f 04 08          mov    0x8049f14,%eax
</span></span><span class="line"><span class="cl"> 804845c:       83 f8 ff                cmp    $0xffffffff,%eax
</span></span><span class="line"><span class="cl"> 804845f:       74 13                   je     8048474 &lt;__do_global_ctors_aux+0x24&gt;
</span></span><span class="line"><span class="cl"> 8048461:       bb 14 9f 04 08          mov    $0x8049f14,%ebx
</span></span><span class="line"><span class="cl"> 8048466:       66 90                   xchg   %ax,%ax
</span></span><span class="line"><span class="cl"> 8048468:       83 eb 04                sub    $0x4,%ebx
</span></span><span class="line"><span class="cl"> 804846b:       ff d0                   call   *%eax
</span></span><span class="line"><span class="cl"> 804846d:       8b 03                   mov    (%ebx),%eax
</span></span><span class="line"><span class="cl"> 804846f:       83 f8 ff                cmp    $0xffffffff,%eax
</span></span><span class="line"><span class="cl"> 8048472:       75 f4                   jne    8048468 &lt;__do_global_ctors_aux+0x18&gt;
</span></span><span class="line"><span class="cl"> 8048474:       83 c4 04                add    $0x4,%esp
</span></span><span class="line"><span class="cl"> 8048477:       5b                      pop    %ebx
</span></span><span class="line"><span class="cl"> 8048478:       5d                      pop    %ebp
</span></span><span class="line"><span class="cl"> 8048479:       c3                      ret
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="å‡½æ•°æœ€å¼€å§‹çš„éƒ¨åˆ†">å‡½æ•°æœ€å¼€å§‹çš„éƒ¨åˆ†</h5>
<ul>
<li>å‡½æ•°æœ€å¼€å§‹çš„éƒ¨åˆ†ä¾ç„¶éµä»äº†Cå‡½æ•°æ­£å¸¸çš„è°ƒç”¨æƒ¯ä¾‹ï¼ˆä¿å­˜è°ƒç”¨è€…çš„æ ˆåŸºå€å¯„å­˜å™¨ï¼Œè®¾ç½®å½“å‰å‡½æ•°çš„æ ˆåŸºå€å¯„å­˜å™¨ï¼‰ï¼Œæœ¬å‡½æ•°ä¸­è¿˜å¢åŠ äº†ä¸€ç‚¹ï¼šé¢å¤–æŠŠ<code>%ebx</code>ä¿å­˜åˆ°äº†æ ˆä¸­ï¼Œå› ä¸ºè¿™ä¸ªå‡½æ•°åé¢ä¼šä½¿ç”¨åˆ°å®ƒã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¸ºï¼ˆCä»£ç ä¸­çš„ï¼‰æŒ‡é’ˆpä¿ç•™äº†ç©ºé—´ã€‚ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œå³ä½¿æˆ‘ä»¬åœ¨æ ˆä¸Šä¸ºå…¶å¼€è¾Ÿäº†ç©ºé—´ï¼Œä½†æ˜¯ä»æœªä½¿ç”¨è¿™éƒ¨åˆ†ç©ºé—´ã€‚<b>å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œ<code>p</code>å°†ä¼šä¿å­˜åˆ°<code>%ebx</code>ä¸­ï¼Œ<code>*p</code>ä¼šä¿å­˜åˆ°<code>%eax</code>ä¸­</b>ã€‚$\Longrightarrow$ æ³¨æ„çœ‹å‰é¢_initçš„æ±‡ç¼–ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ ˆé‡Œé¢å¼¹å‡ºæ¥çš„ä¸œè¥¿ï¼Œåœ¨æœ¬å‡½æ•°çš„æ±‡ç¼–é‡Œé¢æ²¡æ‰¾åˆ° ï¼ˆâ“œï¸Dï¼ŒçœŸTMéš¾æ‰¾ï¼‰</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> 80482b7:       e8 94 01 00 00          call   8048450 &lt;__do_global_ctors_aux&gt;
</span></span><span class="line"><span class="cl"> 80482bc:       58                      pop    %eax
</span></span><span class="line"><span class="cl"> 80482bd:       5b                      pop    %ebx
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="å¾ªç¯ä¹‹å‰çš„è®¾ç½®">å¾ªç¯ä¹‹å‰çš„è®¾ç½®</h5>
<ul>
<li>çœ‹èµ·æ¥ç¼–è¯‘å™¨åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œç¼–è¯‘å™¨å¹¶æ²¡æœ‰ç›´æ¥â€œåŠ è½½<code>__CTOR_END__</code>ï¼Œç„¶åå°†å…¶å€¼å‡å»1ï¼Œå†æŸ¥æ‰¾å®ƒæŒ‡å‘çš„å†…å®¹â€ï¼Œè€Œæ˜¯ç›´æ¥åŠ è½½<code>*(__CTOR_END__ - 1)</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªç«‹å³æ•°<code>0x8049f14</code>ï¼ˆæ³¨æ„ï¼Œ<code>$0x8049f14</code>æ„æ€æ˜¯ä¸€ä¸ªç«‹å³æ•°ï¼Œè€Œä¸å¸¦<code>$</code>ï¼Œåªå†™<code>0x8049f14</code>çš„æ„æ€æ˜¯è¿™ä¸ªåœ°å€æŒ‡å‘çš„å†…å®¹ï¼‰ã€‚è¿™ä¸ªæ•°é‡Œé¢çš„å†…å®¹è¢«ç›´æ¥æ”¾åˆ°äº†%eaxä¸­ï¼Œç„¶åç«‹åˆ»æ¯”è¾ƒ%eaxå’Œ-1ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™è·³è½¬åˆ°åœ°å€0x8048474ï¼Œå›æ”¶æ ˆï¼Œå¼¹å‡ºæˆ‘ä»¬ä¿å­˜åœ¨æ ˆé‡Œçš„å†…å®¹ï¼Œå‡½æ•°è°ƒç”¨ç»“æŸï¼Œè¿”å›ã€‚</li>
<li>å‡è®¾åœ¨å‡½æ•°è¡¨ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå€¼ï¼Œç«‹å³æ•°<code>0x8049f14</code>è¢«å­˜æ”¾åˆ°<code>%ebx</code>ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°æŒ‡é’ˆ<code>p</code>ï¼Œç„¶åæ‰§è¡ŒæŒ‡ä»¤<code>xchg %ax,%ax</code>ï¼Œè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ$\Downarrow$</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> 8048461:       bb 14 9f 04 08          mov    $0x8049f14,%ebx
</span></span><span class="line"><span class="cl"> 8048466:       66 90                   xchg   %ax,%ax
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><b>åŸæ¥è¿™æ˜¯X86 16æˆ–è€…32ä½é‡Œçš„ä¸€ä¸ªnopï¼ˆNo Operationï¼‰è¯­å¥ã€‚å®ƒä»€ä¹ˆä¹Ÿä¸åšï¼Œåªæ˜¯å æ®äº†ä¸€ä¸ªæŒ‡ä»¤å‘¨æœŸï¼Œèµ·ä¸€ä¸ªå ä½ç¬¦ä½œç”¨è€Œå·²ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿å¾ªç¯å¼€å§‹äº<code>8048468</code>ï¼Œè€Œä¸æ˜¯<code>8048466</code>ã€‚<u>è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯ä½¿å¾ªç¯å¼€å§‹çš„åœ°æ–¹ä»¥4å­—èŠ‚å¯¹é½ï¼Œè¿™æ ·æ•´ä¸ªå¾ªç¯å°†ä¼šæå¤§å¯èƒ½çš„è¢«ä¿å­˜åˆ°ä¸€ä¸ªcache lineé‡Œï¼Œè€Œä¸ä¼šè¢«åˆ†æˆä¸¤æ®µï¼Œä»è€Œèµ·åˆ°åŠ é€Ÿæ‰§è¡Œçš„ä½œç”¨</u></b> ï¼ˆè¿™æ®µæ„Ÿè§‰ç¼–è¯‘å™¨å¥½ğŸ®ğŸ…±ï¸å•Šï¼‰</li>
<li>æ¥ä¸‹æ¥ï¼Œå°†<code>%ebx</code>å‡å»4ï¼Œä»è€Œä¸ºä¸‹ä¸€æ¬¡å¾ªç¯åšå¥½å‡†å¤‡ï¼Œè°ƒç”¨<code>%eax</code>é‡Œä¿å­˜çš„åœ°å€å¯¹åº”çš„å‡½æ•°ï¼Œç„¶åå°†ä¸‹ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆç§»è‡³<code>%eax</code>ä¸­ï¼Œå¹¶ä¸”å’Œ-1æ¯”è¾ƒï¼Œå¦‚æœä¸ç­‰äº-1ï¼Œå†æ¬¡è°ƒå›åˆ°ä¸Šè¿°å¾ªç¯</li>
</ul>
<h5 id="and-finally-the-epilogue">And finally the epilogue</h5>
<p>Otherwise we fall through into our function epilogue and return to <strong>_init</strong>, which immediately falls through into its epilogue and returns to <strong><strong>libc_csu_init</strong></strong>. Bet you forgot all about him. There&rsquo;s still a loop to deal with there but first&ndash;</p>
<h5 id="ä½¿ç”¨gdbæ£€æµ‹prog2">ä½¿ç”¨gdbæ£€æµ‹prog2</h5>
<ul>
<li><b>GDBæ€»æ˜¯æ˜¾ç¤ºä½ å°†è¦æ‰§è¡Œçš„ä¸‹ä¸€è¡Œæˆ–è€…ä¸‹ä¸€æ¡æŒ‡ä»¤</b></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ !gdb
</span></span><span class="line"><span class="cl">gdb prog2
</span></span><span class="line"><span class="cl">Reading symbols from /home/patrick/src/asm/prog2...done.
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> <span class="nb">set</span> disassemble-next-line on
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> b *0x80482b7
</span></span><span class="line"><span class="cl">Breakpoint <span class="m">1</span> at 0x80482b7
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¿è¡Œè°ƒè¯•å™¨ï¼Œæ‰“å¼€<code>disassemble-next-line</code>ï¼Œè¿™æ ·å®ƒå°±ä¼šæ€»æ˜¯æ˜¾ç¤ºä¸‹ä¸€æ¡å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„æ±‡ç¼–ä»£ç ï¼Œç„¶åæˆ‘ä»¬åœ¨<code>_init</code>å‡½æ•°å°†è¦è°ƒç”¨<code>__do_global_ctors_aux</code>å‡½æ•°çš„åœ°æ–¹è®¾ç½®ä¸€ä¸ªæ–­ç‚¹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> r
</span></span><span class="line"><span class="cl">Starting program: /home/patrick/src/asm/prog2 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Breakpoint 1, 0x080482b7 in _init <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080482b7 &lt;_init+39&gt;:    e8 <span class="m">94</span> <span class="m">01</span> <span class="m">00</span> <span class="m">00</span> call   0x8048450 &lt;__do_global_ctors_aux&gt;
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> si
</span></span><span class="line"><span class="cl">0x08048450 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048450 &lt;__do_global_ctors_aux+0&gt;:     <span class="m">55</span> push   %ebp
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¾“å…¥<code>r</code>ç»§ç»­è¿è¡Œç¨‹åºï¼Œåˆ°è¾¾æ–­ç‚¹å¤„ã€‚å†è¾“å…¥<code>si</code>å•æ­¥æ‰§è¡ŒæŒ‡ä»¤ï¼Œç°åœ¨æˆ‘ä»¬è¿›å…¥äº†<code>__do_global_ctors_aux</code>å‡½æ•°å†…éƒ¨ã€‚åé¢ä½ ä¼šçœ‹åˆ°è‹¥å¹²æ¬¡æˆ‘å¹¶æ²¡è¾“å…¥ä»»ä½•æŒ‡ä»¤ï¼Œä½†æ˜¯GDBå´ç»§ç»­æ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸ºæˆ‘åªæ˜¯æŒ‰äº†å›è½¦è€Œå·²ï¼ŒGDBé»˜è®¤ä¼šé‡å¤ä¸Šæ¡æŒ‡ä»¤ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘æŒ‰ä¸‹å›è½¦ï¼ŒGDBå°†ä¼šæŒ‰ç…§è¾“å…¥<code>si</code>ç»§ç»­æ‰§è¡Œ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span>
</span></span><span class="line"><span class="cl">0x08048451 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048451 &lt;__do_global_ctors_aux+1&gt;:     <span class="m">89</span> e5  mov    %esp,%ebp
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048453 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048453 &lt;__do_global_ctors_aux+3&gt;:     <span class="m">53</span> push   %ebx
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048454 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048454 &lt;__do_global_ctors_aux+4&gt;:     <span class="m">83</span> ec <span class="m">04</span>   sub    <span class="nv">$0</span>x4,%esp
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048457 in __do_global_ctors_aux <span class="o">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¥½çš„ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»æ‰§è¡Œå®Œç¨‹åºæœ€å¼€å§‹çš„éƒ¨åˆ†ï¼Œæ¥ä¸‹æ¥å°†è¦æ‰§è¡ŒçœŸæ­£çš„ä»£ç äº†ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048457 &lt;__do_global_ctors_aux+7&gt;:     a1 <span class="m">14</span> 9f <span class="m">04</span> <span class="m">08</span> mov    0x8049f14,%eax
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x0804845c in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x0804845c &lt;__do_global_ctors_aux+12&gt;:    <span class="m">83</span> f8 ff   cmp    <span class="nv">$0</span>xffffffff,%eax
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> p/x <span class="nv">$eax</span>
</span></span><span class="line"><span class="cl"><span class="nv">$1</span> <span class="o">=</span> 0x80483b4
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æˆ‘æƒ³çŸ¥é“åŠ è½½å®ŒæŒ‡é’ˆä¹‹åä¼šæ˜¯ä»€ä¹ˆæ ·ï¼Œæ‰€ä»¥è¾“å…¥äº†<code>p/x $eax</code>ï¼Œæ„æ€æ˜¯ä»¥åå…­è¿›åˆ¶çš„å½¢å¼æ‰“å°å¯„å­˜å™¨<code>%eax</code>çš„å†…å®¹ã€‚å®ƒä¸ç­‰äº-1ï¼Œæ‰€ä»¥æˆ‘ä»¬å‡å®šç¨‹åºå°†ç»§ç»­æ‰§è¡Œå¾ªç¯ã€‚ç°åœ¨ç”±äºæˆ‘çš„æœ€åä¸€æ¡æŒ‡ä»¤æ˜¯printæŒ‡ä»¤ï¼Œæ‰€ä»¥æˆ‘ä¸èƒ½æŒ‰å›è½¦ç»§ç»­æ‰§è¡Œäº†ï¼Œä¸‹æ¬¡æˆ‘å°±å¾—è¾“å…¥<code>si</code>äº†</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> si
</span></span><span class="line"><span class="cl">0x0804845f in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x0804845f &lt;__do_global_ctors_aux+15&gt;:    <span class="m">74</span> <span class="m">13</span>  je     0x8048474 &lt;__do_global_ctors_aux+36&gt;
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048461 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048461 &lt;__do_global_ctors_aux+17&gt;:    bb <span class="m">14</span> 9f <span class="m">04</span> <span class="m">08</span> mov    <span class="nv">$0</span>x8049f14,%ebx
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048466 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048466 &lt;__do_global_ctors_aux+22&gt;:    <span class="m">66</span> <span class="m">90</span>  xchg   %ax,%ax
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048468 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048468 &lt;__do_global_ctors_aux+24&gt;:    <span class="m">83</span> eb <span class="m">04</span>   sub    <span class="nv">$0</span>x4,%ebx
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x0804846b in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x0804846b &lt;__do_global_ctors_aux+27&gt;:    ff d0  call   *%eax
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">a_constructor <span class="o">()</span> at prog2.c:3
</span></span><span class="line"><span class="cl"><span class="m">3</span>   void __attribute__ <span class="o">((</span>constructor<span class="o">))</span> a_constructor<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080483b4 &lt;a_constructor+0&gt;:     <span class="m">55</span> push   %ebp
</span></span><span class="line"><span class="cl">   0x080483b5 &lt;a_constructor+1&gt;:     <span class="m">89</span> e5  mov    %esp,%ebp
</span></span><span class="line"><span class="cl">   0x080483b7 &lt;a_constructor+3&gt;:     <span class="m">83</span> ec <span class="m">18</span>   sub    <span class="nv">$0</span>x18,%esp
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>è¿™éƒ¨åˆ†ä»£ç å¾ˆæœ‰æ„æ€ã€‚æˆ‘ä»¬ä¸€æ­¥æ­¥è°ƒç”¨æ¥çœ‹çœ‹ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»è¿›å…¥äº†æˆ‘ä»¬è‡ªå·±å†™çš„å‡½æ•°<code>a_constructor</code>ã€‚å› ä¸ºGDBæ˜¯èƒ½çœ‹åˆ°æˆ‘ä»¬çš„æºä»£ç çš„ï¼Œæ‰€ä»¥å®ƒåœ¨ä¸‹ä¸€è¡Œç»™å‡ºäº†æˆ‘ä»¬æºç ã€‚åˆå› ä¸ºæˆ‘æ‰“å¼€äº†<code>disassemble-next-line</code>ï¼Œæ‰€ä»¥å®ƒä¹Ÿä¼šç»™å‡ºå¯¹åº”çš„æ±‡ç¼–ä»£ç ã€‚è¿™ä¸ªä¾‹å­ä¸­è¾“å‡ºäº†å‡½æ•°æœ€å¼€å§‹çš„éƒ¨åˆ†ï¼Œå¯¹åº”äº†å‡½æ•°çš„å£°æ˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°äº†ä¸‰è¡Œæ±‡ç¼–ã€‚æœ‰æ„æ€å§ï¼Ÿç°åœ¨ï¼Œæˆ‘è¾“å…¥<code>n</code>å‘½ä»¤ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†™çš„<code>prinf</code>å°±ä¼šè¢«è°ƒç”¨äº†ã€‚ç¬¬ä¸€ä¸ªnè·³è¿‡äº†ç¨‹åºæœ€å¼€å§‹çš„éƒ¨åˆ†ï¼Œç¬¬äºŒä¸ªnæ‰§è¡Œprinfï¼Œç¬¬ä¸‰ä¸ªnæ‰§è¡Œäº†å‡½æ•°çš„ç»“å°¾éƒ¨åˆ†ã€‚å¦‚æœä½ æƒ³çŸ¥é“ä¸ºä»€ä¹ˆä½ éœ€è¦åœ¨å‡½æ•°æœ€å¼€å§‹å’Œç»“æŸéƒ¨åˆ†åšäº›å¤„ç†çš„è¯ï¼Œç°åœ¨ï¼Œä½ ä½¿ç”¨GDBçš„å•æ­¥è°ƒè¯•åº”è¯¥èƒ½çŸ¥é“ç­”æ¡ˆäº†å§ã€‚</p>
</li>
<li>
<p>ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»æŠŠ<code>a_constructor</code>å­—ç¬¦ä¸²çš„åœ°å€ä½œä¸º<code>printf</code>çš„å‚æ•°ä¿å­˜åˆ°äº†æ ˆé‡Œï¼Œå› ä¸ºç¼–è¯‘å™¨è¶³å¤Ÿçš„æ™ºèƒ½ï¼Œå‘ç°å®é™…ä¸Š<code>puts</code>å‡½æ•°æ‰æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæ‰€ä»¥å®ƒè°ƒç”¨äº†<code>puts</code>å‡½æ•°ã€‚</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(gdb) n
</span></span><span class="line"><span class="cl">4       printf(&#34;%s\n&#34;, __FUNCTION__);
</span></span><span class="line"><span class="cl">=&gt; 0x080483ba &lt;a_constructor+6&gt;:     c7 04 24 a5 84 04 08   movl   $0x80484a5,(%esp)
</span></span><span class="line"><span class="cl">   0x080483c1 &lt;a_constructor+13&gt;:    e8 2a ff ff ff call   0x80482f0 &lt;puts@plt&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å› ä¸ºæˆ‘ä»¬æ­£åœ¨è¿è¡Œä¸­æ¥è°ƒè¯•ç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°äº†a_constructoræ‰“å°å‡ºäº†ä¸Šé¢çš„å†…å®¹ã€‚åæ‹¬å·}å¯¹åº”äº†å‡½æ•°çš„ç»“å°¾éƒ¨åˆ†</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> n
</span></span><span class="line"><span class="cl">a_constructor
</span></span><span class="line"><span class="cl"><span class="m">5</span>   <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080483c6 &lt;a_constructor+18&gt;:    c9 leave  
</span></span><span class="line"><span class="cl">   0x080483c7 &lt;a_constructor+19&gt;:    c3 ret 
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æœ‰å…³<code>leave</code>æŒ‡ä»¤å®é™…æ“ä½œ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> movl %ebp, %esp
</span></span><span class="line"><span class="cl"> popl %ebp
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç»§ç»­æ‰§è¡Œï¼Œæˆ‘ä»¬å°±é€€å‡ºäº†å‡½æ•°ï¼Œå¹¶è¿”å›äº†è°ƒç”¨å‡½æ•°ã€‚è¿™é‡Œæˆ‘åˆä¸å¾—ä¸è¾“å…¥<code>si</code>äº†ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> n
</span></span><span class="line"><span class="cl">0x0804846d in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x0804846d &lt;__do_global_ctors_aux+29&gt;:    8b <span class="m">03</span>  mov    <span class="o">(</span>%ebx<span class="o">)</span>,%eax
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> si
</span></span><span class="line"><span class="cl">0x0804846f in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x0804846f &lt;__do_global_ctors_aux+31&gt;:    <span class="m">83</span> f8 ff   cmp    <span class="nv">$0</span>xffffffff,%eax
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048472 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048472 &lt;__do_global_ctors_aux+34&gt;:    <span class="m">75</span> f4  jne    0x8048468 &lt;__do_global_ctors_aux+24&gt;
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> p/x <span class="nv">$eax</span>
</span></span><span class="line"><span class="cl"><span class="nv">$2</span> <span class="o">=</span> 0xffffffff
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æˆ‘æ¯”è¾ƒå¥½å¥‡ï¼Œå¹¶ä¸”å†æ¬¡çœ‹äº†ä¸€ä¸‹ï¼šè¿™æ¬¡ï¼Œæˆ‘ä»¬çš„å‡½æ•°æŒ‡é’ˆæŒ‡å‘äº†-1ï¼Œæ‰€ä»¥ï¼Œç¨‹åºé€€å‡ºäº†å¾ªç¯</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> si
</span></span><span class="line"><span class="cl">0x08048474 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048474 &lt;__do_global_ctors_aux+36&gt;:    <span class="m">83</span> c4 <span class="m">04</span>   add    <span class="nv">$0</span>x4,%esp
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048477 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048477 &lt;__do_global_ctors_aux+39&gt;:    5b pop    %ebx
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048478 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048478 &lt;__do_global_ctors_aux+40&gt;:    5d pop    %ebp
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048479 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048479 &lt;__do_global_ctors_aux+41&gt;:    c3 ret    
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x080482bc in _init <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080482bc &lt;_init+44&gt;:    <span class="m">58</span> pop    %eax
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æˆ‘ä»¬ç°åœ¨é€€å›åˆ°äº†<code>_init</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x080482bd in _init <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080482bd &lt;_init+45&gt;:    5b pop    %ebx
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x080482be in _init <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080482be &lt;_init+46&gt;:    c9 leave  
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x080482bf in _init <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080482bf &lt;_init+47&gt;:    c3 ret    
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x080483f9 in __libc_csu_init <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080483f9 &lt;__libc_csu_init+25&gt;:  8d bb 1c ff ff ff  lea    -0xe4<span class="o">(</span>%ebx<span class="o">)</span>,%edi
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> q
</span></span><span class="line"><span class="cl">A debugging session is active.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Inferior <span class="m">1</span> <span class="o">[</span>process 17368<span class="o">]</span> will be killed.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Quit anyway? <span class="o">(</span>y or n<span class="o">)</span> y
</span></span><span class="line"><span class="cl">$
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å›åˆ°__libc_csu_init__">å›åˆ°<code>__libc_csu_init__</code></h4>
<ul>
<li>æºç </li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">__libc_csu_init</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">_init</span> <span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">size_t</span> <span class="n">size</span> <span class="o">=</span> <span class="n">__init_array_end</span> <span class="o">-</span> <span class="n">__init_array_start</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="o">*</span><span class="n">__init_array_start</span> <span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">envp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="è¿™æ˜¯å¦ä¸€ä¸ªå‡½æ•°çš„å¾ªç¯è°ƒç”¨">è¿™æ˜¯å¦ä¸€ä¸ªå‡½æ•°çš„å¾ªç¯è°ƒç”¨</h5>
<ul>
<li><code>__init__</code>æ•°ç»„é‡Œé¢æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä½ è‚¯å®šä¸ä¼šæƒ³åˆ°ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨è¿™ä¸ªé˜¶æ®µè‡ªå®šä¹‰ä»£ç ã€‚è¿™æ—¶åˆšåˆšä»è¿è¡Œæˆ‘ä»¬è‡ªå®šä¹‰çš„æ„é€ å‡½æ•°çš„<code>_init</code>å‡½æ•°è¿”å›ï¼Œè¿™æ„å‘³ç€ï¼Œåœ¨è¿™ä¸ªæ•°ç»„é‡Œé¢çš„å†…å®¹å°†ä¼šåœ¨æ„é€ å‡½æ•°å®Œæˆä¹‹åè¿è¡Œã€‚ä½ èƒ½é€šè¿‡æŸç§æ–¹å¼å‘Šè¯‰ç¼–è¯‘å™¨ä½ æƒ³åœ¨è¿™ä¸ªé˜¶æ®µè¿è¡ŒæŸä¸ªä½ è‡ªå®šä¹‰çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¹Ÿä¼šæ”¶åˆ°å’Œmainå‡½æ•°ç›¸åŒçš„å‚æ•°</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">&#34;.init_array&#34;</span><span class="p">)))</span> <span class="n">typeof</span><span class="p">(</span><span class="n">init</span><span class="p">)</span> <span class="o">*</span><span class="n">__init</span> <span class="o">=</span> <span class="n">init</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ç¨‹åºå°†è¿”å›__libc_start_main__">ç¨‹åºå°†è¿”å›<code>__libc_start_main__</code></h4>
<ul>
<li>å®ƒè°ƒç”¨äº†æˆ‘ä»¬çš„mainå‡½æ•°ï¼Œç„¶åæŠŠmainå‡½æ•°çš„è¿”å›å€¼ä¼ é€’ç»™exit()å‡½æ•°</li>
</ul>
<h5 id="exitå‡½æ•°è¿è¡Œäº†æ›´å¤šçš„å¾ªç¯">exit()å‡½æ•°è¿è¡Œäº†æ›´å¤šçš„å¾ªç¯</h5>
<ul>
<li>exit()å‡½æ•°æŒ‰ç…§æ³¨å†Œé¡ºåºä¾æ¬¡è¿è¡Œäº†åœ¨at_exit()ä¸­æ³¨å†Œçš„å‡½æ•°ã€‚ç„¶åä¼šè¿è¡Œå¦å¤–ä¸€ä¸ªå¾ªç¯ï¼Œè¿™æ¬¡çš„å¾ªç¯æ˜¯åœ¨<code>__fini_</code>æ•°ç»„ä¸­å®šä¹‰çš„ã€‚åœ¨è¿è¡Œå®Œè¿™äº›å‡½æ•°ä¹‹åï¼Œå°±ä¼šè°ƒç”¨ææ„å‡½æ•°ã€‚</li>
</ul>
<h3 id="è¿™ä¸ªç¨‹åºæŠŠä¸Šé¢æ‰€æœ‰çš„è¿‡ç¨‹è”ç³»äº†èµ·æ¥">è¿™ä¸ªç¨‹åºï¼ŒæŠŠä¸Šé¢æ‰€æœ‰çš„è¿‡ç¨‹è”ç³»äº†èµ·æ¥</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">preinit</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">fini</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">&#34;.init_array&#34;</span><span class="p">)))</span> <span class="n">typeof</span><span class="p">(</span><span class="n">init</span><span class="p">)</span> <span class="o">*</span><span class="n">__init</span> <span class="o">=</span> <span class="n">init</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">&#34;.preinit_array&#34;</span><span class="p">)))</span> <span class="n">typeof</span><span class="p">(</span><span class="n">preinit</span><span class="p">)</span> <span class="o">*</span><span class="n">__preinit</span> <span class="o">=</span> <span class="n">preinit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">&#34;.fini_array&#34;</span><span class="p">)))</span> <span class="n">typeof</span><span class="p">(</span><span class="n">fini</span><span class="p">)</span> <span class="o">*</span><span class="n">__fini</span> <span class="o">=</span> <span class="n">fini</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span>  <span class="nf">__attribute__</span> <span class="p">((</span><span class="n">constructor</span><span class="p">))</span> <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">__attribute__</span> <span class="p">((</span><span class="n">destructor</span><span class="p">))</span> <span class="n">destructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">my_atexit</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">my_atexit2</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">atexit</span><span class="p">(</span><span class="n">my_atexit</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="n">atexit</span><span class="p">(</span><span class="n">my_atexit2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç¼–è¯‘å¹¶è¿è¡Œè¿™ä¸ªå‡½æ•°ï¼ˆè¿™é‡Œæˆ‘å°†å…¶å‘½åä¸ºhooks.cï¼‰ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ./hooks
</span></span><span class="line"><span class="cl">preinit
</span></span><span class="line"><span class="cl">constructor
</span></span><span class="line"><span class="cl">init
</span></span><span class="line"><span class="cl">my_atexit2
</span></span><span class="line"><span class="cl">my_atexit
</span></span><span class="line"><span class="cl">fini
</span></span><span class="line"><span class="cl">destructor
</span></span><span class="line"><span class="cl">$
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å›é¡¾">å›é¡¾</h2>
<ul>
<li>è¿˜æ˜¯è¿™å¼ å›¾</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/support2-1.png" title="/img/Operating System/support2-1.png" data-thumbnail="/img/Operating System/support2-1.png" data-sub-html="<h2>æ€»ä½“æµç¨‹å›¾</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/support2-1.png"
            data-srcset="/img/Operating%20System/support2-1.png, /img/Operating%20System/support2-1.png 1.5x, /img/Operating%20System/support2-1.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/support2-1.png" />
    </a><figcaption class="image-caption">æ€»ä½“æµç¨‹å›¾</figcaption>
    </figure>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<ul>
<li>æ±‡ç¼–çœŸTMéš¾åˆ†æ</li>
<li>ç”±äºæ˜¯32ä½çš„è€Linuxï¼Œæ‰€ä»¥æ²¡èƒ½åœ¨è‡ªå·±çš„è™šæ‹Ÿæœºä¸Šé¢å¤ç°</li>
<li>æ¶‰åŠç¼–è¯‘å’Œé“¾æ¥çš„è¿‡ç¨‹ï¼Œåº”è¯¥å»è¡¥<a href="https://luomuxiaoxiao.com/?p=137" target="_blank" rel="noopener noreffer">ã€Šè®¡ç®—æœºåŸç†ç³»åˆ—ä¹‹ä¸‰ â€”â€”â€“ å¦‚ä½•ç¼–è¯‘ç›®æ ‡æ–‡ä»¶ã€‹</a>è¿™ç¯‡æ–‡ç« </li>
</ul>
<h2 id="ç›¸å…³å‚è€ƒèµ„æ–™">ç›¸å…³å‚è€ƒèµ„æ–™</h2>
<ul>
<li>å‚è€ƒæ–‡ç« 
<ul>
<li>
<p><a href="http://dbp-consulting.com/tutorials/debugging/linuxProgramStartup.html" target="_blank" rel="noopener noreffer">ã€ŠLinux x86 Program Start Up or - How the heck do we get to main()? by Patrick Horganã€‹</a></p>
</li>
<li>
<p><a href="https://luomuxiaoxiao.com/?p=516" target="_blank" rel="noopener noreffer">ã€ŠLinux X86 ç¨‹åºå¯åŠ¨ â€“ mainå‡½æ•°æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„ï¼Ÿâ€”â€”è½æœ¨è§è§çš„åšå®¢ã€‹</a>ï¼ˆå·²ä¸ä½œè€…æ²Ÿé€šï¼ŒåŒæ„éƒ¨åˆ†è½¬è½½ï¼‰</p>
</li>
<li>
<p><a href="https://www.gnu.org/software/hurd/glibc/startup.html" target="_blank" rel="noopener noreffer">ã€ŠHow libc startup in a process worksã€‹</a></p>
</li>
</ul>
</li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info"><div class="post-info-tag"><span><a href="/tags/operating-system/">Operating System</a>
                </span><span><a href="/tags/linux/">Linux</a>
                </span></div><div class="post-info-line"><div class="post-info-mod">
                <span>æ›´æ–°äº 2023-03-04</span>
            </div><div class="post-info-mod"></div>
        </div><div class="post-info-share">
            <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://Jungle430.github.io/posts/operating-system/support2/" data-title="Linux x86 Program Start Up or - How the heck do we get to main()?" data-hashtags="Operating System,Linux"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://Jungle430.github.io/posts/operating-system/support2/" data-hashtag="Operating System"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Linkedin" data-sharer="linkedin" data-url="https://Jungle430.github.io/posts/operating-system/support2/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° WhatsApp" data-sharer="whatsapp" data-url="https://Jungle430.github.io/posts/operating-system/support2/" data-title="Linux x86 Program Start Up or - How the heck do we get to main()?" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://Jungle430.github.io/posts/operating-system/support2/" data-title="Linux x86 Program Start Up or - How the heck do we get to main()?"><i class="fab fa-line fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://Jungle430.github.io/posts/operating-system/support2/" data-title="Linux x86 Program Start Up or - How the heck do we get to main()?"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Myspace" data-sharer="myspace" data-url="https://Jungle430.github.io/posts/operating-system/support2/" data-title="Linux x86 Program Start Up or - How the heck do we get to main()?" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Blogger" data-sharer="blogger" data-url="https://Jungle430.github.io/posts/operating-system/support2/" data-title="Linux x86 Program Start Up or - How the heck do we get to main()?" data-description=""><i class="fab fa-blogger fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° ç™¾åº¦" data-sharer="baidu" data-url="https://Jungle430.github.io/posts/operating-system/support2/" data-title="Linux x86 Program Start Up or - How the heck do we get to main()?"><i data-svg-src="/lib/simple-icons/icons/baidu.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Evernote" data-sharer="evernote" data-url="https://Jungle430.github.io/posts/operating-system/support2/" data-title="Linux x86 Program Start Up or - How the heck do we get to main()?"><i class="fab fa-evernote fa-fw"></i></a></span>
        </div></div><div class="post-nav"><a href="/posts/java/biginteger/" class="prev" rel="prev" title="é€Ÿé€šBigInteger"><i class="fas fa-angle-left fa-fw"></i>Previous Post</a>
            <a href="/posts/operating-system/operating-system-chapter4/" class="next" rel="next" title="Operating System Chapter4 ç†è§£å¹¶å‘ç¨‹åºæ‰§è¡Œ">Next Post<i class="fas fa-angle-right fa-fw"></i></a></div></div>
</div></article></div>
            </main>
            <footer class="footer"><div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.105.0">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/khusika/FeelIt" target="_blank" rel="noopener noreffer" title="FeelIt 1.0.1"><i class="fas fa-hand-holding-heart fa-fw"></i> FeelIt</a>
        </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/Jungle430">Jungle</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
</div>
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker
        .register('/sw.min.js?version=0.0.1', { scope: '/' })
        .then(() => {
            console.info('Jungle\u0027s Blog\u00A0Service Worker Registered');
        }, err => console.error('Jungle\u0027s Blog\u00A0Service Worker registration failed: ', err));

    navigator.serviceWorker
        .ready
        .then(() => {
            console.info('Jungle\u0027s Blog\u00A0Service Worker Ready');
        });
}
</script>
</footer>
        </div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-chevron-up fa-fw"></i>
            </a></div><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.fill%2CArray.prototype.find%2CArray.from%2CIntersectionObserver%2CMath.sign%2CObject.assign%2CPromise%2CObject.entries%2Chtml5shiv%2CObject.values%2Cfetch%2CElement.prototype.after"></script><script src="/lib/autocomplete/autocomplete.min.js"></script><script src="/lib/lunr/lunr.min.js"></script><script src="/lib/lunr/lunr.stemmer.support.min.js"></script><script src="/lib/lunr/lunr.zh.min.js"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script src="/lib/katex/katex.min.js"></script><script src="/lib/katex/auto-render.min.js"></script><script src="/lib/katex/copy-tex.min.js"></script><script src="/lib/katex/mhchem.min.js"></script><script>window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":100},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":50}};</script><script src="/js/theme.min.js"></script></body></html>
