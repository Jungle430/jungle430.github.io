<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>CMU 15-445 Lecture #17: Two-Phase Locking - Jungle&#39;s Blog</title><meta name="description" content="Welcome to Jungle&#39;s blog."><meta property="og:title" content="CMU 15-445 Lecture #17: Two-Phase Locking" />
<meta property="og:description" content="CMU 15-445 Database Systems Lecture #17: Two-Phase Locking Transaction Locks åœ¨æ“ä½œæ•°æ®çš„æ—¶å€™é€šè¿‡DBMSçš„é”ç®¡ç†å™¨ç»™æ•°æ®ä¸Šä¸€æŠŠé”ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å¹¶å‘çš„æ•°æ®ç«äº‰é—®é¢˜ ä½†æ˜¯è¿™ä¸ªé”æ€ä¹ˆåŠ æ€ä¹ˆè§£çš„æ–¹æ¡ˆéœ€è¦è®¾" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter17/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-04-19T17:58:06+08:00" />
<meta property="article:modified_time" content="2024-04-19T17:58:06+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CMU 15-445 Lecture #17: Two-Phase Locking"/>
<meta name="twitter:description" content="CMU 15-445 Database Systems Lecture #17: Two-Phase Locking Transaction Locks åœ¨æ“ä½œæ•°æ®çš„æ—¶å€™é€šè¿‡DBMSçš„é”ç®¡ç†å™¨ç»™æ•°æ®ä¸Šä¸€æŠŠé”ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å¹¶å‘çš„æ•°æ®ç«äº‰é—®é¢˜ ä½†æ˜¯è¿™ä¸ªé”æ€ä¹ˆåŠ æ€ä¹ˆè§£çš„æ–¹æ¡ˆéœ€è¦è®¾"/>
<meta name="application-name" content="Jungle&#39;s blog">
<meta name="apple-mobile-web-app-title" content="Jungle&#39;s blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter17/" /><link rel="prev" href="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter16/" /><link rel="next" href="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter18/" /><link rel="stylesheet" href="/css/page.min.css"><link rel="stylesheet" href="/css/home.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "CMU 15-445 Lecture #17: Two-Phase Locking",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/Jungle430.github.io\/posts\/cmu-15-445-database-systems\/chapter17\/"
        },"genre": "posts","keywords": "Database Systems","wordcount":  1358 ,
        "url": "https:\/\/Jungle430.github.io\/posts\/cmu-15-445-database-systems\/chapter17\/","datePublished": "2024-04-19T17:58:06+08:00","dateModified": "2024-04-19T17:58:06+08:00","publisher": {
            "@type": "Organization",
            "name": "Jungle"},"author": {
                "@type": "Person",
                "name": "Jungle"
            },"description": ""
    }
    </script></head><body data-header-desktop="fixed" data-header-mobile="auto"><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Jungle&#39;s Blog">Jungle&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/">ğŸ“š æ–‡ç«  </a><a class="menu-item" href="/tags/">ğŸ·ï¸ æ ‡ç­¾ </a><a class="menu-item" href="/categories/">ğŸ—ƒï¸ åˆ†ç±» </a><a class="menu-item" href="/about/">ğŸ‘´ å…³äº </a><a class="menu-item" href="https://github.com/Jungle430" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Jungle&#39;s Blog">Jungle&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">ğŸ“šæ–‡ç« </a><a class="menu-item" href="/tags/" title="">ğŸ·ï¸æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">ğŸ—ƒï¸åˆ†ç±»</a><a class="menu-item" href="/about/" title="">ğŸ‘´å…³äº</a><a class="menu-item" href="https://github.com/Jungle430" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><div class="menu-item"><a href="javascript:void(0);" class="theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single" data-toc="enable"><div class="single-card" ><h2 class="single-title animated flipInX">CMU 15-445 Lecture #17: Two-Phase Locking</h2><div class="post-meta">
                <div class="post-meta-line"><span class="post-author"><a href="https://github.com/Jungle430" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Jungle</a></span>&nbsp;<span class="post-category">å‡ºç‰ˆäº  <a href="/categories/cmu-15-445-database-systems/"><i class="far fa-folder fa-fw"></i>CMU 15-445 Database Systems</a></span></div>
                <div class="post-meta-line"><span><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2024-04-19">2024-04-19</time></span>&nbsp;<span><i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 1358 å­—</span>&nbsp;
                    <span><i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 3 åˆ†é’Ÿ</span>&nbsp;</div>
            </div>
            
            <hr><div class="details toc" id="toc-static"  data-kept="">
                    <div class="details-summary toc-title">
                        <span>ç›®å½•</span>
                        <span><i class="details-icon fas fa-angle-right"></i></span>
                    </div>
                    <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#lecture-17-two-phase-locking">Lecture #17: Two-Phase Locking</a>
      <ul>
        <li><a href="#transaction-locks">Transaction Locks</a></li>
        <li><a href="#two-phase-locking2pl">Two-Phase Locking(2PL)</a></li>
        <li><a href="#deadlock-handling">Deadlock Handling</a></li>
        <li><a href="#lock-granularities">Lock Granularities</a></li>
        <li><a href="#conclusion">CONCLUSION</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
                </div><div class="content" id="content"><h1 id="cmu-15-445-database-systems">CMU 15-445 Database Systems</h1>
<h2 id="lecture-17-two-phase-locking">Lecture #17: Two-Phase Locking</h2>
<h3 id="transaction-locks">Transaction Locks</h3>
<ul>
<li>
<p>åœ¨æ“ä½œæ•°æ®çš„æ—¶å€™é€šè¿‡DBMSçš„é”ç®¡ç†å™¨ç»™æ•°æ®ä¸Šä¸€æŠŠé”ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å¹¶å‘çš„æ•°æ®ç«äº‰é—®é¢˜</p>
</li>
<li>
<p>ä½†æ˜¯è¿™ä¸ªé”æ€ä¹ˆåŠ æ€ä¹ˆè§£çš„æ–¹æ¡ˆéœ€è¦è®¾è®¡</p>
</li>
</ul>
<figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter17-1.png" title="/img/CMU 15-445 Database Systems/chapter17-1.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter17-1.png" data-sub-html="<h2>åˆ©ç”¨é”ä¿è¯æ•°æ®å®‰å…¨</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter17-1.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter17-1.png, /img/CMU%2015-445%20Database%20Systems/chapter17-1.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter17-1.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter17-1.png" />
    </a><figcaption class="image-caption">åˆ©ç”¨é”ä¿è¯æ•°æ®å®‰å…¨</figcaption>
    </figure>
<ul>
<li>
<p><strong>Lock Types</strong></p>
<ul>
<li><strong>S-LOCK</strong>: Shared locks for reading(Reading Lock)</li>
<li><strong>X-LOCK</strong>: Exclusive locks for writing(Writing Lock)</li>
</ul>
</li>
<li>
<p>ä»…ä»…W(R)çš„æ—¶å€™ä¸Šé”ï¼Œä¿®æ”¹å®Œäº†è§£é”æ˜¯æ— æ³•ä¿®å¤ä¸²è¡ŒåŒ–å¸¦æ¥çš„é—®é¢˜ï¼Œå› ä¸ºè¿™ä¸ªæ“ä½œåœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œé¢åªæ˜¯ä¸€æ®µï¼Œæ²¡æœ‰é”è¿™ä¸ªäº‹åŠ¡</p>
</li>
</ul>
<figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter17-2.png" title="/img/CMU 15-445 Database Systems/chapter17-2.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter17-2.png" data-sub-html="<h2>lock -&gt; W(R) -&gt; unlockä¸‹çš„ä¸²è¡Œé—®é¢˜</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter17-2.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter17-2.png, /img/CMU%2015-445%20Database%20Systems/chapter17-2.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter17-2.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter17-2.png" />
    </a><figcaption class="image-caption">lock -&gt; W(R) -&gt; unlockä¸‹çš„ä¸²è¡Œé—®é¢˜</figcaption>
    </figure>
<h3 id="two-phase-locking2pl">Two-Phase Locking(2PL)</h3>
<ul>
<li>è¿™ä¸ªå°±æ˜¯åé¢çš„ç ”ç©¶äººå‘˜ä¸ºäº†é¿å…ä¸Šé¢åŠ é”è¿˜æ˜¯æ²¡æœ‰è§£å†³å¹¶å‘é—®é¢˜æå‡ºæ¥çš„ä¸€ä¸ªç†è®ºï¼Œè¿™ä¸ªåŠ é”çš„ç†è®ºå’Œä¸Šé¢æœ€å¤§çš„ä¸åŒå°±æ˜¯ä¸ç”¨é¢„å…ˆçŸ¥é“æ•´ä¸ªäº‹åŠ¡çš„å…¨è²Œï¼ˆå‰é¢çš„åŠ é”æ–¹æ¡ˆå¥½å¤šéƒ½æ˜¯äº‹åè¯¸è‘›äº®ï¼Œä½†æ˜¯æ”¾åœ¨çœŸå®åœºæ™¯ä¸‹ä½ åˆä¸å¯èƒ½å›æ»šå»å¹²è¿™ç©æ„ï¼‰</li>
<li>2PLåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ
<ul>
<li><strong>Phase #1â€“ Growing</strong>: In the growing phase, each transaction requests the locks that it needs from the DBMSâ€™s lock manager. The lock manager grants/denies these lock requests.</li>
<li><strong>Phase #2â€“ Shrinking</strong>: Transactions enter the shrinking phase immediately after they release their first
lock. In the shrinking phase, transactions are only allowed to release locks. They are not allowed to acquire
new ones.</li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter17-3.png" title="/img/CMU 15-445 Database Systems/chapter17-3.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter17-3.png" data-sub-html="<h2>2PL Two Phases</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter17-3.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter17-3.png, /img/CMU%2015-445%20Database%20Systems/chapter17-3.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter17-3.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter17-3.png" />
    </a><figcaption class="image-caption">2PL Two Phases</figcaption>
    </figure>
<ul>
<li>2PLçš„é—®é¢˜: <strong>cascading aborts</strong></li>
</ul>
<figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter17-4.png" title="/img/CMU 15-445 Database Systems/chapter17-4.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter17-4.png" data-sub-html="<h2>Shrinkingé˜¶æ®µå¦‚æœRollbackï¼Œä¼šé€ æˆå…¶ä»–äº‹åŠ¡è¯»åˆ°äº†ä½ ä¸Šé¢ä¿®æ”¹è¿‡ä½†æœªcommitçš„æ•°æ®</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter17-4.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter17-4.png, /img/CMU%2015-445%20Database%20Systems/chapter17-4.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter17-4.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter17-4.png" />
    </a><figcaption class="image-caption">Shrinkingé˜¶æ®µå¦‚æœRollbackï¼Œä¼šé€ æˆå…¶ä»–äº‹åŠ¡è¯»åˆ°äº†ä½ ä¸Šé¢ä¿®æ”¹è¿‡ä½†æœªcommitçš„æ•°æ®</figcaption>
    </figure>
<ul>
<li>Solution: <strong>Strong Strict 2PL (aka Rigorous 2PL)</strong></li>
</ul>
<figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter17-5.png" title="/img/CMU 15-445 Database Systems/chapter17-5.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter17-5.png" data-sub-html="<h2>Strong Strict 2PLè§£å†³äº†cascading abortsé—®é¢˜</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter17-5.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter17-5.png, /img/CMU%2015-445%20Database%20Systems/chapter17-5.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter17-5.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter17-5.png" />
    </a><figcaption class="image-caption">Strong Strict 2PLè§£å†³äº†cascading abortsé—®é¢˜</figcaption>
    </figure>
<hr>
<h3 id="deadlock-handling">Deadlock Handling</h3>
<ul>
<li>2PLçš„å¦ä¸€ä¸ªé—®é¢˜: <strong>Dead-Locks</strong></li>
</ul>
<figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter17-6.png" title="/img/CMU 15-445 Database Systems/chapter17-6.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter17-6.png" data-sub-html="<h2>Strong Strict 2PLè§£å†³ä¸äº†Dead-Lockçš„é—®é¢˜ï¼Œå‡ºæ¥ç¯é”åŸºæœ¬å°±è§£ä¸å¼€äº†</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter17-6.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter17-6.png, /img/CMU%2015-445%20Database%20Systems/chapter17-6.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter17-6.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter17-6.png" />
    </a><figcaption class="image-caption">Strong Strict 2PLè§£å†³ä¸äº†Dead-Lockçš„é—®é¢˜ï¼Œå‡ºæ¥ç¯é”åŸºæœ¬å°±è§£ä¸å¼€äº†</figcaption>
    </figure>
<ul>
<li>
<p>Two ways of dealing with deadlocks:</p>
<ul>
<li>
<p>â†’ Approach #1: <strong>Deadlock Detection</strong>:DBMSä¼šç»´æŠ¤ä¸€ä¸ªwaits-for graphæ¥æè¿°æ‰€æœ‰å¹¶å‘çš„äº‹åŠ¡è°åœ¨ç­‰è°çš„é”</p>
<ul>
<li>Nodes are transactions</li>
<li>Edge from $T_i$ to $T_j$ if $T_i$ is waiting for $T_j$ to release a lock.</li>
<li><figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter17-7.png" title="/img/CMU 15-445 Database Systems/chapter17-7.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter17-7.png" data-sub-html="<h2>The system periodically checks for cycles in waits-for graph and then decides how to break it.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter17-7.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter17-7.png, /img/CMU%2015-445%20Database%20Systems/chapter17-7.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter17-7.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter17-7.png" />
    </a><figcaption class="image-caption">The system periodically checks for cycles in waits-for graph and then decides how to break it.</figcaption>
    </figure></li>
<li>When the DBMS detects a deadlock, it will <strong>select a â€œvictimâ€ transaction to rollback(rollback or restart) to break the cycle.</strong></li>
<li>æƒè¡¡: æ£€æµ‹å‘¨æœŸå’Œæ­»é”è§£å¼€æ—¶é—´åç›¸å…³ï¼Œå’Œå¼€é”€æ­£ç›¸å…³ï¼Œè¿˜æœ‰å°±æ˜¯å¹²æ‰é‚£ä¸ªäº‹åŠ¡(æ‰§è¡Œæ—¶é—´ï¼Œyoungè¿˜æ˜¯oldï¼Œæ‰§è¡Œäº†å‡ æ¡SQLï¼ŒåŠ äº†å‡ ä¸ªé”)</li>
<li><strong>Deadlock handling: rollback length</strong>
<ul>
<li>Approach #1: <strong>Completely</strong> â†’ Rollback entire txn and tell the application it was aborted.</li>
<li>Approach #2: <strong>Partial (Savepoints)</strong> â†’ DBMS rolls back a portion of a txn (to break deadlock) and then attempts to re-execute the undone queries.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>â†’ Approach #2: <strong>Deadlock Prevention</strong></p>
<ul>
<li>
<p>ç»™æ¯ä¸ªäº‹åŠ¡åŠ ä¸Šæ—¶é—´æˆ³ï¼Œè¶Šé å‰çš„äº‹åŠ¡è¶Šè€ï¼Œè¶Šé åçš„äº‹åŠ¡è¶Šå¹´è½»</p>
</li>
<li>
<p>Older Timestamp = Higher Priority (e.g., T1 &gt; T2)</p>
</li>
<li>
<p><strong>Wait-Die (â€œOld Waits for Youngâ€)</strong>:</p>
<ul>
<li>If requesting txn has higher priority than holding txn, then requesting txn waits for holding txn. (è€äº‹åŠ¡ç¢°åˆ°å¹´è½»çš„äº‹åŠ¡å æœ‰é”ï¼Œå°±ç­‰åˆ°å¹´è½»çš„äº‹åŠ¡è§£é”)</li>
<li>Otherwise requesting txn aborts.(åä¹‹å¹´è½»çš„äº‹åŠ¡ç­‰è€äº‹åŠ¡çš„é”ï¼Œç›´æ¥rollbackè‡ªæ€)</li>
</ul>
</li>
<li>
<p><strong>Wound-Wait (â€œYoung Waits for Oldâ€)</strong></p>
<ul>
<li>If requesting txn has higher priority than holding txn, then holding txn aborts and releases lock(è€çš„äº‹åŠ¡è¦é”ï¼Œå‘ç°æ•´ä¸ªé”è¢«å¹´è½»çš„äº‹åŠ¡æŒæœ‰ï¼Œç›´æ¥rollbackå¹´è½»çš„äº‹åŠ¡ç„¶åæŠ¢é”)</li>
<li>Otherwise requesting txn waits.(å¹´è½»çš„äº‹åŠ¡å‘ç°é”åœ¨è€çš„äº‹åŠ¡å“ªé‡Œï¼Œé‚£å°±ç­‰è€çš„äº‹åŠ¡è§£é”)</li>
</ul>
</li>
<li>
<p>è¿™ä¸ªä¸»è¦çš„æ€è·¯å°±æ˜¯è§£å†³äº†æ„æˆæ­»é”æ¡ä»¶é‡Œé¢â€œæŒæœ‰å¹¶ç­‰å¾…â€çš„æ¡ä»¶ï¼Œå†²çªäº†ç›´æ¥å¼€æŠ¢</p>
</li>
<li>
<p>æ³¨æ„: restartçš„txnçš„æ—¶é—´æˆ³ç”¨ä¸Šæ¬¡çš„æ—¶é—´æˆ³ï¼Œä¸ç„¶å¯èƒ½ä¼šé€ æˆé¥¥é¥¿</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="lock-granularities">Lock Granularities</h3>
<ul>
<li>
<p>è·å–é”çš„æ—¶å€™æ˜¯è·å–å±æ€§é”ï¼Œè¡Œé”ï¼Œè¡¨é”ï¼Œè¿˜æ˜¯åº“é”ï¼Ÿæ•´ä¸ªéœ€è¦DBMSæ¥è´Ÿè´£ï¼Œéœ€è¦ä¿è¯ä½ åŠ é”çš„æ•°é‡å°½å¯èƒ½å°(10äº¿è¡Œé” vs ä¸€å¼ è¡¨é”)ï¼Œä¹Ÿéœ€è¦è€ƒè™‘å¯¹å¹¶å‘åº¦çš„å½±å“</p>
</li>
<li>
<p><strong>Intention Lock</strong>:é«˜å±‚çº§çš„é”ä¼šæœ‰æ ‡è®°æ¥åˆ¤æ–­ä¸‹é¢æœ‰æ²¡æœ‰åŠ é”çš„ï¼ˆæ¯”å¦‚è¡¨é”ä¼šè®°å½•ä¸‹é¢çš„è¡Œæœ‰æ²¡æœ‰åŠ é”çš„ï¼‰ï¼ŒèŠ‚çœäº†å‘ä¸‹æ£€ç´¢çš„æ•ˆç‡</p>
<ul>
<li>æ„å‘é”ä¹Ÿæœ‰Sé”å’ŒXé”</li>
</ul>
</li>
<li>
<p>åˆ†å±‚çš„é”åœ¨å®é™…å·¥ç¨‹ä¸­ç›¸å½“å¥½ç”¨</p>
</li>
<li>
<p><strong>LOCK ESCALATION</strong></p>
<ul>
<li>å¦‚æœä¸‹å±‚çš„é”è¿‡å¤šäº†ï¼Œé‚£ä¹ˆDBMSå°±ä¼šè‡ªåŠ¨å‡çº§æˆé«˜å±‚çš„é”ï¼ˆæ€ä¹ˆå’ŒJVMçš„é”å‡çº§æœºåˆ¶çš„æ€æƒ³å¾ˆåƒï¼Ÿï¼‰</li>
</ul>
</li>
<li>
<p>ä¸€èˆ¬åŠ é”éƒ½æ˜¯DBMSè‡ªåŠ¨è´Ÿè´£çš„ï¼Œä½†æ˜¯ç”¨æˆ·å¯ä»¥ç”¨SQLæ‰‹åŠ¨æ¥åŠ é”</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">LOCK</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">mode</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">qualification</span><span class="o">&gt;</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">UPDATE</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">#è¿™æ ·å‘Šè¯‰äº†MYSQLè¿™ä¸ªä¸åŠ è¯»é”ï¼ŒåŠ å†™é”(åé¢è¦UPDATE)
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="conclusion">CONCLUSION</h3>
<ul>
<li>
<p>2PL is used in almost every DBMS.</p>
</li>
<li>
<p>Automatically generates correct interleaving:</p>
<ul>
<li>Locks + protocol (2PL, SS2PL &hellip;)</li>
<li>Deadlock detection + handling</li>
<li>Deadlock prevention</li>
</ul>
</li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info"><div class="post-info-tag"><span><a href="/tags/database-systems/">Database Systems</a>
                </span></div><div class="post-info-line"><div class="post-info-mod">
                <span>æ›´æ–°äº 2024-04-19</span>
            </div><div class="post-info-mod"></div>
        </div><div class="post-info-share">
            <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter17/" data-title="CMU 15-445 Lecture #17: Two-Phase Locking" data-hashtags="Database Systems"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter17/" data-hashtag="Database Systems"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Linkedin" data-sharer="linkedin" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter17/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° WhatsApp" data-sharer="whatsapp" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter17/" data-title="CMU 15-445 Lecture #17: Two-Phase Locking" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter17/" data-title="CMU 15-445 Lecture #17: Two-Phase Locking"><i class="fab fa-line fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter17/" data-title="CMU 15-445 Lecture #17: Two-Phase Locking"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Myspace" data-sharer="myspace" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter17/" data-title="CMU 15-445 Lecture #17: Two-Phase Locking" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Blogger" data-sharer="blogger" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter17/" data-title="CMU 15-445 Lecture #17: Two-Phase Locking" data-description=""><i class="fab fa-blogger fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° ç™¾åº¦" data-sharer="baidu" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter17/" data-title="CMU 15-445 Lecture #17: Two-Phase Locking"><i data-svg-src="/lib/simple-icons/icons/baidu.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Evernote" data-sharer="evernote" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter17/" data-title="CMU 15-445 Lecture #17: Two-Phase Locking"><i class="fab fa-evernote fa-fw"></i></a></span>
        </div></div><div class="post-nav"><a href="/posts/cmu-15-445-database-systems/chapter16/" class="prev" rel="prev" title="CMU 15-445 Lecture #16: Concurrency Control Theory"><i class="fas fa-angle-left fa-fw"></i>Previous Post</a>
            <a href="/posts/cmu-15-445-database-systems/chapter18/" class="next" rel="next" title="CMU 15-445 Lecture #18: Timestamp Ordering Concurrency Control">Next Post<i class="fas fa-angle-right fa-fw"></i></a></div></div>
</div></article></div>
            </main>
            <footer class="footer"><div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.105.0">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/khusika/FeelIt" target="_blank" rel="noopener noreffer" title="FeelIt 1.0.1"><i class="fas fa-hand-holding-heart fa-fw"></i> FeelIt</a>
        </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/Jungle430">Jungle</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
</div>
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker
        .register('/sw.min.js?version=0.0.1', { scope: '/' })
        .then(() => {
            console.info('Jungle\u0027s Blog\u00A0Service Worker Registered');
        }, err => console.error('Jungle\u0027s Blog\u00A0Service Worker registration failed: ', err));

    navigator.serviceWorker
        .ready
        .then(() => {
            console.info('Jungle\u0027s Blog\u00A0Service Worker Ready');
        });
}
</script>
</footer>
        </div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-chevron-up fa-fw"></i>
            </a></div><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.fill%2CArray.prototype.find%2CArray.from%2CIntersectionObserver%2CMath.sign%2CObject.assign%2CPromise%2CObject.entries%2Chtml5shiv%2CObject.values%2Cfetch%2CElement.prototype.after"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script src="/lib/katex/katex.min.js"></script><script src="/lib/katex/auto-render.min.js"></script><script src="/lib/katex/copy-tex.min.js"></script><script src="/lib/katex/mhchem.min.js"></script><script>window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":100},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script src="/js/theme.min.js"></script></body></html>
