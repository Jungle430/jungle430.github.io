<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>CMU 15-445 Lecture #20: Database Logging - Jungle&#39;s Blog</title><meta name="description" content="Welcome to Jungle&#39;s blog."><meta property="og:title" content="CMU 15-445 Lecture #20: Database Logging" />
<meta property="og:description" content="CMU 15-445 Database Systems Lecture #20: Database Logging Crash Recovery æƒ…æ™¯ï¼šæ•°æ®åº“è¿è¡Œåˆ°ä¸€åŠæ²¡ç”µäº† Recovery algorithms are techniques to ensure database consistency(C), transaction atomicity(A), and durability(D) despite failures(example no power) The key primitives that used in recovery algorithms are UNDO and REDO. Not all algorithms use both primitives. UNDO: The process of removing the effects of an incomplete or aborted" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter20/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-04-21T15:08:57+08:00" />
<meta property="article:modified_time" content="2024-04-21T15:08:57+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CMU 15-445 Lecture #20: Database Logging"/>
<meta name="twitter:description" content="CMU 15-445 Database Systems Lecture #20: Database Logging Crash Recovery æƒ…æ™¯ï¼šæ•°æ®åº“è¿è¡Œåˆ°ä¸€åŠæ²¡ç”µäº† Recovery algorithms are techniques to ensure database consistency(C), transaction atomicity(A), and durability(D) despite failures(example no power) The key primitives that used in recovery algorithms are UNDO and REDO. Not all algorithms use both primitives. UNDO: The process of removing the effects of an incomplete or aborted"/>
<meta name="application-name" content="Jungle&#39;s blog">
<meta name="apple-mobile-web-app-title" content="Jungle&#39;s blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter20/" /><link rel="prev" href="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter19/" /><link rel="next" href="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter21/" /><link rel="stylesheet" href="/css/page.min.css"><link rel="stylesheet" href="/css/home.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "CMU 15-445 Lecture #20: Database Logging",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/Jungle430.github.io\/posts\/cmu-15-445-database-systems\/chapter20\/"
        },"genre": "posts","keywords": "Database Systems","wordcount":  1528 ,
        "url": "https:\/\/Jungle430.github.io\/posts\/cmu-15-445-database-systems\/chapter20\/","datePublished": "2024-04-21T15:08:57+08:00","dateModified": "2024-04-21T15:08:57+08:00","publisher": {
            "@type": "Organization",
            "name": "Jungle"},"author": {
                "@type": "Person",
                "name": "Jungle"
            },"description": ""
    }
    </script></head><body data-header-desktop="fixed" data-header-mobile="auto"><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Jungle&#39;s Blog">Jungle&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/">ğŸ“š æ–‡ç«  </a><a class="menu-item" href="/tags/">ğŸ·ï¸ æ ‡ç­¾ </a><a class="menu-item" href="/categories/">ğŸ—ƒï¸ åˆ†ç±» </a><a class="menu-item" href="/about/">ğŸ‘´ å…³äº </a><a class="menu-item" href="https://github.com/Jungle430" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Jungle&#39;s Blog">Jungle&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">ğŸ“šæ–‡ç« </a><a class="menu-item" href="/tags/" title="">ğŸ·ï¸æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">ğŸ—ƒï¸åˆ†ç±»</a><a class="menu-item" href="/about/" title="">ğŸ‘´å…³äº</a><a class="menu-item" href="https://github.com/Jungle430" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><div class="menu-item"><a href="javascript:void(0);" class="theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single" data-toc="enable"><div class="single-card" ><h2 class="single-title animated flipInX">CMU 15-445 Lecture #20: Database Logging</h2><div class="post-meta">
                <div class="post-meta-line"><span class="post-author"><a href="https://github.com/Jungle430" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Jungle</a></span>&nbsp;<span class="post-category">å‡ºç‰ˆäº  <a href="/categories/cmu-15-445-database-systems/"><i class="far fa-folder fa-fw"></i>CMU 15-445 Database Systems</a></span></div>
                <div class="post-meta-line"><span><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2024-04-21">2024-04-21</time></span>&nbsp;<span><i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 1528 å­—</span>&nbsp;
                    <span><i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 4 åˆ†é’Ÿ</span>&nbsp;</div>
            </div>
            
            <hr><div class="details toc" id="toc-static"  data-kept="">
                    <div class="details-summary toc-title">
                        <span>ç›®å½•</span>
                        <span><i class="details-icon fas fa-angle-right"></i></span>
                    </div>
                    <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#lecture-20-database-logging">Lecture #20: Database Logging</a>
      <ul>
        <li><a href="#crash-recovery">Crash Recovery</a></li>
        <li><a href="#failure-classification">FAILURE CLASSIFICATION</a></li>
        <li><a href="#shadow-paging">Shadow Paging</a></li>
        <li><a href="#write-ahead-loggingwal">Write-Ahead Loggingï¼ˆWALï¼‰</a></li>
        <li><a href="#logging-schemes">Logging Schemes</a></li>
        <li><a href="#checkpoints">Checkpoints</a></li>
        <li><a href="#conclusion">CONCLUSION</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
                </div><div class="content" id="content"><h1 id="cmu-15-445-database-systems">CMU 15-445 Database Systems</h1>
<h2 id="lecture-20-database-logging">Lecture #20: Database Logging</h2>
<h3 id="crash-recovery">Crash Recovery</h3>
<figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter20-1.png" title="/img/CMU 15-445 Database Systems/chapter20-1.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter20-1.png" data-sub-html="<h2>æƒ…æ™¯ï¼šæ•°æ®åº“è¿è¡Œåˆ°ä¸€åŠæ²¡ç”µäº†</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter20-1.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter20-1.png, /img/CMU%2015-445%20Database%20Systems/chapter20-1.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter20-1.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter20-1.png" />
    </a><figcaption class="image-caption">æƒ…æ™¯ï¼šæ•°æ®åº“è¿è¡Œåˆ°ä¸€åŠæ²¡ç”µäº†</figcaption>
    </figure>
<ul>
<li>Recovery algorithms are techniques to ensure <strong>database consistency(C), transaction atomicity(A), and durability(D)</strong> <strong>despite failures(example no power)</strong></li>
<li>The key primitives that used in recovery algorithms are UNDO and REDO. Not all algorithms use both primitives.
<ul>
<li><strong>UNDO</strong>: The process of removing the effects of an incomplete or aborted transaction.</li>
<li><strong>REDO</strong>: The process of re-applying the effects of a committed transaction for durability.</li>
</ul>
</li>
</ul>
<h3 id="failure-classification">FAILURE CLASSIFICATION</h3>
<ul>
<li>
<p><strong>Type #1 â€“ Transaction Failures</strong></p>
<ul>
<li>Logical Errors:â†’ Transaction cannot complete due to some internal error condition (e.g., integrity constraint violation).</li>
<li>Internal State Errors:â†’ DBMS must terminate an active transaction due to an error condition (e.g., deadlock).</li>
</ul>
</li>
<li>
<p><strong>Type #2 â€“ System Failures</strong></p>
<ul>
<li>
<p>Software Failure:â†’ Problem with the OS or DBMS implementation (e.g., uncaught divide-by-zero exception).</p>
</li>
<li>
<p>Hardware Failure:</p>
<ul>
<li>â†’ The computer hosting the DBMS crashes (e.g., power plug gets pulled).</li>
<li>â†’ Fail-stop Assumption: Non-volatile storage contents are assumed to not be corrupted by system crash.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Type #3 â€“ Storage Media Failures</strong></p>
<ul>
<li>Non-Repairable Hardware Failure:
<ul>
<li>â†’ A head crash or similar disk failure destroys all or part of non-volatile storage.</li>
<li>â†’ Destruction is assumed to be detectable (e.g., disk controller use checksums to detect failures).</li>
<li>The recovery protocol canâ€™t recover from this! Database must be restored from an archived version.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>è€ƒè™‘ï¼šç£ç›˜æ¯”å†…å­˜æ…¢çš„å¤šï¼Œæ‰€ä»¥DBMSçš„æ¨¡å¼æ˜¯loadåˆ°å†…å­˜æ± åä¿®æ”¹ï¼Œæœ€ååˆ·ç›˜</p>
<ul>
<li><strong>ä¿è¯çš„ç‚¹ï¼šåªè¦commitæˆåŠŸï¼Œæ•°æ®æ°¸è¿œä¸ä¼šä¸¢ï¼ˆé™¤äº†ç¡¬ç›˜çˆ†ç‚¸ï¼‰ï¼Œå¦‚æœäº‹åŠ¡ä¸­é—´å¤±è´¥äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹åŠ¡åº”è¯¥å°±å’Œæ²¡å‘ç”Ÿä¸€æ ·</strong></li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter20-2.png" title="/img/CMU 15-445 Database Systems/chapter20-2.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter20-2.png" data-sub-html="<h2>æ–¹æ¡ˆé€‰æ‹©ï¼šæ˜¯å¦commitåè¦ç«‹å³åˆ·ç›˜ï¼Œåˆ·ç›˜çš„æ—¶å€™åŒä¸€é¡µå…¶ä»–æœªcommitçš„äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®æ€ä¹ˆå¤„ç†(è€ƒè™‘å›æ»šé—®é¢˜)</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter20-2.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter20-2.png, /img/CMU%2015-445%20Database%20Systems/chapter20-2.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter20-2.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter20-2.png" />
    </a><figcaption class="image-caption">æ–¹æ¡ˆé€‰æ‹©ï¼šæ˜¯å¦commitåè¦ç«‹å³åˆ·ç›˜ï¼Œåˆ·ç›˜çš„æ—¶å€™åŒä¸€é¡µå…¶ä»–æœªcommitçš„äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®æ€ä¹ˆå¤„ç†(è€ƒè™‘å›æ»šé—®é¢˜)</figcaption>
    </figure>
<ul>
<li>
<p><strong>STEAL POLICY</strong></p>
<ul>
<li>STEAL: Is allowed.(åˆ«äººæ²¡æäº¤çš„æ•°æ®æˆ‘ä¹Ÿåˆ·)</li>
<li>NO-STEAL: Is not allowed.(åˆ«äººæ²¡æäº¤æˆ‘å°±ä¸èƒ½åˆ·åˆ°ç£ç›˜)</li>
</ul>
</li>
<li>
<p><strong>FORCE POLICY</strong></p>
<ul>
<li>FORCE: Is required.(commitåç«‹å³åˆ·)</li>
<li>NO-FORCE: Is not required.(ä¸å¼ºåˆ¶è¦æ±‚)</li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter20-3.png" title="/img/CMU 15-445 Database Systems/chapter20-3.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter20-3.png" data-sub-html="<h2>NO-STEAL FORCE</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter20-3.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter20-3.png, /img/CMU%2015-445%20Database%20Systems/chapter20-3.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter20-3.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter20-3.png" />
    </a><figcaption class="image-caption">NO-STEAL FORCE</figcaption>
    </figure>
<ul>
<li>NO-STEAL FORCE
<ul>
<li>ä¼˜ç‚¹ï¼šå¥½å®ç°ï¼Œä¸éœ€è¦undoå’Œredoçš„æ“ä½œ</li>
<li>ç¼ºç‚¹ï¼šæ•ˆç‡ä½ï¼Œåˆ·ç›˜é¢‘ç‡å¤ªé«˜ï¼Œæ²¡æœ‰undoå’Œredoé‚£æ‰€æœ‰çš„ä¸œè¥¿éƒ½è¦loadåˆ°å†…å­˜æ± ï¼Œä¹Ÿå¾ˆä¼¤å®³æ•ˆç‡ï¼Œèƒ½å¤Ÿä¿®æ”¹æ•°æ®çš„é‡æ”¶åˆ°ç¼“å­˜æ± å¤§å°çš„é™åˆ¶ï¼ˆç¼“å­˜æ± å°±ç”¨æ¥åšçš„æ•°æ®å¤‡ä»½ï¼Œæ²¡æœ‰å†™è¿›ç£ç›˜çš„æ•°æ®éœ€è¦å…¨éƒ¨æš‚å­˜åœ¨ç¼“å­˜æ± ï¼‰</li>
</ul>
</li>
</ul>
<h3 id="shadow-paging">Shadow Paging</h3>
<ul>
<li>
<p>å…·ä½“å®ç°ï¼š<strong>SHADOW PAGING</strong></p>
</li>
<li>
<figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter20-4.png" title="/img/CMU 15-445 Database Systems/chapter20-4.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter20-4.png" data-sub-html="<h2>æŠŠéœ€è¦çš„æ•°æ®Copyä¸€ä»½å†æ”¹ï¼Œæ”¹çš„æ—¶å€™ä¹Ÿåˆ·ç›˜ï¼Œcommitä¹‹åæ”¹æŒ‡é’ˆæŒ‡å‘ï¼Œæœ€åæ¸…é™¤åŸæœ‰é¡µ</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter20-4.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter20-4.png, /img/CMU%2015-445%20Database%20Systems/chapter20-4.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter20-4.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter20-4.png" />
    </a><figcaption class="image-caption">æŠŠéœ€è¦çš„æ•°æ®Copyä¸€ä»½å†æ”¹ï¼Œæ”¹çš„æ—¶å€™ä¹Ÿåˆ·ç›˜ï¼Œcommitä¹‹åæ”¹æŒ‡é’ˆæŒ‡å‘ï¼Œæœ€åæ¸…é™¤åŸæœ‰é¡µ</figcaption>
    </figure>
<ul>
<li>Undo: æŠŠæœ¬åœ°å¤åˆ¶å‡ºæ¥çš„é¡µå…¨éƒ¨å¹²æ‰</li>
<li>Redo: ä¸éœ€è¦ï¼Œcommitå¿…é¡»åˆ·ç›˜</li>
</ul>
</li>
<li>
<p>å®é™…åº”ç”¨ï¼šSQLITE (PRE-2010)</p>
<ul>
<li><figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter20-5.png" title="/img/CMU 15-445 Database Systems/chapter20-5.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter20-5.png" data-sub-html="<h2>åœ¨ç¡¬ç›˜ä¸Šé¢ç•™åŸå§‹ç‰ˆæœ¬(undo),commitçš„æ—¶å€™åˆ·ç›˜</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter20-5.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter20-5.png, /img/CMU%2015-445%20Database%20Systems/chapter20-5.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter20-5.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter20-5.png" />
    </a><figcaption class="image-caption">åœ¨ç¡¬ç›˜ä¸Šé¢ç•™åŸå§‹ç‰ˆæœ¬(undo),commitçš„æ—¶å€™åˆ·ç›˜</figcaption>
    </figure></li>
</ul>
</li>
<li>
<p>ç¼ºç‚¹ï¼šå¯¹ç£ç›˜æœ‰å¤§é‡çš„éšæœºè¯»å†™ï¼Œæ€§èƒ½ä¸å¥½</p>
</li>
<li>
<p>æ€è·¯ï¼šéšæœºå†™=&gt;é¡ºåºå†™ï¼šWAL</p>
</li>
</ul>
<h3 id="write-ahead-loggingwal">Write-Ahead Loggingï¼ˆWALï¼‰</h3>
<ul>
<li>
<p><strong>With write-ahead logging, the DBMS records all the changes made to the database in a log file (on stable storage) before the change is made to a disk page</strong></p>
</li>
<li>
<p><strong>The log contains sufficient information to perform the necessary undo and redo actions to restore the database after a crash.</strong></p>
</li>
<li>
<p><strong>The DBMS must write to disk the log file records that correspond to changes made to a database object before it can flush that object to disk.</strong></p>
</li>
<li>
<p>Buffer Pool Policy: STEAL + NO-FORCE</p>
</li>
<li>
<p>ä¸€èˆ¬æ˜¯&lt;BEGIN&gt;æ‰“å¤´ï¼Œ&lt;COMMIT&gt;ç»“å°¾ï¼ŒCOMMITå¿…é¡»æ˜¯è¦æŠŠæ‰€æœ‰æ•°æ®éƒ½åˆ·åˆ°ç£ç›˜é‡Œé¢</p>
</li>
<li>
<p>æ—¥å¿—æ ¼å¼</p>
<ul>
<li>
<p>Transaction Id</p>
</li>
<li>
<p>Object Id</p>
</li>
<li>
<p>Before Value (UNDO)</p>
</li>
<li>
<p>After Value (REDO)</p>
</li>
<li>
<p>Not necessary for Before Value and After Value if using append-only MVCC</p>
</li>
<li>
<figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter20-6.png" title="/img/CMU 15-445 Database Systems/chapter20-6.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter20-6.png" data-sub-html="<h2>å…ˆåˆ·æ—¥å¿—å†åˆ·ç›˜ï¼Œcommitä»£è¡¨åˆ·æ—¥å¿—æˆåŠŸ</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter20-6.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter20-6.png, /img/CMU%2015-445%20Database%20Systems/chapter20-6.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter20-6.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter20-6.png" />
    </a><figcaption class="image-caption">å…ˆåˆ·æ—¥å¿—å†åˆ·ç›˜ï¼Œcommitä»£è¡¨åˆ·æ—¥å¿—æˆåŠŸ</figcaption>
    </figure>
</li>
<li>
<figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter20-7.png" title="/img/CMU 15-445 Database Systems/chapter20-7.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter20-7.png" data-sub-html="<h2>crashä¹‹åé æ—¥å¿—æ¢å¤</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter20-7.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter20-7.png, /img/CMU%2015-445%20Database%20Systems/chapter20-7.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter20-7.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter20-7.png" />
    </a><figcaption class="image-caption">crashä¹‹åé æ—¥å¿—æ¢å¤</figcaption>
    </figure>
</li>
</ul>
</li>
<li>
<p>é—®é¢˜ï¼šç”¨æˆ·commitä½ å°±è¦æŠŠæ—¥å¿—åˆ·åˆ°ç›˜é‡Œé¢ï¼Œä½†æ˜¯åˆ·ç›˜é¢‘ç‡é«˜äº†åˆç ´åæ•ˆç‡</p>
<ul>
<li>ä¼˜åŒ–ï¼š group commit: commitçš„æ—¶å€™å¡ä½ï¼Œå‡‘å¤Ÿäº†å‡ ä¸ªäº‹åŠ¡å†ä¸€èµ·åˆ·</li>
</ul>
</li>
</ul>
<h3 id="logging-schemes">Logging Schemes</h3>
<ul>
<li>
<p><strong>Physical Logging:</strong></p>
<ul>
<li>
<p>Record the byte-level changes made to a specific location in the database.</p>
</li>
<li>
<p>Example: git diff</p>
</li>
<li>
<p>ç¼ºç‚¹ï¼šä¼šè¢«å†™æ”¾å¤§(UPDATE ALL FRO A TABLE =&gt; BIG Physical Log)</p>
</li>
</ul>
</li>
<li>
<p><strong>Logical Logging:</strong></p>
<ul>
<li>SQL</li>
<li>ç¼ºç‚¹ï¼šæ¢å¤çš„æ—¶å€™æ…¢ï¼Œè¿˜æœ‰SQLè‡ªå·±çš„ç¼ºé™·(NOW()å‡½æ•°ä¸èƒ½é‡æ”¾ï¼ŒLIMITä¸ä¿è¯æ¬¡æ¬¡ç›¸åŒï¼Œå¤‡åº“æ²¡æœ‰ä¸»åº“çš„ç´¢å¼•)</li>
</ul>
</li>
<li>
<p><strong>Physiological Logging</strong></p>
<ul>
<li>åŸºç¡€æ˜¯ç‰©ç†æ—¥å¿—ï¼Œæ··åˆSQLï¼Œåç§»é‡æ¢æˆæ§½</li>
</ul>
</li>
<li>
<figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter20-8.png" title="/img/CMU 15-445 Database Systems/chapter20-8.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter20-8.png" data-sub-html="<h2>ä¸‰ç§æ—¥å¿—</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter20-8.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter20-8.png, /img/CMU%2015-445%20Database%20Systems/chapter20-8.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter20-8.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter20-8.png" />
    </a><figcaption class="image-caption">ä¸‰ç§æ—¥å¿—</figcaption>
    </figure>
</li>
<li>
<p>MYSQLä¸ºä»€ä¹ˆundoå’Œredoåˆ†å¼€ï¼šå®‰å…¨ï¼Œè¿˜æœ‰å°±æ˜¯undo logå¯ä»¥ç”¨æ¥åšmvcc</p>
</li>
</ul>
<h3 id="checkpoints">Checkpoints</h3>
<ul>
<li>
<p>Blocking / Consistent Checkpoint Protocol:</p>
<ul>
<li>â†’ Pause all queries.</li>
<li>â†’ Flush all WAL records in memory to disk.</li>
<li>â†’ Flush all modified pages in the buffer pool to disk.</li>
<li>â†’ Write a &lt;CHECKPOINT&gt; entry to WAL and flush to disk.</li>
<li>â†’ Resume queries</li>
</ul>
</li>
<li>
<p>æ—¥å¿—ä¸æ¸…ç†ä¹Ÿä¼šçˆ†ç£ç›˜</p>
</li>
<li>
<p>crashä¹‹åä½ è¦çŸ¥é“ä»å“ªæ¢å¤ï¼Œç±»æ¯”æ¸¸æˆå­˜æ¡£ï¼ˆåä½›/åç«ï¼‰</p>
</li>
<li>
<p>ç¼“å­˜ç‚¹åœä½ï¼ŒæŠŠæ—¥å¿—å’Œè„é¡µå…¨åˆ·å›å»ï¼Œç„¶ååœ¨æ—¥å¿—é‡Œé¢è®°ä¸Šä¸€ä¸ª&lt;CHECKPOINT&gt;ï¼Œè¡¨ç¤ºä¸Šé¢çš„æ•°æ®éƒ½åˆ·ç›˜äº†</p>
</li>
<li>
<figure><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter20-9.png" title="/img/CMU 15-445 Database Systems/chapter20-9.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter20-9.png" data-sub-html="<h2>æ³¨æ„CHECKPOINTä¸Šé¢æœ‰å®Œå…¨æäº¤çš„å’ŒåŠæäº¤çš„, T2ç”¨redo,T3ç”¨undo</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/CMU%2015-445%20Database%20Systems/chapter20-9.png"
            data-srcset="/img/CMU%2015-445%20Database%20Systems/chapter20-9.png, /img/CMU%2015-445%20Database%20Systems/chapter20-9.png 1.5x, /img/CMU%2015-445%20Database%20Systems/chapter20-9.png 2x"
            data-sizes="auto"
            alt="/img/CMU 15-445 Database Systems/chapter20-9.png" />
    </a><figcaption class="image-caption">æ³¨æ„CHECKPOINTä¸Šé¢æœ‰å®Œå…¨æäº¤çš„å’ŒåŠæäº¤çš„, T2ç”¨redo,T3ç”¨undo</figcaption>
    </figure>
</li>
<li>
<p>T1åœ¨æ£€æŸ¥ç‚¹ä¹‹å‰å…¨åˆ·ï¼Œä¸ç”¨ç®¡ï¼ŒT2æ£€æŸ¥ç‚¹å‰æœ‰BEGINï¼Œæ£€æŸ¥ç‚¹åCOMMITï¼Œç”¨REDOæ¢å¤ï¼ŒT3æ£€æŸ¥ç‚¹ä¹‹å‰æœ‰BEGINï¼Œæ£€æŸ¥ç‚¹åæ²¡æœ‰COMMITï¼Œç”¨UNDOæ¢å¤</p>
</li>
</ul>
<h3 id="conclusion">CONCLUSION</h3>
<ul>
<li>Write-Ahead Logging is (almost) always the best approach to handle loss of volatile storage.</li>
<li>Use incremental updates (STEAL + NO-FORCE) with checkpoints.</li>
<li>On Recovery: undo uncommitted txns + redo committed txns.</li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info"><div class="post-info-tag"><span><a href="/tags/database-systems/">Database Systems</a>
                </span></div><div class="post-info-line"><div class="post-info-mod">
                <span>æ›´æ–°äº 2024-04-21</span>
            </div><div class="post-info-mod"></div>
        </div><div class="post-info-share">
            <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter20/" data-title="CMU 15-445 Lecture #20: Database Logging" data-hashtags="Database Systems"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter20/" data-hashtag="Database Systems"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Linkedin" data-sharer="linkedin" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter20/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° WhatsApp" data-sharer="whatsapp" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter20/" data-title="CMU 15-445 Lecture #20: Database Logging" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter20/" data-title="CMU 15-445 Lecture #20: Database Logging"><i class="fab fa-line fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter20/" data-title="CMU 15-445 Lecture #20: Database Logging"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Myspace" data-sharer="myspace" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter20/" data-title="CMU 15-445 Lecture #20: Database Logging" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Blogger" data-sharer="blogger" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter20/" data-title="CMU 15-445 Lecture #20: Database Logging" data-description=""><i class="fab fa-blogger fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° ç™¾åº¦" data-sharer="baidu" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter20/" data-title="CMU 15-445 Lecture #20: Database Logging"><i data-svg-src="/lib/simple-icons/icons/baidu.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Evernote" data-sharer="evernote" data-url="https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter20/" data-title="CMU 15-445 Lecture #20: Database Logging"><i class="fab fa-evernote fa-fw"></i></a></span>
        </div></div><div class="post-nav"><a href="/posts/cmu-15-445-database-systems/chapter19/" class="prev" rel="prev" title="CMU 15-445 Lecture #19: Multi-Version Concurrency Control"><i class="fas fa-angle-left fa-fw"></i>Previous Post</a>
            <a href="/posts/cmu-15-445-database-systems/chapter21/" class="next" rel="next" title="CMU 15-445 Lecture #21: Database Crash Recovery">Next Post<i class="fas fa-angle-right fa-fw"></i></a></div></div>
</div></article></div>
            </main>
            <footer class="footer"><div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.105.0">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/khusika/FeelIt" target="_blank" rel="noopener noreffer" title="FeelIt 1.0.1"><i class="fas fa-hand-holding-heart fa-fw"></i> FeelIt</a>
        </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/Jungle430">Jungle</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
</div>
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker
        .register('/sw.min.js?version=0.0.1', { scope: '/' })
        .then(() => {
            console.info('Jungle\u0027s Blog\u00A0Service Worker Registered');
        }, err => console.error('Jungle\u0027s Blog\u00A0Service Worker registration failed: ', err));

    navigator.serviceWorker
        .ready
        .then(() => {
            console.info('Jungle\u0027s Blog\u00A0Service Worker Ready');
        });
}
</script>
</footer>
        </div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-chevron-up fa-fw"></i>
            </a></div><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.fill%2CArray.prototype.find%2CArray.from%2CIntersectionObserver%2CMath.sign%2CObject.assign%2CPromise%2CObject.entries%2Chtml5shiv%2CObject.values%2Cfetch%2CElement.prototype.after"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script src="/lib/katex/katex.min.js"></script><script src="/lib/katex/auto-render.min.js"></script><script src="/lib/katex/copy-tex.min.js"></script><script src="/lib/katex/mhchem.min.js"></script><script>window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":100},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script src="/js/theme.min.js"></script></body></html>
