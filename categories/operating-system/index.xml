<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>Operating System - åˆ†ç±» - Jungle&#39;s Blog</title>
        <link>https://Jungle430.github.io/categories/operating-system/</link>
        <description>Operating System - åˆ†ç±» - Jungle&#39;s Blog</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>1239946358@qq.com (Jungle)</managingEditor>
            <webMaster>1239946358@qq.com (Jungle)</webMaster><lastBuildDate>Mon, 06 Mar 2023 19:34:15 &#43;0800</lastBuildDate><atom:link href="https://Jungle430.github.io/categories/operating-system/" rel="self" type="application/rss+xml" /><item>
    <title>Operating System Chapter4 ç†è§£å¹¶å‘ç¨‹åºæ‰§è¡Œ</title>
    <link>https://Jungle430.github.io/posts/operating-system/operating-system-chapter4/</link>
    <pubDate>Mon, 06 Mar 2023 19:34:15 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/operating-system/operating-system-chapter4/</guid>
    <description><![CDATA[<h1 id="operating-system">Operating System</h1>
<p>$Nanjing\ University\rightarrow Yanyan\ Jiang\newline$</p>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Update<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="typeit"><div id="id-1" class=""></div></div>
<p>æ™šä¸Šçœ‹çš„ï¼Œ<b>Peterson</b>ç®—æ³•å¥½â„¢ï¸çš„ğŸ‘¨ï¼Œè¯æ˜ç­‰è¿‡ä¸¤å¤©æœ‰æ—¶é—´ç»™çœ‹äº†</div>
        </div>
    </div>
<h2 id="ç†è§£å¹¶å‘ç¨‹åºæ‰§è¡Œ">ç†è§£å¹¶å‘ç¨‹åºæ‰§è¡Œ</h2>
<h3 id="å¤ä¹ ">å¤ä¹ </h3>
<ul>
<li>ä¸€èˆ¬ç¨‹åºæ‰§è¡Œ</li>
</ul>
<div class="mermaid" id="id-2"></div>
<p>çº¿ç¨‹çš„æ ˆå¸§ä¼šç”¨ä¸€ä¸ª<code>list</code>æ¥å­˜æ”¾</p>
<ul>
<li>å¤šçº¿ç¨‹</li>
</ul>
<div class="mermaid" id="id-3"></div>
<p>T1,T2éšæœºæ¥å›è½¬æ¢æ‰§è¡Œ</p>
<ul>
<li><b>å¹¶å‘ç¨‹åº = å¤šä¸ªæ‰§è¡Œæµã€å…±äº«å†…å­˜çš„<u>çŠ¶æ€æœº</u></b></li>
</ul>
<h3 id="ç”»çŠ¶æ€æœºç†è§£å¹¶å‘ç¨‹åº">ç”»çŠ¶æ€æœºç†è§£å¹¶å‘ç¨‹åº</h3>
<blockquote>
<p><u>äº’æ–¥ï¼šä¿è¯ä¸¤ä¸ªçº¿ç¨‹ä¸èƒ½åŒæ—¶æ‰§è¡Œä¸€æ®µä»£ç </u></p>
</blockquote>
<ul>
<li>æ’å…¥ â€œç¥ç§˜ä»£ç â€ï¼Œä½¿å¾— <a href="https://jyywiki.cn/pages/OS/2022/demos/sum.c" target="_blank" rel="noopener noreffer">sum.c</a> (æˆ–è€…ä»»æ„å…¶ä»–ä»£ç ) èƒ½å¤Ÿæ­£å¸¸å·¥ä½œ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Tsum</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ç¥ç§˜ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">sum</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ç¥ç§˜ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¯ä»¥é€šè¿‡<code>__sync_synchronize();</code>æ¥ä¿è¯åŸå­æ“ä½œ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">__sync_synchronize</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// æˆ– int t = x;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">__sync_synchronize</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å¤±è´¥çš„å°è¯•">å¤±è´¥çš„å°è¯•</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">locked</span> <span class="o">=</span> <span class="n">UNLOCK</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">critical_section</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nl">retry</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">locked</span> <span class="o">!=</span> <span class="n">UNLOCK</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">goto</span> <span class="n">retry</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">locked</span> <span class="o">=</span> <span class="n">LOCK</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// critical section
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">locked</span> <span class="o">=</span> <span class="n">UNLOCK</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>åŸå› </p>
<ul>
<li>çœ‹åˆ°çš„çŠ¶æ€åˆ°çœŸæ­£åšä¸‹ä¸€ä»¶äº‹ä¹‹é—´çš„çŠ¶æ€æ˜¯å¦è¢«äººæ”¹äº†ï¼Ÿï¼ˆ<u>çœ‹åˆ°çš„ä¸œè¥¿ä»…ä»…åªæ˜¯ä¸€ä¸ªå†å²ï¼Œç¦»åšè¿˜æœ‰å‡ ä¸ªå‘¨æœŸï¼Œè€Œåšæ˜¯æ ¹æ®è¿™ä¸ª<b>â€œå†å²â€</b>çš„çŠ¶æ€æ¥å†³å®šçš„</u>ï¼‰$\Longrightarrow$ å’Œäººçœ¼çœ‹ç€ä¸œè¥¿å¯¹æ¯”ï¼Œäººçœ¼æ˜¯<b>ä¸€ç›´åœ¨çœ‹çš„</b>ï¼Œè€ŒCPUå¹¶è¡Œæ‰§è¡Œç¨‹åºçš„æ—¶å€™ï¼Œçœ‹è¿™ä¸ªæŒ‡ä»¤æ‰§è¡Œå®Œäº†ä¹‹åå¯èƒ½CPUä¼šå»æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹çš„å‡ æ¡æŒ‡ä»¤ï¼Œè¿™ç§æƒ…å†µä¸‹ç›¸å½“äºè¿™ä¸ªäºº<b>çœ‹å®Œåé—­ä¸Šçœ¼ç›ç­‰äº†å‡ ç§’</b>ï¼Œç„¶åæ ¹æ®å‡ ç§’å‰æ‰€çœ‹çš„ä¸œè¥¿æ¥åˆ¤æ–­è‡ªå·±è¦å¹²å•¥ï¼Œ<b>å¯æ˜¯è¿™ä¸ªä¸œè¥¿åœ¨å‰å‡ ç§’å¯èƒ½å·²ç»è®©å¦ä¸€ä¸ªçº¿ç¨‹çš„æŸäº›æŒ‡ä»¤æ”¹è¿‡äº†</b></li>
<li>å¤„ç†å™¨é»˜è®¤ä¸ä¿è¯ load + store çš„åŸå­æ€§ï¼ˆå•æ“ä½œå¯ä»¥ä¿è¯ï¼‰</li>
</ul>
</li>
<li>
<p>ä¸€ç§å¤±è´¥çš„æƒ…å†µ</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;thread.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define N 100000000
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define LOCK 1
</span></span></span><span class="line"><span class="cl"><span class="cp">#define UNLOCK 0
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">long</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">locked</span> <span class="o">=</span> <span class="n">UNLOCK</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Tsum</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nl">retry</span><span class="p">:</span>  <span class="c1">//T2åœ¨è¿™ä¸ªæ—¶å€™ä¹Ÿæ‰§è¡Œåˆ°äº†locked != UNLOCKçš„åˆ¤æ–­ï¼Œè€Œlock = LOCK,T2ä¹Ÿè¿›å»äº†ï¼Œæ²¡é”ä½ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="n">locked</span> <span class="o">!=</span> <span class="n">UNLOCK</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//&lt;--------------------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">goto</span> <span class="n">retry</span><span class="p">;</span>                                        <span class="c1">//  |
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>                                                    <span class="c1">//  |  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">locked</span> <span class="o">=</span> <span class="n">LOCK</span><span class="p">;</span>         <span class="c1">//T1æ‰§è¡Œåˆ°äº†è¿™é‡Œ æ­¤æ—¶locked = LOCK-|
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sum</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">locked</span> <span class="o">=</span> <span class="n">UNLOCK</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Tsum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Tsum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">join</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;sum = %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ­£ç¡®æ€§ä¸æ˜çš„å¥‡æ€ªå°è¯•-peterson-ç®—æ³•">æ­£ç¡®æ€§ä¸æ˜çš„å¥‡æ€ªå°è¯• (<code>Peterson</code> ç®—æ³•)</h4>
<p>A å’Œ B äº‰ç”¨å•æ‰€çš„åŒ…å¢</p>
<ul>
<li>
<p>æƒ³è¿›å…¥åŒ…å¢ä¹‹å‰ï¼ŒA/B éƒ½è¦å…ˆä¸¾èµ·è‡ªå·±çš„æ——å­</p>
<ul>
<li>A ç¡®è®¤æ——å­ä¸¾å¥½ä»¥åï¼Œå¾€å•æ‰€é—¨ä¸Šè´´ä¸Š <b>â€œB æ­£åœ¨ä½¿ç”¨â€</b> çš„æ ‡ç­¾</li>
<li>B ç¡®è®¤æ——å­ä¸¾å¥½ä»¥åï¼Œå¾€å•æ‰€é—¨ä¸Šè´´ä¸Š <b>â€œA æ­£åœ¨ä½¿ç”¨â€</b> çš„æ ‡ç­¾</li>
</ul>
</li>
<li>
<p>ç„¶å<b>å¦‚æœå¯¹æ–¹çš„æ——å­ä¸¾èµ·æ¥ï¼Œä¸”é—¨ä¸Šçš„åå­—ä¸æ˜¯è‡ªå·±</b>ï¼Œç­‰å¾…</p>
<ul>
<li>å¦åˆ™å¯ä»¥è¿›å…¥åŒ…å¢</li>
</ul>
</li>
<li>
<p><b>å‡ºåŒ…å¢åï¼Œæ”¾ä¸‹è‡ªå·±çš„æ——å­</b></p>
</li>
<li>
<p>ç¤ºä¾‹ä»£ç ï¼š<a href="https://jyywiki.cn/pages/OS/2022/demos/peterson-simple.c" target="_blank" rel="noopener noreffer">peterson-simple.c</a></p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;thread.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define A 1
</span></span></span><span class="line"><span class="cl"><span class="cp">#define B 2
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">atomic_int</span> <span class="n">nested</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">atomic_long</span> <span class="n">count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">critical_section</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">long</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">atomic_fetch_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">count</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">assert</span><span class="p">(</span><span class="n">atomic_fetch_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nested</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">atomic_fetch_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nested</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="k">volatile</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">A</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">TA</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=1 */</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=2 */</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=3 */</span> <span class="k">while</span> <span class="p">(</span><span class="n">y</span> <span class="o">&amp;&amp;</span> <span class="n">turn</span> <span class="o">==</span> <span class="n">B</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">critical_section</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=4 */</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">TB</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=1 */</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=2 */</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">A</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=3 */</span> <span class="k">while</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">turn</span> <span class="o">==</span> <span class="n">A</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">critical_section</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=4 */</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">TA</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">TB</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><b>å£°æ˜ï¼šæœ¬æ–‡ç« å¼•ç”¨èµ„æ–™ä¸å›¾åƒå‡å·²åšæ ‡æ³¨ï¼Œå¦‚æœ‰ä¾µæƒæœ¬äººä¼šé©¬ä¸Šåˆ é™¤</b></p>
]]></description>
</item>
<item>
    <title>Linux x86 Program Start Up or - How the heck do we get to main()?</title>
    <link>https://Jungle430.github.io/posts/operating-system/support2/</link>
    <pubDate>Sat, 04 Mar 2023 15:47:02 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/operating-system/support2/</guid>
    <description><![CDATA[<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<ul>
<li>
<p>æ–‡ç« ä»‹ç»äº†X86ç³»ç»Ÿmainå‡½æ•°è°ƒç”¨å‰åçš„ä¸€äº›ç»†èŠ‚ï¼Œå¹¶é˜è¿°äº†Cç¨‹åºçš„<b>æ„é€ å‡½æ•°</b>å’Œ<b>ææ„å‡½æ•°</b>ï¼Œ<u>ä»¥åŠ<code>.init</code>,<code>.fini</code>,<code>init_array</code>å’Œ<code>fini_array</code>å„sectionç›¸å¯¹äºmainå‡½æ•°åŠå½¼æ­¤çš„æ‰§è¡Œé¡ºåºã€‚é—æ†¾çš„æ˜¯è¿™ç¯‡æ–‡ç« æ˜¯åŸºäº32ä½CPUæ¶æ„æ¥ç ”ç©¶çš„</u></p>
</li>
<li>
<p>æ–‡ç« å¯¹$debug$ <code>main</code>å‡½æ•°ä¹‹å‰çš„ä»£ç æœ‰ä¸€å®šçš„å¸®åŠ©æ•ˆæœ</p>
</li>
<li>
<p>ä¸»è¦ä»‹ç»äº†X86 ELFæ–‡ä»¶çš„åŠ¨æ€åŠ è½½è¿‡ç¨‹</p>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/support2-1.png" title="/img/Operating System/support2-1.png" data-thumbnail="/img/Operating System/support2-1.png" data-sub-html="<h2>æ€»ä½“æµç¨‹å›¾</h2>">
        
    </a><figcaption class="image-caption">æ€»ä½“æµç¨‹å›¾</figcaption>
    </figure>
<h2 id="è°ƒç”¨è¿‡ç¨‹åˆ†æ">è°ƒç”¨è¿‡ç¨‹åˆ†æ</h2>
<h3 id="mainå‡½æ•°çš„è°ƒç”¨">mainå‡½æ•°çš„è°ƒç”¨</h3>
<ul>
<li>å…ˆå†™ä¸€ä¸ªæœ€ç®€å•çš„Cç¨‹åºprog1.c</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç¼–è¯‘ä¸€ä¸‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -ggdb -o prog1 prog1.c
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨ï¼š<code>-ggdb</code>çš„é€‰é¡¹ä½œç”¨ï¼šç”Ÿæˆ<code>gdb</code>ä¸“ç”¨çš„è°ƒè¯•ä¿¡æ¯ï¼Œä¼šæœ‰ä¸€äº›<code>gdb</code>ä¸“ç”¨çš„æ‰©å±•</p>
</blockquote>
<ul>
<li>ç„¶åæˆ‘ä»¬ç”¨objdumpåšä¸€ä¸‹åæ±‡ç¼–</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">objdump -d prog1 &gt; prog1.asm
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ä»æˆ‘ä»¬ç»ˆç«¯æ•²å›è½¦åˆ°ç¨‹åºè¢«è½½å…¥æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆ">ä»æˆ‘ä»¬ç»ˆç«¯æ•²å›è½¦åˆ°ç¨‹åºè¢«è½½å…¥æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h4>
<ul>
<li>å½“æˆ‘ä»¬ä»ç»ˆç«¯è¾“å…¥è¦è¿è¡Œçš„ç¨‹åºæˆ–è€…æ˜¯ä»æœ‰å…³çš„<code>gui</code>ç•Œé¢ç‚¹å‡»ç›¸å…³çš„buttonçš„æ—¶å€™ï¼Œ<b>shell</b>æˆ–è€…<b>gui</b>å°±ä¼šè°ƒç”¨<code>execve()</code>ã€‚è¿™é‡Œä¸æ˜¯æˆ‘ä»¬é‡ç‚¹å…³å¿ƒçš„åœ°æ–¹ï¼Œç®€å•æ¥è¯´ï¼Œexecve()ä¼šè®¾ç«‹ä¸€ä¸ªæ ˆï¼Œç„¶åå°†å‚æ•°<code>argc</code>ï¼Œ<code>argv</code>å’Œ<code>envp</code>å‹å…¥æ ˆä¸­ã€‚æ–‡ä»¶æè¿°ç¬¦0ï¼Œ1ï¼Œ2ï¼ˆstdin, stdoutå’Œstderrï¼‰ç”±ä¹‹å‰çš„shellè®¾ç½®ï¼ŒåŠ è½½å™¨ä¼šå¸®æˆ‘ä»¬å®Œæˆæœ‰å…³é‡å®šä½çš„è®¸å¤šå·¥ä½œï¼Œå½“æ‰€æœ‰æå®šä¹‹åï¼Œæ§åˆ¶æƒä¼šä¼ é€’ç»™<code>_start()</code></li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/support2-2.png" title="/img/Operating System/support2-2.png" data-thumbnail="/img/Operating System/support2-2.png" data-sub-html="<h2>shellè¾“å…¥man execveä¹‹åçš„å‡½æ•°å£°æ˜å’Œæ‰€åœ¨ä½ç½®</h2>">
        
    </a><figcaption class="image-caption">shellè¾“å…¥<code>man execve</code>ä¹‹åçš„å‡½æ•°å£°æ˜å’Œæ‰€åœ¨ä½ç½®</figcaption>
    </figure>
<h4 id="_start">_start()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">080482e0 &lt;_start&gt;:
</span></span><span class="line"><span class="cl">80482e0:       31 ed                   xor    %ebp,%ebp
</span></span><span class="line"><span class="cl">80482e2:       5e                      pop    %esi
</span></span><span class="line"><span class="cl">80482e3:       89 e1                   mov    %esp,%ecx
</span></span><span class="line"><span class="cl">80482e5:       83 e4 f0                and    $0xfffffff0,%esp
</span></span><span class="line"><span class="cl">80482e8:       50                      push   %eax
</span></span><span class="line"><span class="cl">80482e9:       54                      push   %esp
</span></span><span class="line"><span class="cl">80482ea:       52                      push   %edx
</span></span><span class="line"><span class="cl">80482eb:       68 00 84 04 08          push   $0x8048400
</span></span><span class="line"><span class="cl">80482f0:       68 a0 83 04 08          push   $0x80483a0
</span></span><span class="line"><span class="cl">80482f5:       51                      push   %ecx
</span></span><span class="line"><span class="cl">80482f6:       56                      push   %esi
</span></span><span class="line"><span class="cl">80482f7:       68 94 83 04 08          push   $0x8048394
</span></span><span class="line"><span class="cl">80482fc:       e8 c3 ff ff ff          call   80482c4 &lt;__libc_start_main@plt&gt;
</span></span><span class="line"><span class="cl">8048301:       f4                      hlt
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä»»ä½•å€¼<code>xor</code>è‡ªèº«å¾—åˆ°çš„ç»“æœéƒ½æ˜¯0ã€‚æ‰€ä»¥<code>xor %ebp,%ebp</code>è¯­å¥ä¼šæŠŠ<code>%ebp</code>è®¾ç½®ä¸º0ã€‚ABIï¼ˆApplication Binary Interface specificationï¼‰æ¨èè¿™ä¹ˆåšï¼Œç›®çš„æ˜¯ä¸ºäº†æ ‡è®°æœ€å¤–å±‚å‡½æ•°çš„é¡µå¸§ï¼ˆframeï¼‰</li>
<li>æ¥ä¸‹æ¥ï¼Œä»æ ˆä¸­å¼¹å‡ºæ ˆé¡¶çš„å€¼ä¿å­˜åˆ°<code>%esi</code>ã€‚åœ¨æœ€å¼€å§‹çš„æ—¶å€™æˆ‘ä»¬æŠŠ<code>argc</code>ï¼Œ<code>argv</code>å’Œ<code>envp</code>æ”¾åˆ°äº†æ ˆé‡Œï¼Œæ‰€ä»¥ç°åœ¨çš„<code>pop</code>è¯­å¥ä¼šæŠŠ<code>argc</code>æ”¾åˆ°<code>%esi</code>ä¸­</li>
<li>è¿™é‡Œåªæ˜¯ä¸´æ—¶ä¿å­˜ä¸€ä¸‹ï¼Œç¨åæˆ‘ä»¬ä¼šæŠŠå®ƒå†æ¬¡å‹å›æ ˆä¸­</li>
<li>å› ä¸ºæˆ‘ä»¬å¼¹å‡ºäº†<code>argc</code>ï¼Œæ‰€ä»¥<code>%ebp</code>ç°åœ¨æŒ‡å‘çš„æ˜¯<code>argv</code>ã€‚<code>mov</code>æŒ‡ä»¤æŠŠ<code>argv</code>æ”¾åˆ°äº†<code>%ecx</code>ä¸­ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç§»åŠ¨æ ˆæŒ‡é’ˆ</li>
<li><u>ç„¶åï¼Œå°†æ ˆæŒ‡é’ˆå’Œä¸€ä¸ªå¯ä»¥æ¸…é™¤åå››ä½çš„æ©ç åš<code>and</code>æ“ä½œã€‚æ ¹æ®å½“å‰æ ˆæŒ‡é’ˆçš„ä½ç½®ä¸åŒï¼Œæ ˆæŒ‡é’ˆå°†ä¼šå‘ä¸‹ç§»åŠ¨0åˆ°15ä¸ªå­—èŠ‚ã€‚è¿™ä¹ˆåšï¼Œä¿è¯äº†ä»»ä½•æƒ…å†µä¸‹ï¼Œæ ˆæŒ‡é’ˆéƒ½æ˜¯16å­—èŠ‚çš„å¶æ•°å€å¯¹é½çš„ã€‚å¯¹é½çš„ç›®çš„æ˜¯ä¿è¯æ ˆä¸Šæ‰€æœ‰çš„å˜é‡éƒ½èƒ½å¤Ÿè¢«å†…å­˜å’Œcacheå¿«é€Ÿçš„è®¿é—®</u></li>
<li><u>è¦æ±‚è¿™ä¹ˆåšçš„æ˜¯SSEï¼Œå°±æ˜¯æŒ‡ä»¤éƒ½èƒ½åœ¨å•ç²¾åº¦æµ®ç‚¹æ•°ç»„ä¸Šå·¥ä½œçš„é‚£ä¸ª<b>ï¼ˆæ‰©å±•æŒ‡ä»¤é›†ï¼‰</b></u></li>
<li>ä¾‹å­ï¼šæŸæ¬¡è¿è¡Œæ—¶ï¼Œ<code>_start</code>å‡½æ•°åˆšè¢«è°ƒç”¨çš„æ—¶å€™ï¼Œ<code>%esp</code>å¤„äº<code>0xbffff770</code>ã€‚åœ¨æˆ‘ä»¬ä»æ ˆä¸Šå¼¹å‡º<code>argc</code>åï¼Œ<code>%esp</code>æŒ‡å‘<code>0xbffff774</code>ã€‚å®ƒå‘é«˜åœ°å€ç§»åŠ¨äº†ï¼ˆæ ˆå‘ä¸‹å¢é•¿ï¼‰ã€‚å½“å¯¹æ ˆæŒ‡é’ˆæ‰§è¡Œäº†<code>and</code>æ“ä½œåï¼Œæ ˆæŒ‡é’ˆå›åˆ°äº†<code>0xbffff770</code></li>
</ul>
<h4 id="__libc_start_main">__libc_start_main</h4>
<ul>
<li>ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠ<code>__libc_start_main</code>å‡½æ•°çš„å‚æ•°å‹å…¥æ ˆä¸­ã€‚ç¬¬ä¸€ä¸ªå‚æ•°<code>%eax</code>è¢«å‹å…¥æ ˆä¸­ï¼Œé‡Œé¢ä¿å­˜äº†æ— æ•ˆä¿¡æ¯ï¼ŒåŸå› æ˜¯ç¨åä¼šæœ‰ä¸ƒä¸ªå‚æ•°å°†è¢«å‹å…¥æ ˆä¸­ï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯16å­—èŠ‚å¯¹é½ï¼Œæ‰€ä»¥éœ€è¦ç¬¬å…«ä¸ªå‚æ•°ã€‚è¿™ä¸ªå€¼ä¹Ÿå¹¶ä¸ä¼šè¢«ç”¨åˆ°ã€‚<code>__libc_start_main</code>æ˜¯åœ¨é“¾æ¥çš„æ—¶å€™ä»glibcå¤åˆ¶è¿‡æ¥çš„ã€‚åœ¨glibcçš„ä»£ç ä¸­ï¼Œå®ƒä½äº<code>csu/libc-start.c</code>æ–‡ä»¶é‡Œã€‚<code>__libc_start_main</code>çš„å®šä¹‰å¦‚ä¸‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">__libc_start_main</span><span class="p">(</span>  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">main</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="o">*</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="o">*</span> <span class="n">ubp_av</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">init</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fini</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">rtld_fini</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="kt">void</span> <span class="p">(</span><span class="o">*</span> <span class="n">stack_end</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><figure><a class="lightgallery" href="/img/Operating%20System/support2-3.jpg" title="/img/Operating System/support2-3.jpg" data-thumbnail="/img/Operating System/support2-3.jpg" data-sub-html="<h2>å‚æ•°è¯´æ˜</h2>">
        
    </a><figcaption class="image-caption">å‚æ•°è¯´æ˜</figcaption>
    </figure>
<ul>
<li>__libc_csu_finiå‡½æ•°ä¹Ÿæ˜¯ä»glibcè¢«é“¾æ¥è¿›æˆ‘ä»¬ä»£ç çš„ï¼Œå®ƒçš„æºä»£ç ä½äºcsu/elf-init.cä¸­</li>
</ul>
<h4 id="ç¯å¢ƒå˜é‡å“ªé‡Œå»äº†">ç¯å¢ƒå˜é‡å“ªé‡Œå»äº†ï¼Ÿ</h4>
<ul>
<li>
<p>æˆ‘ä»¬å¹¶æ²¡æœ‰è·å–envpï¼ˆæ ˆé‡ŒæŒ‡å‘æˆ‘ä»¬ç¯å¢ƒå˜é‡çš„æŒ‡é’ˆï¼‰ï¼Ÿå®ƒå¹¶ä¸æ˜¯<code>__libc_start_main</code>å‡½æ•°çš„å‚æ•°ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“mainå‡½æ•°çš„åŸå‹å…¶å®æ˜¯<code>int main(int argc, char** argv, char** envp)</code>ã€‚æ‰€ä»¥ï¼Œåˆ°åº•æ€ä¹ˆå›äº‹ï¼Ÿ</p>
</li>
<li>
<p>å…¶å®ï¼Œ<code>__libc_start_main</code>å‡½æ•°ä¼šè°ƒç”¨<code>__libc_init_first</code>ï¼Œè¿™ä¸ªå‡½æ•°ä¼šä½¿ç”¨å†…éƒ¨ä¿¡æ¯å»æ‰¾åˆ°ç¯å¢ƒå˜é‡ï¼ˆå®é™…ä¸Šç¯å¢ƒå˜é‡å°±ä½äº<code>argv</code>çš„ç»ˆæ­¢å­—ç¬¦nullçš„åé¢ï¼‰ï¼Œç„¶åè®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡<code>__environ</code>ï¼Œè¿™ä¸ªå…¨å±€å˜é‡å¯ä»¥è¢«<code>__libc_start_main</code>å‡½æ•°å†…éƒ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼ŒåŒ…æ‹¬è°ƒç”¨mainå‡½æ•°æ—¶ã€‚å½“<code>envp</code>å»ºç«‹äº†ä¹‹åï¼Œ<code>__libc_start_main</code>å‡½æ•°ä¼šä½¿ç”¨ç›¸åŒçš„å°æŠ€å·§ï¼Œè¶Šè¿‡envpæ•°ç»„ä¹‹åçš„<code>NULL</code>å­—ç¬¦ï¼Œè·å–å¦ä¸€ä¸ªå‘é‡â€”â€”ELFè¾…åŠ©å‘é‡ï¼ˆåŠ è½½å™¨ä½¿ç”¨å®ƒç»™è¿›ç¨‹ä¼ é€’ä¸€äº›ä¿¡æ¯ï¼‰</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">__libc_init_first</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">arg0</span><span class="p">,</span> <span class="p">...)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">arg0</span><span class="p">,</span> <span class="o">**</span><span class="n">envp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">argv</span><span class="p">[</span><span class="n">argc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">__environ</span> <span class="o">=</span> <span class="n">envp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">__libc_init</span> <span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">envp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¿è¡Œç¨‹åºå‰ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡<code>LD_SHOW_AUXV=1</code>,å¯ä»¥æŸ¥çœ‹é‡Œé¢çš„å†…å®¹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ <span class="nv">LD_SHOW_AUXV</span><span class="o">=</span><span class="m">1</span> ./prog1
</span></span><span class="line"><span class="cl">AT_SYSINFO:      0xe62414
</span></span><span class="line"><span class="cl">AT_SYSINFO_EHDR: 0xe62000
</span></span><span class="line"><span class="cl">AT_HWCAP:    fpu vme de pse tsc msr pae mce cx8 apic
</span></span><span class="line"><span class="cl">             mtrr pge mca cmov pat pse36 clflush dts
</span></span><span class="line"><span class="cl">             acpi mmx fxsr sse sse2 ss ht tm pbe
</span></span><span class="line"><span class="cl">AT_PAGESZ:       <span class="m">4096</span>
</span></span><span class="line"><span class="cl">AT_CLKTCK:       <span class="m">100</span>
</span></span><span class="line"><span class="cl">AT_PHDR:         0x8048034
</span></span><span class="line"><span class="cl">AT_PHENT:        <span class="m">32</span>
</span></span><span class="line"><span class="cl">AT_PHNUM:        <span class="m">8</span>
</span></span><span class="line"><span class="cl">AT_BASE:         0x686000
</span></span><span class="line"><span class="cl">AT_FLAGS:        0x0
</span></span><span class="line"><span class="cl">AT_ENTRY:        0x80482e0
</span></span><span class="line"><span class="cl">AT_UID:          <span class="m">1002</span>
</span></span><span class="line"><span class="cl">AT_EUID:         <span class="m">1002</span>
</span></span><span class="line"><span class="cl">AT_GID:          <span class="m">1000</span>
</span></span><span class="line"><span class="cl">AT_EGID:         <span class="m">1000</span>
</span></span><span class="line"><span class="cl">AT_SECURE:       <span class="m">0</span>
</span></span><span class="line"><span class="cl">AT_RANDOM:       0xbff09acb
</span></span><span class="line"><span class="cl">AT_EXECFN:       ./prog1
</span></span><span class="line"><span class="cl">AT_PLATFORM:     i686
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>å„ç§å„æ ·çš„ä¿¡æ¯ã€‚<code>AT_ENTRY</code>æ˜¯<code>_start</code>çš„åœ°å€ï¼Œè¿˜æœ‰æˆ‘ä»¬çš„UIDã€æœ‰æ•ˆUIDå’ŒGID</p>
</li>
<li>
<p><b>__libc_start_mainåŠŸèƒ½æ€»ç»“</b></p>
<ul>
<li>å¤„ç†å…³äºsetuidã€setgidç¨‹åºçš„å®‰å…¨é—®é¢˜</li>
<li>å¯åŠ¨çº¿ç¨‹</li>
<li>æŠŠ<code>fini</code>å‡½æ•°å’Œ<code>rtld_fini</code>å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™<code>at_exit</code>è°ƒç”¨ï¼Œä½¿å®ƒä»¬åœ¨<code>at_exit</code>é‡Œè¢«è°ƒç”¨ï¼Œä»è€Œå®Œæˆç”¨æˆ·ç¨‹åºå’ŒåŠ è½½å™¨çš„è°ƒç”¨ç»“æŸä¹‹åçš„æ¸…ç†å·¥ä½œ</li>
<li>è°ƒç”¨å…¶<code>init</code>å‚æ•°</li>
<li>è°ƒç”¨<code>main</code>å‡½æ•°ï¼Œå¹¶æŠŠ<code>argc</code>å’Œ<code>argv</code>å‚æ•°ã€ç¯å¢ƒå˜é‡ä¼ é€’ç»™å®ƒ</li>
<li>è°ƒç”¨<code>exit</code>å‡½æ•°ï¼Œå¹¶å°†mainå‡½æ•°çš„è¿”å›å€¼ä¼ é€’ç»™å®ƒ</li>
</ul>
</li>
</ul>
<h2 id="ç›¸å…³å‚è€ƒèµ„æ–™">ç›¸å…³å‚è€ƒèµ„æ–™</h2>
<ul>
<li>å‚è€ƒæ–‡ç« 
<ul>
<li>
<p><a href="http://dbp-consulting.com/tutorials/debugging/linuxProgramStartup.html" target="_blank" rel="noopener noreffer">ã€ŠLinux x86 Program Start Up or - How the heck do we get to main()? by Patrick Horganã€‹</a></p>
</li>
<li>
<p><a href="https://luomuxiaoxiao.com/?p=516" target="_blank" rel="noopener noreffer">ã€ŠLinux X86 ç¨‹åºå¯åŠ¨ â€“ mainå‡½æ•°æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„ï¼Ÿâ€”â€”è½æœ¨è§è§çš„åšå®¢ã€‹</a>ï¼ˆå·²ä¸ä½œè€…æ²Ÿé€šï¼ŒåŒæ„éƒ¨åˆ†è½¬è½½ï¼‰</p>
</li>
<li>
<p><a href="https://www.gnu.org/software/hurd/glibc/startup.html" target="_blank" rel="noopener noreffer">ã€ŠHow libc startup in a process worksã€‹</a></p>
</li>
</ul>
</li>
</ul>
]]></description>
</item>
<item>
    <title>Chapter2-éƒ¨åˆ†äºŒåˆ·-ä¸ªäººç†è§£System call</title>
    <link>https://Jungle430.github.io/posts/operating-system/support1/</link>
    <pubDate>Sun, 26 Feb 2023 21:02:57 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/operating-system/support1/</guid>
    <description><![CDATA[<h1 id="äºŒåˆ·éƒ¨åˆ†chapter2-longrightarrow-å¦‚ä½•ç†è§£system-call">äºŒåˆ·éƒ¨åˆ†Chapter2 $\Longrightarrow$ å¦‚ä½•ç†è§£<code>System call</code></h1>
<h2 id="é—®é¢˜æ„é€ æœ€å°çš„hello-worldç¨‹åº">é—®é¢˜ï¼šæ„é€ æœ€å°çš„â€Hello worldâ€ç¨‹åº</h2>
<h3 id="åŸºæœ¬ç¨‹åºå’Œé™æ€ç¼–è¯‘">åŸºæœ¬ç¨‹åºå’Œé™æ€ç¼–è¯‘</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello world&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -static hello.c -o hello <span class="o">&amp;&amp;</span> ./hello
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–è¯‘å‡ºæ¥å¾ˆå¤§(Ubuntuä¸Šçº¦900KB)</p>
<ul>
<li>å¦‚æœåªç¼–è¯‘ï¼Œä¸é“¾æ¥ï¼Œçœ‹ä¸€ä¸‹objæ–‡ä»¶çš„åæ±‡ç¼–</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gcc -c hello.c <span class="o">&amp;&amp;</span> objdump -d hello.o
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">hello.oï¼š     æ–‡ä»¶æ ¼å¼ elf64-x86-64
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Disassembly of section .text:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">0000000000000000</span> &lt;main&gt;:
</span></span><span class="line"><span class="cl">   0:	f3 0f 1e fa          	endbr64 
</span></span><span class="line"><span class="cl">   4:	<span class="m">55</span>                   	push   %rbp
</span></span><span class="line"><span class="cl">   5:	<span class="m">48</span> <span class="m">89</span> e5             	mov    %rsp,%rbp
</span></span><span class="line"><span class="cl">   8:	<span class="m">48</span> 8d <span class="m">05</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> 	lea    0x0<span class="o">(</span>%rip<span class="o">)</span>,%rax        <span class="c1"># f &lt;main+0xf&gt;</span>
</span></span><span class="line"><span class="cl">   f:	<span class="m">48</span> <span class="m">89</span> c7             	mov    %rax,%rdi
</span></span><span class="line"><span class="cl">  12:	b8 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>       	mov    <span class="nv">$0</span>x0,%eax
</span></span><span class="line"><span class="cl">  17:	e8 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>       	call   1c &lt;main+0x1c&gt;
</span></span><span class="line"><span class="cl">  1c:	b8 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>       	mov    <span class="nv">$0</span>x0,%eax
</span></span><span class="line"><span class="cl">  21:	5d                   	pop    %rbp
</span></span><span class="line"><span class="cl">  22:	c3                   	ret    
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å°±å’Œæ™®é€šçš„å‡½æ•°å·®ä¸å¤šï¼Œåªæœ‰å‚æ•°å‹æ ˆï¼Œcallå’Œå‚æ•°å‡ºæ ˆçš„è¿‡ç¨‹
<ul>
<li>æ™®é€šå‡½æ•°<code>fun.c</code></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">f</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -c fun.c <span class="o">&amp;&amp;</span> objdump -d fun.o 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fun.oï¼š     æ–‡ä»¶æ ¼å¼ elf64-x86-64
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Disassembly of section .text:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">0000000000000000</span> &lt;f&gt;:
</span></span><span class="line"><span class="cl">   0:	f3 0f 1e fa          	endbr64 
</span></span><span class="line"><span class="cl">   4:	<span class="m">55</span>                   	push   %rbp
</span></span><span class="line"><span class="cl">   5:	<span class="m">48</span> <span class="m">89</span> e5             	mov    %rsp,%rbp
</span></span><span class="line"><span class="cl">   8:	<span class="m">90</span>                   	nop
</span></span><span class="line"><span class="cl">   9:	5d                   	pop    %rbp
</span></span><span class="line"><span class="cl">   a:	c3                   	ret
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>å¯ä»¥çœ‹åˆ°ä¸é“¾æ¥çš„è¯å’Œæ™®é€šçš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹å·®ä¸å¤š</p>
</li>
<li>
<p>é“¾æ¥å¤±è´¥ï¼</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â—‹ â†’ ld hello.o
</span></span><span class="line"><span class="cl">ld: è­¦å‘Š: æ— æ³•æ‰¾åˆ°é¡¹ç›®ç¬¦å· _start<span class="p">;</span> ç¼ºçœä¸º <span class="m">0000000000401000</span>
</span></span><span class="line"><span class="cl">ld: hello.o: in <span class="k">function</span> <span class="sb">`</span>main<span class="s1">&#39;:
</span></span></span><span class="line"><span class="cl"><span class="s1">hello.c:(.text+0x18): undefined reference to `printf&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æœ¬æ¥ä»¥ä¸ºæ‰¾çš„<code>main</code>ï¼Œä½†æ˜¯å®ƒå®é™…ä¸Šåœ¨æ‰¾<code>_start</code>è¿™ä¸ªä¸œè¥¿ï¼Ÿ</li>
</ul>
<h3 id="é‚£æˆ‘ä»¬å°±æŠŠmainæ”¹æˆ_start">é‚£æˆ‘ä»¬å°±æŠŠ<code>main</code>æ”¹æˆ<code>_start</code></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">_start</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello world&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><figure><a class="lightgallery" href="/img/Operating%20System/support1-1.png" title="/img/Operating System/support1-1.png" data-thumbnail="/img/Operating System/support1-1.png" data-sub-html="<h2>ldä»ç„¶ä¸äºˆé€šè¿‡-&gt; æ‰¾ä¸åˆ°printf?</h2>">
        
    </a><figcaption class="image-caption"><code>ldä»ç„¶ä¸äºˆé€šè¿‡</code>-&gt; æ‰¾ä¸åˆ°printf?</figcaption>
    </figure>
<ul>
<li>é‚£æŠŠprintfä¹Ÿç»™å»äº†</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">_start</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç¼–è¯‘ä¸é“¾æ¥å…¨éƒ¨æˆåŠŸï¼</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â—‹ â†’ gcc -c hello.c <span class="o">&amp;&amp;</span> objdump -d hello.o <span class="o">&amp;&amp;</span> ld hello.o
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">hello.oï¼š     æ–‡ä»¶æ ¼å¼ elf64-x86-64
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Disassembly of section .text:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">0000000000000000</span> &lt;_start&gt;:
</span></span><span class="line"><span class="cl">   0:	f3 0f 1e fa          	endbr64 
</span></span><span class="line"><span class="cl">   4:	<span class="m">55</span>                   	push   %rbp
</span></span><span class="line"><span class="cl">   5:	<span class="m">48</span> <span class="m">89</span> e5             	mov    %rsp,%rbp
</span></span><span class="line"><span class="cl">   8:	<span class="m">90</span>                   	nop
</span></span><span class="line"><span class="cl">   9:	5d                   	pop    %rbp
</span></span><span class="line"><span class="cl">   a:	c3                   	ret    
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>ç¨‹åºå¾ˆå°ï¼Œåªæœ‰99ä¸ªå­—èŠ‚</p>
</li>
<li>
<p>ä½†æ˜¯è¿è¡Œ $\Longrightarrow$ æ®µé”™è¯¯ï¼</p>
</li>
<li>
<p>ä½†æ˜¯é‡Œé¢åŠ å…¥while(1)è¿™ç§æ­»å¾ªç¯å°±æ²¡äº‹äº†</p>
</li>
</ul>
<hr>
<ul>
<li>å¯¹äºæ²¡æœ‰while(1)çš„a.outï¼Œä½¿ç”¨gdbç‹ ç‹ çš„æ‹·æ‰“è°ƒè¯•</li>
</ul>
<a class="lightgallery" href="/img/Operating%20System/support1-2.jpg" title="/img/Operating System/support1-2.jpg" data-thumbnail="/img/Operating System/support1-2.jpg">
        
    </a>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çœ‹åˆ°rspçš„åœ°å€æ˜¯åˆæ³•çš„ï¼Œé‡Œé¢çš„å€¼æ˜¯1ï¼Œå½“æ‰§è¡Œretåï¼Œrspå°†æ ˆé¡¶çš„å€¼1èµ‹ç»™äº†pcï¼Œgdbæ˜¾ç¤ºpcè®¿é—®äº†éæ³•ä½ç½®</p>
<figure><a class="lightgallery" href="/img/Operating%20System/support1-3.png" title="/img/Operating System/support1-3.png" data-thumbnail="/img/Operating System/support1-3.png" data-sub-html="<h2>ğŸ¤¡å‘¦å¼ï¼Œå´©æºƒäº†ï¼</h2>">
        
    </a><figcaption class="image-caption">ğŸ¤¡å‘¦å¼ï¼Œå´©æºƒäº†ï¼</figcaption>
    </figure>
<ul>
<li>CPUåªä¼šæ‰§è¡ŒæŒ‡ä»¤ï¼Œè¯¥æ€ä¹ˆåœä¸‹æ¥ï¼Ÿ(mov,addè¿™äº›æŒ‡ä»¤åœä¸ä¸‹æ¥)</li>
<li>éœ€è¦ä»€ä¹ˆæŒ‡ä»¤è®©å®ƒåœä¸‹æ¥ï¼Ÿ $\Longrightarrow$ <code>System call</code> ä¹Ÿå°±æ˜¯ç®¡æ€</li>
</ul>
<h3 id="æœ€å°çš„hello-worldç¨‹åº">æœ€å°çš„<code>Hello world</code>ç¨‹åº</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/syscall.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="n">globl</span> <span class="n">_start</span>
</span></span><span class="line"><span class="cl"><span class="nl">_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="n">SYS_write</span><span class="p">,</span> <span class="o">%</span><span class="n">rax</span>   <span class="err">#</span> <span class="n">write</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span>         <span class="o">%</span><span class="n">rdi</span>   <span class="err">#</span>   <span class="n">fd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="n">st</span><span class="p">,</span>        <span class="o">%</span><span class="n">rsi</span>   <span class="err">#</span>   <span class="n">buf</span><span class="o">=</span><span class="n">st</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="p">(</span><span class="n">ed</span> <span class="o">-</span> <span class="n">st</span><span class="p">),</span> <span class="o">%</span><span class="n">rdx</span>   <span class="err">#</span>   <span class="n">count</span><span class="o">=</span><span class="n">ed</span><span class="o">-</span><span class="n">st</span>
</span></span><span class="line"><span class="cl">  <span class="n">syscall</span>                 <span class="err">#</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="n">SYS_exit</span><span class="p">,</span>  <span class="o">%</span><span class="n">rax</span>   <span class="err">#</span> <span class="n">exit</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span>         <span class="o">%</span><span class="n">rdi</span>   <span class="err">#</span>   <span class="n">status</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="n">syscall</span>                 <span class="err">#</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">st</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="n">ascii</span> <span class="s">&#34;</span><span class="se">\033</span><span class="s">[01;31mHello, OS World</span><span class="se">\033</span><span class="s">[0m</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nl">ed</span><span class="p">:</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å®ƒåœ¨å¹²ä»€ä¹ˆ
<ul>
<li>ç»™è®¸å¤šå¯„å­˜å™¨èµ‹å€¼ï¼Œç„¶åcalläº†syscall</li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/support1-4.png" title="/img/Operating System/support1-4.png" data-thumbnail="/img/Operating System/support1-4.png" data-sub-html="<h2>ç¼–è¯‘åæŸ¥çœ‹åæ±‡ç¼–ä»£ç </h2>">
        
    </a><figcaption class="image-caption">ç¼–è¯‘åæŸ¥çœ‹åæ±‡ç¼–ä»£ç </figcaption>
    </figure>
<ul>
<li>ldé“¾æ¥ï¼Œç¼–è¯‘æˆåŠŸï¼Œè¿è¡ŒæˆåŠŸï¼</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â—‹ â†’ objdump -d a.out <span class="p">|</span> less
</span></span></code></pre></td></tr></table>
</div>
</div><figure><a class="lightgallery" href="/img/Operating%20System/support1-5.png" title="/img/Operating System/support1-5.png" data-thumbnail="/img/Operating System/support1-5.png" data-sub-html="<h2>æŸ¥çœ‹åæ±‡ç¼–ä»£ç </h2>">
        
    </a><figcaption class="image-caption">æŸ¥çœ‹åæ±‡ç¼–ä»£ç </figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/support1-6.png" title="/img/Operating System/support1-6.png" data-thumbnail="/img/Operating System/support1-6.png" data-sub-html="<h2>man syscallæŸ¥çœ‹syscallçš„æ–‡æ¡£</h2>">
        
    </a><figcaption class="image-caption"><code>man syscall</code>æŸ¥çœ‹syscallçš„æ–‡æ¡£</figcaption>
    </figure>
<p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œsyscallä¼šå‘Šè¯‰æˆ‘ä»¬åœ¨å„ç§æ¶æ„çš„è®¡ç®—æœºä¸­è¯¥å¦‚ä½•é€šè¿‡å¯„å­˜å™¨ä¸ºsyscallä¼ å…¥å‚æ•°,<code>man syscalls</code>ä¼šå‘Šè¯‰æˆ‘ä»¬Linuxæ“ä½œç³»ç»Ÿçš„æ¥å£</p>
<ul>
<li>æ‰€ä»¥ç¨‹åºçš„æ‰§è¡Œæ¨¡å¼</li>
</ul>
<div class="mermaid" id="id-1"></div>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>æ„Ÿè°¢<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="typeit"><div id="id-2" class=""></div></div>
<p>æ„Ÿè°¢jyyäº’åŠ©ç¾¤é‡Œ<b>zweix</b>å¤§ä½¬æä¾›çš„<a href="https://github.com/zweix123/jyyslide-md" target="_blank" rel="noopener noreffer">
jyyslide-md</a></p>
<p>ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°å› ä¸ºWindowså¾ˆçƒ‚çš„ç¼–ç é—®é¢˜å§‹ç»ˆä¼šå‡ºç°gbkè§£ç é”™è¯¯çš„errorï¼Œå’Œ<b>zweix</b>å¤§ä½¬å·®ä¸å¤šæ²Ÿé€šäº†å¤§åŠä¸ªä¸‹åˆï¼Œç”±äºæ‡’å¾—ç»™vscodeé…ç¯å¢ƒç›´æ¥æ”¹æˆæ‰‹åŠ¨printçœ‹æ•°æ®ğŸ¤£ï¼Œæ„Ÿè§‰å°±æ˜¯å‘½ä»¤è¡Œä¼ å‚ç¼–ç çš„é—®é¢˜ï¼Œæœ€åç»ˆäºæ‰¾åˆ°äº†è§£å†³æ–¹æ³•ğŸ˜†ï¼Œåªèƒ½è¯´Windowsè¿™ä¸ªç¼–ç è®¾ç½®ä¹Ÿæ˜¯æ²¡è°äº†ã€‚</p>
</div>
        </div>
    </div>
]]></description>
</item>
<item>
    <title>Operating System Chapter3 å¤šå¤„ç†å™¨ç¼–ç¨‹ï¼šä»å…¥é—¨åˆ°æ”¾å¼ƒ</title>
    <link>https://Jungle430.github.io/posts/operating-system/operating-system-chapter3/</link>
    <pubDate>Sun, 01 Jan 2023 19:59:41 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/operating-system/operating-system-chapter3/</guid>
    <description><![CDATA[<h1 id="operating-system">Operating System</h1>
<p>$Nanjing\ University\rightarrow Yanyan\ Jiang\newline$</p>
<h2 id="å¤šå¤„ç†å™¨ç¼–ç¨‹ä»å…¥é—¨åˆ°æ”¾å¼ƒ">å¤šå¤„ç†å™¨ç¼–ç¨‹ï¼šä»å…¥é—¨åˆ°æ”¾å¼ƒ</h2>
<h3 id="overview">Overview</h3>
<p>å¤ä¹ </p>
<ul>
<li>ç¨‹åº (æºä»£ç <code>S</code>ã€äºŒè¿›åˆ¶ä»£ç <code>C</code>) = çŠ¶æ€æœº
<ul>
<li>ç¼–è¯‘å™¨ $C = \textrm{compile}(S)\newline$</li>
</ul>
</li>
<li>åº”ç”¨è§†è§’çš„æ“ä½œç³»ç»Ÿ = syscall æŒ‡ä»¤</li>
</ul>
<hr>
<p>æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜</p>
<ul>
<li><strong>Q</strong>: åœ¨å¤šå¤„ç†å™¨æ—¶ä»£ï¼Œä¸Šé¢çš„ç†è§£åº”è¯¥ä½œå‡ºæ€æ ·çš„å˜åŒ–ï¼Ÿ</li>
</ul>
<hr>
<p>æœ¬æ¬¡è¯¾ä¸»è¦å†…å®¹</p>
<ul>
<li>å¹¶å‘ç¨‹åºçš„çŠ¶æ€æœºæ¨¡å‹</li>
<li>çº¿ç¨‹åº“ <code>thread.h</code></li>
<li>å¤šçº¿ç¨‹å¸¦æ¥çš„éº»çƒ¦</li>
</ul>
<h3 id="å…¥é—¨">å…¥é—¨</h3>
<h4 id="three-easy-pieces-å¹¶å‘">Three Easy Pieces: å¹¶å‘</h4>
<blockquote>
<p>Concurrent: existing, happening, or done <em>at the same time</em>.</p>
<p>In computer science, concurrency refers to the ability of different parts or units of a program, algorithm, or problem to be executed out-of-order or in partial order, without affecting the final outcome. (Wikipedia)</p>
</blockquote>
<p>ä¸ºä»€ä¹ˆåœ¨è¿™é—¨è¯¾ (å…ˆ) è®²å¹¶å‘ï¼Ÿ</p>
<ul>
<li>è®²å¹¶å‘
<ul>
<li><strong>æ“ä½œç³»ç»Ÿæ˜¯æœ€æ—©çš„å¹¶å‘ç¨‹åºä¹‹ä¸€</strong></li>
<li>ä»Šå¤©éåœ°éƒ½æ˜¯å¤šå¤„ç†å™¨ç³»ç»Ÿ (ä¸ºä»€ä¹ˆï¼Ÿ)</li>
</ul>
</li>
<li>å…ˆè®²å¹¶å‘
<ul>
<li>å®éªŒæ˜¯ bottom-up çš„ (L1: å¤šå¤„ç†å™¨ä¸Šçš„ <code>malloc</code>/<code>free</code>)</li>
</ul>
</li>
</ul>
<h4 id="å¹¶å‘çš„åŸºæœ¬å•ä½çº¿ç¨‹">å¹¶å‘çš„åŸºæœ¬å•ä½ï¼šçº¿ç¨‹</h4>
<p>å…±äº«å†…å­˜çš„å¤šä¸ªæ‰§è¡Œæµ</p>
<ul>
<li>æ‰§è¡Œæµæ‹¥æœ‰ç‹¬ç«‹çš„å †æ ˆ/å¯„å­˜å™¨</li>
<li>å…±äº«å…¨éƒ¨çš„å†…å­˜ (æŒ‡é’ˆå¯ä»¥äº’ç›¸å¼•ç”¨)</li>
</ul>
<hr>
<p>ç”¨çŠ¶æ€æœºçš„è§†è§’å°±å¾ˆå®¹æ˜“ç†è§£äº†ï¼</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-1.jpg" title="/img/Operating System/chapter3-1.jpg" data-thumbnail="/img/Operating System/chapter3-1.jpg" data-sub-html="<h2>æ‰‹å†™(çŠ¶æ€æœº,stack frameä¸å…±äº«å†…å­˜)</h2>">
        
    </a><figcaption class="image-caption">æ‰‹å†™(<code>çŠ¶æ€æœº,stack frameä¸å…±äº«å†…å­˜</code>)</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-2.jpg" title="/img/Operating System/chapter3-2.jpg" data-thumbnail="/img/Operating System/chapter3-2.jpg" data-sub-html="<h2>æ‰‹å†™(çº¿ç¨‹)</h2>">
        
    </a><figcaption class="image-caption">æ‰‹å†™(<code>çº¿ç¨‹</code>)</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-3.jpg" title="/img/Operating System/chapter3-3.jpg" data-thumbnail="/img/Operating System/chapter3-3.jpg" data-sub-html="<h2>æ‰‹å†™(å¹¶å‘ç¼–ç¨‹çš„ä¸ç¡®å®šæ€§)</h2>">
        
    </a><figcaption class="image-caption">æ‰‹å†™(<code>å¹¶å‘ç¼–ç¨‹çš„ä¸ç¡®å®šæ€§</code>)</figcaption>
    </figure>
<h4 id="å…¥é—¨threadh-ç®€åŒ–çš„çº¿ç¨‹-api">å…¥é—¨ï¼š<code>thread.h</code> ç®€åŒ–çš„çº¿ç¨‹ API</h4>
<p>æˆ‘ä»¬ä¸ºå¤§å®¶å°è£…äº†è¶…çº§å¥½ç”¨çš„çº¿ç¨‹ API (<a href="https://jyywiki.cn/pages/OS/2022/demos/thread.h" target="_blank" rel="noopener noreffer"><code>thread.h</code></a>)</p>
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">create</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>åˆ›å»ºä¸€ä¸ªå…¥å£å‡½æ•°æ˜¯<code>fn</code>çš„çº¿ç¨‹ï¼Œå¹¶ç«‹å³å¼€å§‹æ‰§è¡Œï¼ˆçŠ¶æ€æœºç†è§£åˆ›å»º $\rightarrow$ åœ¨çŠ¶æ€æœºé‡ŒåŠ å…¥ä¸€ä¸ªæ–°çš„æ ˆå¸§çš„åˆ—è¡¨ï¼Œå¹¶ä¸”æ¯æ¬¡å¯ä»¥é€‰åˆ°æ¯ä¸€ä¸ªé“¾è¡¨æ¥æ‰§è¡Œï¼‰</p>
<ul>
<li>
<p>void fn(int tid) { &hellip; }</p>
</li>
<li>
<p>å‚æ•° <code>tid</code> ä» 1 å¼€å§‹ç¼–å·</p>
</li>
</ul>
</li>
<li>
<p>è¯­ä¹‰ï¼šåœ¨çŠ¶æ€ä¸­æ–°å¢ stack frame åˆ—è¡¨å¹¶åˆå§‹åŒ–ä¸º <code>fn(tid)</code></p>
</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">join</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç­‰å¾…æ‰€æœ‰è¿è¡Œçº¿ç¨‹çš„ <code>fn</code> è¿”å›</li>
<li>åœ¨ <code>main</code> è¿”å›æ—¶ä¼šè‡ªåŠ¨ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸ</li>
<li><strong>è¯­ä¹‰ï¼šåœ¨æœ‰å…¶ä»–çº¿ç¨‹æœªæ‰§è¡Œå®Œæ—¶æ­»å¾ªç¯ï¼Œå¦åˆ™è¿”å›</strong>ï¼ˆç”¨çŠ¶æ€æœºç©ºè½¬çš„è§’åº¦æ¥ç†è§£ï¼‰</li>
</ul>
</li>
<li>
<p>ç¼–è¯‘æ—¶éœ€è¦å¢åŠ  <code>-lpthread</code></p>
</li>
</ul>
<p><code>thread.h</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdatomic.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define NTHREAD 64
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">enum</span> <span class="p">{</span> <span class="n">T_FREE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">T_LIVE</span><span class="p">,</span> <span class="n">T_DEAD</span><span class="p">,</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="kr">thread</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">pthread_t</span> <span class="kr">thread</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">entry</span><span class="p">)(</span><span class="kt">int</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="kr">thread</span> <span class="n">tpool</span><span class="p">[</span><span class="n">NTHREAD</span><span class="p">],</span> <span class="o">*</span><span class="n">tptr</span> <span class="o">=</span> <span class="n">tpool</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="nf">wrapper</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">struct</span> <span class="kr">thread</span> <span class="o">*</span><span class="kr">thread</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="kr">thread</span> <span class="o">*</span><span class="p">)</span><span class="n">arg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">thread</span><span class="o">-&gt;</span><span class="n">entry</span><span class="p">(</span><span class="kr">thread</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">create</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">fn</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">assert</span><span class="p">(</span><span class="n">tptr</span> <span class="o">-</span> <span class="n">tpool</span> <span class="o">&lt;</span> <span class="n">NTHREAD</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">*</span><span class="n">tptr</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="kr">thread</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">tptr</span> <span class="o">-</span> <span class="n">tpool</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">T_LIVE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">fn</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">tptr</span><span class="o">-&gt;</span><span class="kr">thread</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">,</span> <span class="n">tptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">++</span><span class="n">tptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">join</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NTHREAD</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="kr">thread</span> <span class="o">*</span><span class="n">t</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tpool</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">==</span> <span class="n">T_LIVE</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">pthread_join</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="kr">thread</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">t</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">=</span> <span class="n">T_DEAD</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">__attribute__</span><span class="p">((</span><span class="n">destructor</span><span class="p">))</span> <span class="kt">void</span> <span class="n">cleanup</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">join</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å…¥é—¨-contd">å…¥é—¨ (cont&rsquo;d)</h4>
<p>Hello, Multi-threaded World!</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;thread.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Ta</span><span class="p">()</span> <span class="p">{</span> <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">);</span> <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Tb</span><span class="p">()</span> <span class="p">{</span> <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;b&#34;</span><span class="p">);</span> <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Ta</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Tb</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–è¯‘ï¼ˆæ³¨æ„ä½¿ç”¨<code>-lpthread</code>ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">jungle@jungle-virtual-machine:~$ gcc the.c -lpthread 
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œ $\rightarrow$ äº¤æ›¿è¾“å‡º</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-4.png" title="/img/Operating System/chapter3-4.png" data-thumbnail="/img/Operating System/chapter3-4.png" data-sub-html="<h2>Linux(è¾“å‡ºç»“æœ)</h2>">
        
    </a><figcaption class="image-caption">Linux(<code>è¾“å‡ºç»“æœ</code>)</figcaption>
    </figure>
<p>åˆ©ç”¨ <code>thread.h</code> å°±å¯ä»¥å†™å‡ºåˆ©ç”¨å¤šå¤„ç†å™¨çš„ç¨‹åºï¼</p>
<ul>
<li>æ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨æŠŠçº¿ç¨‹æ”¾ç½®åœ¨ä¸åŒçš„å¤„ç†å™¨ä¸Š</li>
<li>åœ¨åå°è¿è¡Œï¼Œå¯ä»¥çœ‹åˆ° CPU ä½¿ç”¨ç‡è¶…è¿‡äº† 100%ï¼ˆ2ä¸ªæ¥è¿‘200ï¼Œ 4ä¸ªæ¥è¿‘400ï¼‰$\rightarrow$ ä½¿ç”¨äº†å¤šä¸ªCPU</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-5.png" title="/img/Operating System/chapter3-5.png" data-thumbnail="/img/Operating System/chapter3-5.png" data-sub-html="<h2>top(æŸ¥çœ‹CPUä½¿ç”¨ç‡)</h2>">
        
    </a><figcaption class="image-caption">top(<code>æŸ¥çœ‹CPUä½¿ç”¨ç‡</code>)</figcaption>
    </figure>
<blockquote>
<p>ä¼šç¼–ç¨‹ï¼Œä½ å°±æ‹¥æœ‰å…¨ä¸–ç•Œï¼</p>
</blockquote>
<p>å¦‚ä½•è¯æ˜çº¿ç¨‹ç¡®å®å…±äº«å†…å­˜ï¼Ÿ</p>
<ul>
<li><a href="https://jyywiki.cn/pages/OS/2022/demos/shm-test.c" target="_blank" rel="noopener noreffer">shm-test.c</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;thread.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Thello</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">usleep</span><span class="p">(</span><span class="n">id</span> <span class="o">*</span> <span class="mi">100000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello from thread #%c</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="s">&#34;123456789ABCDEF&#34;</span><span class="p">[</span><span class="n">x</span><span class="o">++</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">create</span><span class="p">(</span><span class="n">Thello</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œç»“æœ</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-6.png" title="/img/Operating System/chapter3-6.png" data-thumbnail="/img/Operating System/chapter3-6.png" data-sub-html="<h2>Linux(shm-test.cè¿è¡Œç»“æœ)</h2>">
        
    </a><figcaption class="image-caption">Linux(<code>shm-test.cè¿è¡Œç»“æœ</code>)</figcaption>
    </figure>
<hr>
<p>å¦‚ä½•è¯æ˜çº¿ç¨‹å…·æœ‰ç‹¬ç«‹å †æ ˆ (ä»¥åŠç¡®å®šå®ƒä»¬çš„èŒƒå›´)ï¼Ÿ</p>
<ul>
<li><a href="https://jyywiki.cn/pages/OS/2022/demos/stack-probe.c" target="_blank" rel="noopener noreffer">stack-probe.c</a> (è¾“å‡ºæœ‰ç‚¹ä¹±ï¼Ÿæˆ‘ä»¬è¿˜æœ‰ <code>sort</code>!)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;thread.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">__thread</span> <span class="kt">char</span> <span class="o">*</span><span class="n">base</span><span class="p">,</span> <span class="o">*</span><span class="n">cur</span><span class="p">;</span> <span class="c1">// thread-local variables
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">__thread</span> <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// objdump to see how thread-local variables are implemented
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span> <span class="kt">void</span> <span class="n">set_cur</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">)</span> <span class="p">{</span> <span class="n">cur</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span> <span class="kt">char</span> <span class="o">*</span><span class="n">get_cur</span><span class="p">()</span>         <span class="p">{</span> <span class="k">return</span> <span class="n">cur</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">stackoverflow</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">set_cur</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">1024</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">base</span> <span class="o">-</span> <span class="n">get_cur</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stack size of T%d &gt;= %d KB</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">sz</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">stackoverflow</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Tprobe</span><span class="p">(</span><span class="kt">int</span> <span class="n">tid</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">id</span> <span class="o">=</span> <span class="n">tid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">base</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">stackoverflow</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">setbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">create</span><span class="p">(</span><span class="n">Tprobe</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œç»“æœ</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-7.png" title="/img/Operating System/chapter3-7.png" data-thumbnail="/img/Operating System/chapter3-7.png" data-sub-html="<h2>Linux(stack-probe.cè¿è¡Œç»“æœ)</h2>">
        
    </a><figcaption class="image-caption">Linux(<code>stack-probe.cè¿è¡Œç»“æœ</code>)</figcaption>
    </figure>
<p>è¿›è¡Œæ’åº</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">jungle@jungle-virtual-machine:~$ gcc stack-probe.c -lpthread <span class="o">&amp;&amp;</span> ./a.out <span class="p">|</span> sort -nk <span class="m">6</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ•ˆæœï¼š</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-8.png" title="/img/Operating System/chapter3-8.png" data-thumbnail="/img/Operating System/chapter3-8.png" data-sub-html="<h2>stack-probe.c(æ’åºå)</h2>">
        
    </a><figcaption class="image-caption">stack-probe.c(<code>æ’åºå</code>)</figcaption>
    </figure>
<p>$size\ of\ stack=8192KB\newline$</p>
<hr>
<p>æ›´å¤šçš„ä¹ é¢˜</p>
<ul>
<li>åˆ›å»ºçº¿ç¨‹ä½¿ç”¨çš„æ˜¯å“ªä¸ªç³»ç»Ÿè°ƒç”¨ï¼Ÿ</li>
<li>èƒ½ä¸èƒ½ç”¨ gdb è°ƒè¯•ï¼Ÿ</li>
<li>åŸºæœ¬åŸåˆ™ï¼šæœ‰éœ€æ±‚ï¼Œå°±èƒ½åšåˆ° (<a href="https://sourceware.org/gdb/onlinedocs/gdb/Threads.html" target="_blank" rel="noopener noreffer">RTFM</a>)</li>
</ul>
<h4 id="threadh-èƒŒåposix-threads"><code>thread.h</code> èƒŒåï¼šPOSIX Threads</h4>
<p>æƒ³è¿›ä¸€æ­¥é…ç½®çº¿ç¨‹ï¼Ÿ</p>
<ul>
<li>è®¾ç½®æ›´å¤§çš„çº¿ç¨‹æ ˆ</li>
<li>è®¾ç½® detach è¿è¡Œ (ä¸åœ¨è¿›ç¨‹ç»“æŸåè¢«æ€æ­»ï¼Œä¹Ÿä¸èƒ½ join)</li>
<li>â€¦â€¦</li>
</ul>
<hr>
<p>POSIX ä¸ºæˆ‘ä»¬æä¾›äº†çº¿ç¨‹åº“ (pthreads)</p>
<ul>
<li>
<p><code>man 7 pthreads</code></p>
</li>
<li>
<p>ç»ƒä¹ ï¼šæ”¹å†™ thread.hï¼Œä½¿å¾—çº¿ç¨‹æ‹¥æœ‰æ›´å¤§çš„æ ˆ</p>
<ul>
<li>å¯ä»¥ç”¨ <a href="https://jyywiki.cn/pages/OS/2022/demos/stack-probe.c" target="_blank" rel="noopener noreffer">stack-probe.c</a> éªŒè¯</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;thread.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">__thread</span> <span class="kt">char</span> <span class="o">*</span><span class="n">base</span><span class="p">,</span> <span class="o">*</span><span class="n">cur</span><span class="p">;</span> <span class="c1">// thread-local variables
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">__thread</span> <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// objdump to see how thread-local variables are implemented
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span> <span class="kt">void</span> <span class="n">set_cur</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">)</span> <span class="p">{</span> <span class="n">cur</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span> <span class="kt">char</span> <span class="o">*</span><span class="n">get_cur</span><span class="p">()</span>         <span class="p">{</span> <span class="k">return</span> <span class="n">cur</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">stackoverflow</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">set_cur</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">1024</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">base</span> <span class="o">-</span> <span class="n">get_cur</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stack size of T%d &gt;= %d KB</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">sz</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">stackoverflow</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Tprobe</span><span class="p">(</span><span class="kt">int</span> <span class="n">tid</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">id</span> <span class="o">=</span> <span class="n">tid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">base</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">stackoverflow</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">setbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">create</span><span class="p">(</span><span class="n">Tprobe</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶è€Œï¼Œå¯æ€•çš„äº‹æƒ…æ­£åœ¨æ‚„æ‚„é€¼è¿‘â€¦â€¦</p>
<ul>
<li>
<p>å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­çº¿ç¨‹çš„ä»£ç å¯èƒ½åŒæ—¶æ‰§è¡Œ</p>
<ul>
<li>ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ <code>x++</code>ï¼Œç»“æœä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</li>
</ul>
</li>
</ul>
<h3 id="æ”¾å¼ƒ1åŸå­æ€§">æ”¾å¼ƒï¼ˆ1ï¼‰ï¼šåŸå­æ€§</h3>
<h4 id="ä¾‹å­å±±å¯¨å¤šçº¿ç¨‹æ”¯ä»˜å®">ä¾‹å­ï¼šå±±å¯¨å¤šçº¿ç¨‹æ”¯ä»˜å®</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">balance</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">Alipay_withdraw</span><span class="p">(</span><span class="kt">int</span> <span class="n">amt</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">balance</span> <span class="o">&gt;=</span> <span class="n">amt</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">balance</span> <span class="o">-=</span> <span class="n">amt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">SUCCESS</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">FAIL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘æ”¯ä»˜ Â¥100 ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ<a href="https://jyywiki.cn/pages/OS/2022/demos/alipay.c" target="_blank" rel="noopener noreffer">alipay.c</a></p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-10.jpg" title="/img/Operating System/chapter3-10.jpg" data-thumbnail="/img/Operating System/chapter3-10.jpg" data-sub-html="<h2>æ‰‹å†™(å±±å¯¨æ”¯ä»˜å®çŠ¶æ€æœº)</h2>">
        
    </a><figcaption class="image-caption">æ‰‹å†™(<code>å±±å¯¨æ”¯ä»˜å®çŠ¶æ€æœº</code>)</figcaption>
    </figure>
<ul>
<li>è´¦æˆ·é‡Œä¼šå¤šå‡ºç”¨ä¸å®Œçš„é’±ï¼</li>
<li>Bug/æ¼æ´ä¸è·Ÿä½ å¼€ç©ç¬‘ï¼šMt. Gox Hack æŸå¤±650,000
<ul>
<li>ä»Šå¤©ä»·å€¼ $28,000,000,000</li>
</ul>
</li>
</ul>
<p><code>alipay.c</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;thread.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">balance</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Alipay_withdraw</span><span class="p">(</span><span class="kt">int</span> <span class="n">amt</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">balance</span> <span class="o">&gt;=</span> <span class="n">amt</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">usleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// unexpected delays
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">balance</span> <span class="o">-=</span> <span class="n">amt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Talipay</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">Alipay_withdraw</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Talipay</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Talipay</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">join</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;balance = %lu</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">balance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><figure><a class="lightgallery" href="/img/Operating%20System/chapter3-9.png" title="/img/Operating System/chapter3-9.png" data-thumbnail="/img/Operating System/chapter3-9.png" data-sub-html="<h2>Linux(alipay.cè¿è¡Œç»“æœ)</h2>">
        
    </a><figcaption class="image-caption">Linux(<code>alipay.cè¿è¡Œç»“æœ</code>)</figcaption>
    </figure>
<h4 id="ä¾‹å­æ±‚å’Œ">ä¾‹å­ï¼šæ±‚å’Œ</h4>
<p>åˆ†ä¸¤ä¸ªçº¿ç¨‹ï¼Œè®¡ç®— $1+1+1+\ldots+1+1+1+1+â€¦+1$ (å…±è®¡ 2n ä¸ª 1)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define N 100000000
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">long</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Tsum</span><span class="p">()</span> <span class="p">{</span> <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">sum</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Tsum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Tsum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">join</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;sum = %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://jyywiki.cn/pages/OS/2022/demos/sum.c" target="_blank" rel="noopener noreffer">sum.c</a> è¿è¡Œç»“æœ</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-11.png" title="/img/Operating System/chapter3-11.png" data-thumbnail="/img/Operating System/chapter3-11.png" data-sub-html="<h2>Linux(sum.cè¿è¡Œç»“æœ)</h2>">
        
    </a><figcaption class="image-caption">Linux(<code>sum.cè¿è¡Œç»“æœ</code>)</figcaption>
    </figure>
<ul>
<li>
<p>119790390, 99872322 (ç»“æœå¯ä»¥æ¯” <code>N</code> è¿˜è¦å°), &hellip;</p>
</li>
<li>
<p>Inline assembly ä¹Ÿä¸è¡Œ</p>
</li>
</ul>
<p>ä¿®æ”¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;thread.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define N 100000000
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">long</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Tsum</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&#34;lock add $1, %0&#34;</span><span class="o">:</span> <span class="s">&#34;+m&#34;</span><span class="p">(</span><span class="n">sum</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Tsum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Tsum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">join</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;sum = %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œ</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-12.png" title="/img/Operating System/chapter3-12.png" data-thumbnail="/img/Operating System/chapter3-12.png" data-sub-html="<h2>Linux(sum.cä¿®æ”¹åè¿è¡Œç»“æœ)</h2>">
        
    </a><figcaption class="image-caption">Linux(<code>sum.cä¿®æ”¹åè¿è¡Œç»“æœ</code>)</figcaption>
    </figure>
<p>ç»“æœæ­£ç¡®ï¼Œä½†æ˜¯è¿è¡Œæ€§èƒ½æ˜¾è‘—ä¸‹é™</p>
<h4 id="åŸå­æ€§çš„ä¸§å¤±">åŸå­æ€§çš„ä¸§å¤±</h4>
<blockquote>
<p>â€œç¨‹åº (ç”šè‡³æ˜¯ä¸€æ¡æŒ‡ä»¤) ç‹¬å å¤„ç†å™¨æ‰§è¡Œâ€ çš„åŸºæœ¬å‡è®¾åœ¨ç°ä»£å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šä¸å†æˆç«‹ã€‚</p>
</blockquote>
<p>åŸå­æ€§ï¼šä¸€æ®µä»£ç æ‰§è¡Œ (ä¾‹å¦‚ <code>pay()</code>) ç‹¬å æ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿ</p>
<ul>
<li>å•å¤„ç†å™¨å¤šçº¿ç¨‹
<ul>
<li>çº¿ç¨‹åœ¨è¿è¡Œæ—¶å¯èƒ½è¢«ä¸­æ–­ï¼Œåˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ</li>
</ul>
</li>
<li>å¤šå¤„ç†å™¨å¤šçº¿ç¨‹
<ul>
<li>çº¿ç¨‹æ ¹æœ¬å°±æ˜¯å¹¶è¡Œæ‰§è¡Œçš„</li>
</ul>
</li>
</ul>
<hr>
<p>(å†å²) 1960sï¼Œå¤§å®¶äº‰å…ˆåœ¨å…±äº«å†…å­˜ä¸Šå®ç°åŸå­æ€§ (äº’æ–¥)</p>
<ul>
<li>ä½†å‡ ä¹æ‰€æœ‰çš„å®ç°éƒ½æ˜¯é”™çš„ï¼Œç›´åˆ° <a href="https://en.wikipedia.org/wiki/Dekker%27s_algorithm" target="_blank" rel="noopener noreffer">Dekker&rsquo;s Algorithm</a>ï¼Œè¿˜åªèƒ½ä¿è¯ä¸¤ä¸ªçº¿ç¨‹çš„äº’æ–¥</li>
</ul>
<h4 id="åŸå­æ€§çš„ä¸§å¤±æœ‰æ²¡æœ‰æ„Ÿåˆ°åæ€•">åŸå­æ€§çš„ä¸§å¤±ï¼šæœ‰æ²¡æœ‰æ„Ÿåˆ°åæ€•ï¼Ÿ</h4>
<p><code>printf</code> è¿˜èƒ½åœ¨å¤šçº¿ç¨‹ç¨‹åºé‡Œè°ƒç”¨å—ï¼Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">void thread1() { while (1) { printf(&#34;a&#34;); } }
</span></span><span class="line"><span class="cl">void thread2() { while (1) { printf(&#34;b&#34;); } }
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬éƒ½çŸ¥é“ printf æ˜¯æœ‰ç¼“å†²åŒºçš„ (ä¸ºä»€ä¹ˆï¼Ÿ)</p>
<ul>
<li>å¦‚æœæ‰§è¡Œ <code>buf[pos++] = ch</code> (<code>pos</code> å…±äº«) ä¸å°±ğŸ’¥äº†å—ï¼Ÿ</li>
</ul>
<hr>
<p>RTFM!</p>
<p>å‘½ä»¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">jungle@jungle-virtual-machine:~$ man <span class="m">3</span> <span class="nb">printf</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ATTRIBUTES
</span></span><span class="line"><span class="cl">       For an explanation of the terms used in this section, see attributes<span class="o">(</span>7<span class="o">)</span>.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">       â”‚Interface               â”‚ Attribute     â”‚ Value          â”‚
</span></span><span class="line"><span class="cl">       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
</span></span><span class="line"><span class="cl">       â”‚printf<span class="o">()</span>, fprintf<span class="o">()</span>,    â”‚ Thread safety â”‚ MT-Safe locale â”‚
</span></span><span class="line"><span class="cl">       â”‚sprintf<span class="o">()</span>, snprintf<span class="o">()</span>,  â”‚               â”‚                â”‚
</span></span><span class="line"><span class="cl">       â”‚vprintf<span class="o">()</span>, vfprintf<span class="o">()</span>,  â”‚               â”‚                â”‚
</span></span><span class="line"><span class="cl">       â”‚vsprintf<span class="o">()</span>, vsnprintf<span class="o">()</span> â”‚               â”‚                â”‚
</span></span><span class="line"><span class="cl">       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è¿›ç¨‹å®‰å…¨ï¼</strong></p>
<h4 id="å®ç°åŸå­æ€§">å®ç°åŸå­æ€§</h4>
<p>äº’æ–¥å’ŒåŸå­æ€§æ˜¯æœ¬å­¦æœŸçš„é‡è¦ä¸»é¢˜</p>
<ul>
<li>
<p><code>lock(&amp;lk)</code></p>
</li>
<li>
<p><code>unlock(&amp;lk)</code></p>
<ul>
<li>å®ç°ä¸´ç•ŒåŒº (critical section) ä¹‹é—´çš„ç»å¯¹ä¸²è¡ŒåŒ–</li>
<li>ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ä¾ç„¶å¯ä»¥å¹¶è¡Œæ‰§è¡Œ</li>
</ul>
</li>
</ul>
<hr>
<p>99% çš„å¹¶å‘é—®é¢˜éƒ½å¯ä»¥ç”¨ä¸€ä¸ªé˜Ÿåˆ—è§£å†³</p>
<ul>
<li>
<p>æŠŠå¤§ä»»åŠ¡åˆ‡åˆ†æˆå¯ä»¥å¹¶è¡Œçš„å°ä»»åŠ¡</p>
</li>
<li>
<p>worker thread å»é”ä¿æŠ¤çš„é˜Ÿåˆ—é‡Œå–ä»»åŠ¡</p>
</li>
<li>
<p>é™¤å»ä¸å¯å¹¶è¡Œçš„éƒ¨åˆ†ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†å¯ä»¥è·å¾—çº¿æ€§çš„åŠ é€Ÿ</p>
<ul>
<li>$Thm.\ T_n&lt;T_{\infty}+\frac {T_1}{n}$(<a href="https://web.mit.edu/dimitrib/www/pdc.html" target="_blank" rel="noopener noreffer">PDC</a>, Chap. 1)</li>
</ul>
</li>
</ul>
<h3 id="æ”¾å¼ƒ2é¡ºåº">æ”¾å¼ƒï¼ˆ2ï¼‰ï¼šé¡ºåº</h3>
<h4 id="ä¾‹å­æ±‚å’Œ-å†æ¬¡å‡ºç°">ä¾‹å­ï¼šæ±‚å’Œ (å†æ¬¡å‡ºç°)</h4>
<p>åˆ†ä¸¤ä¸ªçº¿ç¨‹ï¼Œè®¡ç®— $1+1+1+\ldots+1+1+1+1+â€¦+1$ (å…±è®¡ 2n ä¸ª 1)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define N 100000000
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">long</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Tsum</span><span class="p">()</span> <span class="p">{</span> <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">sum</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Tsum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Tsum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">join</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;sum = %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¥½åƒå¿˜è®°ç»™ <a href="https://jyywiki.cn/pages/OS/2022/demos/sum.c" target="_blank" rel="noopener noreffer">sum.c</a> æ·»åŠ ç¼–è¯‘ä¼˜åŒ–äº†ï¼Ÿ</p>
<ul>
<li><code>-O1</code>: 100000000 ğŸ˜±ğŸ˜±</li>
<li><code>-O2</code>: 200000000 ğŸ˜±ğŸ˜±ğŸ˜±</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">jungle@jungle-virtual-machine:~$ gcc -O1 sum.c -lpthread <span class="o">&amp;&amp;</span> ./a.out 
</span></span><span class="line"><span class="cl"><span class="nv">sum</span> <span class="o">=</span> <span class="m">100000000</span>
</span></span><span class="line"><span class="cl">jungle@jungle-virtual-machine:~$ gcc -O2 sum.c -lpthread <span class="o">&amp;&amp;</span> ./a.out 
</span></span><span class="line"><span class="cl"><span class="nv">sum</span> <span class="o">=</span> <span class="m">200000000</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="é¡ºåºçš„ä¸§å¤±">é¡ºåºçš„ä¸§å¤±</h4>
<blockquote>
<p>ç¼–è¯‘å™¨å¯¹å†…å­˜è®¿é—® â€œeventually consistentâ€ çš„å¤„ç†å¯¼è‡´å…±äº«å†…å­˜ä½œä¸ºçº¿ç¨‹åŒæ­¥å·¥å…·çš„å¤±æ•ˆã€‚</p>
</blockquote>
<p>åˆšæ‰çš„ä¾‹å­</p>
<ul>
<li><code>-O1</code>: <code>R[eax] = sum; R[eax] += N; sum = R[eax]</code></li>
<li><code>-O2</code>: <code>sum += N;</code></li>
<li>(ä½ çš„ç¼–è¯‘å™¨ä¹Ÿè®¸æ˜¯ä¸åŒçš„ç»“æœ)</li>
</ul>
<p>å¦ä¸€ä¸ªä¾‹å­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">done</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// would be optimized to
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">done</span><span class="p">)</span> <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">jungle@jungle-virtual-machine:~$ gcc -c -O1 sum.c <span class="o">&amp;&amp;</span> objdump -d sum.o
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sum.oï¼š     æ–‡ä»¶æ ¼å¼ elf64-x86-64
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Disassembly of section .text:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">0000000000000000</span> &lt;wrapper&gt;:
</span></span><span class="line"><span class="cl">   0:	f3 0f 1e fa          	endbr64 
</span></span><span class="line"><span class="cl">   4:	<span class="m">48</span> <span class="m">83</span> ec <span class="m">08</span>          	sub    <span class="nv">$0</span>x8,%rsp
</span></span><span class="line"><span class="cl">   8:	<span class="m">48</span> <span class="m">89</span> f8             	mov    %rdi,%rax
</span></span><span class="line"><span class="cl">   b:	8b 3f                	mov    <span class="o">(</span>%rdi<span class="o">)</span>,%edi
</span></span><span class="line"><span class="cl">   d:	ff <span class="m">50</span> <span class="m">10</span>             	call   *0x10<span class="o">(</span>%rax<span class="o">)</span>
</span></span><span class="line"><span class="cl">  10:	b8 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>       	mov    <span class="nv">$0</span>x0,%eax
</span></span><span class="line"><span class="cl">  15:	<span class="m">48</span> <span class="m">83</span> c4 <span class="m">08</span>          	add    <span class="nv">$0</span>x8,%rsp
</span></span><span class="line"><span class="cl">  19:	c3                   	ret    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">000000000000001a &lt;Tsum&gt;:
</span></span><span class="line"><span class="cl">  1a:	f3 0f 1e fa          	endbr64 
</span></span><span class="line"><span class="cl">  1e:	<span class="m">48</span> 8b <span class="m">15</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> 	mov    0x0<span class="o">(</span>%rip<span class="o">)</span>,%rdx        <span class="c1"># 25 &lt;Tsum+0xb&gt; -&gt; R[eax] = sum</span>
</span></span><span class="line"><span class="cl">  25:	<span class="m">48</span> 8d <span class="m">42</span> <span class="m">01</span>          	lea    0x1<span class="o">(</span>%rdx<span class="o">)</span>,%rax		 <span class="c1"># -&gt; R[eax] += N, sum = R[eax]</span>
</span></span><span class="line"><span class="cl">  29:	<span class="m">48</span> <span class="m">81</span> c2 <span class="m">01</span> e1 f5 <span class="m">05</span> 	add    <span class="nv">$0</span>x5f5e101,%rdx
</span></span><span class="line"><span class="cl">  30:	<span class="m">48</span> <span class="m">89</span> c1             	mov    %rax,%rcx
</span></span><span class="line"><span class="cl">  33:	<span class="m">48</span> <span class="m">83</span> c0 <span class="m">01</span>          	add    <span class="nv">$0</span>x1,%rax
</span></span><span class="line"><span class="cl">  37:	<span class="m">48</span> <span class="m">39</span> d0             	cmp    %rdx,%rax
</span></span><span class="line"><span class="cl">  3a:	<span class="m">75</span> f4                	jne    <span class="m">30</span> &lt;Tsum+0x16&gt;
</span></span><span class="line"><span class="cl">  3c:	<span class="m">48</span> <span class="m">89</span> 0d <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> 	mov    %rcx,0x0<span class="o">(</span>%rip<span class="o">)</span>        <span class="c1"># 43 &lt;Tsum+0x29&gt;</span>
</span></span><span class="line"><span class="cl">  43:	c3                   	ret    
</span></span></code></pre></td></tr></table>
</div>
</div><figure><a class="lightgallery" href="/img/Operating%20System/chapter3-13.jpg" title="/img/Operating System/chapter3-13.jpg" data-thumbnail="/img/Operating System/chapter3-13.jpg" data-sub-html="<h2>æ‰‹å†™(O1æ¨¡å¼ä¸‹ä¼˜åŒ–)</h2>">
        
    </a><figcaption class="image-caption">æ‰‹å†™(<code>O1æ¨¡å¼ä¸‹ä¼˜åŒ–</code>)</figcaption>
    </figure>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">jungle@jungle-virtual-machine:~$ gcc -c -O2 sum.c <span class="o">&amp;&amp;</span> objdump -d sum.o
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sum.oï¼š     æ–‡ä»¶æ ¼å¼ elf64-x86-64
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Disassembly of section .text:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">0000000000000000</span> &lt;wrapper&gt;:
</span></span><span class="line"><span class="cl">   0:	f3 0f 1e fa          	endbr64 
</span></span><span class="line"><span class="cl">   4:	<span class="m">48</span> <span class="m">83</span> ec <span class="m">08</span>          	sub    <span class="nv">$0</span>x8,%rsp
</span></span><span class="line"><span class="cl">   8:	<span class="m">48</span> <span class="m">89</span> f8             	mov    %rdi,%rax
</span></span><span class="line"><span class="cl">   b:	8b 3f                	mov    <span class="o">(</span>%rdi<span class="o">)</span>,%edi
</span></span><span class="line"><span class="cl">   d:	ff <span class="m">50</span> <span class="m">10</span>             	call   *0x10<span class="o">(</span>%rax<span class="o">)</span>
</span></span><span class="line"><span class="cl">  10:	<span class="m">31</span> c0                	xor    %eax,%eax
</span></span><span class="line"><span class="cl">  12:	<span class="m">48</span> <span class="m">83</span> c4 <span class="m">08</span>          	add    <span class="nv">$0</span>x8,%rsp
</span></span><span class="line"><span class="cl">  16:	c3                   	ret    
</span></span><span class="line"><span class="cl">  17:	<span class="m">66</span> 0f 1f <span class="m">84</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> 	nopw   0x0<span class="o">(</span>%rax,%rax,1<span class="o">)</span>
</span></span><span class="line"><span class="cl">  1e:	<span class="m">00</span> <span class="m">00</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">0000000000000020</span> &lt;Tsum&gt;:
</span></span><span class="line"><span class="cl">  20:	f3 0f 1e fa          	endbr64 
</span></span><span class="line"><span class="cl">  24:	<span class="m">48</span> <span class="m">81</span> <span class="m">05</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> 	addq   <span class="nv">$0</span>x5f5e100,0x0<span class="o">(</span>%rip<span class="o">)</span>        <span class="c1"># 2f &lt;Tsum+0xf&gt;</span>
</span></span><span class="line"><span class="cl">  2b:	<span class="m">00</span> e1 f5 <span class="m">05</span> 
</span></span><span class="line"><span class="cl">  2f:	c3                   	ret 
</span></span></code></pre></td></tr></table>
</div>
</div><p>O2ä¼˜åŒ–çš„æ¯”è¾ƒå½»åº•ï¼Œåªaddäº†ä¸€æ¬¡ï¼ˆå‡ºé—®é¢˜çš„æ¦‚ç‡æ¯”è¾ƒä½ï¼‰</p>
<h4 id="å®ç°æºä»£ç çš„æŒ‰é¡ºåºç¿»è¯‘">å®ç°æºä»£ç çš„æŒ‰é¡ºåºç¿»è¯‘</h4>
<p>åœ¨ä»£ç ä¸­æ’å…¥ â€œä¼˜åŒ–ä¸èƒ½ç©¿è¶Šâ€ çš„ barrier</p>
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">asm</span> <span class="nf">volatile</span> <span class="p">(</span><span class="s">&#34;&#34;</span> <span class="o">:::</span> <span class="s">&#34;memory&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Barrier çš„å«ä¹‰æ˜¯ â€œå¯ä»¥è¯»å†™ä»»ä½•å†…å­˜â€</li>
</ul>
</li>
<li>
<p>ä½¿ç”¨<code>volatile</code>å˜é‡</p>
<ul>
<li>ä¿æŒ C è¯­ä¹‰å’Œæ±‡ç¼–è¯­ä¹‰ä¸€è‡´</li>
</ul>
</li>
</ul>
<hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">extern</span> <span class="kt">int</span> <span class="k">volatile</span> <span class="n">done</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">done</span><span class="p">)</span> <span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ”¾å¼ƒ-3å¯è§æ€§">æ”¾å¼ƒ (3)ï¼šå¯è§æ€§</h3>
<h4 id="ä¾‹å­">ä¾‹å­</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">T1</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&#34;&#34;</span> <span class="o">:</span> <span class="o">:</span> <span class="s">&#34;memory&#34;</span><span class="p">);</span> <span class="c1">// compiler barrier
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;y = %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">T2</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&#34;&#34;</span> <span class="o">:</span> <span class="o">:</span> <span class="s">&#34;memory&#34;</span><span class="p">);</span> <span class="c1">// compiler barrier
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;x = %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é—®é¢˜ï¼šæˆ‘ä»¬æœ€ç»ˆèƒ½çœ‹åˆ°å“ªäº›ç»“æœï¼Ÿ</p>
<p>çŠ¶æ€æœº</p>
<div class="mermaid" id="id-1"></div>
<ul>
<li>mem-ordering.c
<ul>
<li>è¾“å‡ºä¸å¥½è¯»ï¼Ÿ<code>pipe to head -n 1000000 | sort | uniq -c</code></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;thread.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">atomic_int</span> <span class="n">flag</span><span class="p">;</span> <span class="c1">//å¼€å…³åˆå§‹ä¸º0ï¼ˆå…³ç€ï¼‰ï¼ŒåŸå­å˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define FLAG atomic_load(&amp;flag) </span><span class="c1">//åŸå­è¯»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define FLAG_XOR(val) atomic_fetch_xor(&amp;flag, val) </span><span class="c1">//åŸå­å¼‚æˆ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define WAIT_FOR(cond) while (!(cond)) ;
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"> <span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">write_x_read_y</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">y_val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">asm</span> <span class="k">volatile</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;movl $1, %0;&#34;</span> <span class="c1">// x = 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s">&#34;movl %2, %1;&#34;</span> <span class="c1">// y_val = y
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">:</span> <span class="s">&#34;=m&#34;</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s">&#34;=r&#34;</span><span class="p">(</span><span class="n">y_val</span><span class="p">)</span> <span class="o">:</span> <span class="s">&#34;m&#34;</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d &#34;</span><span class="p">,</span> <span class="n">y_val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">write_y_read_x</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">x_val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">asm</span> <span class="k">volatile</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;movl $1, %0;&#34;</span> <span class="c1">// y = 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s">&#34;movl %2, %1;&#34;</span> <span class="c1">// x_val = x
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">:</span> <span class="s">&#34;=m&#34;</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="s">&#34;=r&#34;</span><span class="p">(</span><span class="n">x_val</span><span class="p">)</span> <span class="o">:</span> <span class="s">&#34;m&#34;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d &#34;</span><span class="p">,</span> <span class="n">x_val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">T1</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">WAIT_FOR</span><span class="p">((</span><span class="n">FLAG</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">));</span> <span class="c1">//ç­‰å¼€å…³1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">write_x_read_y</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">FLAG_XOR</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">//å…³æ‰å¼€å…³1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">T2</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">WAIT_FOR</span><span class="p">((</span><span class="n">FLAG</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">));</span> <span class="c1">//ç­‰å¼€å…³2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">write_y_read_x</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="n">FLAG_XOR</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">//å…³æ‰å¼€å…³2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Tsync</span><span class="p">()</span> <span class="p">{</span> <span class="c1">//æ§åˆ¶çº¿ç¨‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//å¸ƒç½®å¥½åˆå€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">__sync_synchronize</span><span class="p">();</span> <span class="c1">// full barrier
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">usleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>            <span class="c1">// + delay
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">assert</span><span class="p">(</span><span class="n">FLAG</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">//ç¡®å®šå¼€å…³æ˜¯å…³ç€çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">FLAG_XOR</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1">//å¼€å…³çš„ä¸¤ä¸ªbitä»0å˜ä¸º1ï¼ˆå¼€å¯å¼€å…³1ï¼Œ2ï¼‰ï¼ˆåŸå­æ“ä½œï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// T1 and T2 clear 0/1-bit, respectively
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WAIT_FOR</span><span class="p">(</span><span class="n">FLAG</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span> <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">T1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">T2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Tsync</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>-O2æ¨¡å¼ä¸‹ç¼–è¯‘</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">00000000000001a0 &lt;write_x_read_y&gt;:
</span></span><span class="line"><span class="cl"> 1a0:	f3 0f 1e fa          	endbr64 
</span></span><span class="line"><span class="cl"> 1a4:	c7 05 00 00 00 00 01 	movl   $0x1,0x0(%rip)        # 1ae &lt;write_x_read_y+0xe&gt;
</span></span><span class="line"><span class="cl"> 1ab:	00 00 00 
</span></span><span class="line"><span class="cl"> 1ae:	8b 15 00 00 00 00    	mov    0x0(%rip),%edx        # 1b4 &lt;write_x_read_y+0x14&gt;
</span></span><span class="line"><span class="cl"> 1b4:	48 8d 35 00 00 00 00 	lea    0x0(%rip),%rsi        # 1bb &lt;write_x_read_y+0x1b&gt;
</span></span><span class="line"><span class="cl"> 1bb:	bf 01 00 00 00       	mov    $0x1,%edi
</span></span><span class="line"><span class="cl"> 1c0:	31 c0                	xor    %eax,%eax
</span></span><span class="line"><span class="cl"> 1c2:	e9 00 00 00 00       	jmp    1c7 &lt;write_x_read_y+0x27&gt;
</span></span><span class="line"><span class="cl"> 1c7:	66 0f 1f 84 00 00 00 	nopw   0x0(%rax,%rax,1)
</span></span><span class="line"><span class="cl"> 1ce:	00 00 
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ©ç”¨è„šæœ¬æ¥ç»Ÿè®¡ï¼Œä¸çŸ¥é“ä¸ºå•¥è‡ªå·±çš„ä¹Œç­å›¾ğŸ’©ğŸ´è·‘å‡ºæ¥éƒ½æ˜¯01ï¼Œ00ï¼Œ01ï¼Œ10ï¼Œ11éƒ½è·‘å‡ºæ¥äº†ï¼Œå’Œæˆ‘ä»¬çš„çŠ¶æ€æœºæ¨¡å‹ä¸ç¬¦ğŸ¤¡</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-14.png" title="/img/Operating System/chapter3-14.png" data-thumbnail="/img/Operating System/chapter3-14.png" data-sub-html="<h2>From class(è¾“å‡ºç»“æœ)</h2>">
        
    </a><figcaption class="image-caption">From class(<code>è¾“å‡ºç»“æœ</code>)</figcaption>
    </figure>
<h4 id="ç°ä»£å¤„ç†å™¨å¤„ç†å™¨ä¹Ÿæ˜¯-åŠ¨æ€-ç¼–è¯‘å™¨">ç°ä»£å¤„ç†å™¨ï¼šå¤„ç†å™¨ä¹Ÿæ˜¯ (åŠ¨æ€) ç¼–è¯‘å™¨ï¼</h4>
<p>å•ä¸ªå¤„ç†å™¨æŠŠæ±‡ç¼–ä»£ç  (ç”¨ç”µè·¯) â€œç¼–è¯‘â€ æˆæ›´å°çš„ $\mu ops\newline$</p>
<ul>
<li>RF[9] = load(RF[7] + 400)</li>
<li>store(RF[12], RF[13])</li>
<li>RF[3] = RF[4] + RF[5]
<ul>
<li>æ¯ä¸ª $\mu op$ éƒ½æœ‰ Fetch, Issue, Execute, Commit å››ä¸ªé˜¶æ®µ</li>
</ul>
</li>
</ul>
<hr>
<p>åœ¨ä»»ä½•æ—¶åˆ»ï¼Œå¤„ç†å™¨éƒ½ç»´æŠ¤ä¸€ä¸ª $\mu op$ çš„ â€œæ± å­â€</p>
<ul>
<li>
<p>æ¯ä¸€å‘¨æœŸå‘æ± å­è¡¥å……å°½å¯èƒ½å¤šçš„$\mu op\newline$</p>
<ul>
<li>â€œå¤šå‘å°„â€</li>
</ul>
</li>
<li>
<p>æ¯ä¸€å‘¨æœŸ (åœ¨ä¸è¿åç¼–è¯‘æ­£ç¡®æ€§çš„å‰æä¸‹) æ‰§è¡Œå°½å¯èƒ½å¤šçš„$\mu op\newline$</p>
<ul>
<li>â€œä¹±åºæ‰§è¡Œâ€ã€â€œæŒ‰åºæäº¤â€</li>
</ul>
</li>
<li>
<p>è¿™å°±æ˜¯ã€Šè®¡ç®—æœºä½“ç³»ç»“æ„ã€‹ (å‰©ä¸‹å°±æ˜¯æœ¨æ¡¶æ•ˆåº”ï¼Œå“ªé‡ŒçŸ­æ¿è¡¥å“ªé‡Œ)</p>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-15.jpg" title="/img/Operating System/chapter3-15.jpg" data-thumbnail="/img/Operating System/chapter3-15.jpg" data-sub-html="<h2>ç¥ä¹¦(ã€Šè®¡ç®—æœºä½“ç³»ç»“æ„â€”â€”é‡åŒ–ç ”ç©¶æ–¹æ³•ã€‹)</h2>">
        
    </a><figcaption class="image-caption">ç¥ä¹¦(<code>ã€Šè®¡ç®—æœºä½“ç³»ç»“æ„â€”â€”é‡åŒ–ç ”ç©¶æ–¹æ³•ã€‹</code>)</figcaption>
    </figure>
<h4 id="å¤šå¤„ç†å™¨é—´å³æ—¶å¯è§æ€§çš„ä¸§å¤±">å¤šå¤„ç†å™¨é—´å³æ—¶å¯è§æ€§çš„ä¸§å¤±</h4>
<blockquote>
<p>æ»¡è¶³å•å¤„ç†å™¨ eventual memory consistency çš„æ‰§è¡Œï¼Œåœ¨å¤šå¤„ç†å™¨ä¸Šå¯èƒ½æ— æ³•åºåˆ—åŒ–ï¼</p>
</blockquote>
<p>å½“ $x \ne y$ æ—¶ï¼Œå¯¹ $x ,y$ çš„å†…å­˜è¯»å†™å¯ä»¥äº¤æ¢é¡ºåº</p>
<ul>
<li>å®ƒä»¬ç”šè‡³å¯ä»¥åœ¨åŒä¸€ä¸ªå‘¨æœŸé‡Œå®Œæˆ (åªè¦ load/store unit æ”¯æŒ)</li>
<li>å¦‚æœå†™xå‘ç”Ÿ cache missï¼Œå¯ä»¥è®©è¯»yå…ˆæ‰§è¡Œ
<ul>
<li>æ»¡è¶³ â€œå°½å¯èƒ½æ‰§è¡Œ â€œ$\mu op$â€ çš„åŸåˆ™ï¼Œæœ€å¤§åŒ–å¤„ç†å™¨æ€§èƒ½</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">     # &lt;-----------+
</span></span><span class="line"><span class="cl">movl $1, (x)   #   |
</span></span><span class="line"><span class="cl">movl (y), %eax # --+
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åœ¨å¤šå¤„ç†å™¨ä¸Šçš„è¡¨ç°
<ul>
<li>ä¸¤ä¸ªå¤„ç†å™¨åˆ†åˆ«çœ‹åˆ° $y=0 å’Œ x=0\newline$</li>
</ul>
</li>
</ul>
<h4 id="å®½æ¾å†…å­˜æ¨¡å‹-relaxedweak-memory-model">å®½æ¾å†…å­˜æ¨¡å‹ (Relaxed/Weak Memory Model)</h4>
<blockquote>
<p>å®½æ¾å†…å­˜æ¨¡å‹çš„ç›®çš„æ˜¯ä½¿å•å¤„ç†å™¨çš„æ‰§è¡Œæ›´é«˜æ•ˆã€‚</p>
</blockquote>
<p>x86 å·²ç»æ˜¯å¸‚é¢ä¸Šèƒ½ä¹°åˆ°çš„ â€œæœ€å¼ºâ€ çš„å†…å­˜æ¨¡å‹äº† ğŸ˜‚</p>
<ul>
<li>è¿™ä¹Ÿæ˜¯ Intel è‡ªå·±ç»™è‡ªå·±åŠ çš„åŒ…è¢±</li>
<li>çœ‹çœ‹ <a href="https://research.swtch.com/mem-weak@2x.png" target="_blank" rel="noopener noreffer">ARM/RISC-V</a> å§ï¼Œæ ¹æœ¬å°±æ˜¯ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿ</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-16.png" title="/img/Operating System/chapter3-16.png" data-thumbnail="/img/Operating System/chapter3-16.png" data-sub-html="<h2>x86(å†…å­˜æ¨¡å‹)</h2>">
        
    </a><figcaption class="image-caption">x86(<code>å†…å­˜æ¨¡å‹</code>)</figcaption>
    </figure>
<p><strong>(x86-TSO in <a href="https://research.swtch.com/hwmm" target="_blank" rel="noopener noreffer">Hardware memory models</a> by Russ Cox)</strong></p>
<hr>
<p><strong>ARM/RISC-V</strong></p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-17.png" title="/img/Operating System/chapter3-17.png" data-thumbnail="/img/Operating System/chapter3-17.png" data-sub-html="<h2>ARM/RISC-V(å†…å­˜æ¨¡å‹)</h2>">
        
    </a><figcaption class="image-caption">ARM/RISC-V(<code>å†…å­˜æ¨¡å‹</code>)</figcaption>
    </figure>
<h4 id="å®ç°é¡ºåºä¸€è‡´æ€§">å®ç°é¡ºåºä¸€è‡´æ€§</h4>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter3-18.png" title="/img/Operating System/chapter3-18.png" data-thumbnail="/img/Operating System/chapter3-18.png" data-sub-html="<h2>æ”¹è‰¯(å†…å­˜æ¨¡å‹)</h2>">
        
    </a><figcaption class="image-caption">æ”¹è‰¯(<code>å†…å­˜æ¨¡å‹</code>)</figcaption>
    </figure>
<hr>
<p>è½¯ä»¶åšä¸åˆ°ï¼Œç¡¬ä»¶æ¥å¸®å¿™</p>
<ul>
<li>
<p>Memory barrier: __sync_synchronize() (RTFM)</p>
<ul>
<li>Compiler barrier + fence æŒ‡ä»¤</li>
<li>æ’å…¥ fence æŒ‡ä»¤åï¼Œå°†é˜»æ­¢ x=y=0</li>
</ul>
</li>
<li>
<p>åŸå­æŒ‡ä»¤ (lock,prefix, lr/sc, &hellip;)</p>
<ul>
<li><code>stdatomic.h</code></li>
</ul>
</li>
</ul>
<p>ä¿®æ”¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;thread.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">atomic_int</span> <span class="n">flag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#define FLAG atomic_load(&amp;flag)
</span></span></span><span class="line"><span class="cl"><span class="cp">#define FLAG_XOR(val) atomic_fetch_xor(&amp;flag, val)
</span></span></span><span class="line"><span class="cl"><span class="cp">#define WAIT_FOR(cond) while (!(cond)) ;
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"> <span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">write_x_read_y</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">y_val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">asm</span> <span class="k">volatile</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;movl $1, %0;&#34;</span> <span class="c1">// x = 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s">&#34;mfence;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;movl %2, %1;&#34;</span> <span class="c1">// y_val = y
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">:</span> <span class="s">&#34;=m&#34;</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s">&#34;=r&#34;</span><span class="p">(</span><span class="n">y_val</span><span class="p">)</span> <span class="o">:</span> <span class="s">&#34;m&#34;</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d &#34;</span><span class="p">,</span> <span class="n">y_val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">write_y_read_x</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">x_val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">asm</span> <span class="k">volatile</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;movl $1, %0;&#34;</span> <span class="c1">// y = 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s">&#34;mfence;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;movl %2, %1;&#34;</span> <span class="c1">// x_val = x
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">:</span> <span class="s">&#34;=m&#34;</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="s">&#34;=r&#34;</span><span class="p">(</span><span class="n">x_val</span><span class="p">)</span> <span class="o">:</span> <span class="s">&#34;m&#34;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d &#34;</span><span class="p">,</span> <span class="n">x_val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">T1</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">WAIT_FOR</span><span class="p">((</span><span class="n">FLAG</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">write_x_read_y</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">FLAG_XOR</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">T2</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">WAIT_FOR</span><span class="p">((</span><span class="n">FLAG</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">write_y_read_x</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">FLAG_XOR</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Tsync</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">__sync_synchronize</span><span class="p">();</span> <span class="c1">// full barrier
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">usleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>            <span class="c1">// + delay
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">assert</span><span class="p">(</span><span class="n">FLAG</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">FLAG_XOR</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// T1 and T2 clear 0/1-bit, respectively
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WAIT_FOR</span><span class="p">(</span><span class="n">FLAG</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span> <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">T1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">T2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Tsync</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸ä¼šå†çœ‹è§00çš„ç»„åˆäº†</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜</p>
<ul>
<li><strong>Q</strong>: å¦‚ä½•ç†è§£å¤šå¤„ç†å™¨ç³»ç»Ÿï¼Ÿ</li>
</ul>
<hr>
<p>Take-away message</p>
<ul>
<li>å¤šå¤„ç†å™¨ç¼–ç¨‹ï¼šå…¥é—¨
<ul>
<li>å¤šå¤„ç†å™¨ç¨‹åº = çŠ¶æ€æœº (å…±äº«å†…å­˜ï¼›éç¡®å®šé€‰æ‹©çº¿ç¨‹æ‰§è¡Œ)</li>
<li>thread.h = create + join</li>
</ul>
</li>
<li>å¤šå¤„ç†å™¨ç¼–ç¨‹ï¼šæ”¾å¼ƒä½ å¯¹ â€œç¨‹åºâ€ çš„æ—§ç†è§£
<ul>
<li>ä¸åŸå­ã€èƒ½ä¹±åºã€ä¸ç«‹å³å¯è§ï¼ˆç°ä»£å¤„ç†å™¨å°±æ˜¯ä¸€ä¸ªåŠ¨æ€çš„æ•°æ®æµåˆ†æå™¨ï¼‰
<ul>
<li>æ¥è‡ªäºç¼–è¯‘ä¼˜åŒ– (å¤„ç†å™¨ä¹Ÿæ˜¯ç¼–è¯‘å™¨)</li>
<li><a href="https://www.usenix.org/events/osdi10/tech/full_papers/Xiong.pdf" target="_blank" rel="noopener noreffer">Ad hoc synchronization considered harmful</a> (OSDI'10)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>å£°æ˜ï¼šæœ¬æ–‡ç« å¼•ç”¨èµ„æ–™ä¸å›¾åƒå‡å·²åšæ ‡æ³¨ï¼Œå¦‚æœ‰ä¾µæƒæœ¬äººä¼šé©¬ä¸Šåˆ é™¤</strong></p>
]]></description>
</item>
<item>
    <title>Operating System Chapter2 æ“ä½œç³»ç»Ÿä¸Šçš„ç¨‹åº</title>
    <link>https://Jungle430.github.io/posts/operating-system/operating-system-chapter2/</link>
    <pubDate>Sat, 31 Dec 2022 19:30:30 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/operating-system/operating-system-chapter2/</guid>
    <description><![CDATA[<h1 id="operating-system">Operating System</h1>
<p>$Nanjing\ University\rightarrow Yanyan\ Jiang\newline$</p>
<h2 id="æ“ä½œç³»ç»Ÿä¸Šçš„ç¨‹åº">æ“ä½œç³»ç»Ÿä¸Šçš„ç¨‹åº</h2>
<h3 id="overview">Overview</h3>
<h4 id="å¤ä¹ ">å¤ä¹ </h4>
<p>ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Ÿ</p>
<ul>
<li>åº”ç”¨è§†è§’ (è®¾è®¡): ä¸€ç»„å¯¹è±¡ (è¿›ç¨‹/æ–‡ä»¶/&hellip;) + API</li>
<li>ç¡¬ä»¶è§†è§’ (å®ç°): ä¸€ä¸ª C ç¨‹åº</li>
</ul>
<h4 id="æœ¬æ¬¡è¯¾ç¨‹ä¸»è¦é—®é¢˜">æœ¬æ¬¡è¯¾ç¨‹ä¸»è¦é—®é¢˜</h4>
<ul>
<li>åˆ°åº•ä»€ä¹ˆæ˜¯â€ç¨‹åºâ€ï¼Ÿ</li>
</ul>
<h4 id="æœ¬æ¬¡è¯¾ä¸»è¦å†…å®¹">æœ¬æ¬¡è¯¾ä¸»è¦å†…å®¹</h4>
<ul>
<li>ç¨‹åºçš„çŠ¶æ€æœºæ¨¡å‹ (å’Œç¼–è¯‘å™¨)</li>
<li>æ“ä½œç³»ç»Ÿä¸Šçš„ {æœ€å°/ä¸€èˆ¬/å›¾å½¢} ç¨‹åº</li>
</ul>
<h3 id="çŠ¶æ€æœºä¸æ•°å­—ç”µè·¯">çŠ¶æ€æœºä¸æ•°å­—ç”µè·¯</h3>
<p>æ•°å­—é€»è¾‘ç”µè·¯</p>
<ul>
<li>çŠ¶æ€ = å¯„å­˜å™¨ä¿å­˜çš„å€¼ (flip-flop)</li>
<li>åˆå§‹çŠ¶æ€ = RESET (implementation dependent)</li>
<li>è¿ç§» = ç»„åˆé€»è¾‘ç”µè·¯è®¡ç®—å¯„å­˜å™¨ä¸‹ä¸€å‘¨æœŸçš„å€¼</li>
</ul>
<p>ä¾‹å­ï¼š
$$
\begin{align}
&amp;X^{&rsquo;}= \neg X \wedge Y\newline
&amp;Y^{&rsquo;}= \neg X \wedge \neg Y\newline
\end{align}
$$</p>
<div class="mermaid" id="id-1"></div>
<p>ä»£ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Windows.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define REGS_FOREACH(_)  _(X) _(Y)
</span></span></span><span class="line"><span class="cl"><span class="cp">#define RUN_LOGIC        X1 = !X &amp;&amp; Y; \
</span></span></span><span class="line"><span class="cl"><span class="cp">                         Y1 = !X &amp;&amp; !Y;
</span></span></span><span class="line"><span class="cl"><span class="cp">#define DEFINE(X)        static int X, X##1;
</span></span></span><span class="line"><span class="cl"><span class="cp">#define UPDATE(X)        X = X##1;
</span></span></span><span class="line"><span class="cl"><span class="cp">#define PRINT(X)         printf(#X &#34; = %d; &#34;, X);
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">REGS_FOREACH</span><span class="p">(</span><span class="n">DEFINE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// clock
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">RUN_LOGIC</span>
</span></span><span class="line"><span class="cl">        <span class="n">REGS_FOREACH</span><span class="p">(</span><span class="n">PRINT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">REGS_FOREACH</span><span class="p">(</span><span class="n">UPDATE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">putchar</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">Sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®å±•å¼€</p>
<p>ä½¿ç”¨mingwå‘½ä»¤(æ³¨æ„å»æ‰å¤´æ–‡ä»¶ï¼Œå¦åˆ™å¤´æ–‡ä»¶ä¹Ÿä¼šä¸€å¹¶å±•å¼€ï¼Œå°±æ²¡æ³•çœ‹äº†ğŸ¤¡)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -E main.c
</span></span></code></pre></td></tr></table>
</div>
</div><p>å±•å¼€å</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="kt">int</span> <span class="n">X</span><span class="p">,</span> <span class="n">X1</span><span class="p">;</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Y1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">X1</span> <span class="o">=</span> <span class="o">!</span><span class="n">X</span> <span class="o">&amp;&amp;</span> <span class="n">Y</span><span class="p">;</span> <span class="n">Y1</span> <span class="o">=</span> <span class="o">!</span><span class="n">X</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">Y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;X&#34;</span> <span class="s">&#34; = %d; &#34;</span><span class="p">,</span> <span class="n">X</span><span class="p">);</span> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Y&#34;</span> <span class="s">&#34; = %d; &#34;</span><span class="p">,</span> <span class="n">Y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">X</span> <span class="o">=</span> <span class="n">X1</span><span class="p">;</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">putchar</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">Sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ›´å®Œæ•´çš„å®ç°ï¼šæ•°ç ç®¡æ˜¾ç¤º</p>
<p>ä»£ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Windows.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define REGS_FOREACH(_)  _(X) _(Y)
</span></span></span><span class="line"><span class="cl"><span class="cp">#define OUTS_FOREACH(_)  _(A) _(B) _(C) _(D) _(E) _(F) _(G)
</span></span></span><span class="line"><span class="cl"><span class="cp">#define RUN_LOGIC        X1 = !X &amp;&amp; Y; \
</span></span></span><span class="line"><span class="cl"><span class="cp">                         Y1 = !X &amp;&amp; !Y; \
</span></span></span><span class="line"><span class="cl"><span class="cp">                         A  = (!X &amp;&amp; !Y) || (X &amp;&amp; !Y); \
</span></span></span><span class="line"><span class="cl"><span class="cp">                         B  = 1; \
</span></span></span><span class="line"><span class="cl"><span class="cp">                         C  = (!X &amp;&amp; !Y) || (!X &amp;&amp; Y); \
</span></span></span><span class="line"><span class="cl"><span class="cp">                         D  = (!X &amp;&amp; !Y) || (X &amp;&amp; !Y); \
</span></span></span><span class="line"><span class="cl"><span class="cp">                         E  = (!X &amp;&amp; !Y) || (X &amp;&amp; !Y); \
</span></span></span><span class="line"><span class="cl"><span class="cp">                         F  = (!X &amp;&amp; !Y); \
</span></span></span><span class="line"><span class="cl"><span class="cp">                         G  = (X &amp;&amp; !Y);
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define DEFINE(X)   static int X, X##1;
</span></span></span><span class="line"><span class="cl"><span class="cp">#define UPDATE(X)   X = X##1;
</span></span></span><span class="line"><span class="cl"><span class="cp">#define PRINT(X)    printf(#X &#34; = %d; &#34;, X);
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">REGS_FOREACH</span><span class="p">(</span><span class="n">DEFINE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">OUTS_FOREACH</span><span class="p">(</span><span class="n">DEFINE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// clock
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">RUN_LOGIC</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">OUTS_FOREACH</span><span class="p">(</span><span class="n">PRINT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">REGS_FOREACH</span><span class="p">(</span><span class="n">UPDATE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">putchar</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">Sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®å±•å¼€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="kt">int</span> <span class="n">X</span><span class="p">,</span> <span class="n">X1</span><span class="p">;</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Y1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="kt">int</span> <span class="n">A</span><span class="p">,</span> <span class="n">A1</span><span class="p">;</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">B</span><span class="p">,</span> <span class="n">B1</span><span class="p">;</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">C</span><span class="p">,</span> <span class="n">C1</span><span class="p">;</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">D</span><span class="p">,</span> <span class="n">D1</span><span class="p">;</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">E</span><span class="p">,</span> <span class="n">E1</span><span class="p">;</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">F</span><span class="p">,</span> <span class="n">F1</span><span class="p">;</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">G</span><span class="p">,</span> <span class="n">G1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">X1</span> <span class="o">=</span> <span class="o">!</span><span class="n">X</span> <span class="o">&amp;&amp;</span> <span class="n">Y</span><span class="p">;</span> <span class="n">Y1</span> <span class="o">=</span> <span class="o">!</span><span class="n">X</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">Y</span><span class="p">;</span> <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="n">X</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">Y</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">X</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">Y</span><span class="p">);</span> <span class="n">B</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="n">X</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">Y</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="n">X</span> <span class="o">&amp;&amp;</span> <span class="n">Y</span><span class="p">);</span> <span class="n">D</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="n">X</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">Y</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">X</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">Y</span><span class="p">);</span> <span class="n">E</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="n">X</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">Y</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">X</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">Y</span><span class="p">);</span> <span class="n">F</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="n">X</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">Y</span><span class="p">);</span> <span class="n">G</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">Y</span><span class="p">);;</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;A&#34;</span> <span class="s">&#34; = %d; &#34;</span><span class="p">,</span> <span class="n">A</span><span class="p">);</span> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;B&#34;</span> <span class="s">&#34; = %d; &#34;</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;C&#34;</span> <span class="s">&#34; = %d; &#34;</span><span class="p">,</span> <span class="n">C</span><span class="p">);</span> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;D&#34;</span> <span class="s">&#34; = %d; &#34;</span><span class="p">,</span> <span class="n">D</span><span class="p">);</span> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;E&#34;</span> <span class="s">&#34; = %d; &#34;</span><span class="p">,</span> <span class="n">E</span><span class="p">);</span> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;F&#34;</span> <span class="s">&#34; = %d; &#34;</span><span class="p">,</span> <span class="n">F</span><span class="p">);</span> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;G&#34;</span> <span class="s">&#34; = %d; &#34;</span><span class="p">,</span> <span class="n">G</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">X</span> <span class="o">=</span> <span class="n">X1</span><span class="p">;</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">putchar</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">Sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>pythonåç«¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">fileinput</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="n">TEMPLATE</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1"></span><span class="se">\033</span><span class="s1">[2J</span><span class="se">\033</span><span class="s1">[1;1f
</span></span></span><span class="line"><span class="cl"><span class="s1">     AAAAAAAAA
</span></span></span><span class="line"><span class="cl"><span class="s1">    FF       BB
</span></span></span><span class="line"><span class="cl"><span class="s1">    FF       BB
</span></span></span><span class="line"><span class="cl"><span class="s1">    FF       BB
</span></span></span><span class="line"><span class="cl"><span class="s1">    FF       BB
</span></span></span><span class="line"><span class="cl"><span class="s1">    GGGGGGGGGG
</span></span></span><span class="line"><span class="cl"><span class="s1">   EE       CC
</span></span></span><span class="line"><span class="cl"><span class="s1">   EE       CC
</span></span></span><span class="line"><span class="cl"><span class="s1">   EE       CC
</span></span></span><span class="line"><span class="cl"><span class="s1">   EE       CC
</span></span></span><span class="line"><span class="cl"><span class="s1">    DDDDDDDDD
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span> 
</span></span><span class="line"><span class="cl"><span class="n">BLOCK</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[37mâ–‘</span><span class="se">\033</span><span class="s1">[0m&#39;</span><span class="p">,</span> <span class="c1"># STFW: ANSI Escape Code</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[31mâ–ˆ</span><span class="se">\033</span><span class="s1">[0m&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">VARS</span> <span class="o">=</span> <span class="s1">&#39;ABCDEFG&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">VARS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">globals</span><span class="p">()[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">stdin</span> <span class="o">=</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">exec</span><span class="p">(</span><span class="n">stdin</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">pic</span> <span class="o">=</span> <span class="n">TEMPLATE</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">VARS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">pic</span> <span class="o">=</span> <span class="n">pic</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">BLOCK</span><span class="p">[</span><span class="nb">globals</span><span class="p">()[</span><span class="n">v</span><span class="p">]])</span> <span class="c1"># &#39;A&#39; -&gt; BLOCK[A], ...</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">pic</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨æ–¹æ³•</p>
<p>å…ˆé€šè¿‡gccå°†cæ–‡ä»¶ç¼–è¯‘ä¸ºexeæ–‡ä»¶</p>
<p>ç„¶åcmdå‘½ä»¤ç«¯è¾“å…¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">logisim.exe <span class="p">|</span> python seven-seg.py
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ•ˆæœï¼šå¾ªç¯å‡ºç°å¦‚ä¸‹ç”»é¢</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-1.png" title="/img/Operating System/chapter2-1.png" data-thumbnail="/img/Operating System/chapter2-1.png" data-sub-html="<h2>pythonåç«¯(image 1)</h2>">
        
    </a><figcaption class="image-caption">pythonåç«¯(<code>image 1</code>)</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-2.png" title="/img/Operating System/chapter2-2.png" data-thumbnail="/img/Operating System/chapter2-2.png" data-sub-html="<h2>pythonåç«¯(image 2)</h2>">
        
    </a><figcaption class="image-caption">pythonåç«¯(<code>image 2</code>)</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-3.png" title="/img/Operating System/chapter2-3.png" data-thumbnail="/img/Operating System/chapter2-3.png" data-sub-html="<h2>pythonåç«¯(image 3)</h2>">
        
    </a><figcaption class="image-caption">pythonåç«¯(<code>image 3</code>)</figcaption>
    </figure>
<ul>
<li>
<p>ä¼šç¼–ç¨‹ï¼Œä½ å°±æ‹¥æœ‰å…¨ä¸–ç•Œï¼</p>
</li>
<li>
<p>åŒæ ·çš„æ–¹å¼å¯ä»¥æ¨¡æ‹Ÿä»»ä½•æ•°å­—ç³»ç»Ÿ</p>
<ul>
<li>å½“ç„¶ï¼Œä¹ŸåŒ…æ‹¬è®¡ç®—æœºç³»ç»Ÿ</li>
</ul>
</li>
</ul>
<p>UNIX å“²å­¦</p>
<ul>
<li>Make each program do one thing well</li>
<li>Expect the output of every program to become the input to another</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯ç¨‹åºæºä»£ç è§†è§’">ä»€ä¹ˆæ˜¯ç¨‹åºï¼ˆæºä»£ç è§†è§’ï¼‰</h3>
<p>ç¨‹åºå°±æ˜¯çŠ¶æ€æœº (ä½ åœ¨ gdb é‡Œçœ‹åˆ°çš„)</p>
<p>ä»£ç ï¼šhanoi-r.c</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">hanoi</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">char</span> <span class="n">from</span><span class="p">,</span> <span class="kt">char</span> <span class="n">to</span><span class="p">,</span> <span class="kt">char</span> <span class="n">via</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%c -&gt; %c</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">hanoi</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">via</span><span class="p">,</span> <span class="n">to</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">hanoi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>     <span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span>  <span class="n">via</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">hanoi</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">via</span><span class="p">,</span>  <span class="n">to</span><span class="p">,</span>  <span class="n">from</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="c-ç¨‹åºçš„çŠ¶æ€æœºæ¨¡å‹è§’åº¦ä¸€">C ç¨‹åºçš„çŠ¶æ€æœºæ¨¡å‹ï¼ˆè§’åº¦ä¸€ï¼‰</h4>
<p><strong>(è¯­ä¹‰ï¼Œsemantics)</strong></p>
<ul>
<li>çŠ¶æ€ = å † + æ ˆ</li>
<li>åˆå§‹çŠ¶æ€ = <code>main</code> çš„ç¬¬ä¸€æ¡è¯­å¥</li>
<li>è¿ç§» = æ‰§è¡Œä¸€æ¡ç®€å•è¯­å¥
<ul>
<li>ä»»ä½• C ç¨‹åºéƒ½å¯ä»¥æ”¹å†™æˆ â€œéå¤åˆè¯­å¥â€ çš„ C ä»£ç </li>
<li><a href="https://cil-project.github.io/cil/" target="_blank" rel="noopener noreffer">çœŸçš„æœ‰è¿™ç§å·¥å…·</a> (C Intermediate Language) å’Œ<a href="https://gitlab.com/zsaleeba/picoc" target="_blank" rel="noopener noreffer">è§£é‡Šå™¨</a></li>
</ul>
</li>
</ul>
<hr>
<p>(è¿™è¿˜åªæ˜¯ â€œç²—æµ…â€ çš„ç†è§£)</p>
<ul>
<li>Talk is cheap. Show me the code. (Linus Torvalds): ä»»ä½•çœŸæ­£çš„ç†è§£éƒ½åº”è¯¥è½åˆ°å¯ä»¥æ‰§è¡Œçš„ä»£ç </li>
</ul>
<h4 id="c-ç¨‹åºçš„çŠ¶æ€æœºæ¨¡å‹è§’åº¦äºŒ">C ç¨‹åºçš„çŠ¶æ€æœºæ¨¡å‹ï¼ˆè§’åº¦äºŒï¼‰</h4>
<p><strong>(è¯­ä¹‰ï¼Œsemantics)</strong></p>
<ul>
<li>çŠ¶æ€ = stack frame çš„åˆ—è¡¨ (æ¯ä¸ª frame æœ‰ PC <code>program counter</code> ) + å…¨å±€å˜é‡</li>
<li>åˆå§‹çŠ¶æ€ = main(argc, argv), å…¨å±€å˜é‡åˆå§‹åŒ–</li>
<li>è¿ç§» = æ‰§è¡Œ top stack frame PC çš„è¯­å¥; PC++
<ul>
<li>å‡½æ•°è°ƒç”¨ = push frame (frame.PC = å…¥å£)</li>
<li>å‡½æ•°è¿”å› = pop frame</li>
</ul>
</li>
</ul>
<p><strong>åº”ç”¨ï¼šå°†ä»»ä½•é€’å½’ç¨‹åºå°±åœ°è½¬ä¸ºéé€’å½’</strong>ï¼ˆæ¨¡æ‹Ÿ$stack$ï¼‰</p>
<p>$hanoi-nr.c\newline$</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">pc</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">via</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">Frame</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#define call(...) ({ *(++top) = (Frame) { .pc = 0, __VA_ARGS__ }; })
</span></span></span><span class="line"><span class="cl"><span class="cp">#define ret()     ({ top--; })
</span></span></span><span class="line"><span class="cl"><span class="cp">#define goto(loc) ({ f-&gt;pc = (loc) - 1; })
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">hanoi</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">char</span> <span class="n">from</span><span class="p">,</span> <span class="kt">char</span> <span class="n">to</span><span class="p">,</span> <span class="kt">char</span> <span class="n">via</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">Frame</span> <span class="n">stk</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span> <span class="o">*</span><span class="n">top</span> <span class="o">=</span> <span class="n">stk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">call</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">via</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">Frame</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span> <span class="p">(</span><span class="n">f</span> <span class="o">=</span> <span class="n">top</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">stk</span><span class="p">;</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">switch</span> <span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="mi">0</span><span class="o">:</span> <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%c -&gt; %c</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">from</span><span class="p">,</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">to</span><span class="p">);</span> <span class="k">goto</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="mi">1</span><span class="o">:</span> <span class="n">call</span><span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">from</span><span class="p">,</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">via</span><span class="p">,</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">to</span><span class="p">);</span>   <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="mi">2</span><span class="o">:</span> <span class="n">call</span><span class="p">(</span>       <span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">from</span><span class="p">,</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">to</span><span class="p">,</span>  <span class="n">f</span><span class="o">-&gt;</span><span class="n">via</span><span class="p">);</span>  <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="mi">3</span><span class="o">:</span> <span class="n">call</span><span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">via</span><span class="p">,</span>  <span class="n">f</span><span class="o">-&gt;</span><span class="n">to</span><span class="p">,</span>  <span class="n">f</span><span class="o">-&gt;</span><span class="n">from</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="mi">4</span><span class="o">:</span> <span class="n">ret</span><span class="p">();</span>                                    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">default</span><span class="o">:</span> <span class="n">assert</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>A â†’ B, B â†’ A çš„è¿åˆƒè€Œè§£
<ul>
<li>è¿˜æ˜¯ä¸€æ ·çš„ <code>call()</code>ï¼Œä½†æ”¾å…¥ä¸åŒçš„ <code>Frame</code></li>
</ul>
</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯ç¨‹åº-äºŒè¿›åˆ¶ä»£ç è§†è§’">ä»€ä¹ˆæ˜¯ç¨‹åº (äºŒè¿›åˆ¶ä»£ç è§†è§’)</h3>
<p>è¿˜æ˜¯çŠ¶æ€æœº	(æ²¡çœ‹è¿‡å—å¤§çš„è®¡ç®—æœºåŸºç¡€å’Œæ•°å­—é€»è¾‘è¯¾åˆ°è¿™å¤šå°‘æœ‰ç‚¹ğŸ¤¡äº†)</p>
<ul>
<li>çŠ¶æ€ = å†…å­˜ <code>M</code> + å¯„å­˜å™¨ <code>R</code></li>
<li>åˆå§‹çŠ¶æ€ = (ç¨åå›ç­”)</li>
<li>è¿ç§» = æ‰§è¡Œä¸€æ¡æŒ‡ä»¤
<ul>
<li>æˆ‘ä»¬èŠ±äº†ä¸€æ•´ä¸ªã€Šè®¡ç®—æœºç³»ç»ŸåŸºç¡€ã€‹è§£é‡Šè¿™ä»¶äº‹</li>
<li>gdb åŒæ ·å¯ä»¥è§‚å¯ŸçŠ¶æ€å’Œæ‰§è¡Œ</li>
</ul>
</li>
</ul>
<hr>
<p>æ“ä½œç³»ç»Ÿä¸Šçš„ç¨‹åº</p>
<ul>
<li>
<p>æ‰€æœ‰çš„æŒ‡ä»¤éƒ½åªèƒ½<code>è®¡ç®—</code></p>
<ul>
<li>deterministic: mov, add, sub, call, &hellip;</li>
<li>non-deterministic: rdrand, &hellip;</li>
<li>ä½†è¿™äº›æŒ‡ä»¤ç”šè‡³éƒ½æ— æ³•ä½¿ç¨‹åºåœä¸‹æ¥ ,ç›´æ¥ğŸ¤¡, å¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´æ²¡æœ‰ä»€ä¹ˆğŸ”ç”¨(NEMU: åŠ æ¡ <code>trap</code> æŒ‡ä»¤)</li>
</ul>
</li>
</ul>
<h4 id="ä¸€æ¡ç‰¹æ®Šçš„æŒ‡ä»¤">ä¸€æ¡ç‰¹æ®Šçš„æŒ‡ä»¤</h4>
<p>è°ƒç”¨æ“ä½œç³»ç»Ÿ <code>syscall</code></p>
<ul>
<li>æŠŠ(<code>M</code>, <code>R</code>)<strong>å®Œå…¨äº¤ç»™æ“ä½œç³»ç»Ÿ</strong>ï¼Œä»»å…¶ä¿®æ”¹
<ul>
<li>ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼šå¦‚æœç¨‹åºä¸æ‰“ç®—å®Œå…¨ä¿¡ä»»æ“ä½œç³»ç»Ÿï¼Ÿ</li>
</ul>
</li>
<li>å®ç°ä¸æ“ä½œç³»ç»Ÿä¸­çš„å…¶ä»–å¯¹è±¡äº¤äº’
<ul>
<li>è¯»å†™æ–‡ä»¶/æ“ä½œç³»ç»ŸçŠ¶æ€ (ä¾‹å¦‚æŠŠæ–‡ä»¶å†…å®¹å†™å…¥ M<em>M</em>)</li>
<li>æ”¹å˜è¿›ç¨‹ (è¿è¡Œä¸­çŠ¶æ€æœº) çš„çŠ¶æ€ï¼Œä¾‹å¦‚åˆ›å»ºè¿›ç¨‹/é”€æ¯è‡ªå·±</li>
</ul>
</li>
</ul>
<hr>
<p><strong>ç¨‹åº = è®¡ç®— + syscall</strong></p>
<div class="mermaid" id="id-2"></div>
<h4 id="é—®é¢˜æ€ä¹ˆæ„é€ ä¸€ä¸ªæœ€å°çš„-hello-world">é—®é¢˜ï¼šæ€ä¹ˆæ„é€ ä¸€ä¸ªæœ€å°çš„ Hello, Worldï¼Ÿ</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello, World</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>gcc ç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶ä¸æ»¡è¶³ â€œæœ€å°â€</p>
<ul>
<li><code>--verbose</code>å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç¼–è¯‘é€‰é¡¹ (çœŸä¸å°‘)
<ul>
<li><code>printf </code>å˜æˆäº† puts@plt</li>
</ul>
</li>
<li><code>-static</code> ä¼šå¤åˆ¶ libc</li>
</ul>
<p>gccèƒ½ç©çš„è¿™ä¹ˆå¤šï¼Œçœ‹æ¥âœŒï¸ä¹‹å‰å¤©å¤©é ç°æˆ$IDE$å¤šå°‘æ²¾ç‚¹ğŸ¤¡äº†</p>
<p>å®é™…ä½¿ç”¨<code>--verbose</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc --verbose hello.c
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ•ˆæœ</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-4.png" title="/img/Operating System/chapter2-4.png" data-thumbnail="/img/Operating System/chapter2-4.png" data-sub-html="<h2>æ•ˆæœ(on windows)</h2>">
        
    </a><figcaption class="image-caption">æ•ˆæœ(<code>on windows</code>)</figcaption>
    </figure>
<p>å®é™…ä½¿ç”¨<code>â€“static</code>(ä¸ä¾èµ–åŠ¨æ€é“¾æ¥åº“)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -static hello.c
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶ä¼šå¾ˆå¤§ï¼ˆæˆ‘çš„æ˜¯53KBï¼‰</p>
<hr>
<p>ç›´æ¥ç¡¬æ¥ï¼Ÿ</p>
<p>å¼ºè¡Œç¼–è¯‘ + é“¾æ¥ï¼š<code>gcc -c</code> + <code>ld</code></p>
<ul>
<li>
<p>ç›´æ¥ç”¨ ld é“¾æ¥å¤±è´¥</p>
<ul>
<li>ld ä¸çŸ¥é“æ€ä¹ˆé“¾æ¥åº“å‡½æ•°â€¦â€¦</li>
</ul>
</li>
<li>
<p>ç©ºçš„ main å‡½æ•°å€’æ˜¯å¯ä»¥</p>
<ul>
<li>é“¾æ¥æ—¶å¾—åˆ°å¥‡æ€ªçš„è­¦å‘Š (å¯ä»¥å®šä¹‰æˆ <code>_start</code> é¿å…è­¦å‘Š)</li>
<li>ä½† Segmentation Fault äº†â€¦â€¦</li>
</ul>
</li>
</ul>
<p>æ‰¾äº†ä¸€ä¸‹<code>Segmentation Fault</code></p>
<p>$From\ wikipedia\newline$
$\rightarrow$ <a href="https://en.wikipedia.org/wiki/Segmentation_fault" target="_blank" rel="noopener noreffer">address</a></p>
<blockquote>
<p>In <a href="https://en.wikipedia.org/wiki/Computing" target="_blank" rel="noopener noreffer">computing</a>, a <strong>segmentation fault</strong> (often shortened to <strong>segfault</strong>) or <strong>access violation</strong> is a <a href="https://en.wikipedia.org/wiki/Fault_%28computing%29" target="_blank" rel="noopener noreffer">fault</a>, or failure condition, raised by hardware with <a href="https://en.wikipedia.org/wiki/Memory_protection" target="_blank" rel="noopener noreffer">memory protection</a>, notifying an <a href="https://en.wikipedia.org/wiki/Operating_system" target="_blank" rel="noopener noreffer">operating system</a> (OS) the software has attempted to access a restricted area of memory (a memory access violation). On standard <a href="https://en.wikipedia.org/wiki/X86" target="_blank" rel="noopener noreffer">x86</a> computers, this is a form of <a href="https://en.wikipedia.org/wiki/General_protection_fault" target="_blank" rel="noopener noreffer">general protection fault</a>. The <a href="https://en.wikipedia.org/wiki/Operating_system_kernel" target="_blank" rel="noopener noreffer">operating system kernel</a> will, in response, usually perform some corrective action, generally passing the fault on to the offending <a href="https://en.wikipedia.org/wiki/Process_%28computing%29" target="_blank" rel="noopener noreffer">process</a> by sending the process a <a href="https://en.wikipedia.org/wiki/Signal_%28computing%29" target="_blank" rel="noopener noreffer">signal</a>. Processes can in some cases install a custom signal handler, allowing them to recover on their own,[<a href="https://en.wikipedia.org/wiki/Segmentation_fault#cite_note-Peter_Van_der_Linden-1" target="_blank" rel="noopener noreffer">1]</a> but otherwise the OS default signal handler is used, generally causing <a href="https://en.wikipedia.org/wiki/Abnormal_termination" target="_blank" rel="noopener noreffer">abnormal termination</a> of the process (a program <a href="https://en.wikipedia.org/wiki/Crash_%28computing%29" target="_blank" rel="noopener noreffer">crash</a>), and sometimes a <a href="https://en.wikipedia.org/wiki/Core_dump" target="_blank" rel="noopener noreffer">core dump</a>.</p>
<p>Segmentation faults are a common class of error in programs written in languages like <a href="https://en.wikipedia.org/wiki/C_%28programming_language%29" target="_blank" rel="noopener noreffer">C</a> that provide low-level memory access and few to no safety checks. They arise primarily due to errors in use of <a href="https://en.wikipedia.org/wiki/Pointer_%28computer_programming%29" target="_blank" rel="noopener noreffer">pointers</a> for <a href="https://en.wikipedia.org/wiki/Virtual_memory" target="_blank" rel="noopener noreffer">virtual memory</a> addressing, particularly illegal access. Another type of memory access error is a <a href="https://en.wikipedia.org/wiki/Bus_error" target="_blank" rel="noopener noreffer">bus error</a>, which also has various causes, but is today much rarer; these occur primarily due to incorrect <em>physical</em> memory addressing, or due to misaligned memory access â€“ these are memory references that the hardware <em>cannot</em> address, rather than references that a process is not <em>allowed</em> to address.</p>
<p>Many programming languages may employ mechanisms designed to avoid segmentation faults and improve memory safety. For example, <a href="https://en.wikipedia.org/wiki/Rust_%28programming_language%29" target="_blank" rel="noopener noreffer">Rust</a> employs an ownership-based[<a href="https://en.wikipedia.org/wiki/Segmentation_fault#cite_note-2" target="_blank" rel="noopener noreffer">2]</a> model to ensure memory safety.[<a href="https://en.wikipedia.org/wiki/Segmentation_fault#cite_note-3" target="_blank" rel="noopener noreffer">3]</a> Other languages, such as <a href="https://en.wikipedia.org/wiki/Lisp_%28programming_language%29" target="_blank" rel="noopener noreffer">Lisp</a> and <a href="https://en.wikipedia.org/wiki/Java_%28programming_language%29" target="_blank" rel="noopener noreffer">Java</a>, employ <a href="https://en.wikipedia.org/wiki/Garbage_collection_%28computer_science%29" target="_blank" rel="noopener noreffer">garbage collection</a>,[<a href="https://en.wikipedia.org/wiki/Segmentation_fault#cite_note-4" target="_blank" rel="noopener noreffer">4]</a> which avoids certain classes of memory errors that could lead to segmentation faults.[<a href="https://en.wikipedia.org/wiki/Segmentation_fault#cite_note-5" target="_blank" rel="noopener noreffer">5]</a></p>
</blockquote>
<p>ä¸»è¦å’Œéæ³•è®¿é—®å†…å­˜æœ‰å…³</p>
<p>è§£å†³æ–¹æ³•ï¼šè§‚å¯Ÿç¨‹åºï¼ˆçŠ¶æ€æœºï¼‰æ‰§è¡Œ</p>
<ul>
<li>
<p><code>starti</code>å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä»<strong>ç¬¬ä¸€æ¡æŒ‡ä»¤</strong>å¼€å§‹æ‰§è¡Œç¨‹åº</p>
<ul>
<li><code>gdb</code> å¯ä»¥åœ¨ä¸¤ç§çŠ¶æ€æœºè§†è§’ä¹‹é—´åˆ‡æ¢ (<code>layout</code>) <a href="http://sourceware.org/gdb/documentation/" target="_blank" rel="noopener noreffer">GDBå®˜æ–¹æ–‡æ¡£</a></li>
</ul>
</li>
</ul>
<p>å®šä½å‡ºé”™ä½ç½®</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-5.png" title="/img/Operating System/chapter2-5.png" data-thumbnail="/img/Operating System/chapter2-5.png" data-sub-html="<h2>å‡ºé”™ä½ç½®(on linux)</h2>">
        
    </a><figcaption class="image-caption">å‡ºé”™ä½ç½®(<code>on linux</code>)</figcaption>
    </figure>
<p><code>retq</code>:æ ˆç”±<code>rsp</code>ï¼ˆå¯„å­˜å™¨ï¼‰æ§åˆ¶,<code>retq</code>å°±æ˜¯ä»<code>rsp</code>å¯„å­˜å™¨å½“ä¸­å–å‡º8ä¸ªå­—èŠ‚ï¼Œèµ‹å€¼ç»™<code>rip</code>(pc)ï¼Œç„¶å<code>rsp &lt;- rsp + 8</code>ï¼ˆå¾€ä¸ŠæŒªä¸€æ ¼ï¼‰ï¼ˆæ ˆå‘ä¸‹å¢é•¿ï¼‰</p>
<p>åˆå§‹<code>rsp</code>é¡¶éƒ¨ä¸º1</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-6.png" title="/img/Operating System/chapter2-6.png" data-thumbnail="/img/Operating System/chapter2-6.png" data-sub-html="<h2>æŸ¥çœ‹é”™è¯¯(on gdb)</h2>">
        
    </a><figcaption class="image-caption">æŸ¥çœ‹é”™è¯¯(<code>on gdb</code>)</figcaption>
    </figure>
<p>æ ˆ</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-7.png" title="/img/Operating System/chapter2-7.png" data-thumbnail="/img/Operating System/chapter2-7.png" data-sub-html="<h2>æŸ¥çœ‹é”™è¯¯(on gdb)</h2>">
        
    </a><figcaption class="image-caption">æŸ¥çœ‹é”™è¯¯(<code>on gdb</code>)</figcaption>
    </figure>
<p>ä½†æ˜¯å½“æ‰§è¡Œå®Œæœ‰é—®é¢˜çš„è¯­å¥ä¹‹å<code>retq</code>ï¼Œ<code>rip</code>å°±å˜æˆäº†8</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-8.png" title="/img/Operating System/chapter2-8.png" data-thumbnail="/img/Operating System/chapter2-8.png" data-sub-html="<h2>å‡ºç°é”™è¯¯(on gdb)</h2>">
        
    </a><figcaption class="image-caption">å‡ºç°é”™è¯¯(<code>on gdb</code>)</figcaption>
    </figure>
<p>éæ³•è®¿é—®ï¼Œè§¦å‘äº†<code>Segmentation Fault</code></p>
<p><strong>æ‰€ä»¥è¯¥ç¨‹åºèƒ½è¢«æ“ä½œç³»ç»Ÿæ­£ç¡®çš„æ‰§è¡Œï¼Œä½†æ²¡æœ‰åŠæ³•è¿”å›ï¼Œé—®é¢˜å‡ºåœ¨åˆå§‹çŠ¶æ€ä¸Šï¼ˆå³é”™è¯¯çš„æŒ‡ä»¤ï¼‰</strong></p>
<h5 id="è§£å†³å¼‚å¸¸é€€å‡º">è§£å†³å¼‚å¸¸é€€å‡º</h5>
<p>æœ‰åŠæ³•è®©çŠ¶æ€æœº â€œåœä¸‹æ¥â€ å—ï¼Ÿ</p>
<ul>
<li>çº¯ â€œè®¡ç®—â€ çš„çŠ¶æ€æœºï¼šä¸è¡Œ</li>
<li>è¦ä¹ˆæ­»å¾ªç¯ï¼Œè¦ä¹ˆ undefined behavior</li>
</ul>
<p>è§£å†³åŠæ³•ï¼š<code>syscall</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/syscall.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">syscall</span><span class="p">(</span><span class="n">SYS_exit</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>linux</code>ç¯å¢ƒä¸‹ä½¿ç”¨<code>gdb</code>è¿›è¡Œè°ƒè¯•</p>
<p>å‘ç°è°ƒç”¨äº†<code>syscall</code></p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-9.png" title="/img/Operating System/chapter2-9.png" data-thumbnail="/img/Operating System/chapter2-9.png" data-sub-html="<h2>gdb(on linux)</h2>">
        
    </a><figcaption class="image-caption">gdb(<code>on linux</code>)</figcaption>
    </figure>
<p>è¿›å…¥<code>syscall</code>ç»§ç»­æŸ¥çœ‹</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-10.png" title="/img/Operating System/chapter2-10.png" data-thumbnail="/img/Operating System/chapter2-10.png" data-sub-html="<h2>gdb(ç»§ç»­æŸ¥çœ‹)</h2>">
        
    </a><figcaption class="image-caption">gdb(<code>ç»§ç»­æŸ¥çœ‹</code>)</figcaption>
    </figure>
<p>å‘ç°è¯¥å‡½æ•°ç»™ä¸€å¤§å †å¯„å­˜å™¨èµ‹äº†å€¼ï¼Œèµ‹å®Œå€¼ä¹‹åä¼šæ‰§è¡Œä¸€ä¸ª<code>syscall</code>æŒ‡ä»¤</p>
<p>å®è´¨ï¼šå‡†å¤‡å¥½ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨çš„å‚æ•°ï¼Œç„¶åæŠŠè‡ªå·±å®Œå…¨äº¤ç»™æ“ä½œç³»ç»Ÿ</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-11.png" title="/img/Operating System/chapter2-11.png" data-thumbnail="/img/Operating System/chapter2-11.png" data-sub-html="<h2>gdb(å¯ä»¥çœ‹åˆ°é€€å‡ºç )</h2>">
        
    </a><figcaption class="image-caption">gdb(<code>å¯ä»¥çœ‹åˆ°é€€å‡ºç </code>)</figcaption>
    </figure>
<p>ï¼ˆç»ˆæ­¢ï¼‰</p>
<ul>
<li>è°ƒè¯•ä»£ç ï¼šsyscall çš„å®ç°åœ¨å“ªé‡Œï¼Ÿ
<ul>
<li>åæ¶ˆæ¯ï¼šåœ¨ libc é‡Œï¼Œä¸æ–¹ä¾¿ç›´æ¥é“¾æ¥</li>
<li>å¥½æ¶ˆæ¯ï¼šä»£ç å¾ˆçŸ­ï¼Œè€Œä¸”ä¼¼ä¹çœ‹æ‡‚äº†</li>
</ul>
</li>
</ul>
<h5 id="hello-worldçš„æ±‡ç¼–å®ç°">Hello, Worldçš„æ±‡ç¼–å®ç°</h5>
<p>minmal.S</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/syscall.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="n">globl</span> <span class="n">_start</span>
</span></span><span class="line"><span class="cl"><span class="nl">_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="n">SYS_write</span><span class="p">,</span> <span class="o">%</span><span class="n">rax</span>   <span class="err">#</span> <span class="n">write</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span>         <span class="o">%</span><span class="n">rdi</span>   <span class="err">#</span>   <span class="n">fd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="n">st</span><span class="p">,</span>        <span class="o">%</span><span class="n">rsi</span>   <span class="err">#</span>   <span class="n">buf</span><span class="o">=</span><span class="n">st</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="p">(</span><span class="n">ed</span> <span class="o">-</span> <span class="n">st</span><span class="p">),</span> <span class="o">%</span><span class="n">rdx</span>   <span class="err">#</span>   <span class="n">count</span><span class="o">=</span><span class="n">ed</span><span class="o">-</span><span class="n">st</span>
</span></span><span class="line"><span class="cl">  <span class="n">syscall</span>                 <span class="err">#</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="n">SYS_exit</span><span class="p">,</span>  <span class="o">%</span><span class="n">rax</span>   <span class="err">#</span> <span class="n">exit</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span>         <span class="o">%</span><span class="n">rdi</span>   <span class="err">#</span>   <span class="n">status</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="n">syscall</span>                 <span class="err">#</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">st</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="n">ascii</span> <span class="s">&#34;</span><span class="se">\033</span><span class="s">[01;31mHello, OS World</span><span class="se">\033</span><span class="s">[0m</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nl">ed</span><span class="p">:</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Note: gcc æ”¯æŒå¯¹æ±‡ç¼–ä»£ç çš„é¢„ç¼–è¯‘ (è¿˜ä¼šå®šä¹‰ <code>__ASSEMBLER__</code> å®)</p>
<p>è¿è¡ŒæˆåŠŸï¼Œçº¢è‰²çš„hello,worldï¼ˆ<code>linux</code>å¼€å§‹ğŸ’©ğŸ´çŠ¯ç—…ï¼Œç”¨gdbæ‰è°ƒå‡ºæ¥ï¼‰</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-12.png" title="/img/Operating System/chapter2-12.png" data-thumbnail="/img/Operating System/chapter2-12.png" data-sub-html="<h2>è¿è¡Œç¨‹åº(on gdb)</h2>">
        
    </a><figcaption class="image-caption">è¿è¡Œç¨‹åº(<code>on gdb</code>)</figcaption>
    </figure>
<p>å®å±•å¼€ç»“æœ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -E minmal.S
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="p">.</span><span class="n">globl</span> <span class="n">_start</span>
</span></span><span class="line"><span class="cl"><span class="nl">_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span> <span class="o">%</span><span class="n">rax</span> <span class="err">#</span> <span class="n">write</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span> <span class="err">#</span> <span class="n">fd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="n">st</span><span class="p">,</span> <span class="o">%</span><span class="n">rsi</span> <span class="err">#</span> <span class="n">buf</span><span class="o">=</span><span class="n">st</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="p">(</span><span class="n">ed</span> <span class="o">-</span> <span class="n">st</span><span class="p">),</span> <span class="o">%</span><span class="n">rdx</span> <span class="err">#</span> <span class="n">count</span><span class="o">=</span><span class="n">ed</span><span class="o">-</span><span class="n">st</span>
</span></span><span class="line"><span class="cl">  <span class="n">syscall</span> <span class="err">#</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="mi">60</span><span class="p">,</span> <span class="o">%</span><span class="n">rax</span> <span class="err">#</span> <span class="n">exit</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span> <span class="err">#</span> <span class="n">status</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="n">syscall</span> <span class="err">#</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">st</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="n">ascii</span> <span class="s">&#34;</span><span class="se">\033</span><span class="s">[01;31mHello, OS World</span><span class="se">\033</span><span class="s">[0m</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nl">ed</span><span class="p">:</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ·±ç©¶<code>syscall</code></p>
<p>ä½¿ç”¨å‘½ä»¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">man syscall
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥ç›´æ¥æŸ¥çœ‹æ‰‹å†Œ</p>
<hr>
<p>å›é¡¾ï¼šçŠ¶æ€æœºè§†è§’çš„ç¨‹åº</p>
<ul>
<li>ç¨‹åº = è®¡ç®— â†’ <code>syscall </code>â†’ è®¡ç®— â†’ &hellip;</li>
</ul>
<h6 id="å½©è›‹ansi-escape-code">å½©è›‹ï¼šANSI Escape Code</h6>
<blockquote>
<p>ä¸ºä»€ä¹ˆ Hello World æœ‰é¢œè‰²ï¼Ÿï¼Ÿ</p>
</blockquote>
<p>ç‰¹æ®Šç¼–ç çš„å­—ç¬¦å®ç°ç»ˆç«¯æ§åˆ¶</p>
<ul>
<li>
<p><a href="https://git.busybox.net/busybox/tree/editors/vi.c" target="_blank" rel="noopener noreffer">vi.c</a> from busybox</p>
</li>
<li>
<p><code>telnet towel.blinkenlights.nl</code> (ç”µå½±ï¼›Ctrl-] and q é€€å‡º)</p>
</li>
<li>
<p><code>dialog --msgbox 'Hello, OS World!' 8 32</code></p>
</li>
<li>
<p><code>ssh sshtron.zachlatta.com</code>(ç½‘ç»œæ¸¸æˆ)</p>
<ul>
<li>
<p>æ‰€ä»¥ç¼–ç¨‹å¯ä»¥ä»ä¸€å¼€å§‹å°±ä¸é‚£ä¹ˆæ¯ç‡¥</p>
</li>
<li>
<p>çœ‹ä¼¼å¤æ‚ï¼Œå®é™…ç®€å•æ˜äº†</p>
</li>
</ul>
</li>
</ul>
<h3 id="ç¼–è¯‘å™¨ä¸ç¼–è¯‘ä¼˜åŒ–">ç¼–è¯‘å™¨ä¸ç¼–è¯‘ä¼˜åŒ–</h3>
<p>â€œçŠ¶æ€æœºâ€ é¡ºä¾¿è§£å†³äº†ä¸€ä¸ªéå¸¸é‡è¦çš„åŸºæœ¬é—®é¢˜ï¼š</p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯ç¼–è¯‘å™¨ï¼Ÿï¼Ÿï¼Ÿ</p>
</blockquote>
<p>ç¼–è¯‘å™¨ï¼šæºä»£ç  <code>S</code>(çŠ¶æ€æœº) â†’ äºŒè¿›åˆ¶ä»£ç  <code>C</code> (çŠ¶æ€æœº)</p>
<p>$C = \textrm{compile}(S)\newline$</p>
<p>ç¼–è¯‘ (ä¼˜åŒ–) çš„æ­£ç¡®æ€§ (Soundness):</p>
<ul>
<li><em>S</em> ä¸ <em>C</em> çš„å¯è§‚æµ‹è¡Œä¸ºä¸¥æ ¼ä¸€è‡´
<ul>
<li>system calls; volatile variable loads/stores; termination</li>
</ul>
</li>
<li><code>Trivially</code> æ­£ç¡® (ä½†ä½æ•ˆ) çš„å®ç°
<ul>
<li>è§£é‡Šæ‰§è¡Œ/ç›´æ¥ç¿»è¯‘ <code>S</code>çš„è¯­ä¹‰</li>
</ul>
</li>
</ul>
<h4 id="ç°ä»£-ä¸æœªæ¥çš„-ç¼–è¯‘ä¼˜åŒ–">ç°ä»£ (ä¸æœªæ¥çš„) ç¼–è¯‘ä¼˜åŒ–</h4>
<p>åœ¨ä¿è¯è§‚æµ‹ä¸€è‡´æ€§ (sound) çš„å‰æä¸‹æ”¹å†™ä»£ç  (rewriting)</p>
<ul>
<li>
<p>Inline assembly ä¹Ÿå¯ä»¥å‚ä¸ä¼˜åŒ–</p>
<ul>
<li>å…¶ä»–ä¼˜åŒ–å¯èƒ½ä¼šè·¨è¿‡ä¸å¸¦ barrier çš„ <code>asm volatile</code></li>
</ul>
</li>
<li>
<p>Eventual memory consistency</p>
</li>
<li>
<p>Call to external CU = write back visible memory</p>
<ul>
<li>talk is cheap, show me the code!</li>
</ul>
</li>
</ul>
<hr>
<p>è¿™ç»™äº†æˆ‘ä»¬å¾ˆå¤šæƒ³è±¡çš„ç©ºé—´ï¼ˆğŸ®ğŸºçš„ä¸œè¥¿ï¼‰</p>
<ul>
<li>Semantic-based compilation (synthesis)</li>
<li>AI-based rewriting</li>
<li>Fine-grained semantics &amp; system call fusion</li>
</ul>
<p>ä¸å¯ä¼˜åŒ–çš„éƒ¨åˆ†å¯ä»¥è¿›è¡Œåˆå¹¶ï¼Ÿï¼ˆğŸ®ğŸºçš„ä¸œè¥¿ï¼‰</p>
<h4 id="è¿›å…¥-plprogramming-language-çš„é¢†åŸŸ">è¿›å…¥ PL(Programming language) çš„é¢†åŸŸ</h4>
<p>PL é¢†åŸŸ (çš„å¾ˆå¤šäºº) æœ‰ä¸€ç§å€¾å‘ï¼šç”¨æ•°å­¦åŒ–çš„è¯­è¨€å®šä¹‰å’Œç†è§£ä¸€åˆ‡ (all about semantics)</p>
<ul>
<li><del>æ‰€ä»¥ä½ çœ‹ä¸€çœ¼ paper å°±è§‰å¾—è‡ªå·±çäº†</del></li>
<li>ä½†èƒŒåçš„ç›´è§‰ä¾ç„¶æ˜¯ system/software çš„
<ul>
<li>(æˆ‘ä»¬æ˜¯äººï¼Œä¸æ˜¯æ— æƒ…çš„æ•°å­¦æœºå™¨ ğŸ˜‚)</li>
<li>æºœäº†æºœäº†ï¼Œå›åˆ° system çš„ä¸–ç•Œ</li>
</ul>
</li>
</ul>
<hr>
<p>Further readings</p>
<ul>
<li><a href="https://dl.acm.org/doi/10.1145/2103621.2103719" target="_blank" rel="noopener noreffer">An executable formal semantics of C with applications</a> (POPL'12)</li>
<li><a href="https://compcert.org/motivations.html" target="_blank" rel="noopener noreffer">CompCert C verified compiler</a> and a <a href="https://xavierleroy.org/publi/compcert-backend.pdf" target="_blank" rel="noopener noreffer">paper</a> (POPL'06, Most Influential Paper Award :gold medalğŸ®)</li>
<li><a href="https://dl.acm.org/doi/10.1145/3485513" target="_blank" rel="noopener noreffer">Copy-and-patch compilation</a> (OOPSLA'21, Distinguished Paper ğŸ®)</li>
</ul>
<h3 id="æ“ä½œç³»ç»Ÿä¸­çš„ç¨‹åº">æ“ä½œç³»ç»Ÿä¸­çš„ç¨‹åº</h3>
<h4 id="æ“ä½œç³»ç»Ÿä¸­çš„ä¸€èˆ¬ç¨‹åº">æ“ä½œç³»ç»Ÿä¸­çš„ä¸€èˆ¬ç¨‹åº</h4>
<blockquote>
<p>å’Œ <a href="https://jyywiki.cn/pages/OS/2022/demos/minimal.S" target="_blank" rel="noopener noreffer">minimal.S</a> æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼šç¨‹åº = è®¡ç®— â†’ syscall â†’ &hellip;</p>
</blockquote>
<p>æ“ä½œç³»ç»Ÿæ”¶ç¼–äº†æ‰€æœ‰çš„ç¡¬ä»¶/è½¯ä»¶èµ„æº</p>
<ul>
<li>åªèƒ½ç”¨æ“ä½œç³»ç»Ÿå…è®¸çš„æ–¹å¼è®¿é—®æ“ä½œç³»ç»Ÿä¸­çš„å¯¹è±¡
<ul>
<li>ä»è€Œå®ç°æ“ä½œç³»ç»Ÿçš„ â€œéœ¸ä¸»â€ åœ°ä½</li>
<li>ä¾‹å­ï¼š<a href="https://jyywiki.cn/pages/OS/2022/demos/tryopen.c" target="_blank" rel="noopener noreffer">tryopen.c</a></li>
</ul>
</li>
<li>è¿™æ˜¯ä¸º â€œç®¡ç†å¤šä¸ªçŠ¶æ€æœºâ€ æ‰€å¿…é¡»çš„
<ul>
<li>ä¸èƒ½æ‰“æ¶ï¼Œè°æœ‰æƒé™å°±ç»™ä»–</li>
</ul>
</li>
</ul>
<p>tryopen.c</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">try_open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fname</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;open(</span><span class="se">\&#34;</span><span class="s">%s</span><span class="se">\&#34;</span><span class="s">) returns %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">fd</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">perror</span><span class="p">(</span><span class="s">&#34;  FAIL&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;  SUCCESS!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">try_open</span><span class="p">(</span><span class="s">&#34;/something/not/exist&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">try_open</span><span class="p">(</span><span class="s">&#34;/dev/sda&#34;</span><span class="p">);</span> <span class="c1">// hard drive
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œæ•ˆæœ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">jungle@jungle-virtual-machine:~$ gcc tryopen.c <span class="o">&amp;&amp;</span> ./a.out
</span></span><span class="line"><span class="cl">open<span class="o">(</span><span class="s2">&#34;/something/not/exist&#34;</span><span class="o">)</span> returns -1
</span></span><span class="line"><span class="cl">  FAIL: No such file or directory
</span></span><span class="line"><span class="cl">open<span class="o">(</span><span class="s2">&#34;/dev/sda&#34;</span><span class="o">)</span> returns -1
</span></span><span class="line"><span class="cl">  FAIL: Permission denied
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="äºŒè¿›åˆ¶-ç¨‹åºä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿä¸­çš„å¯¹è±¡">(äºŒè¿›åˆ¶) ç¨‹åºä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿä¸­çš„å¯¹è±¡</h4>
<p>å¯æ‰§è¡Œæ–‡ä»¶</p>
<ul>
<li>ä¸å¤§å®¶æ—¥å¸¸ä½¿ç”¨çš„æ–‡ä»¶ (a.c, README.txt) æ²¡æœ‰æœ¬è´¨åŒºåˆ«</li>
<li>æ“ä½œç³»ç»Ÿæä¾› API æ‰“å¼€ã€è¯»å–ã€æ”¹å†™ (éƒ½éœ€è¦ç›¸åº”çš„æƒé™)</li>
</ul>
<hr>
<p>æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶</p>
<ul>
<li>
<p><code>vim</code>,<code>cat</code>,<code>xxd</code></p>
<p>éƒ½å¯ä»¥ç›´æ¥æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶</p>
<ul>
<li><code>vim</code> ä¸­äºŒè¿›åˆ¶çš„éƒ¨åˆ†æ— æ³• â€œé˜…è¯»â€ï¼Œä½†å¯ä»¥çœ‹åˆ°å­—ç¬¦ä¸²å¸¸é‡</li>
<li>ä½¿ç”¨ <code>xxd</code> å¯ä»¥çœ‹åˆ°æ–‡ä»¶ä»¥ <code>&quot;\x7f&quot; &quot;ELF&quot;</code> å¼€å¤´</li>
<li>vscode æœ‰ <code>binary editor</code> æ’ä»¶</li>
</ul>
</li>
</ul>
<h4 id="ç³»ç»Ÿä¸­å¸¸è§çš„åº”ç”¨ç¨‹åº">ç³»ç»Ÿä¸­å¸¸è§çš„åº”ç”¨ç¨‹åº</h4>
<p>Core Utilities (coreutils)</p>
<ul>
<li><em>standard</em> programs for text and file manipulation</li>
<li>ç³»ç»Ÿä¸­å®‰è£…çš„æ˜¯ <a href="https://www.gnu.org/software/coreutils/" target="_blank" rel="noopener noreffer">GNU Coreutils</a>
<ul>
<li>æœ‰è¾ƒå°çš„æ›¿ä»£å“ <a href="https://www.busybox.net/" target="_blank" rel="noopener noreffer">busybox</a></li>
</ul>
</li>
</ul>
<hr>
<p>ç³»ç»Ÿ/å·¥å…·ç¨‹åº</p>
<ul>
<li>
<p>bash,binutils, apt, ip, ssh, vim, tmux, jdk, python, &hellip;</p>
<ul>
<li>
<p>è¿™äº›å·¥å…·çš„åŸç†éƒ½ä¸å¤æ‚ (ä¾‹å¦‚ apt å…¶å®åªæ˜¯ dpkg çš„å£³)</p>
</li>
<li>
<p><a href="https://packages.ubuntu.com/" target="_blank" rel="noopener noreffer">Ubuntu Packages</a> (å’Œ apt-file å·¥å…·) æ”¯æŒæ–‡ä»¶åæ£€ç´¢</p>
<ul>
<li>ä¾‹å­ï¼šæ‰¾ä¸åˆ° <code>SDL2/SDL.h</code> æ—¶&hellip;</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p>å…¶ä»–å„ç§åº”ç”¨ç¨‹åº</p>
<ul>
<li>æµè§ˆå™¨ã€éŸ³ä¹æ’­æ”¾å™¨â€¦â€¦</li>
</ul>
<h4 id="æ“ä½œç³»ç»Ÿä¸­çš„ç¨‹åºdark-side">æ“ä½œç³»ç»Ÿä¸­çš„ç¨‹åºï¼šDark Side</h4>
<blockquote>
<p>æ€äººçš„é¢è¯•é¢˜ (1)ï¼šä¸€ä¸ªæ™®é€šçš„ã€äººç•œæ— å®³çš„ Hello World C ç¨‹åºæ‰§è¡Œçš„ç¬¬ä¸€æ¡æŒ‡ä»¤åœ¨å“ªé‡Œï¼Ÿ</p>
</blockquote>
<p>ç­‰ä»·é—®æ³•</p>
<ul>
<li>â€œäºŒè¿›åˆ¶ç¨‹åºçŠ¶æ€æœºçš„åˆå§‹çŠ¶æ€æ˜¯ä»€ä¹ˆï¼Ÿâ€
<ul>
<li><code>main</code> çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ âŒ</li>
<li><code>libc</code> çš„ <code>_start</code> âŒ</li>
</ul>
</li>
</ul>
<hr>
<p>é—® gdb å§</p>
<ul>
<li><code>info proc {mappings,...}</code> - æ‰“å°è¿›ç¨‹å†…å­˜</li>
</ul>
<p>ä½¿ç”¨<code>gdb</code></p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-13.png" title="/img/Operating System/chapter2-13.png" data-thumbnail="/img/Operating System/chapter2-13.png" data-sub-html="<h2>gdb(æŸ¥çœ‹å…¥å£)</h2>">
        
    </a><figcaption class="image-caption">gdb(<code>æŸ¥çœ‹å…¥å£</code>)</figcaption>
    </figure>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">0x00007ffff7fe32b0 in _start <span class="o">()</span> from /lib64/ld-linux-x86-64.so.2
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨<code>info proc mappings</code>å‘½ä»¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> info proc mappings 
</span></span><span class="line"><span class="cl">process <span class="m">48808</span>
</span></span><span class="line"><span class="cl">Mapped address spaces:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          Start Addr           End Addr       Size     Offset  Perms  objfile
</span></span><span class="line"><span class="cl">      0x555555554000     0x555555555000     0x1000        0x0  r--p   /home/jungle/a.out
</span></span><span class="line"><span class="cl">      0x555555555000     0x555555556000     0x1000     0x1000  r-xp   /home/jungle/a.out
</span></span><span class="line"><span class="cl">      0x555555556000     0x555555557000     0x1000     0x2000  r--p   /home/jungle/a.out
</span></span><span class="line"><span class="cl">      0x555555557000     0x555555559000     0x2000     0x2000  rw-p   /home/jungle/a.out
</span></span><span class="line"><span class="cl">      0x7ffff7fbd000     0x7ffff7fc1000     0x4000        0x0  r--p   <span class="o">[</span>vvar<span class="o">]</span>
</span></span><span class="line"><span class="cl">      0x7ffff7fc1000     0x7ffff7fc3000     0x2000        0x0  r-xp   <span class="o">[</span>vdso<span class="o">]</span>
</span></span><span class="line"><span class="cl">      0x7ffff7fc3000     0x7ffff7fc5000     0x2000        0x0  r--p   /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2
</span></span><span class="line"><span class="cl">      0x7ffff7fc5000     0x7ffff7fef000    0x2a000     0x2000  r-xp   /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2
</span></span><span class="line"><span class="cl">      0x7ffff7fef000     0x7ffff7ffa000     0xb000    0x2c000  r--p   /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2
</span></span><span class="line"><span class="cl">      0x7ffff7ffb000     0x7ffff7fff000     0x4000    0x37000  rw-p   /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2
</span></span><span class="line"><span class="cl">      0x7ffffffde000     0x7ffffffff000    0x21000        0x0  rw-p   <span class="o">[</span>stack<span class="o">]</span>
</span></span><span class="line"><span class="cl">  0xffffffffff600000 0xffffffffff601000     0x1000        0x0  --xp   <span class="o">[</span>vsyscall<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="main-ä¹‹å‰å‘ç”Ÿäº†ä»€ä¹ˆ"><code>main()</code> ä¹‹å‰å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h5>
<p><code>ld-linux-x86-64.so</code> åŠ è½½äº† libc</p>
<ul>
<li>ä¹‹å libc å®Œæˆäº†è‡ªå·±çš„åˆå§‹åŒ–
<ul>
<li>RTFM: <a href="https://www.gnu.org/software/hurd/glibc/startup.html" target="_blank" rel="noopener noreffer">libc startup</a> on Hurd</li>
<li><code>main()</code> çš„å¼€å§‹/ç»“æŸå¹¶ä¸æ˜¯æ•´ä¸ªç¨‹åºçš„å¼€å§‹/ç»“æŸ</li>
<li>ä¾‹å­ï¼š<a href="https://jyywiki.cn/pages/OS/2022/demos/hello-goodbye.c" target="_blank" rel="noopener noreffer">hello-goodbye.c</a></li>
</ul>
</li>
</ul>
<hr>
<p>è°è§„å®šæ˜¯ <code>ld-linux-x86-64.so</code>ï¼Œè€Œä¸æ˜¯ <code>rtfm.so</code>ï¼Ÿ</p>
<ul>
<li>readelf å‘Šè¯‰ä½ ç­”æ¡ˆ</li>
<li>(è®¡ç®—æœºç³»ç»Ÿä¸å­˜åœ¨ç„å­¦ï¼›ä¸€åˆ‡éƒ½å»ºç«‹åœ¨ç¡®å®šçš„æœºåˆ¶ä¸Š)
<ul>
<li>å›é¡¾ <code>gcc --verbose</code></li>
</ul>
</li>
</ul>
<p><code>hello-goodbye.c</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">__attribute__</span><span class="p">((</span><span class="n">constructor</span><span class="p">))</span> <span class="kt">void</span> <span class="n">hello</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello, World</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// See also: atexit(3)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">__attribute__</span><span class="p">((</span><span class="n">destructor</span><span class="p">))</span> <span class="kt">void</span> <span class="n">goodbye</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Goodbye, Cruel OS World!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><figure><a class="lightgallery" href="/img/Operating%20System/chapter2-14.png" title="/img/Operating System/chapter2-14.png" data-thumbnail="/img/Operating System/chapter2-14.png" data-sub-html="<h2>vim(æ±‡ç¼–ä»£ç )</h2>">
        
    </a><figcaption class="image-caption">vim(<code>æ±‡ç¼–ä»£ç </code>)</figcaption>
    </figure>
<p>åé¢è€å¸ˆhackeræ”¹äºŒè¿›åˆ¶ä»£ç çš„æ—¶å€™âœŒï¸çš„ğŸ‘€å·²ç»è·Ÿä¸ä¸Šäº†ï¼Œè„‘å­æ›´æ˜¯ç›´æ¥ğŸ’©ğŸ´</p>
<blockquote>
<p>æ€äººçš„é¢è¯•é¢˜ (2)ï¼šmain æ‰§è¡Œä¹‹å‰ã€æ‰§è¡Œä¸­ã€æ‰§è¡Œåï¼Œå‘ç”Ÿäº†å“ªäº›æ“ä½œç³»ç»Ÿ API è°ƒç”¨ï¼Ÿ</p>
</blockquote>
<hr>
<p>å‘ƒâ€¦â€¦</p>
<ul>
<li>(è®¡ç®—æœºç³»ç»Ÿä¸å­˜åœ¨ç„å­¦ï¼›ä¸€åˆ‡éƒ½å»ºç«‹åœ¨ç¡®å®šçš„æœºåˆ¶ä¸Š)</li>
<li>æ‰€ä»¥ä½ åº”è¯¥æœ‰ä¸€ä¸ªå¼ºçƒˆçš„ä¿¡å¿µï¼šè¿™ä¸ªé—®é¢˜æ˜¯å¯ä»¥å›ç­”çš„</li>
</ul>
<h4 id="æ‰“å¼€ç¨‹åºçš„æ‰§è¡Œtrace-è¸ªè¿¹">æ‰“å¼€ç¨‹åºçš„æ‰§è¡Œï¼šTrace (è¸ªè¿¹)</h4>
<blockquote>
<p>In general, trace refers to the process of following <em>anything</em> from the beginning to the end. For example, the <code>traceroute</code> command follows each of the network hops as your computer connects to another computer.</p>
</blockquote>
<p>è¿™é—¨è¯¾ä¸­å¾ˆé‡è¦çš„å·¥å…·ï¼šstrace</p>
<ul>
<li>system call trace</li>
<li>ç†è§£ç¨‹åºè¿è¡Œæ—¶ä½¿ç”¨çš„ç³»ç»Ÿè°ƒç”¨
<ul>
<li>demo: <code>strace ./hello-goodbye</code></li>
<li>åœ¨è¿™é—¨è¯¾ä¸­ï¼Œä½ èƒ½ç†è§£ strace çš„è¾“å‡ºå¹¶åœ¨ä½ è‡ªå·±çš„æ“ä½œç³»ç»Ÿé‡Œå®ç°ç›¸å½“ä¸€éƒ¨åˆ†ç³»ç»Ÿè°ƒç”¨ (mmap, execve, &hellip;)</li>
</ul>
</li>
</ul>
<p>ä½¿ç”¨<code>strace</code></p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-15.png" title="/img/Operating System/chapter2-15.png" data-thumbnail="/img/Operating System/chapter2-15.png" data-sub-html="<h2>linux(ä½¿ç”¨strace)</h2>">
        
    </a><figcaption class="image-caption">linux(<code>ä½¿ç”¨strace</code>)</figcaption>
    </figure>
<h4 id="æœ¬è´¨ä¸Šæ‰€æœ‰çš„ç¨‹åºå’Œ-hello-world-ç±»ä¼¼">æœ¬è´¨ä¸Šï¼Œæ‰€æœ‰çš„ç¨‹åºå’Œ Hello World ç±»ä¼¼</h4>
<p>ç¨‹åº = çŠ¶æ€æœº = è®¡ç®— â†’ syscall â†’ è®¡ç®— â†’</p>
<ul>
<li>
<p>è¢«æ“ä½œç³»ç»ŸåŠ è½½</p>
<ul>
<li>é€šè¿‡å¦ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œ execve è®¾ç½®ä¸ºåˆå§‹çŠ¶æ€</li>
</ul>
</li>
<li>
<p>çŠ¶æ€æœºæ‰§è¡Œ</p>
<ul>
<li>è¿›ç¨‹ç®¡ç†ï¼šfork, execve, exit, &hellip;</li>
<li>æ–‡ä»¶/è®¾å¤‡ç®¡ç†ï¼šopen, close, read, write, &hellip;</li>
<li>å­˜å‚¨ç®¡ç†ï¼šmmap, brk, &hellip;</li>
</ul>
</li>
<li>
<p>ç›´åˆ° _exit (exit_group) é€€å‡º</p>
</li>
</ul>
<hr>
<ul>
<li>è¯´å¥½çš„æµè§ˆå™¨ã€æ¸¸æˆã€æ€æ¯’è½¯ä»¶ã€ç—…æ¯’å‘¢ï¼Ÿéƒ½æ˜¯è¿™äº› API å—ï¼ŸğŸ’¢ğŸ’¢ğŸ’¢(éƒ½æ˜¯) $\rightarrow$ğŸ®ğŸº</li>
</ul>
<h4 id="yes---è¿™äº›-api-å°±æ˜¯æ“ä½œç³»ç»Ÿçš„å…¨éƒ¨">Yes! - è¿™äº› API å°±æ˜¯æ“ä½œç³»ç»Ÿçš„å…¨éƒ¨</h4>
<p>ç¼–è¯‘å™¨ (gcc)ï¼Œä»£è¡¨å…¶ä»–å·¥å…·ç¨‹åº</p>
<ul>
<li>
<p>ä¸»è¦çš„ç³»ç»Ÿè°ƒç”¨ï¼šexecve, read, write</p>
</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">strace -f gcc a.c
</span></span></code></pre></td></tr></table>
</div>
</div><p>(gcc ä¼šå¯åŠ¨å…¶ä»–è¿›ç¨‹)</p>
<ul>
<li>å¯ä»¥ç®¡é“ç»™ç¼–è¾‘å™¨ <code>vim -</code></li>
<li>ç¼–è¾‘å™¨é‡Œè¿˜å¯ä»¥ <code>%!grep</code> (ç»†èŠ‚/æŠ€å·§)</li>
</ul>
</li>
</ul>
<hr>
<p>å›¾å½¢ç•Œé¢ç¨‹åº (xedit)ï¼Œä»£è¡¨å…¶ä»–å›¾å½¢ç•Œé¢ç¨‹åº (ä¾‹å¦‚ vscode)</p>
<ul>
<li>
<p>ä¸»è¦çš„ç³»ç»Ÿè°ƒç”¨ï¼špoll, recvmsg, writev</p>
</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">strace xedit
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å›¾å½¢ç•Œé¢ç¨‹åºå’Œ X-Window æœåŠ¡å™¨æŒ‰ç…§ X11 åè®®é€šä¿¡</li>
<li>è™šæ‹Ÿæœºä¸­çš„ <code>xedit</code> å°† <code>X11</code> å‘½ä»¤é€šè¿‡<code>ssh</code>(X11 forwarding) è½¬å‘åˆ° Host</li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-16.png" title="/img/Operating System/chapter2-16.png" data-thumbnail="/img/Operating System/chapter2-16.png" data-sub-html="<h2>strace(xedit)</h2>">
        
    </a><figcaption class="image-caption">strace(<code>xedit</code>)</figcaption>
    </figure>
<h4 id="å„å¼å„æ ·çš„åº”ç”¨ç¨‹åº">å„å¼å„æ ·çš„åº”ç”¨ç¨‹åº</h4>
<p>éƒ½åœ¨æ“ä½œç³»ç»Ÿ API (syscall) å’Œæ“ä½œç³»ç»Ÿä¸­çš„å¯¹è±¡ä¸Šæ„å»º</p>
<ul>
<li>çª—å£ç®¡ç†å™¨
<ul>
<li>ç®¡ç†è®¾å¤‡å’Œå±å¹• (read/write/mmap)</li>
<li>è¿›ç¨‹é—´é€šä¿¡ (send, recv)</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>ä»»åŠ¡ç®¡ç†å™¨
<ul>
<li>è®¿é—®æ“ä½œç³»ç»Ÿæä¾›çš„è¿›ç¨‹å¯¹è±¡ (readdir/read)</li>
<li>å‚è€ƒ gdb é‡Œçš„ <code>info proc *</code></li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>æ€æ¯’è½¯ä»¶
<ul>
<li>æ–‡ä»¶é™æ€æ‰«æ (read)</li>
<li>ä¸»åŠ¨é˜²å¾¡ (ptrace)</li>
<li>å…¶ä»–æ›´å¤æ‚çš„å®‰å…¨æœºåˆ¶â€¦â€¦</li>
</ul>
</li>
</ul>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜</p>
<ul>
<li><strong>Q</strong>: åˆ°åº•ä»€ä¹ˆæ˜¯ â€œç¨‹åºâ€ï¼Ÿ</li>
</ul>
<hr>
<p>$Take-away\ message\newline$</p>
<ul>
<li>ç¨‹åº = çŠ¶æ€æœº
<ul>
<li>æºä»£ç  S: çŠ¶æ€è¿ç§» = æ‰§è¡Œè¯­å¥</li>
<li>äºŒè¿›åˆ¶ä»£ç  C: çŠ¶æ€è¿ç§» = æ‰§è¡ŒæŒ‡ä»¤</li>
<li>ç¼–è¯‘å™¨ $C=compile(S)\newline$</li>
</ul>
</li>
<li>åº”ç”¨è§†è§’çš„æ“ä½œç³»ç»Ÿ
<ul>
<li>å°±æ˜¯ä¸€æ¡ <code>syscall</code> æŒ‡ä»¤</li>
</ul>
</li>
<li>è®¡ç®—æœºç³»ç»Ÿä¸å­˜åœ¨ç„å­¦ï¼›ä¸€åˆ‡éƒ½å»ºç«‹åœ¨ç¡®å®šçš„æœºåˆ¶ä¸Š
<ul>
<li>ç†è§£æ“ä½œç³»ç»Ÿçš„é‡è¦å·¥å…·ï¼š<code>gcc</code>, <code>binutils</code>, <code>gdb</code>, <code>strace</code></li>
</ul>
</li>
</ul>
<h3 id="ä¸ªäººçš„ä¸€äº›è¡¥å……">ä¸ªäººçš„ä¸€äº›è¡¥å……</h3>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Update<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="typeit"><div id="id-3" class=""></div></div>
</div>
        </div>
    </div>
<p>æ–°å­¦æœŸå¼€è¯¾ï¼Œä¹Ÿä¸Šäº†æ“ä½œç³»ç»Ÿï¼Œå½“ç„¶ï¼Œè€å¸ˆå¿µpptè®²çš„ä¹Ÿç¡®å®æ˜¯ğŸ’©ğŸ´åœ°å¬ä¸æ‡‚ï¼Œä»Šæ™šåšä½œä¸šï¼Œå…¶ä¸­ä¹Ÿæœ‰æœ‰å…³<b>System call</b>çš„ä¸€äº›ç›¸å…³é—®é¢˜ï¼Œäºæ˜¯å†™äº†ä¸€ä¸ªæœ€ç®€å•çš„Cç¨‹åº</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åç”¨gdbè°ƒè¯•äº†ä¸€ä¸‹</p>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter2-17.png" title="/img/Operating System/chapter2-17.png" data-thumbnail="/img/Operating System/chapter2-17.png" data-sub-html="<h2>gdb $\Longrightarrow$ layout asm</h2>">
        
    </a><figcaption class="image-caption">gdb $\Longrightarrow$ <code>layout asm</code></figcaption>
    </figure>
<p>å¿½ç„¶å¯¹å‰é¢è¿™äº›æŒ‡ä»¤çš„è°ƒç”¨æœ‰äº†äº›å…´è¶£ï¼Œ&lt;_do_global_dtors_aux&gt;æ˜¯ä¸ªå•¥ï¼Ÿ&lt;frame_dummy&gt;åˆæ˜¯ä¸ªå•¥ï¼Œç»“æœç”¨è¿™äº›åå­—æ‰¾åˆ°äº†ä¸€ä¸ªè®²çš„éå¸¸ç»†çš„åšå®¢<a href="https://luomuxiaoxiao.com/?p=516" target="_blank" rel="noopener noreffer">ã€ŠLinux X86 ç¨‹åºå¯åŠ¨ â€“ mainå‡½æ•°æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„ï¼Ÿâ€”â€”è½æœ¨è§è§çš„åšå®¢ã€‹</a>ï¼Œä¸è¿‡å†…å®¹çœŸçš„æ˜¯å¤ªå¤šäº†ï¼Œå…ˆç«‹ä¸€ä¸ªflagï¼Œè¿™ä¸¤å‘¨ä¸€å®šè¦æ‰¾æ—¶é—´ç»™è¯»ä¸€éï¼Œå®Œä¸æˆå°±å…¨éƒ¨ğŸ’©ğŸ´</p>
<hr>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Update<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="typeit"><div id="id-4" class=""></div></div>
</div>
        </div>
    </div>
<p>çœ‹äº†ä¸€éƒ¨åˆ†è¯¥æ–‡ç« ï¼Œå¤ªé•¿äº†ï¼Œå…ˆçœ‹ä¸€å°åŠï¼Œå› ä¸ºæ˜¯32ä½çš„è€ç‰ˆæœ¬Linuxï¼Œå¾ˆå¤šä¸œè¥¿ä¸èƒ½å®Œå…¨å¤ç°</p>
<p>$\Longrightarrow$ <a href="https://jungle430.github.io/posts/operating-system/support2/" target="_blank" rel="noopener noreffer">ã€ŠLinux x86 Program Start Up or - How the heck do we get to main()?ã€‹</a></p>
<p><b>å£°æ˜ï¼šæœ¬æ–‡ç« å¼•ç”¨èµ„æ–™ä¸å›¾åƒå‡å·²åšæ ‡æ³¨ï¼Œå¦‚æœ‰ä¾µæƒæœ¬äººä¼šé©¬ä¸Šåˆ é™¤</b></p>
]]></description>
</item>
<item>
    <title>Operating System Chapter1 æ“ä½œç³»ç»Ÿæ¦‚è¿°</title>
    <link>https://Jungle430.github.io/posts/operating-system/operating-system-chapter1/</link>
    <pubDate>Fri, 30 Dec 2022 16:27:09 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/operating-system/operating-system-chapter1/</guid>
    <description><![CDATA[<h1 id="operating-system">Operating System</h1>
<p>$Nanjing\ University\rightarrow Yanyan\ Jiang\newline$</p>
<h2 id="æ“ä½œç³»ç»Ÿæ¦‚è¿°">æ“ä½œç³»ç»Ÿæ¦‚è¿°</h2>
<p>$Overvier\newline$</p>
<ul>
<li>ä¸ºä»€ä¹ˆè¦å­¦æ“ä½œç³»ç»Ÿ? $(why)\newline$</li>
<li>åˆ°åº•ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿ? $(what)\newline$</li>
<li>æ€ä¹ˆå­¦æ“ä½œç³»ç»Ÿ? $(how)\newline$</li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆå­¦æ“ä½œç³»ç»Ÿwhynewline">ä¸ºä»€ä¹ˆå­¦æ“ä½œç³»ç»Ÿ?$(why)\newline$</h3>
<ul>
<li>
<p>æ¯å¤©éƒ½åœ¨ç”¨çš„ä¸œè¥¿ä½ æ²¡ææ˜ç™½ $\rightarrow$ çª—å£æ˜¯æ€ä¹ˆåˆ›å»ºçš„ï¼Ÿ ä¸ºä»€ä¹ˆ$Ctrl-C$æœ‰æ—¶ä¸èƒ½é€€å‡ºç¨‹åºï¼Ÿ</p>
</li>
<li>
<p>ç»„é‡Œçš„æœåŠ¡å™¨æœ‰128ä¸ªå¤„ç†å™¨ï¼Œè€Œä½ çš„ç¨‹åºå´åªèƒ½ç”¨ä¸€ä¸ª ğŸ˜‚</p>
</li>
<li>
<p>ä½ æ¯å¤©éƒ½åœ¨ç”¨çš„ä¸œè¥¿ï¼Œå´å®ç°ä¸å‡ºæ¥ğŸ¤¡ $\rightarrow$ æµè§ˆå™¨ï¼Œç¼–è¯‘å™¨ï¼Œ$IDE$ï¼Œæ¸¸æˆ/å¤–æŒ‚ï¼Œä»»åŠ¡ç®¡ç†å™¨ï¼Œæ€æ¯’è½¯ä»¶ï¼Œç—…æ¯’â€¦</p>
</li>
</ul>
<p>å­¦å®Œï¼š</p>
<p>æ‚Ÿæ€§å¥½ $\rightarrow$ ç³»ç»Ÿæ–¹å‘â€œæ¯•ä¸šâ€ï¼Œå…·æœ‰ç¼–å†™ä¸€åˆ‡â€œèƒ½å†™å‡ºæ¥â€ç¨‹åºçš„èƒ½åŠ›ï¼ˆå…·å¤‡é˜…è¯»è®ºæ–‡çš„èƒ½åŠ›ï¼‰</p>
<p>æ‚Ÿæ€§å·® $\rightarrow$ å†…åŠ›å¤§å¢ï¼Œ å¯èƒ½åœ¨å·¥ä½œä¸­çš„æŸä¸€å¤©æƒ³èµ·ä¸Šè¯¾çš„å†…å®¹</p>
<h3 id="ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿwhatnewline">ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿ?$(what)\newline$</h3>
<blockquote>
<p>Operating System: A body of software, in fact, that is responsible for <em>making it easy to run programs</em> (even allowing you to seemingly run many at the same time), allowing programs to share memory, enabling programs to interact with devices, and other fun stuff like that. (OSTEP)</p>
</blockquote>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-1.png" title="/img/Operating System/chapter1-1.png" data-thumbnail="/img/Operating System/chapter1-1.png" data-sub-html="<h2>From PPT(ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Ÿ)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Ÿ</code>)</figcaption>
    </figure>
<p>Question:æ“ä½œç³»ç»Ÿå¦‚ä½•ä»ä¸€å¼€å§‹å˜æˆç°åœ¨è¿™æ ·çš„ï¼Ÿ</p>
<p>$\rightarrow$ ä¸‰ä¸ªé‡è¦çš„çº¿ç´¢</p>
<blockquote>
<p>è®¡ç®—æœºï¼ˆç¡¬ä»¶ï¼‰</p>
<p>ç¨‹åºï¼ˆè½¯ä»¶ï¼‰</p>
<p>æ“ä½œç³»ç»Ÿï¼ˆç®¡ç†è½¯ä»¶çš„è½¯ä»¶ï¼‰</p>
</blockquote>
<h4 id="æ“ä½œç³»ç»Ÿå†å²">æ“ä½œç³»ç»Ÿå†å²</h4>
<h5 id="1940s">1940s</h5>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-2.png" title="/img/Operating System/chapter1-2.png" data-thumbnail="/img/Operating System/chapter1-2.png" data-sub-html="<h2>From PPT(1940s 1)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>1940s 1</code>)</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-3.jpg" title="/img/Operating System/chapter1-3.jpg" data-thumbnail="/img/Operating System/chapter1-3.jpg" data-sub-html="<h2>From PPT(1940s 2)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>1940s 2</code>)</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-4.jpg" title="/img/Operating System/chapter1-4.jpg" data-thumbnail="/img/Operating System/chapter1-4.jpg" data-sub-html="<h2>From PPT(1940s 3)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>1940s 3</code>)</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-5.png" title="/img/Operating System/chapter1-5.png" data-thumbnail="/img/Operating System/chapter1-5.png" data-sub-html="<h2>From PPT(1940s 4)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>1940s 4</code>)</figcaption>
    </figure>
<h5 id="1950s">1950s</h5>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-6.png" title="/img/Operating System/chapter1-6.png" data-thumbnail="/img/Operating System/chapter1-6.png" data-sub-html="<h2>From PPT(1950s 1)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>1950s 1</code>)</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-7.png" title="/img/Operating System/chapter1-7.png" data-thumbnail="/img/Operating System/chapter1-7.png" data-sub-html="<h2>From PPT(1950s 2)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>1950s 2</code>)</figcaption>
    </figure>
<p>Example code on ppt</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fortran" data-lang="fortran"><span class="line"><span class="cl"><span class="n">C</span><span class="o">----</span><span class="w"> </span><span class="n">THIS</span><span class="w"> </span><span class="k">PROGRAM </span><span class="n">READS</span><span class="w"> </span><span class="n">INPUT</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">CARD</span><span class="w"> </span><span class="n">READER</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">C</span><span class="o">----</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">INTEGERS</span><span class="w"> </span><span class="n">IN</span><span class="w"> </span><span class="n">EACH</span><span class="w"> </span><span class="n">CARD</span><span class="p">,</span><span class="w"> </span><span class="n">CALCULATE</span><span class="w"> </span><span class="nb">AND </span><span class="n">OUTPUT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">C</span><span class="o">----</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="nb">SUM </span><span class="n">OF</span><span class="w"> </span><span class="n">THEM</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="mi">100</span><span class="w"> </span><span class="k">READ</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="n">I1</span><span class="p">,</span><span class="w"> </span><span class="n">I2</span><span class="p">,</span><span class="w"> </span><span class="n">I3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="mi">10</span><span class="w"> </span><span class="k">FORMAT</span><span class="p">(</span><span class="mi">3</span><span class="n">I5</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">I1</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">I2</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">I3</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">200</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">ISUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">I2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">I3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="n">I1</span><span class="p">,</span><span class="w"> </span><span class="n">I2</span><span class="p">,</span><span class="w"> </span><span class="n">I3</span><span class="p">,</span><span class="w"> </span><span class="n">ISUM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="mi">20</span><span class="w"> </span><span class="k">FORMAT</span><span class="p">(</span><span class="mi">7</span><span class="n">HSUM</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">I5</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="n">H</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">I5</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="n">H</span><span class="w"> </span><span class="nb">AND</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">I5</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="o">*</span><span class="w">   </span><span class="mi">4</span><span class="n">H</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">I6</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">100</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="mi">200</span><span class="w"> </span><span class="k">STOP
</span></span></span><span class="line"><span class="cl"><span class="k">      END</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><figure><a class="lightgallery" href="/img/Operating%20System/chapter1-8.png" title="/img/Operating System/chapter1-8.png" data-thumbnail="/img/Operating System/chapter1-8.png" data-sub-html="<h2>From PPT(1950s 3)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>1950s 3</code>)</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-9.png" title="/img/Operating System/chapter1-9.png" data-thumbnail="/img/Operating System/chapter1-9.png" data-sub-html="<h2>From PPT(1950s 4)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>1950s 4</code>)</figcaption>
    </figure>
<h5 id="1960s">1960s</h5>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-10.png" title="/img/Operating System/chapter1-10.png" data-thumbnail="/img/Operating System/chapter1-10.png" data-sub-html="<h2>From PPT(1960s 1)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>1960s 1</code>)</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-11.png" title="/img/Operating System/chapter1-11.png" data-thumbnail="/img/Operating System/chapter1-11.png" data-sub-html="<h2>From PPT(1960s 2)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>1960s 2</code>)</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-12.png" title="/img/Operating System/chapter1-12.png" data-thumbnail="/img/Operating System/chapter1-12.png" data-sub-html="<h2>From PPT(1960s 3)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>1960s 3</code>)</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-13.png" title="/img/Operating System/chapter1-13.png" data-thumbnail="/img/Operating System/chapter1-13.png" data-sub-html="<h2>From PPT(1960s 4)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>1960s 4</code>)</figcaption>
    </figure>
<h5 id="1970s">1970s+</h5>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-14.png" title="/img/Operating System/chapter1-14.png" data-thumbnail="/img/Operating System/chapter1-14.png" data-sub-html="<h2>From PPT(1970s&#43; 1)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>1970s+ 1</code>)</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-15.png" title="/img/Operating System/chapter1-15.png" data-thumbnail="/img/Operating System/chapter1-15.png" data-sub-html="<h2>From PPT(1970s&#43; 2)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>1970s+ 2</code>)</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-16.png" title="/img/Operating System/chapter1-16.png" data-thumbnail="/img/Operating System/chapter1-16.png" data-sub-html="<h2>From PPT(1970s&#43; 3)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>1970s+ 3</code>)</figcaption>
    </figure>
<h5 id="today">today</h5>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-17.png" title="/img/Operating System/chapter1-17.png" data-thumbnail="/img/Operating System/chapter1-17.png" data-sub-html="<h2>From PPT(today)</h2>">
        
    </a><figcaption class="image-caption">From PPT(<code>today</code>)</figcaption>
    </figure>
<h4 id="ç†è§£æ“ä½œç³»ç»Ÿä¸‰ä¸ªæ ¹æœ¬é—®é¢˜">ç†è§£æ“ä½œç³»ç»Ÿï¼šä¸‰ä¸ªæ ¹æœ¬é—®é¢˜</h4>
<p>æ“ä½œç³»ç»ŸæœåŠ¡è°ï¼Ÿ</p>
<ul>
<li><strong>ç¨‹åº = çŠ¶æ€æœº</strong></li>
<li>è¯¾ç¨‹æ¶‰åŠï¼šå¤šçº¿ç¨‹ $Linux$ åº”ç”¨ç¨‹åº</li>
</ul>
<hr>
<p>(è®¾è®¡/åº”ç”¨è§†è§’) æ“ä½œç³»ç»Ÿä¸ºç¨‹åºæä¾›ä»€ä¹ˆæœåŠ¡ï¼Ÿ</p>
<ul>
<li><strong>æ“ä½œç³»ç»Ÿ = å¯¹è±¡ + $API\newline$</strong></li>
<li>è¯¾ç¨‹æ¶‰åŠï¼š$POSIX$ + éƒ¨åˆ†$ Linux$ ç‰¹æ€§</li>
</ul>
<hr>
<p>(å®ç°/ç¡¬ä»¶è§†è§’) å¦‚ä½•å®ç°æ“ä½œç³»ç»Ÿæä¾›çš„æœåŠ¡ï¼Ÿ</p>
<ul>
<li><strong>æ“ä½œç³»ç»Ÿ = C ç¨‹åº</strong>
<ul>
<li>å®Œæˆåˆå§‹åŒ–åå°±æˆä¸º $interrupt/trap/fault handler\newline$</li>
</ul>
</li>
<li>è¯¾ç¨‹æ¶‰åŠï¼š$xv6$, è‡ªåˆ¶è¿·ä½ æ“ä½œç³»ç»Ÿ</li>
</ul>
<h3 id="æ€ä¹ˆå­¦æ“ä½œç³»ç»Ÿhownewline">æ€ä¹ˆå­¦æ“ä½œç³»ç»Ÿ?$(how)\newline$</h3>
<ol>
<li>æ˜¯ä¸€ä¸ªåˆæ ¼çš„æ“ä½œç³»ç»Ÿç”¨æˆ·
<ul>
<li>ä¼š $STFW/RTFM$ è‡ªå·±åŠ¨æ‰‹è§£å†³é—®é¢˜</li>
<li>ä¸æ€•ä½¿ç”¨ä»»ä½•å‘½ä»¤è¡Œå·¥å…·
<ul>
<li>$vim, tmux, grep, gcc, binutils, &hellip;\newline$</li>
</ul>
</li>
</ul>
</li>
<li>ä¸æƒ§æ€•å†™ä»£ç 
<ul>
<li>èƒ½ç®¡ç†ä¸€å®šè§„æ¨¡ (æ•°åƒè¡Œ) çš„ä»£ç </li>
<li>èƒ½åœ¨å‡º bug æ—¶é»˜å¿µ â€œæœºå™¨æ°¸è¿œæ˜¯å¯¹çš„ã€æˆ‘è‚¯å®šèƒ½è°ƒå‡ºæ¥çš„â€
<ul>
<li>ç„¶åå¼€å§‹ç”¨æ­£ç¡®çš„å·¥å…·/æ–¹æ³•è°ƒè¯•</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>å†™ä»£ç  = åˆ›é€ æœ‰è¶£çš„ä¸œè¥¿</p>
<ul>
<li>å‘½ä»¤è¡Œ + æµè§ˆå™¨å°±æ˜¯ä¸–ç•Œ</li>
</ul>
<p>æ•™ç§‘ä¹¦:</p>
<p>Remzi&rsquo;s <a href="https://pages.cs.wisc.edu/~remzi/OSTEP/" target="_blank" rel="noopener noreffer">Operating Systems: Three Easy Pieces</a></p>
<p>é¡ºåºï¼šå¹¶å‘ â†’ è™šæ‹ŸåŒ– â†’ æŒä¹…åŒ–</p>
<h3 id="ä¸ªäººè¡¥å……è€ƒè¯•ç”¨">ä¸ªäººè¡¥å……ï¼ˆè€ƒè¯•ç”¨ï¼‰</h3>
<blockquote>
<p>Update in 2023-03-02 åˆæ˜¯ğŸ¤¡+ğŸ’©ğŸ´çš„ä¸€å¤©</p>
<p>PPTä¸Šé¢è®²äº†ä¸ªğŸ”8ï¸âƒ£ï¼ŒçœŸæ˜¯ç»™âœŒï¸æ•´æ— è¯­äº†ï¼Œåˆæ²¡çœ‹æ‡‚ï¼Œçœ‹ç‚¹ä¹¦å§</p>
<p>2023-03-03 0:10 ğŸ¤¡åŠå¤œçœ‹ä¹¦ï¼Œç¡®å®æ˜¯æœ‰ğŸ…±ï¸<b>IG</b>ğŸ§Šäº†</p>
</blockquote>
<ul>
<li>è®¡ç®—æœºç³»ç»Ÿè‡ªä¸Šè€Œä¸‹å¯å¤§è‡´åˆ†æˆå››ä¸ªéƒ¨åˆ†ï¼š<b>ç¡¬ä»¶ï¼Œæ“ä½œç³»ç»Ÿï¼Œåº”ç”¨ç¨‹åºå’Œç”¨æˆ·</b>ï¼ˆå’Œè®¡ç»„çš„åˆ†å±‚ä¸ä¸€æ ·ï¼‰</li>
</ul>
<h4 id="æ“ä½œç³»ç»Ÿçš„ç‰¹å¾">æ“ä½œç³»ç»Ÿçš„ç‰¹å¾</h4>
<h5 id="å¹¶å‘concurrence">å¹¶å‘(<code>Concurrence</code>)</h5>
<p>å¹¶å‘æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨<b>åŒä¸€æ—¶é—´é—´éš”å†…å‘ç”Ÿ</b>ã€‚æ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§æ˜¯æŒ‡è®¡ç®—æœºç³»ç»Ÿä¸­åŒæ—¶å­˜åœ¨å¤šä¸ªè¿è¡Œçš„ç¨‹åºï¼Œå› æ­¤å®ƒå…·æœ‰å¤„ç†å’Œè°ƒåº¦å¤šä¸ªç¨‹åºåŒæ—¶æ‰§è¡Œçš„èƒ½åŠ›ã€‚<u>å¼•å…¥è¿›ç¨‹çš„ç›®çš„æ˜¯ä½¿ç¨‹åºèƒ½å¹¶å‘æ‰§è¡Œ</u></p>
<ul>
<li>
<p><b>æ³¨æ„åŒºåˆ†åŒä¸€æ—¶é—´é—´éš”ï¼ˆå¹¶å‘ï¼‰å’ŒåŒä¸€æ—¶åˆ»ï¼ˆå¹¶è¡Œï¼‰çš„åŒºåˆ«ã€‚</b></p>
<ul>
<li>
<p>åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œä¸€æ®µæ—¶é—´å†…ï¼Œå®è§‚ä¸Šæœ‰å¤šé“ç¨‹åºåœ¨åŒæ—¶æ‰§è¡Œï¼Œè€Œæ¯ä¸ªæ—¶åˆ»ï¼Œ<b>å•å¤„ç†æœº</b>ç¯å¢ƒä¸‹å®é™…ä»…èƒ½æœ‰ä¸€é“ç¨‹åºæ‰§è¡Œï¼Œ<u>å› æ­¤å¾®è§‚ä¸Šè¿™äº›ç¨‹åºä»æ˜¯åˆ†æ—¶äº¤æ›¿æ‰§è¡Œçš„</u>ã€‚<b>æ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§æ˜¯é€šè¿‡åˆ†æ—¶å¾—ä»¥å®ç°çš„</b>ã€‚</p>
</li>
<li>
<p><b>å¹¶è¡Œæ€§æ˜¯æŒ‡ç³»ç»Ÿå…·æœ‰åŒæ—¶è¿›è¡Œè¿ç®—æˆ–æ“ä½œçš„ç‰¹æ€§ï¼Œåœ¨åŒä¸€æ—¶åˆ»èƒ½å®Œæˆä¸¤ç§æˆ–ä¸¤ç§ä»¥ä¸Šçš„å·¥ä½œ</b>ã€‚<u>å¹¶è¡Œæ€§éœ€è¦æœ‰ç›¸å…³ç¡¬ä»¶çš„æ”¯æŒï¼Œå¦‚å¤šæµæ°´çº¿æˆ–å¤šå¤„ç†æœºç¡¬ä»¶ç¯å¢ƒ</u></p>
</li>
<li>
<p>ä¾‹å­ï¼š</p>
<ul>
<li>å¹¶å‘æ‰§è¡Œï¼šåƒååˆ†é’Ÿé¢åŒ…ï¼ˆå°±åƒé¢åŒ…ï¼‰ $\Longrightarrow$ å†™ååˆ†é’Ÿå­—ï¼ˆå°±å†™å­—ï¼‰ $\Longrightarrow$ åƒååˆ†é’Ÿé¢åŒ…ï¼ˆå°±åƒé¢åŒ…ï¼‰$\Longrightarrow$ $\dots$ ï¼ˆå®è§‚ä¸Šä¸€èµ·åšå¾®è§‚ä¸Šåˆ†ç€åšï¼‰</li>
<li>å¹¶è¡Œæ‰§è¡Œï¼šå·¦æ‰‹æ‹¿ç€é¢åŒ…åƒï¼Œå³æ‰‹å†™å­—ï¼ˆå®è§‚å’Œå¾®è§‚éƒ½æ˜¯åŒæ—¶åšï¼‰</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h5 id="å…±äº«sharing">å…±äº«(<code>Sharing</code>)</h5>
<p>æŒ‡ç³»ç»Ÿä¸­çš„èµ„æºå¯ä¾›å†…å­˜ä¸­<u>å¤šä¸ªå¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹å…±åŒä½¿ç”¨</u>ã€‚å¯åˆ†ä¸ºä¸¤ç§æ–¹å¼</p>
<ul>
<li>
<p>äº’æ–¥å…±äº«æ–¹å¼</p>
<ul>
<li>ç³»ç»Ÿä¸­çš„æŸäº›èµ„æºï¼Œå¦‚æ‰“å°æœºï¼Œç£å¸¦æœºï¼Œ<u>è™½ç„¶å¯ä¾›å¤šä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œä½†ä¸ºä½¿å¾—æ‰€æ‰“å°æˆ–è®°å½•çš„ç»“æœä¸è‡´é€ æˆæ··æ·†ï¼Œåº”è§„å®šåœ¨<b>ä¸€ä¸ªæ—¶é—´æ®µå†…åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®æ­¤èµ„æº</b></u>
<ul>
<li>ä¸ºæ­¤ï¼Œ<u>å½“è¿›ç¨‹Aè®¿é—®æŸä¸ªèµ„æºæ—¶ï¼Œå¿…é¡»å…ˆæå‡ºè¯·æ±‚</u>ï¼Œè‹¥æ­¤æ—¶èµ„æºç©ºé—²ï¼Œåˆ™ç³»ç»Ÿä¾¿å°†ä¹‹åˆ†é…ç»™è¿›ç¨‹Aä½¿ç”¨ï¼Œ<b>æ­¤ååˆå…¶ä»–è¿›ç¨‹å¯¹è¯¥èµ„æºè¿›è¡Œè®¿é—®ï¼ˆåªè¦Aæœªç”¨å®Œï¼‰å°±å¿…é¡»ç­‰å¾…</b>ã€‚<u>ä»…å½“è¿›ç¨‹Aè®¿é—®å®Œå¹¶é‡Šæ”¾è¯¥èµ„æºåï¼Œæ‰å…è®¸å¦ä¸€ä¸ªè¿›ç¨‹å¯¹è¯¥èµ„æºè¿›è¡Œè®¿é—®</u>ã€‚è¿™ç§èµ„æºè®¿é—®æ–¹å¼å°±å«<b>äº’æ–¥å¼å…±äº«</b>ï¼ŒæŠŠ<u>åœ¨ä¸€æ®µæ—¶é—´å†…åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®çš„èµ„æºç§°ä¸º<b>ä¸´ç•Œèµ„æº</b></u>ã€‚</li>
<li><b>è®¡ç®—æœºç³»ç»Ÿä¸­çš„å¤§å¤šæ•°ç‰©ç†è®¾å¤‡åŠæŸäº›è½¯ä»¶ä¸­æ‰€ç”¨çš„æ ˆï¼Œå˜é‡å’Œè¡¨æ ¼ï¼Œéƒ½å±äºä¸´ç•Œèµ„æºï¼Œå®ƒä»¬éƒ½è¦æ±‚è¢«äº’æ–¥åœ°å…±äº«</b>ã€‚</li>
<li><u>äº’æ–¥å…±äº«çš„æ–¹å¼è¦æ±‚ä¸€ç§èµ„æºåœ¨ä¸€æ®µæ—¶é—´å†…ï¼ˆå“ªæ€•æ˜¯ä¸€æ®µå¾ˆå°çš„æ—¶é—´ï¼‰åªèƒ½æ»¡è¶³ä¸€ä¸ªè¯·æ±‚ï¼Œå¦åˆ™å°±ä¼šå‡ºç°ä¸¥é‡çš„é—®é¢˜</u>ï¼Œï¼ˆæ¯”å¦‚æ‰“å°æœºç¬¬ä¸€è¡Œæ‰“çš„æ˜¯A fileçš„å†…å®¹ï¼Œç¬¬äºŒè¡Œæ‰“çš„æ˜¯B fileçš„å†…å®¹ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p>åŒæ—¶è®¿é—®æ–¹å¼</p>
<ul>
<li>ç³»ç»Ÿä¸­è¿˜æœ‰å¦ä¸€ç±»èµ„æºï¼Œè¿™ç±»èµ„æºå…è®¸åœ¨ä¸€æ®µæ—¶é—´å†…ç”±å¤šä¸ªè¿›ç¨‹â€åŒæ—¶â€œè®¿é—®ã€‚<b>è¿™é‡Œæ‰€è¯´çš„â€åŒæ—¶â€œé€šå¸¸æ˜¯å®è§‚ä¸Šçš„ï¼Œè€Œåœ¨â€å¾®è§‚â€œä¸Šï¼Œè¿™äº›è¿›ç¨‹å¯èƒ½æ˜¯äº¤æ›¿åœ°å¯¹è¯¥èµ„æºè¿›è¡Œè®¿é—®å³â€åˆ†æ—¶å…±äº«â€œçš„</b>ã€‚<u>å¯ä¾›å¤šä¸ªè¿›ç¨‹â€åŒæ—¶â€œè®¿é—®çš„å…¸å‹èµ„æºå°±æ˜¯ç£ç›˜è®¾å¤‡ï¼Œä¸€äº›ç”¨é‡å…¥ç ç¼–å†™çš„æ–‡ä»¶ä¹Ÿå¯è¢«â€åŒæ—¶â€œå…±äº«ï¼Œå³å…è®¸è‹¥å¹²ä¸ªç”¨æˆ·åŒæ—¶è®¿é—®è¯¥æ–‡ä»¶</u>ã€‚</li>
<li>åŒæ—¶è®¿é—®å…±äº«é€šå¸¸è¦æ±‚ä¸€ä¸ªè¯·æ±‚åˆ†å‡ ä¸ªæ—¶é—´ç‰‡æ®µé—´éš”åœ°å®Œæˆï¼Œ<b>å…¶æ•ˆæœä¸è¿ç»­å®Œæˆåœ°æ•ˆæœç›¸åŒ</b>ã€‚</li>
</ul>
</li>
<li>
<p><b>å¹¶å‘</b>å’Œ<b>å…±äº«</b>ä¹‹é—´çš„å…³ç³»</p>
<ul>
<li>å¹¶å‘å’Œå…±äº«æ˜¯æ“ä½œç³»ç»Ÿä¸¤ä¸ª<b>æœ€åŸºæœ¬</b>çš„ç‰¹å¾</li>
<li><b>èµ„æºå…±äº«æ˜¯ä»¥ç¨‹åºçš„å¹¶å‘ä¸ºæ¡ä»¶çš„</b>ï¼Œè‹¥ç³»ç»Ÿä¸å…è®¸ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œåˆ™è‡ªç„¶ä¸å­˜åœ¨èµ„æºå…±äº«é—®é¢˜</li>
<li><u>è‹¥ç³»ç»Ÿä¸èƒ½å¯¹èµ„æºå…±äº«å®æ–½æœ‰æ•ˆçš„ç®¡ç†ï¼Œåˆ™å¿…å°†å½±å“åˆ°ç¨‹åºçš„å¹¶å‘æ‰§è¡Œï¼Œç”šè‡³æ ¹æœ¬æ— æ³•å¹¶å‘æ‰§è¡Œ</u></li>
</ul>
</li>
</ul>
<hr>
<h5 id="è™šæ‹Ÿvirtual">è™šæ‹Ÿ(<code>Virtual</code>)</h5>
<p><b>è™šæ‹Ÿæ˜¯æŒ‡æŠŠä¸€ä¸ªç‰©ç†ä¸Šçš„å®ä½“å˜ä¸ºè‹¥å¹²é€»è¾‘ä¸Šçš„å¯¹åº”ç‰©</b>ã€‚ç‰©ç†å®ä½“ï¼ˆå‰è€…ï¼‰æ˜¯å®é™…å­˜åœ¨çš„ï¼›è€Œåè€…æ˜¯è™šçš„ï¼Œæ˜¯ç”¨æˆ·æ„Ÿè§‰ä¸Šçš„äº‹ç‰©ã€‚<u>ç”¨äºå®ç°è™šæ‹Ÿçš„æŠ€æœ¯ï¼Œç§°ä¸º<b>è™šæ‹ŸæŠ€æœ¯</b></u>ã€‚</p>
<p>æ“ä½œç³»ç»Ÿä¸­åˆ©ç”¨äº†å¤šç§è™šæ‹ŸæŠ€æœ¯æ¥å®ç°<u>è™šæ‹Ÿå¤„ç†å™¨ï¼Œè™šæ‹Ÿå†…å­˜å’Œè™šæ‹Ÿå¤–éƒ¨è®¾å¤‡ç­‰</u>ã€‚</p>
<ul>
<li>è™šæ‹Ÿå¤„ç†å™¨æŠ€æœ¯
<ul>
<li><b>è™šæ‹Ÿå¤„ç†å™¨æŠ€æœ¯æ˜¯é€šè¿‡å¤šé“ç¨‹åºè®¾è®¡æŠ€æœ¯ï¼Œé‡‡ç”¨è®©<u>å¤šé“ç¨‹åºå¹¶å‘æ‰§è¡Œçš„æ–¹æ³•</u>ï¼Œæ¥åˆ†æ—¶ä½¿ç”¨ä¸€ä¸ªå¤„ç†å™¨çš„</b>ã€‚æ­¤æ—¶ï¼Œ<b>è™½ç„¶åªæœ‰ä¸€ä¸ªå¤„ç†å™¨</b>ï¼Œä½†å®ƒèƒ½åŒæ—¶ä¸ºå¤šä¸ªç”¨æˆ·æœåŠ¡ï¼Œ<u>ä½¿æ¯ä¸ªç»ˆç«¯ç”¨æˆ·éƒ½æ„Ÿè§‰æœ‰ä¸€ä¸ªä¸­å¤®å¤„ç†å™¨ï¼ˆCPUï¼‰åœ¨ä¸“é—¨ä¸ºå®ƒæœåŠ¡</u>ã€‚<u>åˆ©ç”¨<b>å¤šé“ç¨‹åºè®¾è®¡æŠ€æœ¯</b>æŠŠä¸€ä¸ªç‰©ç†ä¸Šçš„CPUè™šæ‹Ÿä¸ºå¤šä¸ªé€»è¾‘ä¸Šçš„CPU</u>ï¼Œç§°ä¸º<b>è™šæ‹Ÿå¤„ç†å™¨</b>ã€‚</li>
</ul>
</li>
<li>è™šæ‹Ÿå­˜å‚¨å™¨æŠ€æœ¯
<ul>
<li>é‡‡ç”¨è™šæ‹Ÿå­˜å‚¨å™¨æŠ€æœ¯å°†ä¸€å°æœºå™¨çš„ç‰©ç†å­˜å‚¨å™¨å˜ä¸ºè™šæ‹Ÿå­˜å‚¨å™¨ï¼Œä»¥ä¾¿<b>ä»é€»è¾‘ä¸Šæ‰©å……å­˜å‚¨å™¨çš„å®¹é‡</b>ã€‚å½“ç„¶ï¼Œè¿™æ—¶ç”¨æˆ·æ‰€æ„Ÿè§‰åˆ°çš„å†…å­˜å®¹é‡æ˜¯è™šçš„ã€‚<u>æˆ‘ä»¬æŠŠç”¨æˆ·æ„Ÿè§‰åˆ°ï¼ˆä½†å®é™…ä¸å­˜åœ¨ï¼‰çš„å­˜å‚¨å™¨ç§°ä¸º<b>è™šæ‹Ÿå­˜å‚¨å™¨</b></u>ã€‚</li>
</ul>
</li>
<li>è™šæ‹Ÿè®¾å¤‡æŠ€æœ¯
<ul>
<li>é‡‡ç”¨è™šæ‹Ÿè®¾å¤‡æŠ€æœ¯å°†ä¸€å°ç‰©ç†$I/O$è®¾å¤‡<b>è™šæ‹Ÿä¸ºå¤šå°é€»è¾‘ä¸Šçš„$I/O$è®¾å¤‡</b>ï¼Œå¹¶<u>å…è®¸æ¯ä¸ªç”¨æˆ·å ç”¨ä¸€å°é€»è¾‘ä¸Šçš„$I/O$è®¾å¤‡</u>ï¼Œ<b>ä½¿åŸæ¥ä»…å…è®¸åœ¨ä¸€æ®µæ—¶é—´å†…ç”±ä¸€ä¸ªç”¨æˆ·è®¿é—®çš„è®¾å¤‡ï¼ˆå³ä¸´ç•Œèµ„æºï¼‰å˜ä¸ºåœ¨ä¸€æ®µæ—¶é—´å†…å…è®¸å¤šä¸ªç”¨æˆ·åŒæ—¶è®¿é—®çš„å…±äº«è®¾å¤‡</b>ã€‚</li>
</ul>
</li>
<li>æ“ä½œç³»ç»Ÿè™šæ‹ŸæŠ€æœ¯å½’çº³
<ul>
<li>æ—¶åˆ†å¤ç”¨æŠ€æœ¯ $\Longrightarrow$ å¤„ç†å™¨çš„åˆ†æ—¶å…±äº«</li>
<li>ç©ºåˆ†å¤ç”¨æŠ€æœ¯ $\Longrightarrow$ è™šæ‹Ÿå­˜å‚¨å™¨</li>
</ul>
</li>
</ul>
<hr>
<h5 id="å¼‚æ­¥asynchronism">å¼‚æ­¥(<code>Asynchronism</code>)</h5>
<ul>
<li>å¤šé“ç¨‹åºç¯å¢ƒå…è®¸å¤šä¸ªç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œ<b>ä½†æ˜¯ç”±äºèµ„æºæœ‰é™ã€‚è¿›ç¨‹çš„æ‰§è¡Œå¹¶ä¸æ˜¯ä¸€è´¯åˆ°åº•çš„ï¼Œè€Œæ˜¯èµ°èµ°åœåœçš„ï¼Œå®ƒ<u>ä»¥ä¸å¯é¢„çŸ¥çš„é€Ÿåº¦å‘å‰æ¨è¿›</u>ï¼Œè¿™å°±æ˜¯ç¨‹åºçš„å¼‚æ­¥æ€§</b>ã€‚</li>
<li>å¼‚æ­¥æ€§ä½¿å¾—æ“ä½œç³»ç»Ÿ<b>è¿è¡Œåœ¨ä¸€ç§éšæœºçš„ç¯å¢ƒä¸‹</b>ï¼Œ<u>å¯èƒ½å¯¼è‡´è¿›ç¨‹çš„äº§ç”Ÿä¸æ—¶é—´æœ‰å…³çš„é”™è¯¯</u>ï¼ˆå°±åƒå¯¹å…¨å±€å˜é‡çš„è®¿é—®é¡ºåºä¸å½“ä¼šå¯¼è‡´ç¨‹åºå‡ºé”™ä¸€æ ·ï¼‰ã€‚ç„¶è€Œï¼Œ<b>åªè¦è¿è¡Œç¯å¢ƒç›¸åŒï¼Œæ“ä½œç³»ç»Ÿå°±é¡»ä¿è¯å¤šæ¬¡è¿è¡Œç¨‹åºåéƒ½èƒ½è·å¾—ç›¸åŒçš„ç»“æœ</b>ã€‚</li>
</ul>
<h4 id="æ“ä½œç³»ç»Ÿçš„ç›®æ ‡å’ŒåŠŸèƒ½">æ“ä½œç³»ç»Ÿçš„ç›®æ ‡å’ŒåŠŸèƒ½</h4>
<blockquote>
<p>Update in 2023-03-03 22:00</p>
<p>ç¿˜è¯¾çˆ½ç©çš„ä¸€å¤©ï¼ŒâœŒï¸åœ¨ç™¾äº¬å°±æ˜¯ç™¾äº¬æœé˜³âœŒï¸ï¼Œé€›äº†ä¸‡è¾¾ï¼Œä¸è¿‡ä¸‡è¾¾ä¹Ÿå’Œè€å®¶çš„å•†ç½‘ç»“æ„å·®ä¸å¤šï¼Œæ„Ÿè§‰å…¨ğŸ‡¨ğŸ‡³çš„äº”å…­å±‚éƒ½æ˜¯ä¸€ä¸ªğŸ…±ï¸ğŸ‘ï¼Œä¸€æ¥¼ğŸä¸“å–åº—çœ‹äº†çœ‹<b>MacBook Air</b>ï¼ŒğŸ®é­”æ˜¯çœŸå¾—è–„å•Šï¼ŒåŠ ä¸Šç±»Unixçš„ç³»ç»Ÿå’Œç»­èˆªï¼ŒâœŒï¸å°†æ¥æœ‰ğŸ’¸å¿…é¡»ç‹ ç‹ å¥–åŠ±è‡ªå·±ä¸€å°</p>
</blockquote>
<p>æ¯”å–»</p>
<div class="mermaid" id="id-1"></div>
<p>æœ‰äº†å·¥äººï¼Œæœºå™¨å°±èƒ½å‘æŒ¥æ›´å¤§çš„ä½œç”¨ï¼Œå› æ­¤å·¥äººå°±æˆäº†<b>â€æ‰©å……æœºå™¨â€œ</b>ã€‚</p>
<h5 id="æ“ä½œç³»ç»Ÿä½œä¸ºè®¡ç®—æœºç³»ç»Ÿèµ„æºçš„ç®¡ç†è€…">æ“ä½œç³»ç»Ÿä½œä¸ºè®¡ç®—æœºç³»ç»Ÿèµ„æºçš„ç®¡ç†è€…</h5>
<h6 id="å¤„ç†æœºç®¡ç†">å¤„ç†æœºç®¡ç†</h6>
<ul>
<li><b>åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œå¤„ç†æœºçš„åˆ†é…å’Œè¿è¡Œéƒ½ä»¥è¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰ä¸ºåŸºæœ¬å•ä½</b>ï¼Œå› æ­¤<u>å¯¹å¤„ç†æœºçš„ç®¡ç†å¯å½’ç»“ä¸ºå¯¹è¿›ç¨‹çš„ç®¡ç†</u>ã€‚å¹¶å‘æ˜¯æŒ‡åœ¨è®¡ç®—æœºå†…åŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œå› æ­¤<u>è¿›ç¨‹ä½•æ—¶åˆ›å»ºï¼Œä½•æ—¶æ’¤é”€ï¼Œå¦‚ä½•ç®¡ç†ï¼Œå¦‚ä½•é¿å…å†²çªï¼Œåˆç†å…±äº«å°±æ˜¯è¿›ç¨‹ç®¡ç†çš„æœ€ä¸»è¦çš„ä»»åŠ¡</u>ã€‚è¿›ç¨‹ç®¡ç†çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬<b>è¿›ç¨‹æ§åˆ¶ï¼Œè¿›ç¨‹åŒæ­¥ï¼Œè¿›ç¨‹é€šä¿¡ï¼Œæ­»é”å¤„ç†ï¼Œå¤„ç†æœºè°ƒåº¦</b>ç­‰</li>
</ul>
<h6 id="å­˜å‚¨å™¨ç®¡ç†">å­˜å‚¨å™¨ç®¡ç†</h6>
<ul>
<li>å­˜å‚¨å™¨ç®¡ç†æ˜¯ä¸ºäº†ç»™å¤šé“ç¨‹åºçš„è¿è¡Œæä¾›è‰¯å¥½çš„ç¯å¢ƒï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨åŠæé«˜å†…å­˜çš„åˆ©ç”¨ç‡ï¼Œ<b>ä¸»è¦åŒ…æ‹¬å†…å­˜åˆ†é…ä¸å›æ”¶ï¼Œåœ°å€æ˜ å°„ï¼Œå†…å­˜ä¿æŠ¤ä¸å…±äº«å’Œå†…å­˜æ‰©å……ç­‰åŠŸèƒ½</b></li>
</ul>
<h6 id="æ–‡ä»¶ç®¡ç†">æ–‡ä»¶ç®¡ç†</h6>
<ul>
<li>è®¡ç®—æœºä¸­çš„ä¿¡æ¯éƒ½æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨çš„ï¼Œæ“ä½œç³»ç»Ÿä¸­<b>è´Ÿè´£æ–‡ä»¶ç®¡ç†çš„éƒ¨åˆ†</b>ç§°ä¸º<b>æ–‡ä»¶ç³»ç»Ÿ</b>ã€‚<b>æ–‡ä»¶ç®¡ç†åŒ…æ‹¬æ–‡ä»¶å­˜å‚¨ç©ºé—´çš„ç®¡ç†ï¼Œç›®å½•ç®¡ç†åŠæ–‡ä»¶è¯»å†™ç®¡ç†å’Œä¿æŠ¤ç­‰</b>ã€‚</li>
</ul>
<h6 id="è®¾å¤‡ç®¡ç†">è®¾å¤‡ç®¡ç†</h6>
<ul>
<li><u>è®¾å¤‡ç®¡ç†çš„ä¸»è¦ä»»åŠ¡æ˜¯å®Œæˆç”¨æˆ·çš„$I/O$è¯·æ±‚ï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨å„ç§è®¾å¤‡ï¼Œå¹¶æé«˜è®¾å¤‡çš„åˆ©ç”¨ç‡</u>ï¼Œä¸»è¦åŒ…æ‹¬<b>ç¼“å†²ç®¡ç†ï¼Œè®¾å¤‡åˆ†é…ï¼Œè®¾å¤‡å¤„ç†å’Œè™šæ‹Ÿè®¾å¤‡ç­‰åŠŸèƒ½</b>ã€‚</li>
</ul>
<p><u>ä»¥ä¸Šå·¥ä½œéƒ½ç”±OSè´Ÿè´£ï¼Œç”¨æˆ·æ— éœ€å…³æ³¨</u></p>
<h5 id="æ“ä½œç³»ç»Ÿä½œä¸ºç”¨æˆ·ä¸è®¡ç®—æœºç¡¬ä»¶ç³»ç»Ÿä¹‹é—´çš„æ¥å£">æ“ä½œç³»ç»Ÿä½œä¸ºç”¨æˆ·ä¸è®¡ç®—æœºç¡¬ä»¶ç³»ç»Ÿä¹‹é—´çš„æ¥å£</h5>
<ul>
<li>æ“ä½œç³»ç»Ÿæä¾›çš„æ¥å£ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼š<b>å‘½ä»¤æ¥å£ï¼Œç¨‹åºæ¥å£</b>ã€‚</li>
</ul>
<h6 id="å‘½ä»¤æ¥å£">å‘½ä»¤æ¥å£</h6>
<ul>
<li>ä½¿ç”¨å‘½ä»¤æ¥å£è¿›è¡Œä½œä¸šæ§åˆ¶çš„ä¸»è¦æ–¹å¼æœ‰ä¸¤ç§ï¼š<u>è”æœºæ§åˆ¶æ–¹å¼å’Œè„±æœºæ§åˆ¶æ–¹å¼</u></li>
<li><u>æŒ‰ç…§ä½œä¸šæ§åˆ¶æ–¹å¼çš„ä¸åŒ</u>ï¼Œå¯å°†å‘½ä»¤æ¥å£åˆ†ä¸º<b>è”æœºå‘½ä»¤æ¥å£</b>å’Œ<b>è„±æœºå‘½ä»¤æ¥å£</b></li>
</ul>
<hr>
<ul>
<li>
<p><b>è”æœºå‘½ä»¤æ¥å£</b></p>
<ul>
<li>åˆç§°<u>äº¤äº’å¼å‘½ä»¤æ¥å£</u>ï¼Œé€‚ç”¨äº<b>åˆ†æ—¶æˆ–å®æ—¶ç³»ç»Ÿçš„æ¥å£</b>ã€‚å®ƒç”±ä¸€ç»„é”®ç›˜æ“ä½œå‘½ä»¤ç»„æˆã€‚<u>ç”¨æˆ·é€šè¿‡æ§åˆ¶å°æˆ–ç»ˆç«¯è¾“å…¥æ“ä½œå‘½ä»¤ï¼Œå‘ç³»ç»Ÿæå‡ºå„ç§æœåŠ¡è¦æ±‚</u>ã€‚<b>ç”¨æˆ·æ¯è¾“å…¥ä¸€æ¡å‘½ä»¤ï¼Œæ§åˆ¶æƒå°±è½¬ç»™æ“ä½œç³»ç»Ÿçš„å‘½ä»¤è§£é‡Šç¨‹åºï¼Œç„¶åç”±<u>å‘½ä»¤è§£é‡Šç¨‹åº</u>è§£é‡Šå¹¶æ‰§è¡Œè¾“å…¥çš„å‘½ä»¤ï¼Œå®ŒæˆæŒ‡å®šçš„åŠŸèƒ½ã€‚ä¹‹åï¼Œæ§åˆ¶æƒè½¬å›æ§åˆ¶å°æˆ–ç»ˆç«¯</b>ï¼Œæ­¤æ—¶ç”¨æˆ·åˆå¯è¾“å…¥ä¸‹ä¸€æ¡å‘½ä»¤ã€‚è”æœºå‘½ä»¤æ¥å£å¯ä»¥è¿™æ ·ç†è§£ï¼š<u>â€é›‡ä¸»â€œè¯´ä¸€å¥è¯ï¼Œâ€å·¥äººâ€œåšä¸€ä»¶äº‹ï¼Œå¹¶ä½œå‡ºåé¦ˆ</u>ï¼Œè¿™å°±å¼ºè°ƒäº†äº¤äº’æ€§ã€‚<u>ï¼ˆå…¸å‹<code>Linux</code>çš„ç»ˆç«¯<b>ç¾¤é­”ä¹±èˆ</b> $\Longrightarrow$ <code>shell</code>æ˜¯å‘½ä»¤è§£æå™¨ï¼‰</u></li>
</ul>
</li>
<li>
<p><b>è„±æœºå‘½ä»¤æ¥å£</b></p>
<ul>
<li>åˆç§°<u>æ‰¹å¤„ç†å‘½ä»¤æ¥å£</u>ï¼Œé€‚ç”¨äº<b>æ‰¹å¤„ç†ç³»ç»Ÿ</b>ï¼Œå®ƒç”±ä¸€ç»„ä½œä¸šæ§åˆ¶å‘½ä»¤ç»„æˆã€‚<u>è„±æœºç”¨æˆ·ä¸èƒ½ç›´æ¥å¹²é¢„ä½œä¸šçš„è¿è¡Œ</u>ï¼Œè€Œåº”äº‹å…ˆç”¨ç›¸åº”çš„ä½œä¸šæ§åˆ¶å‘½ä»¤å†™æˆä¸€ä»½ä½œä¸šæ“ä½œè¯´æ˜è¯´æ˜ä¹¦ï¼Œè¿åŒä½œä¸šä¸€èµ·æäº¤ç»™ç³»ç»Ÿã€‚<b>ç³»ç»Ÿè°ƒåº¦åˆ°è¯¥ä½œä¸šæ—¶ï¼Œç”±ç³»ç»Ÿä¸­çš„å‘½ä»¤è§£é‡Šç¨‹åºé€æ¡è§£é‡Šæ‰§è¡Œä½œä¸šè¯´æ˜ä¹¦ä¸Šçš„å‘½ä»¤</b>ï¼Œä»è€Œ<b>é—´æ¥åœ°</b>æ§åˆ¶ä½œä¸šåœ°è¿è¡Œã€‚</li>
</ul>
</li>
</ul>
<h6 id="ç¨‹åºæ¥å£">ç¨‹åºæ¥å£</h6>
<ul>
<li>ç¨‹åºæ¥å£ç”±<b>ä¸€ç»„ç³»ç»Ÿè°ƒç”¨</b>ï¼ˆä¹Ÿç§°<b>å¹¿ä¹‰æŒ‡ä»¤</b>ï¼‰ç»„æˆï¼Œ<b>ç”¨æˆ·é€šè¿‡åœ¨ç¨‹åºä¸­ä½¿ç”¨è¿™äº›ç³»ç»Ÿè°ƒç”¨æ¥è¯·æ±‚æ“ä½œç³»ç»Ÿä¸ºå…¶æä¾›æœåŠ¡</b>ã€‚</li>
<li>å½“å‰æœ€ä¸ºæµè¡Œçš„æ˜¯ç”¨æˆ·å›¾å½¢ç•Œé¢($GUI$)ï¼Œå³å›¾å½¢æ¥å£ã€‚</li>
<li>ä¸¥æ ¼æ¥è¯´ï¼Œ<u>å›¾å½¢æ¥å£ä¸æ˜¯æ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†</u>ï¼Œä½†æ˜¯<b>å›¾å½¢æ¥å£æ‰€è°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨å‘½ä»¤æ˜¯æ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†</b>ã€‚</li>
</ul>
<h5 id="æ“ä½œç³»ç»Ÿå®ç°äº†å¯¹è®¡ç®—æœºèµ„æºçš„æ‰©å……">æ“ä½œç³»ç»Ÿå®ç°äº†å¯¹è®¡ç®—æœºèµ„æºçš„æ‰©å……</h5>
<ul>
<li>æ²¡æœ‰ä»»ä½•è½¯ä»¶æ”¯æŒçš„è®¡ç®—æœºç§°ä¸º<b>è£¸æœº</b></li>
<li>æ“ä½œç³»ç»Ÿæ‰€æä¾›çš„èµ„æºç®¡ç†åŠŸèƒ½å’Œæ–¹ä¾¿ç”¨æˆ·çš„å„ç§æœåŠ¡åŠŸèƒ½ï¼Œå°†è£¸æœºçš„åŠŸèƒ½å˜å¾—æ›´å¼ºå¤§ï¼Œä½¿ç”¨å˜å¾—æ›´æ–¹ä¾¿</li>
<li>è¦†ç›–è½¯ä»¶çš„æœºå™¨ç§°ä¸º<b>æ‰©å……æœºå™¨</b>æˆ–<b>è™šæ‹Ÿæœº</b></li>
<li>â€å·¥äººâ€œæ“ä½œæœºå™¨ï¼Œæœºå™¨å°±æœ‰æ›´å¤§çš„ä½œç”¨ï¼Œäºæ˜¯â€å·¥äººâ€œä¾¿æˆäº†â€æ‰©å……æœºå™¨â€œ</li>
</ul>
<hr>
<ul>
<li>
<p>æ€»ç»“ï¼šæ“ä½œç³»ç»Ÿæ˜¯å¯¹<b>è®¡ç®—æœºèµ„æº</b>è¿›è¡Œç®¡ç†çš„<b>è½¯ä»¶</b></p>
</li>
<li>
<p>è¡¥å……ï¼šè®¡ç®—æœºå¼€æœºåï¼Œæ“ä½œç³»ç»Ÿæœ€ç»ˆè¢«åŠ è½½åˆ°<b>RAM</b></p>
</li>
</ul>
<h4 id="æ“ä½œç³»ç»Ÿå†å²-1">æ“ä½œç³»ç»Ÿå†å²</h4>
<blockquote>
<p>Update in 2023-03-04</p>
<p>æ˜¨å¤©å¤ªâ„¢ï¸ç´¯äº†ï¼Œæœé˜³å’Œè¥¿åœŸåŸæ¥å›æŠ˜è…¾åŠ ä¸Šå½•ä¸€ä¸‹åˆèŠ‚ç›®ç»™âœŒï¸æ•´çš„æµ‘èº«éƒ½æ˜¯é…¸ç—›çš„ï¼Œä¸ç»™âœŒï¸å½•å¿—æ„¿ç™¾äº¬âœŒï¸å°±é²¨äº†ä½ ä»¬æ‰€æœ‰äººçš„ğŸ‡</p>
<p>ä»Šå¤©ç›´æ¥ğŸ˜´ğŸ…±ï¸ğŸ…±ï¸äº†ï¼Œä¸€è§‰æ·¦åˆ°1ï¸âƒ£2ï¸âƒ£ç‚¹ï¼Œåˆ°é£Ÿå ‚ç‹ ç‹ åœ°ç‚«äº†ğŸœï¼Œä¸‹åˆæŠŠç¬¬ä¸€ç« ç»™çœ‹å®Œ</p>
</blockquote>
<h5 id="æ‰‹å·¥æ“ä½œé˜¶æ®µæ­¤æ—¶æ²¡æœ‰æ“ä½œç³»ç»Ÿ">æ‰‹å·¥æ“ä½œé˜¶æ®µï¼ˆæ­¤æ—¶æ²¡æœ‰æ“ä½œç³»ç»Ÿï¼‰</h5>
<p>ä¸€åˆ‡éƒ½å¾—<b>äººå·¥å¹²é¢„</b></p>
<ul>
<li>ä¸¤ä¸ªçªå‡ºçš„ç¼ºç‚¹
<ul>
<li><b>ç”¨æˆ·ç‹¬å å…¨æœº</b>ï¼Œè™½ç„¶ä¸ä¼šå‡ºç°å› ä¸ºèµ„æºå·²è¢«å…¶ä»–ç”¨æˆ·å ç”¨è€Œç­‰å¾…çš„ç°è±¡ï¼Œ<b>ä½†èµ„æºåˆ©ç”¨ç‡ä½</b></li>
<li><b>CPUç­‰å¾…æ‰‹å·¥æ“ä½œ</b>ï¼ŒCPUçš„åˆ©ç”¨ä¸å……åˆ†</li>
</ul>
</li>
</ul>
<h5 id="æ‰¹å¤„ç†é˜¶æ®µæ“ä½œç³»ç»Ÿå¼€å§‹å‡ºç°">æ‰¹å¤„ç†é˜¶æ®µï¼ˆæ“ä½œç³»ç»Ÿå¼€å§‹å‡ºç°ï¼‰</h5>
<h6 id="å•é“æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿ">å•é“æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿ</h6>
<ul>
<li>ç³»ç»Ÿå¯¹ä½œä¸šçš„å¤„ç†æ˜¯æˆæ‰¹è¿›è¡Œçš„ï¼Œä½†å†…å­˜ä¸­å§‹ç»ˆä¿æŒä¸€é“ä½œä¸š</li>
<li>ç›®çš„ï¼šè§£å†³äººæœºçŸ›ç›¾ä»¥åŠCPUå’ŒI/Oè®¾å¤‡é€Ÿç‡ä¸åŒ¹é…</li>
</ul>
<hr>
<ul>
<li>
<p>ç‰¹å¾</p>
<ul>
<li>è‡ªåŠ¨æ€§ï¼šç£å¸¦ä¸Šçš„ä½œä¸šèƒ½è‡ªåŠ¨åœ°é€ä¸ªè¿è¡Œï¼Œæ— é¡»äººå·¥å¹²é¢„</li>
<li>é¡ºåºæ€§ï¼šç£å¸¦ä¸Šçš„å„é“ä½œä¸šé¡ºåºåœ°è¿›å…¥å†…å­˜ï¼Œ<b>å„é“ä½œä¸šå®Œæˆé¡ºåºä¸å®ƒä»¬è¿›å…¥å†…å­˜çš„é¡ºåºåœ¨æ­£å¸¸æƒ…å†µä¸‹åº”å®Œå…¨ç›¸åŒ</b></li>
<li>å•é“æ€§ï¼šå†…å­˜ä¸­ä»…æœ‰ä¸€é“ç¨‹åºè¿è¡Œï¼Œå½“è¯¥ç¨‹åº<b>å®Œæˆ</b>æˆ–<b>å‘ç”Ÿå¼‚å¸¸æƒ…å†µ</b>æ—¶ï¼Œæ‰æ¢å…¥å…¶åç»­ç¨‹åºè¿›å…¥å†…å­˜è¿è¡Œ</li>
</ul>
</li>
<li>
<p>é—®é¢˜ï¼šå•é“ç¨‹åº<b>è¿è¡ŒæœŸé—´</b>å‘å‡ºè¾“å…¥/è¾“å‡ºè¯·æ±‚åï¼Œé«˜é€Ÿçš„CPUéœ€è¦å¤„äºç­‰å¾…ä½é€Ÿçš„I/Oå®Œæˆçš„çŠ¶æ€</p>
</li>
</ul>
<h6 id="å¤šé“æ‰¹å¤„ç†ç¨‹åº">å¤šé“æ‰¹å¤„ç†ç¨‹åº</h6>
<ul>
<li>
<p>å¤šé“ç¨‹åºè®¾è®¡æŠ€æœ¯å…è®¸å¤šä¸ªç¨‹åºåŒæ—¶è¿›å…¥å†…å­˜å¹¶å…è®¸å®ƒä»¬<b>åœ¨CPUä¸­äº¤æ›¿åœ°è¿è¡Œ</b>ï¼Œ<u>è¿™äº›ç¨‹åºå…±äº«ç³»ç»Ÿä¸­çš„å„ç§ç¡¬/è½¯ä»¶èµ„æº</u></p>
</li>
<li>
<p>å½“ä¸€é“ç¨‹åºå› I/Oè¯·æ±‚è€Œæš‚åœè¿è¡Œæ—¶ï¼ŒCPUä¾¿ç«‹å³è½¬å»è¿è¡Œå¦ä¸€é“ç¨‹åº $\Longrightarrow$ å®ç°ç³»ç»Ÿå„éƒ¨ä»¶ä¹‹é—´çš„<b>å¹¶è¡Œå·¥ä½œ</b>ï¼Œè®©ç³»ç»Ÿå„ä¸ªç»„æˆéƒ¨åˆ†çš„éƒ½å°½é‡å»â€œå¿™â€ï¼Œæé«˜æ•ˆç‡</p>
</li>
<li>
<p>ç‰¹ç‚¹</p>
<ul>
<li><b>å¤šé“</b>ï¼šè®¡ç®—æœºå†…å­˜ä¸­åŒæ—¶å­˜æ”¾å¤šé“ç›¸äº’ç‹¬ç«‹çš„ç¨‹åº</li>
<li><b>å®è§‚ä¸Šå¹¶è¡Œ</b>ï¼šåŒæ—¶è¿›å…¥ç³»ç»Ÿçš„å¤šé“ç¨‹åºéƒ½å¤„äºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå³å®ƒä»¬å…ˆåå¼€å§‹å„è‡ªçš„è¿è¡Œï¼Œä½†éƒ½æœªè¿è¡Œå®Œæ¯•</li>
<li><b>å¾®è§‚ä¸Šä¸²è¡Œ</b>ï¼š<u>å†…å­˜ä¸­çš„å¤šé“ç¨‹åºè½®æµå æœ‰CPUï¼Œäº¤æ›¿æ‰§è¡Œ</u></li>
</ul>
</li>
<li>
<p>é¢ä¸´çš„é—®é¢˜</p>
<ul>
<li>å¦‚ä½•åˆ†é…å¤„ç†å™¨</li>
<li>å¤šé“ç¨‹åºå†…å­˜çš„åˆ†é…é—®é¢˜</li>
<li>I/Oè®¾å¤‡å¦‚ä½•åˆ†é…</li>
<li>å¦‚ä½•ç»„ç»‡å’Œå­˜æ”¾å¤§é‡çš„ç¨‹åºå’Œæ•°æ®ï¼Œä»¥æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨å¹¶ä¿è¯å…¶å®‰å…¨æ€§ä¸ä¸€è‡´æ€§</li>
</ul>
</li>
<li>
<p>ä¼˜ç‚¹ï¼šèµ„æºåˆ©ç”¨ç‡é«˜ï¼Œç³»ç»Ÿååé‡å¤§</p>
</li>
<li>
<p>ç¼ºç‚¹ï¼šç”¨æˆ·å“åº”æ—¶é—´è¾ƒé•¿ï¼›<b>ä¸æä¾›äººæœºäº¤äº’èƒ½åŠ›</b>ï¼Œ<u>ç”¨æˆ·å³ä¸èƒ½äº†è§£è‡ªå·±çš„ç¨‹åºçš„è¿è¡Œæƒ…å†µï¼Œåˆä¸èƒ½æ§åˆ¶è®¡ç®—æœº</u></p>
</li>
</ul>
<h5 id="åˆ†æ—¶æ“ä½œç³»ç»Ÿ">åˆ†æ—¶æ“ä½œç³»ç»Ÿ</h5>
<ul>
<li>å°†å¤„ç†å™¨çš„è¿è¡Œæ—¶é—´åˆ‡æˆå¾ˆçŸ­çš„æ—¶é—´ç‰‡ï¼ŒæŒ‰ç…§æ—¶é—´ç‰‡æŠŠå¤„ç†å™¨åˆ†é…ç»™å„è”æœºä½œä¸šä½¿ç”¨</li>
<li><u>è‹¥æŸä¸ªä½œä¸šåœ¨åˆ†é…ç»™å®ƒçš„æ—¶é—´ç‰‡å†…ä¸èƒ½å®Œæˆè®¡ç®—ï¼Œåˆ™æš‚æ—¶åœæ­¢è¯¥ä½œä¸šçš„è¿è¡Œï¼Œå°†å¤„ç†å™¨åˆ†é…ç»™å…¶ä»–ä½œä¸šä½¿ç”¨ï¼Œç­‰å¾…ä¸‹ä¸€è½®è¿è¡Œ</u></li>
<li><u>ç”±äºè®¡ç®—æœºè¿è¡Œå¾ˆå¿«ï¼Œä½œä¸šè½®è½¬åœ°ä¹Ÿå¾ˆå¿«ï¼Œæ‰€ä»¥æ¯ä¸ªç”¨æˆ·éƒ½æ„Ÿè§‰è‡ªå·±åœ¨ç‹¬å ä¸€å°è®¡ç®—æœº</u></li>
<li>å¤šä¸ªç”¨æˆ·é€šè¿‡ç»ˆç«¯ä¸ä¸»æœºè¿›è¡Œäº¤äº’è€Œäº’ä¸å¹²æ‰°ï¼Œ<b>å®ç°åˆ†æ—¶çš„å…³é”®å°±æ˜¯å¦‚ä½•ä½¿ç”¨æˆ·èƒ½ä¸è‡ªå·±çš„ä½œä¸šè¿›è¡Œäº¤äº’</b></li>
<li>åˆ†æ—¶æ“ä½œç³»ç»Ÿæ”¯æŒå¤šé“ç¨‹åºè®¾è®¡ï¼Œä½†æ˜¯ä¸<b>å¤šé“æ‰¹å¤„ç†ç›¸æ¯”ä¸åŒçš„æ˜¯åˆ†æ—¶æ“ä½œç³»ç»Ÿæ”¯æŒäººæœºäº¤äº’</b></li>
<li>ç‰¹å¾
<ul>
<li>åŒæ—¶æ€§ï¼ˆå¤šè·¯æ€§ï¼‰ï¼šå…è®¸å¤šä¸ªç»ˆç«¯ç”¨æˆ·åŒæ—¶ä½¿ç”¨ä¸€å°è®¡ç®—æœº</li>
<li>äº¤äº’æ€§ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡ç»ˆç«¯ä¸è®¡ç®—æœºäº¤äº’</li>
<li>ç‹¬ç«‹æ€§ï¼šç³»ç»Ÿä¸­å¤šä¸ªç”¨æˆ·å¯ä»¥å½¼æ­¤ç‹¬ç«‹çš„æ“ä½œï¼Œäº’ä¸å¹²æ‰°</li>
<li>åŠæ—¶æ€§ï¼šç”¨æˆ·è¯·æ±‚èƒ½åœ¨å¾ˆçŸ­æ—¶é—´å†…è·å¾—å“åº”</li>
</ul>
</li>
</ul>
<h5 id="å®æ—¶æ“ä½œç³»ç»Ÿ">å®æ—¶æ“ä½œç³»ç»Ÿ</h5>
<p><b>æœ‰æ—¶é—´é™åˆ¶</b></p>
<ul>
<li>ç¡¬å®æ—¶ç³»ç»Ÿï¼šæŸä¸ªåŠ¨ä½œ<b>å¿…é¡»ç»å¯¹åœ°åœ¨è§„å®šçš„æ—¶åˆ»ï¼ˆæˆ–è§„å®šçš„æ—¶é—´èŒƒå›´å†…ï¼‰å‘ç”Ÿ</b>ï¼Œå¦‚é£è¡Œå™¨çš„é£è¡Œè‡ªåŠ¨æ§åˆ¶ç³»ç»Ÿ</li>
<li>è½¯å®æ—¶ç³»ç»Ÿï¼šèƒ½å¤Ÿ<b>æ¥å—å¶å°”è¿åæ—¶é—´è§„å®š</b>ä¸”ä¸ä¼šå¼•èµ·ä»»ä½•æ°¸ä¹…æ€§æŸå®³ï¼Œå…¥è®¢ç¥¨ç³»ç»Ÿï¼Œé“¶è¡Œç®¡ç†ç³»ç»Ÿ</li>
</ul>
<h5 id="ç½‘ç»œæ“ä½œç³»ç»Ÿ">ç½‘ç»œæ“ä½œç³»ç»Ÿ</h5>
<p>é€šè¿‡è®¡ç®—æœºç½‘ç»œå°†å„å°è®¡ç®—æœºæœ‰æœºåœ°è”åˆèµ·æ¥ï¼Œç‰¹ç‚¹æ˜¯ç½‘ç»œä¸­å„ç§èµ„æºçš„å…±äº«åŠå„å°è®¡ç®—æœºä¹‹é—´çš„é€šä¿¡</p>
<h5 id="åˆ†å¸ƒå¼è®¡ç®—æœºç³»ç»Ÿ">åˆ†å¸ƒå¼è®¡ç®—æœºç³»ç»Ÿ</h5>
<ul>
<li>ç³»ç»Ÿä¸­ä»»æ„ä¸¤å°è®¡ç®—æœºé€šè¿‡é€šä¿¡æ–¹å¼äº¤æ¢ä¿¡æ¯ï¼Œç³»ç»Ÿä¸­æ¯å°è®¡ç®—æœºéƒ½å…·æœ‰åŒç­‰åœ°ä½ï¼ˆæ²¡æœ‰ä¸»æœºå’Œä»æœºï¼‰</li>
<li>æ¯å°è®¡ç®—æœºä¸Šçš„èµ„æºéƒ½èƒ½ä¸ºæ‰€æœ‰ç”¨æˆ·å…±äº«ï¼Œç³»ç»Ÿä¸­çš„ä»»æ„å°è®¡ç®—æœºéƒ½å¯ä»¥æ„æˆä¸€ä¸ªå­ç³»ç»Ÿï¼Œè€Œä¸”è¿˜èƒ½é‡æ„</li>
<li>ä»»ä½•å·¥ä½œéƒ½å¯ä»¥åˆ†å¸ƒåœ¨å‡ å°è®¡ç®—æœºä¸Šï¼Œç”±å®ƒä»¬å¹¶è¡Œå·¥ä½œï¼ŒååŒå®Œæˆ</li>
<li>ç”¨äºç®¡ç†åˆ†å¸ƒå¼è®¡ç®—æœºç³»ç»Ÿçš„æ“ä½œç³»ç»Ÿç§°ä¸º<b>åˆ†å¸ƒå¼è®¡ç®—æœºç³»ç»Ÿ</b>
<ul>
<li>ç‰¹ç‚¹ï¼šåˆ†å¸ƒæ€§å’Œå¹¶è¡Œæ€§</li>
<li>ä¸ç½‘ç»œæ“ä½œç³»ç»Ÿæœ¬è´¨ä¸åŒï¼šåˆ†å¸ƒå¼æ“ä½œç³»ç»Ÿä¸­çš„è‹¥å¹²è®¡ç®—æœº<u>ç›¸äº’ååŒå®ŒæˆåŒä¸€ä»»åŠ¡</u></li>
</ul>
</li>
</ul>
<h5 id="ä¸ªäººè®¡ç®—æœºç³»ç»Ÿ">ä¸ªäººè®¡ç®—æœºç³»ç»Ÿ</h5>
<p>ä¸»è¦ä¸ºåŠå…¬å’Œæ¸¸æˆè€Œç”Ÿï¼Œä¸»æµï¼šwindows,macOS,linux</p>
<h5 id="æ€»ç»“">æ€»ç»“</h5>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-18.png" title="/img/Operating System/chapter1-18.png" data-thumbnail="/img/Operating System/chapter1-18.png" data-sub-html="<h2>OSå‘å±•å†å²</h2>">
        
    </a><figcaption class="image-caption">OSå‘å±•å†å²</figcaption>
    </figure>
<h4 id="æ“ä½œç³»ç»Ÿè¿è¡Œç¯å¢ƒ">æ“ä½œç³»ç»Ÿè¿è¡Œç¯å¢ƒ</h4>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Update<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="typeit"><div id="id-2" class=""></div></div>
<p>ç¡è¿‡å¤´äº†ï¼Œä¸‹åˆæ¥ç€å†™ã€‚é©¬ä¸Šæ”¶å°¾ï¼Œæ™šä¸Šå†™ğŸ’©ğŸ çš„è‹±è¯­ä½œä¸š</div>
        </div>
    </div>
<h5 id="å¤„ç†å™¨çš„è¿è¡Œæ¨¡å¼">å¤„ç†å™¨çš„è¿è¡Œæ¨¡å¼</h5>
<ul>
<li>
<p>æŒ‡ä»¤åˆ†ç±»</p>
<ul>
<li>ç‰¹æƒæŒ‡ä»¤ï¼š<b>æŒ‡ä¸å…è®¸ç”¨æˆ·ç›´æ¥ä½¿ç”¨çš„æŒ‡ä»¤</b>ï¼Œå¦‚I/OæŒ‡ä»¤ï¼Œç½®ä¸­æ–­æŒ‡ä»¤ç­‰</li>
<li>éç‰¹æƒæŒ‡ä»¤ï¼š<b>æŒ‡å…è®¸ç”¨æˆ·ç›´æ¥ä½¿ç”¨çš„æŒ‡ä»¤</b>ï¼Œå®ƒä¸èƒ½ç›´æ¥è®¿é—®ç³»ç»Ÿä¸­çš„è½¯ç¡¬ä»¶èµ„æºï¼Œä»…é™äºè®¿é—®ç”¨æˆ·çš„åœ°å€ç©ºé—´ï¼Œ<b>è¿™ä¹Ÿæ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·ç¨‹åºå¯¹ç³»ç»Ÿé€ æˆç ´å</b></li>
</ul>
</li>
<li>
<p>CPUçš„è¿è¡Œæ¨¡å¼</p>
<ul>
<li><b>ç”¨æˆ·æ€</b>ï¼ˆç›®æ€ï¼‰ï¼šåªèƒ½æ‰§è¡Œéç‰¹æƒæŒ‡ä»¤ï¼Œ<u>ç”¨æˆ·è‡ªç¼–ç¨‹åºè¿è¡Œåœ¨ç”¨æˆ·æ€</u></li>
<li><b>æ ¸å¿ƒæ€</b>ï¼ˆç®¡æ€ï¼Œå†…æ ¸æ€ï¼‰ï¼šèƒ½å¤Ÿæ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼Œ<b>åˆ‡æ¢åˆ°ç”¨æˆ·æ€çš„æŒ‡ä»¤ä¹Ÿæ˜¯ç‰¹æƒæŒ‡ä»¤</b>ï¼Œ<u>æ“ä½œç³»ç»Ÿå†…æ ¸ç¨‹åºè¿è¡Œåœ¨æ ¸å¿ƒæ€</u></li>
</ul>
</li>
</ul>
<h5 id="æ“ä½œç³»ç»Ÿå†…æ ¸">æ“ä½œç³»ç»Ÿå†…æ ¸</h5>
<ul>
<li>å†…æ ¸æ˜¯è®¡ç®—æœºé…ç½®çš„åº•å±‚è½¯ä»¶ï¼Œå®ƒç®¡ç†ç€å„ç§èµ„æºï¼Œ$åº”ç”¨ç¨‹åº \xleftrightarrow{å†…æ ¸} ç¡¬ä»¶$ï¼Œä¸»è¦åŒ…æ‹¬4æ–¹é¢å†…å®¹
<ul>
<li>æ—¶é’Ÿç®¡ç†ï¼š<u>æ“ä½œç³»ç»Ÿéœ€è¦é€šè¿‡æ—¶é’Ÿç®¡ç†æ¥å‘ç”¨æˆ·æä¾›æ ‡å‡†çš„ç³»ç»Ÿæ—¶é—´</u>ã€‚å¦å¤–ï¼Œ<b>é€šè¿‡æ—¶é’Ÿçš„ä¸­æ–­ç®¡ç†ï¼Œå¯ä»¥å®ç°è¿›ç¨‹çš„åˆ‡æ¢</b>ã€‚</li>
<li>ä¸­æ–­æœºåˆ¶ï¼šé”®ç›˜æˆ–é¼ æ ‡çš„ä¿¡æ¯è¾“å…¥ï¼Œè¿›ç¨‹çš„ç®¡ç†å’Œè°ƒåº¦ï¼Œç³»ç»ŸåŠŸèƒ½çš„è°ƒç”¨ï¼Œè®¾å¤‡é©±åŠ¨ï¼Œæ–‡ä»¶è®¿é—®ç­‰ï¼Œæ— ä¸ä¾èµ–äºä¸­æ–­æœºåˆ¶ã€‚å¯ä»¥è¯´ï¼Œ<b>ç°åœ¨æ“ä½œç³»ç»Ÿæ˜¯é ä¸­æ–­é©±åŠ¨çš„è½¯ä»¶</b>ã€‚
<ul>
<li>ä¸­æ–­æœºåˆ¶ä¸­ï¼Œ<b>åªæœ‰ä¸€å°éƒ¨åˆ†åŠŸèƒ½å±äºå†…æ ¸</b>ï¼Œå®ƒä»¬è´Ÿè´£<u>ä¿æŠ¤å’Œæ¢å¤ä¸­æ–­ç°åœºçš„ä¿¡æ¯</u>ï¼Œè½¬ç§»æ§åˆ¶æƒåˆ°ç›¸å…³çš„å¤„ç†ç¨‹åºã€‚è¿™æ ·å¯ä»¥<u>å‡å°‘ä¸­æ–­çš„å¤„ç†æ—¶é—´ï¼Œæé«˜ç³»ç»Ÿçš„å¹¶è¡Œå¤„ç†èƒ½åŠ›</u>ã€‚</li>
</ul>
</li>
<li>åŸè¯­ï¼ˆAtomic Operationï¼‰ï¼šæŒ‰ç…§å±‚æ¬¡ç»“æ„è®¾è®¡çš„æ“ä½œç³»ç»Ÿï¼Œåº•å±‚å¿…ç„¶æ˜¯ä¸€äº›<u>å¯è¢«è°ƒç”¨çš„å…¬å…±å°ç¨‹åº</u>ï¼Œå®ƒä»¬å„è‡ªå®Œæˆä¸€ä¸ªè§„å®šçš„æ“ä½œã€‚å®ƒä»¬çš„ç‰¹ç‚¹å¦‚ä¸‹
<ul>
<li><b>å¤„äºæ“ä½œç³»ç»Ÿçš„æœ€åº•å±‚ï¼Œæ˜¯æœ€æ¥è¿‘ç¡¬ä»¶çš„ä¸€éƒ¨åˆ†</b></li>
<li>è¿™äº›ç¨‹åºçš„è¿è¡Œå…·æœ‰åŸå­æ€§ï¼Œ<b>å…¶æ“ä½œåªèƒ½ä¸€æ°”å‘µæˆ</b>ï¼ˆå‡ºäºç³»ç»Ÿå®‰å…¨æ€§å’Œä¾¿äºç®¡ç†è€ƒè™‘ï¼‰$\Longrightarrow$ ç±»æ¯”Javaé‡Œé¢çš„<code>lock()</code>å’Œ<code>synchronized</code></li>
<li><u>è¿è¡Œæ—¶é—´è¾ƒçŸ­ï¼Œè€Œä¸”è°ƒç”¨é¢‘ç¹</u></li>
<li><b>å®šä¹‰åŸè¯­ï¼šå…³é—­ä¸­æ–­ï¼Œè®©æ‰€æœ‰åŠ¨ä½œä¸å¯åˆ†å‰²åœ°å®Œæˆåå†æ‰“å¼€ä¸­æ–­ã€‚</b></li>
<li>ä¾‹å­ï¼š<u>ç³»ç»Ÿä¸­çš„è®¾å¤‡é©±åŠ¨ï¼ŒCPUåˆ‡æ¢ï¼Œè¿›ç¨‹é€šä¿¡ç­‰åŠŸèƒ½ä¸­çš„<b>éƒ¨åˆ†æ“ä½œ</b>éƒ½å¯å®šä¹‰ä¸ºåŸè¯­</u></li>
</ul>
</li>
<li>ç³»ç»Ÿæ§åˆ¶çš„æ•°æ®ç»“æ„åŠå¤„ç†ï¼šç³»ç»Ÿä¸­ç”¨æ¥ç™»è®°çŠ¶æ€ä¿¡æ¯çš„æ•°æ®ç»“æ„æœ‰å¾ˆå¤šï¼Œå¦‚ä½œä¸šæ§åˆ¶å—ï¼Œè¿›ç¨‹æ§åˆ¶å—ç­‰ã€‚ä¸ºäº†å®ç°æœ‰æ•ˆçš„ç®¡ç†ï¼Œç³»ç»Ÿéœ€è¦ä¸€äº›åŸºæœ¬çš„æ“ä½œï¼Œå¸¸è§çš„æ“ä½œæœ‰ä¸€ä¸‹3ç§ï¼š
<ul>
<li><b>è¿›ç¨‹ç®¡ç†</b>ï¼šè¿›ç¨‹çŠ¶æ€ç®¡ç†ï¼Œè¿›ç¨‹è°ƒåº¦å’Œåˆ†æ´¾ï¼Œåˆ›å»ºå’Œæ’¤é”€è¿›ç¨‹æ§åˆ¶å—ç­‰</li>
<li><b>å­˜å‚¨å™¨ç®¡ç†</b>ï¼šå­˜å‚¨å™¨çš„ç©ºé—´åˆ†é…å’Œå›æ”¶ï¼Œå†…å­˜ä¿¡æ¯ä¿æŠ¤ç¨‹åºï¼Œä»£ç å¯¹æ¢ç¨‹åºç­‰</li>
<li><b>è®¾å¤‡ç®¡ç†</b>ï¼šç¼“å†²åŒºç®¡ç†ï¼Œè®¾å¤‡åˆ†é…å’Œå›æ”¶ç­‰</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="ä¸­æ–­å’Œå¼‚å¸¸">ä¸­æ–­å’Œå¼‚å¸¸</h4>
<ul>
<li>
<p>å®šä¹‰</p>
<ul>
<li>ä¸­æ–­(Interruption)ï¼šä¹Ÿç§°<b>å¤–ä¸­æ–­</b>ï¼Œ<b>æ˜¯æŒ‡æ¥è‡ªCPUæ‰§è¡ŒæŒ‡ä»¤å¤–éƒ¨çš„äº‹ä»¶</b>ï¼Œé€šå¸¸ç”¨äºä¿¡æ¯è¾“å…¥/å‡ºï¼Œå¦‚è®¾å¤‡å‘å‡ºçš„I/Oç»“æŸä¸­æ–­ï¼Œè¡¨ç¤ºè®¾å¤‡è¾“å…¥/å‡ºå¤„ç†å·²ç»å®Œæˆã€‚<u>æ—¶é’Ÿä¸­æ–­ï¼Œè¡¨ç¤ºä¸€ä¸ªå›ºå®šçš„æ—¶é—´ç‰‡å·²åˆ°ï¼Œè®©å¤„ç†æœºå¤„ç†è®¡æ—¶ï¼Œå¯åŠ¨å®šæ—¶è¿è¡Œçš„ä»»åŠ¡ç­‰</u>ã€‚</li>
<li>å¼‚å¸¸(Exception)ï¼šä¹Ÿç§°<b>å†…ä¸­æ–­</b>ï¼Œæ˜¯æŒ‡æ¥è‡ª<b>CPUæ‰§è¡ŒæŒ‡ä»¤å†…éƒ¨çš„äº‹ä»¶</b>ï¼Œ<u>å¦‚ç¨‹åºçš„éæ³•æ“ä½œç ï¼Œåœ°å€è¶Šç•Œï¼Œè¿ç®—æº¢å‡ºï¼Œè™šæ‹Ÿç³»ç»Ÿçš„ç¼ºé¡µåŠä¸“é—¨çš„é™·å…¥æŒ‡ä»¤ç­‰å¼•èµ·çš„äº‹ä»¶</u>ã€‚<b>å¼‚å¸¸ä¸èƒ½è¢«å±è”½</b>ï¼Œä¸€æ—¦å‡ºç°ï¼Œå°±åº”ç«‹å³å¤„ç†ã€‚</li>
</ul>
</li>
<li>
<p>è”ç³»ä¸åŒºåˆ«</p>
</li>
</ul>
<div class="mermaid" id="id-3"></div>
<ul>
<li>å¤„ç†è¿‡ç¨‹ï¼šå¤ä¹ è®¡ç»„</li>
</ul>
<h4 id="ç³»ç»Ÿè°ƒç”¨">ç³»ç»Ÿè°ƒç”¨</h4>
<ul>
<li>å¤§è‡´åˆ†ç±»
<ul>
<li>è®¾å¤‡ç®¡ç†</li>
<li>æ–‡ä»¶ç®¡ç†</li>
<li>è¿›ç¨‹æ§åˆ¶</li>
<li>è¿›ç¨‹é€šä¿¡</li>
<li>å†…å­˜ç®¡ç†</li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-19.png" title="/img/Operating System/chapter1-19.png" data-thumbnail="/img/Operating System/chapter1-19.png" data-sub-html="<h2>ä¸¤ç§çŠ¶æ€çš„åˆ‡æ¢</h2>">
        
    </a><figcaption class="image-caption">ä¸¤ç§çŠ¶æ€çš„åˆ‡æ¢</figcaption>
    </figure>
<blockquote>
<p>ç”±ç”¨æˆ·æ€è¿›å…¥æ ¸å¿ƒæ€ï¼Œä¸ä»…çŠ¶æ€éœ€è¦åˆ‡æ¢ï¼Œè€Œä¸”<b>æ‰€ç”¨çš„å †æ ˆä¹Ÿå¯èƒ½éœ€è¦ä»ç”¨æˆ·å †æ ˆåˆ‡æ¢ä¸ºç³»ç»Ÿå †æ ˆ</b>ï¼Œ<u>ä½†è¿™ä¸ªç³»ç»Ÿå †æ ˆä¹Ÿæ˜¯å±äºè¯¥è¿›ç¨‹çš„</u></p>
</blockquote>
<h5 id="å®å†…æ ¸">å®å†…æ ¸</h5>
<p>ä¹Ÿç§°å•å†…æ ¸æˆ–å¤§å†…æ ¸ï¼Œæ˜¯æŒ‡<b>å°†ç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½æ¨¡å—éƒ½ä½œä¸ºä¸€ä¸ªç´§å¯†è”ç³»çš„æ•´ä½“è¿è¡Œåœ¨æ ¸å¿ƒæ€</b>ï¼Œä»è€Œä¸ºç”¨æˆ·ç¨‹åºæä¾›é«˜æ€§èƒ½çš„ç³»ç»ŸæœåŠ¡ã€‚å› ä¸º<u>å„ç®¡ç†æ¨¡å—ä¹‹é—´å…±äº«ä¿¡æ¯ï¼Œèƒ½æœ‰æ•ˆåˆ©ç”¨ç›¸äº’ä¹‹é—´çš„æœ‰æ•ˆç‰¹æ€§ï¼Œæ‰€ä»¥å…·æœ‰æ— å¯æ¯”æ‹Ÿçš„æ€§èƒ½ä¼˜åŠ¿</u>ã€‚</p>
<h5 id="å¾®å†…æ ¸">å¾®å†…æ ¸</h5>
<p>ç”±äºå®å†…æ ¸è¿‡äºåºå¤§ï¼Œæ‰€ä»¥æœ‰äº†å¾®å†…æ ¸æ„æ¶ï¼Œè®²å†…æ ¸ä¸­æœ€åŸºæœ¬çš„åŠŸèƒ½ä¿ç•™åœ¨å†…æ ¸ï¼Œè€Œå°†é‚£äº›ä¸éœ€è¦åœ¨æ ¸å¿ƒæ€æ‰§è¡Œçš„åŠŸèƒ½ç§»åˆ°ç”¨æˆ·æ€æ‰§è¡Œï¼Œä»è€Œé™ä½å†…æ ¸è®¾è®¡å¤æ‚æ€§ã€‚</p>
<ul>
<li>åŸºæœ¬åŠŸèƒ½
<ul>
<li>è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰ç®¡ç†</li>
<li>ä½çº§å­˜å‚¨å™¨ç®¡ç†</li>
<li>ä¸­æ–­å’Œé™·å…¥å¤„ç†</li>
</ul>
</li>
</ul>
<h4 id="æ“ä½œç³»ç»Ÿå¼•å¯¼">æ“ä½œç³»ç»Ÿå¼•å¯¼</h4>
<ol>
<li>æ¿€æ´»CPU</li>
<li>ç¡¬ä»¶è‡ªæ£€</li>
<li>åŠ è½½å¸¦æœ‰æ“ä½œç³»ç»Ÿçš„ç¡¬ç›˜</li>
<li>åŠ è½½ä¸»å¼•å¯¼è®°å½•MBR</li>
<li>æ‰«æç¡¬ç›˜åˆ†åŒºè¡¨</li>
<li>åŠ è½½åˆ†åŒºå¼•å¯¼è®°å½•PBR</li>
</ol>
<h4 id="è™šæ‹Ÿæœº">è™šæ‹Ÿæœº</h4>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter1-20.png" title="/img/Operating System/chapter1-20.png" data-thumbnail="/img/Operating System/chapter1-20.png" data-sub-html="<h2>è™šæ‹Ÿæœºä¸¤ç§æ¨¡å¼</h2>">
        
    </a><figcaption class="image-caption">è™šæ‹Ÿæœºä¸¤ç§æ¨¡å¼</figcaption>
    </figure>
<p><b>å£°æ˜ï¼šæœ¬æ–‡ç« å¼•ç”¨èµ„æ–™ä¸å›¾åƒå‡å·²åšæ ‡æ³¨ï¼Œå¦‚æœ‰ä¾µæƒæœ¬äººä¼šé©¬ä¸Šåˆ é™¤</b></p>
]]></description>
</item>
</channel>
</rss>
