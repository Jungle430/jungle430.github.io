<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>Jungle&#39;s Blog</title>
        <link>https://Jungle430.github.io/</link>
        <description>Welcome to Jungle&#39;s blog.</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>1239946358@qq.com (Jungle)</managingEditor>
            <webMaster>1239946358@qq.com (Jungle)</webMaster><lastBuildDate>Wed, 08 Mar 2023 17:23:11 &#43;0800</lastBuildDate>
            <atom:link href="https://Jungle430.github.io/index.xml" rel="self" type="application/rss+xml" />
        <item>
    <title>Operating System Chapter5 å¹¶å‘æ§åˆ¶ï¼šäº’æ–¥</title>
    <link>https://Jungle430.github.io/posts/operating-system/operating-system-chapter5/</link>
    <pubDate>Wed, 08 Mar 2023 17:23:11 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/operating-system/operating-system-chapter5/</guid>
    <description><![CDATA[<h1 id="operating-system">Operating System</h1>
<p>$Nanjing\ University\rightarrow Yanyan\ Jiang\newline$</p>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Update<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>Update in 2023-03-08 17:30</p>
<p>ç»§ç»­çœ‹ï¼Œå¹¶å‘çœŸâ„¢ï¸ğŸ‘¨</p>
</div>
        </div>
    </div>
<h2 id="overview">Overview</h2>
<p>å¤ä¹ </p>
<ul>
<li>çŠ¶æ€æœºã€çŠ¶æ€æœºã€çŠ¶æ€æœº</li>
</ul>
<hr>
<p>æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜</p>
<ul>
<li><strong>Q</strong>: å¦‚ä½•åœ¨å¤šå¤„ç†å™¨ä¸Šå®ç°çº¿ç¨‹äº’æ–¥ï¼Ÿ</li>
</ul>
<hr>
<p>æœ¬æ¬¡è¯¾ä¸»è¦å†…å®¹</p>
<ul>
<li>è‡ªæ—‹é”çš„å®ç°</li>
<li>äº’æ–¥é”çš„å®ç°</li>
</ul>
<h2 id="å…±äº«å†…å­˜ä¸Šçš„äº’æ–¥">å…±äº«å†…å­˜ä¸Šçš„äº’æ–¥</h2>
<h3 id="å›é¡¾å¹¶å‘ç¼–ç¨‹">å›é¡¾ï¼šå¹¶å‘ç¼–ç¨‹</h3>
<p>ç†è§£å¹¶å‘çš„å·¥å…·</p>
<ul>
<li>çº¿ç¨‹ = äºº (å¤§è„‘èƒ½å®Œæˆå±€éƒ¨å­˜å‚¨å’Œè®¡ç®—)</li>
<li>å…±äº«å†…å­˜ = ç‰©ç†ä¸–ç•Œ (ç‰©ç†ä¸–ç•Œå¤©ç”Ÿå¹¶è¡Œ)</li>
<li>ä¸€åˆ‡éƒ½æ˜¯çŠ¶æ€æœº</li>
</ul>
<h3 id="å›é¡¾äº’æ–¥ç®—æ³•">å›é¡¾ï¼šäº’æ–¥ç®—æ³•</h3>
<p>äº’æ–¥ (mutual exclusion)ï¼Œâ€œäº’ç›¸æ’æ–¥â€</p>
<ul>
<li>å®ç° <code>lock_t</code> æ•°æ®ç»“æ„å’Œ <code>lock/unlock</code> API:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">lock_t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">lock</span><span class="p">(</span><span class="n">lock_t</span> <span class="o">*</span><span class="n">lk</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">unlock</span><span class="p">(</span><span class="n">lock_t</span> <span class="o">*</span><span class="n">lk</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p>ä¸€æŠŠ â€œæ’ä»–æ€§â€ çš„é”â€”â€”å¯¹äºé”å¯¹è±¡ <code>lk</code></p>
<ul>
<li>å¦‚æœæŸä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œåˆ™å…¶ä»–çº¿ç¨‹çš„ <code>lock</code> ä¸èƒ½è¿”å›</li>
</ul>
<h3 id="åœ¨å…±äº«å†…å­˜ä¸Šå®ç°äº’æ–¥">åœ¨å…±äº«å†…å­˜ä¸Šå®ç°äº’æ–¥</h3>
<p>å¤±è´¥çš„å°è¯•</p>
<ul>
<li><a href="https://jyywiki.cn/pages/OS/2022/demos/mutex-bad.py" target="_blank" rel="noopener noreffer">mutex-bad.py</a></li>
</ul>
<hr>
<p>(éƒ¨åˆ†) æˆåŠŸçš„å°è¯•</p>
<ul>
<li><a href="https://jyywiki.cn/pages/OS/2022/demos/peterson-barrier.c" target="_blank" rel="noopener noreffer">peterson-barrier.c</a></li>
</ul>
<hr>
<p>å®ç°äº’æ–¥çš„æ ¹æœ¬å›°éš¾ï¼šä¸èƒ½åŒæ—¶è¯»/å†™å…±äº«å†…å­˜</p>
<ul>
<li>load (ç¯é¡¾å››å‘¨) çš„æ—¶å€™ä¸èƒ½å†™ï¼Œåªèƒ½ â€œçœ‹ä¸€çœ¼å°±æŠŠçœ¼ç›é—­ä¸Šâ€
<ul>
<li>çœ‹åˆ°çš„ä¸œè¥¿é©¬ä¸Šå°±è¿‡æ—¶äº†</li>
</ul>
</li>
<li>store (æ”¹å˜ç‰©ç†ä¸–ç•ŒçŠ¶æ€) çš„æ—¶å€™ä¸èƒ½è¯»ï¼Œåªèƒ½ â€œé—­ç€çœ¼ç›åŠ¨æ‰‹â€
<ul>
<li>ä¹Ÿä¸çŸ¥é“æŠŠä»€ä¹ˆæ”¹æˆäº†ä»€ä¹ˆ</li>
</ul>
</li>
<li>è¿™æ˜¯<del>ç®€å•ã€ç²—æš´ (ç¨³å®š)ã€æœ‰æ•ˆ</del>çš„ã€Šæ“ä½œç³»ç»Ÿã€‹è¯¾</li>
</ul>
<h2 id="è‡ªæ—‹é”-spin-lock">è‡ªæ—‹é” (Spin Lock)</h2>
<h3 id="è§£å†³é—®é¢˜çš„ä¸¤ç§æ–¹æ³•">è§£å†³é—®é¢˜çš„ä¸¤ç§æ–¹æ³•</h3>
<blockquote>
<p>æå‡ºç®—æ³•ã€è§£å†³é—®é¢˜ (Dekker/Peterson/&hellip;&rsquo;s Protocols)</p>
</blockquote>
<p>æˆ–è€…â€¦â€¦</p>
<blockquote>
<p>æ”¹å˜å‡è®¾ (è½¯ä»¶ä¸å¤Ÿï¼Œç¡¬ä»¶æ¥å‡‘$\Longrightarrow$ x86æ¶æ„çš„é£æ ¼ï¼Œè½¯ä»¶æŒ‡ä»¤åšä¸å¥½ç›´æ¥å†™ä¸€ä¸ªæŒ‡ä»¤é›†è®©ç¡¬ä»¶è¿™ä¹ˆåšhhh)</p>
</blockquote>
<hr>
<p>å‡è®¾ç¡¬ä»¶èƒ½ä¸ºæˆ‘ä»¬æä¾›ä¸€æ¡ â€œç¬é—´å®Œæˆâ€ çš„è¯» + å†™æŒ‡ä»¤</p>
<ul>
<li>è¯·æ‰€æœ‰äººé—­ä¸Šçœ¼ç›ï¼Œçœ‹ä¸€çœ¼ (load)ï¼Œç„¶åè´´ä¸Šæ ‡ç­¾ (store)
<ul>
<li>å¦‚æœå¤šäººåŒæ—¶è¯·æ±‚ï¼Œç¡¬ä»¶é€‰å‡ºä¸€ä¸ª â€œèƒœè€…â€</li>
<li>â€œè´¥è€…â€ è¦ç­‰ â€œèƒœè€…â€ å®Œæˆåæ‰èƒ½ç»§ç»­æ‰§è¡Œ</li>
</ul>
</li>
</ul>
<h3 id="x86-åŸå­æ“ä½œlock-æŒ‡ä»¤å‰ç¼€">x86 åŸå­æ“ä½œï¼š<code>LOCK</code> æŒ‡ä»¤å‰ç¼€</h3>
<p>ä¾‹å­ï¼š<a href="https://jyywiki.cn/pages/OS/2022/demos/sum-atomic.c" target="_blank" rel="noopener noreffer"><code>sum-atomic.c</code></a></p>
<ul>
<li><code>sum = 200000000</code></li>
</ul>
<hr>
<p>Atomic exchange (load + store)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">xchg</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">int</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">newval</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">asm</span> <span class="k">volatile</span> <span class="p">(</span><span class="s">&#34;lock xchg %0, %1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="s">&#34;+m&#34;</span><span class="p">(</span><span class="o">*</span><span class="n">addr</span><span class="p">),</span> <span class="s">&#34;=a&#34;</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">:</span> <span class="s">&#34;1&#34;</span><span class="p">(</span><span class="n">newval</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><b>é‡ç‚¹å°±æ˜¯asmå†…è”æ±‡ç¼–é‚£å¥ï¼Œè¿™é‡Œæ˜¯â€œä¸€æ°”å‘µæˆâ€çš„</b></p>
</li>
<li>
<p>æ›´å¤šçš„åŸå­æŒ‡ä»¤ï¼š<a href="https://en.cppreference.com/w/cpp/header/stdatomic.h" target="_blank" rel="noopener noreffer">stdatomic.h</a> (C11)</p>
</li>
</ul>
<h3 id="ç”¨-xchg-å®ç°äº’æ–¥">ç”¨ <code>xchg</code> å®ç°äº’æ–¥</h3>
<ul>
<li>xchgåœ¨ä¹‹å‰çš„<a href="https://jungle430.github.io/posts/operating-system/support2" target="_blank" rel="noopener noreffer">æ–‡ç« </a>ä¸­æœ‰æåˆ°è¿‡</li>
</ul>
<p>å¦‚ä½•åè°ƒå®¿èˆè‹¥å¹²ä½åŒå­¦ä¸Šå•æ‰€é—®é¢˜ï¼Ÿ</p>
<ul>
<li>åœ¨å•æ‰€é—¨å£æ”¾ä¸€ä¸ªæ¡Œå­ (å…±äº«å˜é‡)
<ul>
<li>åˆå§‹æ—¶ï¼Œæ¡Œä¸Šæ˜¯ ğŸ”‘</li>
</ul>
</li>
</ul>
<hr>
<p>å®ç°äº’æ–¥çš„åè®®</p>
<ul>
<li>æƒ³ä¸Šå•æ‰€çš„åŒå­¦ (ä¸€æ¡ xchg æŒ‡ä»¤)
<ul>
<li>å¤©é»‘è¯·é—­çœ¼</li>
<li>çœ‹ä¸€çœ¼æ¡Œå­ä¸Šæœ‰ä»€ä¹ˆ (ğŸ”‘ æˆ– ğŸ”)</li>
<li>æŠŠ ğŸ” æ”¾åˆ°æ¡Œä¸Š (è¦†ç›–ä¹‹å‰æœ‰çš„ä»»ä½•ä¸œè¥¿)</li>
<li>å¤©äº®è¯·ççœ¼ï¼›çœ‹åˆ° ğŸ”‘ æ‰å¯ä»¥è¿›å•æ‰€å“¦</li>
</ul>
</li>
<li>å‡ºå•æ‰€çš„åŒå­¦
<ul>
<li>æŠŠ ğŸ”‘ æ”¾åˆ°æ¡Œä¸Š</li>
</ul>
</li>
</ul>
<h3 id="å®ç°äº’æ–¥è‡ªæ—‹é”">å®ç°äº’æ–¥ï¼šè‡ªæ—‹é”</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">table</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">lock</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nl">retry</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">got</span> <span class="o">=</span> <span class="n">xchg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">table</span><span class="p">,</span> <span class="n">NOPE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">got</span> <span class="o">==</span> <span class="n">NOPE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">goto</span> <span class="n">retry</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">assert</span><span class="p">(</span><span class="n">got</span> <span class="o">==</span> <span class="n">YES</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">unlock</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">xchg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">table</span><span class="p">,</span> <span class="n">YES</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">locked</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">lock</span><span class="p">()</span> <span class="p">{</span> <span class="k">while</span> <span class="p">(</span><span class="n">xchg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">locked</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">unlock</span><span class="p">()</span> <span class="p">{</span> <span class="n">xchg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">locked</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>é‡è¦çš„è¿˜æ˜¯xchgè¿™ä¸ªä¸œè¥¿ï¼Œä¿è¯é‚£ä¸€æ­¥æ˜¯åŸå­æ€§çš„ï¼Œå°±æ²¡æœ‰å…¶ä»–äº‹æƒ…äº†</li>
</ul>
<h3 id="å®ç°äº’æ–¥è‡ªæ—‹é”-contd">å®ç°äº’æ–¥ï¼šè‡ªæ—‹é” (cont&rsquo;d)</h3>
<p>å¹¶å‘ç¼–ç¨‹ï¼šåƒä¸‡å°å¿ƒ</p>
<ul>
<li>åšè¯¦å°½çš„æµ‹è¯• (åœ¨æ­¤çœç•¥ï¼Œä½ ä»¬åš Labs å°±çŸ¥é“äº†)</li>
<li>å°½å¯èƒ½åœ°è¯æ˜ (<a href="https://jyywiki.cn/pages/OS/2022/demos/model-checker.py" target="_blank" rel="noopener noreffer">model-checker.py</a> å’Œ <a href="https://jyywiki.cn/pages/OS/2022/demos/spinlock.py" target="_blank" rel="noopener noreffer">spinlock.py</a>)</li>
</ul>
<hr>
<p>åŸå­æŒ‡ä»¤çš„æ¨¡å‹</p>
<ul>
<li>ä¿è¯ä¹‹å‰çš„ store éƒ½å†™å…¥å†…å­˜</li>
<li>ä¿è¯ load/store ä¸ä¸åŸå­æŒ‡ä»¤ä¹±åº</li>
</ul>
<h3 id="åŸå­æŒ‡ä»¤çš„è¯ç”Ÿbus-lock-80486">åŸå­æŒ‡ä»¤çš„è¯ç”Ÿï¼šBus Lock (80486)</h3>
<ul>
<li>486 (20-50MHz) å°±æ”¯æŒ <code>dual-socket</code> äº†</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter5-1.jpg" title="/img/Operating System/chapter5-1.jpg" data-thumbnail="/img/Operating System/chapter5-1.jpg" data-sub-html="<h2>80486</h2>">
        
    </a><figcaption class="image-caption">80486</figcaption>
    </figure>
<div class="mermaid" id="id-1"></div>
<ul>
<li>
<p>å¦‚æœCPU1éœ€è¦æ‰§è¡Œ<code>add x, 1</code>ï¼Œé‚£ä¹ˆéœ€è¦åˆ†æˆ3æ­¥</p>
<ul>
<li>ä»memoryé‡Œé¢load</li>
<li>å†æŠŠè¿™ä¸ªå€¼add 1ä¹‹åå…ˆæ”¾å…¥ä¸€ä¸ªå†…éƒ¨çš„å¯„å­˜å™¨é‡Œ</li>
<li>å†storeæŠŠmçš„å€¼å†™å›å†…å­˜é‡Œ</li>
</ul>
</li>
<li>
<p>ä¸ºä»€ä¹ˆ486æ—¶ä»£ä¼šè¯ç”ŸLOCKè¿™æ ·çš„æŒ‡ä»¤å‘¢ï¼Ÿ</p>
</li>
</ul>
]]></description>
</item>
<item>
    <title>Operating System Chapter4 ç†è§£å¹¶å‘ç¨‹åºæ‰§è¡Œ</title>
    <link>https://Jungle430.github.io/posts/operating-system/operating-system-chapter4/</link>
    <pubDate>Mon, 06 Mar 2023 19:34:15 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/operating-system/operating-system-chapter4/</guid>
    <description><![CDATA[<h1 id="operating-system">Operating System</h1>
<p>$Nanjing\ University\rightarrow Yanyan\ Jiang\newline$</p>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Update<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="typeit"><div id="id-1" class=""></div></div>
<p>æ™šä¸Šçœ‹çš„ï¼Œ<b>Peterson</b>ç®—æ³•å¥½â„¢ï¸çš„ğŸ‘¨ï¼Œè¯æ˜ç­‰è¿‡ä¸¤å¤©æœ‰æ—¶é—´ç»™çœ‹äº†</div>
        </div>
    </div>
<h2 id="ç†è§£å¹¶å‘ç¨‹åºæ‰§è¡Œ">ç†è§£å¹¶å‘ç¨‹åºæ‰§è¡Œ</h2>
<h3 id="å¤ä¹ ">å¤ä¹ </h3>
<ul>
<li>ä¸€èˆ¬ç¨‹åºæ‰§è¡Œ</li>
</ul>
<div class="mermaid" id="id-2"></div>
<p>çº¿ç¨‹çš„æ ˆå¸§ä¼šç”¨ä¸€ä¸ª<code>list</code>æ¥å­˜æ”¾</p>
<ul>
<li>å¤šçº¿ç¨‹</li>
</ul>
<div class="mermaid" id="id-3"></div>
<p>T1,T2éšæœºæ¥å›è½¬æ¢æ‰§è¡Œ</p>
<ul>
<li><b>å¹¶å‘ç¨‹åº = å¤šä¸ªæ‰§è¡Œæµã€å…±äº«å†…å­˜çš„<u>çŠ¶æ€æœº</u></b></li>
</ul>
<h3 id="ç”»çŠ¶æ€æœºç†è§£å¹¶å‘ç¨‹åº">ç”»çŠ¶æ€æœºç†è§£å¹¶å‘ç¨‹åº</h3>
<blockquote>
<p><u>äº’æ–¥ï¼šä¿è¯ä¸¤ä¸ªçº¿ç¨‹ä¸èƒ½åŒæ—¶æ‰§è¡Œä¸€æ®µä»£ç </u></p>
</blockquote>
<ul>
<li>æ’å…¥ â€œç¥ç§˜ä»£ç â€ï¼Œä½¿å¾— <a href="https://jyywiki.cn/pages/OS/2022/demos/sum.c" target="_blank" rel="noopener noreffer">sum.c</a> (æˆ–è€…ä»»æ„å…¶ä»–ä»£ç ) èƒ½å¤Ÿæ­£å¸¸å·¥ä½œ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Tsum</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ç¥ç§˜ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">sum</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ç¥ç§˜ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¯ä»¥é€šè¿‡<code>__sync_synchronize();</code>æ¥ä¿è¯åŸå­æ“ä½œ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">__sync_synchronize</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// æˆ– int t = x;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">__sync_synchronize</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å¤±è´¥çš„å°è¯•">å¤±è´¥çš„å°è¯•</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">locked</span> <span class="o">=</span> <span class="n">UNLOCK</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">critical_section</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nl">retry</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">locked</span> <span class="o">!=</span> <span class="n">UNLOCK</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">goto</span> <span class="n">retry</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">locked</span> <span class="o">=</span> <span class="n">LOCK</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// critical section
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">locked</span> <span class="o">=</span> <span class="n">UNLOCK</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>åŸå› </p>
<ul>
<li>çœ‹åˆ°çš„çŠ¶æ€åˆ°çœŸæ­£åšä¸‹ä¸€ä»¶äº‹ä¹‹é—´çš„çŠ¶æ€æ˜¯å¦è¢«äººæ”¹äº†ï¼Ÿï¼ˆ<u>çœ‹åˆ°çš„ä¸œè¥¿ä»…ä»…åªæ˜¯ä¸€ä¸ªå†å²ï¼Œç¦»åšè¿˜æœ‰å‡ ä¸ªå‘¨æœŸï¼Œè€Œåšæ˜¯æ ¹æ®è¿™ä¸ª<b>â€œå†å²â€</b>çš„çŠ¶æ€æ¥å†³å®šçš„</u>ï¼‰$\Longrightarrow$ å’Œäººçœ¼çœ‹ç€ä¸œè¥¿å¯¹æ¯”ï¼Œäººçœ¼æ˜¯<b>ä¸€ç›´åœ¨çœ‹çš„</b>ï¼Œè€ŒCPUå¹¶è¡Œæ‰§è¡Œç¨‹åºçš„æ—¶å€™ï¼Œçœ‹è¿™ä¸ªæŒ‡ä»¤æ‰§è¡Œå®Œäº†ä¹‹åå¯èƒ½CPUä¼šå»æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹çš„å‡ æ¡æŒ‡ä»¤ï¼Œè¿™ç§æƒ…å†µä¸‹ç›¸å½“äºè¿™ä¸ªäºº<b>çœ‹å®Œåé—­ä¸Šçœ¼ç›ç­‰äº†å‡ ç§’</b>ï¼Œç„¶åæ ¹æ®å‡ ç§’å‰æ‰€çœ‹çš„ä¸œè¥¿æ¥åˆ¤æ–­è‡ªå·±è¦å¹²å•¥ï¼Œ<b>å¯æ˜¯è¿™ä¸ªä¸œè¥¿åœ¨å‰å‡ ç§’å¯èƒ½å·²ç»è®©å¦ä¸€ä¸ªçº¿ç¨‹çš„æŸäº›æŒ‡ä»¤æ”¹è¿‡äº†</b></li>
<li><b>å¤„ç†å™¨é»˜è®¤ä¸ä¿è¯ load + store çš„åŸå­æ€§ï¼ˆå•æ“ä½œå¯ä»¥ä¿è¯ï¼‰</b></li>
</ul>
</li>
<li>
<p>ä¸€ç§å¤±è´¥çš„æƒ…å†µ</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;thread.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define N 100000000
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define LOCK 1
</span></span></span><span class="line"><span class="cl"><span class="cp">#define UNLOCK 0
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">long</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">locked</span> <span class="o">=</span> <span class="n">UNLOCK</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Tsum</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nl">retry</span><span class="p">:</span>  <span class="c1">//T2åœ¨è¿™ä¸ªæ—¶å€™ä¹Ÿæ‰§è¡Œåˆ°äº†locked != UNLOCKçš„åˆ¤æ–­ï¼Œè€Œlock = LOCK,T2ä¹Ÿè¿›å»äº†ï¼Œæ²¡é”ä½ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="n">locked</span> <span class="o">!=</span> <span class="n">UNLOCK</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//&lt;--------------------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">goto</span> <span class="n">retry</span><span class="p">;</span>                                        <span class="c1">//  |
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>                                                    <span class="c1">//  |  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">locked</span> <span class="o">=</span> <span class="n">LOCK</span><span class="p">;</span>         <span class="c1">//T1æ‰§è¡Œåˆ°äº†è¿™é‡Œ æ­¤æ—¶locked = LOCK-|
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sum</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">locked</span> <span class="o">=</span> <span class="n">UNLOCK</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Tsum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">Tsum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">join</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;sum = %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ­£ç¡®æ€§ä¸æ˜çš„å¥‡æ€ªå°è¯•-peterson-ç®—æ³•">æ­£ç¡®æ€§ä¸æ˜çš„å¥‡æ€ªå°è¯• (<code>Peterson</code> ç®—æ³•)</h4>
<ul>
<li>
<p>A å’Œ B äº‰ç”¨å•æ‰€çš„åŒ…å¢</p>
</li>
<li>
<p>æƒ³è¿›å…¥åŒ…å¢ä¹‹å‰ï¼ŒA/B éƒ½è¦å…ˆä¸¾èµ·è‡ªå·±çš„æ——å­</p>
<ul>
<li>A ç¡®è®¤æ——å­ä¸¾å¥½ä»¥åï¼Œå¾€å•æ‰€é—¨ä¸Šè´´ä¸Š <b>â€œB æ­£åœ¨ä½¿ç”¨â€</b> çš„æ ‡ç­¾</li>
<li>B ç¡®è®¤æ——å­ä¸¾å¥½ä»¥åï¼Œå¾€å•æ‰€é—¨ä¸Šè´´ä¸Š <b>â€œA æ­£åœ¨ä½¿ç”¨â€</b> çš„æ ‡ç­¾</li>
</ul>
</li>
<li>
<p>ç„¶å<b>å¦‚æœå¯¹æ–¹çš„æ——å­ä¸¾èµ·æ¥ï¼Œä¸”é—¨ä¸Šçš„åå­—ä¸æ˜¯è‡ªå·±</b>ï¼Œç­‰å¾…</p>
<ul>
<li>å¦åˆ™å¯ä»¥è¿›å…¥åŒ…å¢</li>
</ul>
</li>
<li>
<p><b>å‡ºåŒ…å¢åï¼Œæ”¾ä¸‹è‡ªå·±çš„æ——å­</b></p>
</li>
<li>
<p>ç¤ºä¾‹ä»£ç ï¼š<a href="https://jyywiki.cn/pages/OS/2022/demos/peterson-simple.c" target="_blank" rel="noopener noreffer">peterson-simple.c</a></p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;thread.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define A 1
</span></span></span><span class="line"><span class="cl"><span class="cp">#define B 2
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">atomic_int</span> <span class="n">nested</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">atomic_long</span> <span class="n">count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">critical_section</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">long</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">atomic_fetch_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">count</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">assert</span><span class="p">(</span><span class="n">atomic_fetch_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nested</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">atomic_fetch_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nested</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="k">volatile</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">A</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">TA</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=1 */</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=2 */</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=3 */</span> <span class="k">while</span> <span class="p">(</span><span class="n">y</span> <span class="o">&amp;&amp;</span> <span class="n">turn</span> <span class="o">==</span> <span class="n">B</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">critical_section</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=4 */</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">TB</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=1 */</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=2 */</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">A</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=3 */</span> <span class="k">while</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">turn</span> <span class="o">==</span> <span class="n">A</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">critical_section</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* PC=4 */</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">TA</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">TB</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="petersons-protocol-verified-">Peterson&rsquo;s Protocol Verified ğŸ–</h4>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Update<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="typeit"><div id="id-4" class=""></div></div>
<p>åŸæ¥è¯æ˜å’Œåˆ¤æ–­å¯ä»¥ç”¨çŠ¶æ€ğŸŒ³æ¥è¯æ˜ï¼ˆå’Œå…¨æ•°å­¦ç›¸æ¯”å¯èƒ½ä¸ä¸¥è°¨ï¼Œä½†æ˜¯ä»CSçš„è§’åº¦æ¥è¯´å¤Ÿç”¨äº†ï¼‰</p>
<p>å…ˆğŸ˜´ï¼Œå›æ¥å†çœ‹</p>
</div>
        </div>
    </div>
<blockquote>
<p>æˆ‘ä»¬ (åœ¨å®Œå…¨ä¸ç†è§£ç®—æ³•çš„å‰æä¸‹) è¯æ˜äº† Sequential å†…å­˜æ¨¡å‹ä¸‹ Peterson&rsquo;s Protocol çš„ Safetyã€‚å®ƒèƒ½å¤Ÿå®ç°äº’æ–¥ã€‚</p>
</blockquote>
<ul>
<li>â€œ<a href="https://zoo.cs.yale.edu/classes/cs323/doc/Peterson.pdf" target="_blank" rel="noopener noreffer">Myths about the mutual exclusion problem</a>â€ (IPL, 1981ï¼Œ<code>Peterson</code>ç®—æ³•è®ºæ–‡ï¼Œ<u>ç»ˆäºç»™äº†ä¸€ä¸ªå¯¹äºæˆ‘ä»¬æ¥è¯´ç†è§£èµ·æ¥<b>ç›¸å¯¹</b>å®¹æ˜“çš„ä¸€ä¸ªç®—æ³•</u>)</li>
<li>ä¹‹å‰æœ‰å…³é”çš„ä¸€äº›å¤æ‚ç®—æ³•ï¼š<a href="https://jyywiki.cn/pages/OS/2022/demos/dekker.py" target="_blank" rel="noopener noreffer">dekker.py</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Dekker</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">flag</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">turn</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@thread</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">t1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">this</span><span class="p">,</span> <span class="n">another</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">[</span><span class="n">this</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">[</span><span class="n">another</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">turn</span> <span class="o">==</span> <span class="n">another</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">[</span><span class="n">this</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">                    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">turn</span> <span class="o">==</span> <span class="n">another</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">[</span><span class="n">this</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            <span class="n">cs</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            <span class="k">del</span> <span class="n">cs</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">turn</span> <span class="o">=</span> <span class="n">another</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">[</span><span class="n">this</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@thread</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">t2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">this</span><span class="p">,</span> <span class="n">another</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">[</span><span class="n">this</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">[</span><span class="n">another</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">turn</span> <span class="o">==</span> <span class="n">another</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">[</span><span class="n">this</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">                    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">turn</span> <span class="o">==</span> <span class="n">another</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">[</span><span class="n">this</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            <span class="n">cs</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            <span class="k">del</span> <span class="n">cs</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">turn</span> <span class="o">=</span> <span class="n">another</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">[</span><span class="n">this</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@marker</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">mark_t1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">localvar</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="s1">&#39;cs&#39;</span><span class="p">):</span> <span class="k">return</span> <span class="s1">&#39;blue&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@marker</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">mark_t2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">localvar</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s1">&#39;t2&#39;</span><span class="p">,</span> <span class="s1">&#39;cs&#39;</span><span class="p">):</span> <span class="k">return</span> <span class="s1">&#39;green&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@marker</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">mark_both</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">localvar</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="s1">&#39;cs&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">localvar</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s1">&#39;t2&#39;</span><span class="p">,</span> <span class="s1">&#39;cs&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s1">&#39;red&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä¸€äº›ç°çŠ¶
<ul>
<li>ä»Šå¤©æœ‰éå¸¸åš (å†…) å® (å·) çš„ç†è®ºä½“ç³»</li>
<li>å°å¿ƒç¼–è¯‘å™¨å’Œå¤šå¤„ç†å™¨ç¡¬ä»¶ï¼ˆç¼–è¯‘å™¨ä¼˜åŒ–ï¼ŒCPUæŒ‡ä»¤æµæ°´çº¿ä¼˜åŒ–ï¼‰
<ul>
<li><a href="https://jyywiki.cn/pages/OS/2022/demos/peterson-barrier.c" target="_blank" rel="noopener noreffer">peterson-barrier.c</a>ï¼ˆ<b>æ”¹è‰¯ç‰ˆï¼Œé˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–é€ æˆçš„ç»“æœå’Œé¢„æœŸä¸ç¬¦</b>ï¼‰</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;thread.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define A 1
</span></span></span><span class="line"><span class="cl"><span class="cp">#define B 2
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define BARRIER __sync_synchronize()
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">atomic_int</span> <span class="n">nested</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">atomic_long</span> <span class="n">count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">critical_section</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">long</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">atomic_fetch_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">count</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">atomic_fetch_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nested</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d threads in the critical section @ count=%ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">cnt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">assert</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">atomic_fetch_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nested</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="k">volatile</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">turn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">TA</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>                   <span class="n">BARRIER</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">turn</span> <span class="o">=</span> <span class="n">B</span><span class="p">;</span>                <span class="n">BARRIER</span><span class="p">;</span> <span class="c1">// &lt;- this is critcal for x86
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">y</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>         <span class="n">BARRIER</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">turn</span> <span class="o">!=</span> <span class="n">B</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>  <span class="n">BARRIER</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">critical_section</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                   <span class="n">BARRIER</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">TB</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>                   <span class="n">BARRIER</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">turn</span> <span class="o">=</span> <span class="n">A</span><span class="p">;</span>                <span class="n">BARRIER</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">x</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>         <span class="n">BARRIER</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">turn</span> <span class="o">!=</span> <span class="n">A</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>  <span class="n">BARRIER</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">critical_section</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                   <span class="n">BARRIER</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">TA</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">create</span><span class="p">(</span><span class="n">TB</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¯¾åæ€è€ƒï¼š<b>å“ªäº› barrier æ˜¯å¤šä½™çš„å—ï¼Ÿ</b></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define BARRIER __sync_synchronize() </span><span class="c1">//é‡ç‚¹ç ”ç©¶è¿™ä¸ªå®çš„ä½œç”¨
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è‡ªåŠ¨-ç”»çŠ¶æ€æœºç†è§£å¹¶å‘ç¨‹åº">(è‡ªåŠ¨) ç”»çŠ¶æ€æœºç†è§£å¹¶å‘ç¨‹åº</h3>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Update<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="typeit"><div id="id-5" class=""></div></div>
<p>ä½“è‚²è¯¾ç´¯æ­‡é€¼äº†ï¼Œæ™šä¸Šç»™çœ‹å®Œ</div>
        </div>
    </div>
<ul>
<li>
<p>å¹¶å‘ç®—æ³•çš„è®¾è®¡å›°å¢ƒ</p>
<ul>
<li>
<p>ä¸æ•¢ä¸ç”»ï¼šè°çŸ¥é“æœ‰ä»€ä¹ˆå¥‡æ€ªæƒ…å†µä¼šå‘ç”Ÿï¼Ÿ</p>
</li>
<li>
<p>ä¸æ•¢ä¹±ç”»ï¼šç”»é”™äº†å°±éƒ½å®Œäº†</p>
</li>
</ul>
</li>
<li>
<p>è§£å†³æ–¹æ³•</p>
<ul>
<li>è®©ç”µè„‘å¸®æˆ‘ä»¬ç”»ï¼ˆå› ä¸ºç”»çŠ¶æ€æœºå°±æ˜¯ä¸€ä¸ª<b>æœºæ¢°</b>çš„äº‹æƒ…ï¼‰</li>
</ul>
</li>
</ul>
<p><a href="https://jyywiki.cn/pages/OS/2022/demos/model-checker.py" target="_blank" rel="noopener noreffer">model-checker.py</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">inspect</span><span class="o">,</span> <span class="nn">ast</span><span class="o">,</span> <span class="nn">astor</span><span class="o">,</span> <span class="nn">copy</span><span class="o">,</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">threads</span><span class="p">,</span> <span class="n">marker_fn</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">thread</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39;Decorate a member function as a thread&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="n">threads</span>
</span></span><span class="line"><span class="cl">    <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">fn</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">marker</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39;Decorate a member function as a state marker&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="n">marker_fn</span>
</span></span><span class="line"><span class="cl">    <span class="n">marker_fn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">localvar</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">varname</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39;Return local variable value of thread t in state s&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">{}))[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">checkpoint</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39;Instrumented `yield checkpoint()` goes here&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">frame</span> <span class="c1"># stack[1] is the caller of checkpoint()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">,</span> <span class="p">{</span> <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">f_locals</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;self&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">hack</span><span class="p">(</span><span class="n">Class</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39;Hack Class to instrument @mc.thread functions&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Instrument</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">NodeTransformer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">def</span> <span class="nf">generic_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">in_fn</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># a @mc.thread function -&gt; instrument it</span>
</span></span><span class="line"><span class="cl">                    <span class="n">in_fn</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">decorator_list</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">                <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">decorator_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># a decorated function like @mc.mark -&gt; remove it</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">body</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="p">[]):</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># prepend each line with `yield checkpoint()`</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">in_fn</span><span class="p">:</span> <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Yield</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                        <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">checkpoint</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">                            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">keywords</span><span class="o">=</span><span class="p">[])))</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">in_fn</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">node</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">node</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Class</span><span class="p">,</span> <span class="s1">&#39;hacked&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">hacked_ast</span> <span class="o">=</span> <span class="n">Instrument</span><span class="p">()</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">Class</span><span class="o">.</span><span class="n">source</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">hacked_src</span><span class="p">,</span> <span class="nb">vars</span> <span class="o">=</span> <span class="n">astor</span><span class="o">.</span><span class="n">to_source</span><span class="p">(</span><span class="n">hacked_ast</span><span class="p">),</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># set a breakpoint() here to see **magic happens**!</span>
</span></span><span class="line"><span class="cl">        <span class="n">exec</span><span class="p">(</span><span class="n">hacked_src</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="nb">vars</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">Class</span><span class="o">.</span><span class="n">hacked</span><span class="p">,</span> <span class="n">Class</span><span class="o">.</span><span class="n">hacked_src</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">Class</span><span class="o">.</span><span class="vm">__name__</span><span class="p">],</span> <span class="n">hacked_src</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Class</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">Class</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39;Execute trace (like [0,0,0,2,2,1,1,1]) on Class&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">attrs</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                <span class="k">yield</span> <span class="n">attr</span><span class="p">,</span> <span class="n">val</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">obj</span> <span class="o">=</span> <span class="n">hack</span><span class="p">(</span><span class="n">Class</span><span class="p">)</span><span class="o">.</span><span class="n">hacked</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="n">T</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">())</span> <span class="c1"># a generator for a thread</span>
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="o">=</span> <span class="p">{</span> <span class="n">t</span><span class="p">:</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">trace</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">chosen</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">threads</span><span class="p">[</span><span class="n">trace</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">trace</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">T</span><span class="p">[</span><span class="n">chosen</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                <span class="n">S</span><span class="p">[</span><span class="n">tname</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">chosen</span><span class="p">]</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">S</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">tname</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">T</span><span class="p">[</span><span class="n">chosen</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">S</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">obj</span><span class="p">,</span> <span class="n">S</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">State</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Class</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">execute</span><span class="p">(</span><span class="n">Class</span><span class="p">,</span> <span class="n">trace</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;s</span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">State</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@staticmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">freeze</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;&#39;&#39;Create an object&#39;s hashable frozen (immutable) counterpart&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">obj</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">State</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="nb">zip</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">(</span><span class="n">State</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">            <span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot freeze&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">Class</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">edges</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39;Serialize all model checking results&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;CLASS(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">Class</span><span class="o">.</span><span class="n">hacked_src</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">sid</span> <span class="o">=</span> <span class="p">{</span> <span class="n">s0</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sid</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl">            <span class="n">sid</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;s</span><span class="si">{</span><span class="n">sid</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">vertices</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">mk</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">marker_fn</span> <span class="k">if</span> <span class="n">f</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">state</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;STATE(</span><span class="si">{</span><span class="n">name</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">state</span><span class="p">)</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">mk</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">chosen</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;TRANS(</span><span class="si">{</span><span class="n">name</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">name</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">threads</span><span class="p">[</span><span class="n">chosen</span><span class="p">])</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check_bfs</span><span class="p">(</span><span class="n">Class</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39;Enumerate all possible thread interleavings of @mc.thread functions&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s0</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">Class</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="p">[])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># breadth-first search to find all possible thread interleavings</span>
</span></span><span class="line"><span class="cl">    <span class="n">queue</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">s0</span><span class="p">],</span> <span class="p">{</span><span class="n">s0</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">s0</span><span class="p">},</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">queue</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">u</span><span class="p">,</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">queue</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">chosen</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">threads</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">v</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">Class</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">trace</span> <span class="o">+</span> <span class="p">[</span><span class="n">chosen</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">vertices</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span></span><span class="line"><span class="cl">            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">chosen</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">serialize</span><span class="p">(</span><span class="n">Class</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">edges</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">src</span><span class="p">,</span> <span class="nb">vars</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read_text</span><span class="p">(),</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="n">exec</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="nb">vars</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Class</span> <span class="o">=</span> <span class="p">[</span><span class="n">C</span> <span class="k">for</span> <span class="n">C</span> <span class="ow">in</span> <span class="nb">vars</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">setattr</span><span class="p">(</span><span class="n">Class</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">check_bfs</span><span class="p">(</span><span class="n">Class</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>$Model$ $\Longrightarrow$ $Input$</p>
</li>
<li>
<p>$checker$ $\Longrightarrow$ éå†æ‰€æœ‰çŠ¶æ€</p>
</li>
<li>
<p>é€šè¿‡ä¸€äº›classæ¥è¯´æ˜ä½ çš„å¹¶å‘ç®—æ³•ï¼š<a href="https://jyywiki.cn/pages/OS/2022/demos/mutex-bad.py" target="_blank" rel="noopener noreffer">mutex-bad.py</a>, <a href="https://jyywiki.cn/pages/OS/2022/demos/peterson-flag.py" target="_blank" rel="noopener noreffer">peterson-flag.py</a>, <a href="https://jyywiki.cn/pages/OS/2022/demos/dekker.py" target="_blank" rel="noopener noreffer">dekker.py</a></p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Mutex</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">locked</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@thread</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">t1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="o">==</span> <span class="s1">&#39;ğŸ”’&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">pass</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="s1">&#39;ğŸ”’&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="n">cs</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            <span class="k">del</span> <span class="n">cs</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@thread</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">t2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="o">==</span> <span class="s1">&#39;ğŸ”’&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">pass</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="s1">&#39;ğŸ”’&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="n">cs</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            <span class="k">del</span> <span class="n">cs</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@marker</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">mark_t1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">localvar</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="s1">&#39;cs&#39;</span><span class="p">):</span> <span class="k">return</span> <span class="s1">&#39;blue&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@marker</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">mark_t2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">localvar</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s1">&#39;t2&#39;</span><span class="p">,</span> <span class="s1">&#39;cs&#39;</span><span class="p">):</span> <span class="k">return</span> <span class="s1">&#39;green&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@marker</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">mark_both</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">localvar</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="s1">&#39;cs&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">localvar</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s1">&#39;t2&#39;</span><span class="p">,</span> <span class="s1">&#39;cs&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s1">&#39;red&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä½¿ç”¨ä¾‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">python3 model-checker.py peterson-flag.py
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>åé¢è·Ÿç€modelçš„å‚æ•°è„šæœ¬å³å¯</p>
</li>
<li>
<p>ä¸ºä»€ä¹ˆè¾“å‡ºæ¨¡å¼è¿™ä¹ˆåäººç±» $\Longrightarrow$ å› ä¸ºè¾“å‡ºæ˜¯ç»™ç¨‹åºçœ‹çš„ï¼Œåé¢çš„pythonè„šæœ¬å¯ä»¥å†™ä¸€äº›lambdaè¡¨è¾¾å¼æ¥æå–ä¿¡æ¯ $\Longrightarrow$ åŠ åˆ°åæœŸçš„å·¥å…·<a href="http://jyywiki.cn/pages/OS/2022/demos/visualize.py" target="_blank" rel="noopener noreffer">visualize.py</a>ï¼Œç›´æ¥å¯è§†åŒ–ï¼ˆå¾ˆåƒä¹‹å‰<b>zweix</b>å¤§ä½¬çš„<a href="https://github.com/zweix123/jyyslide-md" target="_blank" rel="noopener noreffer">jyyslide-md</a>ï¼‰çš„markdownè½¬htmlçš„æ„Ÿè§‰å¾ˆåƒ</p>
</li>
<li>
<p>å®‰è£…ç›¸å…³æ¨¡å—ï¼Œé™¤äº†pipçš„ä»¥å¤–Linuxçš„æœºå™¨ä¸Šè¦å®‰è£…graphviz</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt install graphviz
</span></span><span class="line"><span class="cl">pip install graphviz
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç„¶åé€šè¿‡ç®¡é“é€šä¿¡å’Œé‡å®šå‘</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">python3 model-checker.py peterson-flag.py <span class="p">|</span> python3 visualize.py &gt; a.html
</span></span><span class="line"><span class="cl">open a.html
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://github.com/Jungle430/check-for-NJU-OS" target="_blank" rel="noopener noreffer">ä¸€ä¸ªcheckerçš„demo</a></p>
<h4 id="ä»£ç å¯¼è¯»python-generator">ä»£ç å¯¼è¯»ï¼šPython Generator</h4>
<p>æ­»å¾ªç¯ä¹Ÿèƒ½è¿”å›ï¼Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">numbers</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">n</span> <span class="o">=</span> <span class="n">init</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">n</span> <span class="o">+=</span> <span class="n">step</span>
</span></span><span class="line"><span class="cl">        <span class="k">yield</span> <span class="n">n</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">g</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">g</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="n">numbers</span> <span class="n">at</span> <span class="mh">0x107f873c0</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">g</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">g</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>yield</code>è®©æ­»å¾ªç¯è¿”å›ï¼Œä½†åˆ<b>ä¸æ˜¯å®Œå…¨è¿”å›</b></li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter4-1.png" title="/img/Operating System/chapter4-1.png" data-thumbnail="/img/Operating System/chapter4-1.png" data-sub-html="<h2>æ•ˆæœ $\Longrightarrow$ gå°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœº</h2>">
        
    </a><figcaption class="image-caption">æ•ˆæœ $\Longrightarrow$ gå°±æ˜¯ä¸€ä¸ª<code>çŠ¶æ€æœº</code></figcaption>
    </figure>
<ul>
<li>
<p>æ–‡ç« <a href="https://blog.csdn.net/mieleizhi0522/article/details/82142856" target="_blank" rel="noopener noreffer">ã€Špythonä¸­yieldçš„ç”¨æ³•è¯¦è§£â€”â€”æœ€ç®€å•ï¼Œæœ€æ¸…æ™°çš„è§£é‡Šã€‹</a></p>
</li>
<li>
<p>è¿™é‡Œå°±æ¨¡ä»¿äº†çº¿ç¨‹çš„æ‰§è¡Œ<u>ä½¿ç”¨<code>yield</code>çš„ç‰¹æ€§</u></p>
</li>
</ul>
<h4 id="model-checker-å®ç°">Model Checker: å®ç°</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Mutex</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">locked</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">T1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">yield</span> <span class="n">checkpoint</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">yield</span> <span class="n">checkpoint</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="o">==</span> <span class="s1">&#39;ğŸ”’&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">yield</span> <span class="n">checkpoint</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">pass</span>
</span></span><span class="line"><span class="cl">            <span class="k">yield</span> <span class="n">checkpoint</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="s1">&#39;ğŸ”’&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">thread_state</span> <span class="o">=</span> <span class="n">mutex_obj</span><span class="p">()</span><span class="o">.</span><span class="n">T1</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="n">thread_state</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span> <span class="c1"># å•æ­¥æ‰§è¡Œä¸€è¡Œ; see: execute()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="model-checker-å®ç°-contd">Model Checker: å®ç° (cont&rsquo;d)</h4>
<p>ä»€ä¹ˆæ˜¯çŠ¶æ€ç©ºé—´ï¼Ÿ</p>
<ul>
<li>æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€æœºæ‰§è¡Œåºåˆ—</li>
<li><code>BFS</code> ç”Ÿæˆï¼Œåˆå¹¶é‡å¤çŠ¶æ€</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="cl">[0]      T1
</span></span><span class="line"><span class="cl">[1]      T2
</span></span><span class="line"><span class="cl">[0,0]    T1 -&gt; T1
</span></span><span class="line"><span class="cl">[0,1]    T1 -&gt; T2
</span></span><span class="line"><span class="cl">[0,0,0]  T1 -&gt; T1 -&gt; T1
</span></span><span class="line"><span class="cl">[0,0,1]  T1 -&gt; T1 -&gt; T2
</span></span><span class="line"><span class="cl">[0,1,0]  T1 -&gt; T2 -&gt; T1
</span></span><span class="line"><span class="cl">...      ...
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="model-checking-å’Œå·¥å…·çš„æ•…äº‹">Model Checking å’Œå·¥å…·çš„æ•…äº‹</h3>
<blockquote>
<p>Model checking is a method for formally verifying finite-state systemsâ€”â€”åªè¦èƒ½ä¸ºç³»ç»Ÿå»ºç«‹æ¨¡å‹ï¼Œå°±èƒ½ç”¨ prove by brute-force è¯æ˜æ­£ç¡®/æ‰¾åˆ°é”™è¯¯ã€‚</p>
</blockquote>
<p>Model checker çš„ä¸€åˆ‡å°±æ˜¯çŠ¶æ€æœºï¼</p>
<ul>
<li>Safety: çº¢è‰²çš„çŠ¶æ€ä¸å¯åˆ°è¾¾
<ul>
<li><em>G</em>(<em>V</em>,<em>E</em>) ä¸Šçš„å¯è¾¾æ€§é—®é¢˜</li>
</ul>
</li>
<li>(Strong) Liveness: ä»ä»»æ„çŠ¶æ€å‡ºå‘ï¼Œéƒ½èƒ½åˆ°è¾¾ç»¿/è“è‰²çŠ¶æ€
<ul>
<li><em>G</em>(<em>V</em>,<em>E</em>) ä¸Šçš„ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li>
</ul>
</li>
<li>å¦‚ä½•å±•ç¤ºè¿™ä¸ªçŠ¶æ€æœºï¼Ÿ</li>
<li>å¦‚ä½•èƒ½é¿å…æ— æ•ˆçš„æ¢ç´¢ï¼Ÿ</li>
</ul>
<h4 id="æ›´å¤šçš„-model-checker">æ›´å¤šçš„ Model Checker</h4>
<p>çœŸå®ç¨‹åºçš„çŠ¶æ€ç©ºé—´å¤ªå¤§ï¼Ÿ</p>
<ul>
<li><a href="https://dl.acm.org/doi/abs/10.1145/263699.263717" target="_blank" rel="noopener noreffer">Model checking for programming languages using VeriSoft</a> (POPL'97, ç¬¬ä¸€ä¸ª â€œsoftware model checkerâ€)</li>
<li><a href="https://dl.acm.org/doi/10.5555/1855741.1855760" target="_blank" rel="noopener noreffer">Finding and reproducing Heisenbugs in concurrent programs</a> (OSDI'08, Small Scope Hypothesis ğŸª³ğŸª³ğŸª³)</li>
<li><a href="https://dl.acm.org/doi/10.1145/1189256.1189259" target="_blank" rel="noopener noreffer">Using model checking to find serious file system errors</a> (OSDI'04, Best Paper ğŸ…ï¼Œå¯ä»¥ç”¨åœ¨ä¸å¹¶å‘çš„ç³»ç»Ÿä¸Š)</li>
</ul>
<hr>
<p>ä¸æ»¡è¶³äºç®€å•çš„å†…å­˜æ¨¡å‹ï¼Ÿ</p>
<ul>
<li><a href="https://dl.acm.org/doi/abs/10.1145/3445814.3446748" target="_blank" rel="noopener noreffer">VSync: Push-button verification and optimization for synchronization primitives on weak memory models</a> (ASPLOS'21, Distinguished Paper ğŸ…)</li>
</ul>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜</p>
<ul>
<li><strong>Q</strong>: å¦‚ä½•ç†è§£å„ç§å¹¶å‘ç¨‹åºï¼Ÿ</li>
</ul>
<hr>
<p>Take-away message</p>
<ul>
<li>å¹¶å‘ç¨‹åº = çŠ¶æ€æœº
<ul>
<li>çº¿ç¨‹å…±äº«å†…å­˜</li>
<li>æ¯ä¸€æ­¥éç¡®å®šé€‰æ‹©çº¿ç¨‹æ‰§è¡Œ</li>
</ul>
</li>
<li>ç”»çŠ¶æ€æœºå°±å¯¹äº†
<ul>
<li>å½“ç„¶ï¼Œç”¨å·¥å…·å¸®ä½ ç”» (model checker)</li>
</ul>
</li>
</ul>
<p><b>å£°æ˜ï¼šæœ¬æ–‡ç« å¼•ç”¨èµ„æ–™ä¸å›¾åƒå‡å·²åšæ ‡æ³¨ï¼Œå¦‚æœ‰ä¾µæƒæœ¬äººä¼šé©¬ä¸Šåˆ é™¤</b></p>
]]></description>
</item>
<item>
    <title>Linux x86 Program Start Up or - How the heck do we get to main()?</title>
    <link>https://Jungle430.github.io/posts/operating-system/support2/</link>
    <pubDate>Sat, 04 Mar 2023 15:47:02 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/operating-system/support2/</guid>
    <description><![CDATA[<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<ul>
<li>
<p>æ–‡ç« ä»‹ç»äº†X86ç³»ç»Ÿmainå‡½æ•°è°ƒç”¨å‰åçš„ä¸€äº›ç»†èŠ‚ï¼Œå¹¶é˜è¿°äº†Cç¨‹åºçš„<b>æ„é€ å‡½æ•°</b>å’Œ<b>ææ„å‡½æ•°</b>ï¼Œ<u>ä»¥åŠ<code>.init</code>,<code>.fini</code>,<code>init_array</code>å’Œ<code>fini_array</code>å„sectionç›¸å¯¹äºmainå‡½æ•°åŠå½¼æ­¤çš„æ‰§è¡Œé¡ºåºã€‚é—æ†¾çš„æ˜¯è¿™ç¯‡æ–‡ç« æ˜¯åŸºäº32ä½CPUæ¶æ„æ¥ç ”ç©¶çš„</u></p>
</li>
<li>
<p>æ–‡ç« å¯¹$debug$ <code>main</code>å‡½æ•°ä¹‹å‰çš„ä»£ç æœ‰ä¸€å®šçš„å¸®åŠ©æ•ˆæœ</p>
</li>
<li>
<p>ä¸»è¦ä»‹ç»äº†X86 ELFæ–‡ä»¶çš„åŠ¨æ€åŠ è½½è¿‡ç¨‹</p>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/support2-1.png" title="/img/Operating System/support2-1.png" data-thumbnail="/img/Operating System/support2-1.png" data-sub-html="<h2>æ€»ä½“æµç¨‹å›¾</h2>">
        
    </a><figcaption class="image-caption">æ€»ä½“æµç¨‹å›¾</figcaption>
    </figure>
<h2 id="è°ƒç”¨è¿‡ç¨‹åˆ†æ">è°ƒç”¨è¿‡ç¨‹åˆ†æ</h2>
<h3 id="mainå‡½æ•°çš„è°ƒç”¨">mainå‡½æ•°çš„è°ƒç”¨</h3>
<ul>
<li>å…ˆå†™ä¸€ä¸ªæœ€ç®€å•çš„Cç¨‹åºprog1.c</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç¼–è¯‘ä¸€ä¸‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -ggdb -o prog1 prog1.c
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨ï¼š<code>-ggdb</code>çš„é€‰é¡¹ä½œç”¨ï¼šç”Ÿæˆ<code>gdb</code>ä¸“ç”¨çš„è°ƒè¯•ä¿¡æ¯ï¼Œä¼šæœ‰ä¸€äº›<code>gdb</code>ä¸“ç”¨çš„æ‰©å±•</p>
</blockquote>
<ul>
<li>ç„¶åæˆ‘ä»¬ç”¨objdumpåšä¸€ä¸‹åæ±‡ç¼–</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">objdump -d prog1 &gt; prog1.asm
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ä»æˆ‘ä»¬ç»ˆç«¯æ•²å›è½¦åˆ°ç¨‹åºè¢«è½½å…¥æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆ">ä»æˆ‘ä»¬ç»ˆç«¯æ•²å›è½¦åˆ°ç¨‹åºè¢«è½½å…¥æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h4>
<ul>
<li>å½“æˆ‘ä»¬ä»ç»ˆç«¯è¾“å…¥è¦è¿è¡Œçš„ç¨‹åºæˆ–è€…æ˜¯ä»æœ‰å…³çš„<code>gui</code>ç•Œé¢ç‚¹å‡»ç›¸å…³çš„buttonçš„æ—¶å€™ï¼Œ<b>shell</b>æˆ–è€…<b>gui</b>å°±ä¼šè°ƒç”¨<code>execve()</code>ã€‚è¿™é‡Œä¸æ˜¯æˆ‘ä»¬é‡ç‚¹å…³å¿ƒçš„åœ°æ–¹ï¼Œç®€å•æ¥è¯´ï¼Œexecve()ä¼šè®¾ç«‹ä¸€ä¸ªæ ˆï¼Œç„¶åå°†å‚æ•°<code>argc</code>ï¼Œ<code>argv</code>å’Œ<code>envp</code>å‹å…¥æ ˆä¸­ã€‚æ–‡ä»¶æè¿°ç¬¦0ï¼Œ1ï¼Œ2ï¼ˆstdin, stdoutå’Œstderrï¼‰ç”±ä¹‹å‰çš„shellè®¾ç½®ï¼ŒåŠ è½½å™¨ä¼šå¸®æˆ‘ä»¬å®Œæˆæœ‰å…³é‡å®šä½çš„è®¸å¤šå·¥ä½œï¼Œå½“æ‰€æœ‰æå®šä¹‹åï¼Œæ§åˆ¶æƒä¼šä¼ é€’ç»™<code>_start()</code></li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/support2-2.png" title="/img/Operating System/support2-2.png" data-thumbnail="/img/Operating System/support2-2.png" data-sub-html="<h2>shellè¾“å…¥man execveä¹‹åçš„å‡½æ•°å£°æ˜å’Œæ‰€åœ¨ä½ç½®</h2>">
        
    </a><figcaption class="image-caption">shellè¾“å…¥<code>man execve</code>ä¹‹åçš„å‡½æ•°å£°æ˜å’Œæ‰€åœ¨ä½ç½®</figcaption>
    </figure>
<h4 id="_start">_start()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">080482e0 &lt;_start&gt;:
</span></span><span class="line"><span class="cl">80482e0:       31 ed                   xor    %ebp,%ebp
</span></span><span class="line"><span class="cl">80482e2:       5e                      pop    %esi
</span></span><span class="line"><span class="cl">80482e3:       89 e1                   mov    %esp,%ecx
</span></span><span class="line"><span class="cl">80482e5:       83 e4 f0                and    $0xfffffff0,%esp
</span></span><span class="line"><span class="cl">80482e8:       50                      push   %eax
</span></span><span class="line"><span class="cl">80482e9:       54                      push   %esp
</span></span><span class="line"><span class="cl">80482ea:       52                      push   %edx
</span></span><span class="line"><span class="cl">80482eb:       68 00 84 04 08          push   $0x8048400
</span></span><span class="line"><span class="cl">80482f0:       68 a0 83 04 08          push   $0x80483a0
</span></span><span class="line"><span class="cl">80482f5:       51                      push   %ecx
</span></span><span class="line"><span class="cl">80482f6:       56                      push   %esi
</span></span><span class="line"><span class="cl">80482f7:       68 94 83 04 08          push   $0x8048394
</span></span><span class="line"><span class="cl">80482fc:       e8 c3 ff ff ff          call   80482c4 &lt;__libc_start_main@plt&gt;
</span></span><span class="line"><span class="cl">8048301:       f4                      hlt
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä»»ä½•å€¼<code>xor</code>è‡ªèº«å¾—åˆ°çš„ç»“æœéƒ½æ˜¯0ã€‚æ‰€ä»¥<code>xor %ebp,%ebp</code>è¯­å¥ä¼šæŠŠ<code>%ebp</code>è®¾ç½®ä¸º0ã€‚ABIï¼ˆApplication Binary Interface specificationï¼‰æ¨èè¿™ä¹ˆåšï¼Œç›®çš„æ˜¯ä¸ºäº†æ ‡è®°æœ€å¤–å±‚å‡½æ•°çš„é¡µå¸§ï¼ˆframeï¼‰</li>
<li>æ¥ä¸‹æ¥ï¼Œä»æ ˆä¸­å¼¹å‡ºæ ˆé¡¶çš„å€¼ä¿å­˜åˆ°<code>%esi</code>ã€‚åœ¨æœ€å¼€å§‹çš„æ—¶å€™æˆ‘ä»¬æŠŠ<code>argc</code>ï¼Œ<code>argv</code>å’Œ<code>envp</code>æ”¾åˆ°äº†æ ˆé‡Œï¼Œæ‰€ä»¥ç°åœ¨çš„<code>pop</code>è¯­å¥ä¼šæŠŠ<code>argc</code>æ”¾åˆ°<code>%esi</code>ä¸­</li>
<li>è¿™é‡Œåªæ˜¯ä¸´æ—¶ä¿å­˜ä¸€ä¸‹ï¼Œç¨åæˆ‘ä»¬ä¼šæŠŠå®ƒå†æ¬¡å‹å›æ ˆä¸­</li>
<li>å› ä¸ºæˆ‘ä»¬å¼¹å‡ºäº†<code>argc</code>ï¼Œæ‰€ä»¥<code>%ebp</code>ç°åœ¨æŒ‡å‘çš„æ˜¯<code>argv</code>ã€‚<code>mov</code>æŒ‡ä»¤æŠŠ<code>argv</code>æ”¾åˆ°äº†<code>%ecx</code>ä¸­ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç§»åŠ¨æ ˆæŒ‡é’ˆ</li>
<li><u>ç„¶åï¼Œå°†æ ˆæŒ‡é’ˆå’Œä¸€ä¸ªå¯ä»¥æ¸…é™¤åå››ä½çš„æ©ç åš<code>and</code>æ“ä½œã€‚æ ¹æ®å½“å‰æ ˆæŒ‡é’ˆçš„ä½ç½®ä¸åŒï¼Œæ ˆæŒ‡é’ˆå°†ä¼šå‘ä¸‹ç§»åŠ¨0åˆ°15ä¸ªå­—èŠ‚ã€‚è¿™ä¹ˆåšï¼Œä¿è¯äº†ä»»ä½•æƒ…å†µä¸‹ï¼Œæ ˆæŒ‡é’ˆéƒ½æ˜¯16å­—èŠ‚çš„å¶æ•°å€å¯¹é½çš„ã€‚å¯¹é½çš„ç›®çš„æ˜¯ä¿è¯æ ˆä¸Šæ‰€æœ‰çš„å˜é‡éƒ½èƒ½å¤Ÿè¢«å†…å­˜å’Œcacheå¿«é€Ÿçš„è®¿é—®</u></li>
<li><u>è¦æ±‚è¿™ä¹ˆåšçš„æ˜¯SSEï¼Œå°±æ˜¯æŒ‡ä»¤éƒ½èƒ½åœ¨å•ç²¾åº¦æµ®ç‚¹æ•°ç»„ä¸Šå·¥ä½œçš„é‚£ä¸ª<b>ï¼ˆæ‰©å±•æŒ‡ä»¤é›†ï¼‰</b></u></li>
<li>ä¾‹å­ï¼šæŸæ¬¡è¿è¡Œæ—¶ï¼Œ<code>_start</code>å‡½æ•°åˆšè¢«è°ƒç”¨çš„æ—¶å€™ï¼Œ<code>%esp</code>å¤„äº<code>0xbffff770</code>ã€‚åœ¨æˆ‘ä»¬ä»æ ˆä¸Šå¼¹å‡º<code>argc</code>åï¼Œ<code>%esp</code>æŒ‡å‘<code>0xbffff774</code>ã€‚å®ƒå‘é«˜åœ°å€ç§»åŠ¨äº†ï¼ˆæ ˆå‘ä¸‹å¢é•¿ï¼‰ã€‚å½“å¯¹æ ˆæŒ‡é’ˆæ‰§è¡Œäº†<code>and</code>æ“ä½œåï¼Œæ ˆæŒ‡é’ˆå›åˆ°äº†<code>0xbffff770</code></li>
</ul>
<h4 id="__libc_start_main">__libc_start_main</h4>
<ul>
<li>ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠ<code>__libc_start_main</code>å‡½æ•°çš„å‚æ•°å‹å…¥æ ˆä¸­ã€‚ç¬¬ä¸€ä¸ªå‚æ•°<code>%eax</code>è¢«å‹å…¥æ ˆä¸­ï¼Œé‡Œé¢ä¿å­˜äº†æ— æ•ˆä¿¡æ¯ï¼ŒåŸå› æ˜¯ç¨åä¼šæœ‰ä¸ƒä¸ªå‚æ•°å°†è¢«å‹å…¥æ ˆä¸­ï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯16å­—èŠ‚å¯¹é½ï¼Œæ‰€ä»¥éœ€è¦ç¬¬å…«ä¸ªå‚æ•°ã€‚è¿™ä¸ªå€¼ä¹Ÿå¹¶ä¸ä¼šè¢«ç”¨åˆ°ã€‚<code>__libc_start_main</code>æ˜¯åœ¨é“¾æ¥çš„æ—¶å€™ä»glibcå¤åˆ¶è¿‡æ¥çš„ã€‚åœ¨glibcçš„ä»£ç ä¸­ï¼Œå®ƒä½äº<code>csu/libc-start.c</code>æ–‡ä»¶é‡Œã€‚<code>__libc_start_main</code>çš„å®šä¹‰å¦‚ä¸‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">__libc_start_main</span><span class="p">(</span>  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">main</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="o">*</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="o">*</span> <span class="n">ubp_av</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">init</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fini</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">rtld_fini</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="kt">void</span> <span class="p">(</span><span class="o">*</span> <span class="n">stack_end</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><figure><a class="lightgallery" href="/img/Operating%20System/support2-3.jpg" title="/img/Operating System/support2-3.jpg" data-thumbnail="/img/Operating System/support2-3.jpg" data-sub-html="<h2>å‚æ•°è¯´æ˜</h2>">
        
    </a><figcaption class="image-caption">å‚æ•°è¯´æ˜</figcaption>
    </figure>
<ul>
<li>__libc_csu_finiå‡½æ•°ä¹Ÿæ˜¯ä»glibcè¢«é“¾æ¥è¿›æˆ‘ä»¬ä»£ç çš„ï¼Œå®ƒçš„æºä»£ç ä½äºcsu/elf-init.cä¸­</li>
</ul>
<h4 id="ç¯å¢ƒå˜é‡å“ªé‡Œå»äº†">ç¯å¢ƒå˜é‡å“ªé‡Œå»äº†ï¼Ÿ</h4>
<ul>
<li>
<p>æˆ‘ä»¬å¹¶æ²¡æœ‰è·å–envpï¼ˆæ ˆé‡ŒæŒ‡å‘æˆ‘ä»¬ç¯å¢ƒå˜é‡çš„æŒ‡é’ˆï¼‰ï¼Ÿå®ƒå¹¶ä¸æ˜¯<code>__libc_start_main</code>å‡½æ•°çš„å‚æ•°ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“mainå‡½æ•°çš„åŸå‹å…¶å®æ˜¯<code>int main(int argc, char** argv, char** envp)</code>ã€‚æ‰€ä»¥ï¼Œåˆ°åº•æ€ä¹ˆå›äº‹ï¼Ÿ</p>
</li>
<li>
<p>å…¶å®ï¼Œ<code>__libc_start_main</code>å‡½æ•°ä¼šè°ƒç”¨<code>__libc_init_first</code>ï¼Œè¿™ä¸ªå‡½æ•°ä¼šä½¿ç”¨å†…éƒ¨ä¿¡æ¯å»æ‰¾åˆ°ç¯å¢ƒå˜é‡ï¼ˆå®é™…ä¸Šç¯å¢ƒå˜é‡å°±ä½äº<code>argv</code>çš„ç»ˆæ­¢å­—ç¬¦nullçš„åé¢ï¼‰ï¼Œç„¶åè®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡<code>__environ</code>ï¼Œè¿™ä¸ªå…¨å±€å˜é‡å¯ä»¥è¢«<code>__libc_start_main</code>å‡½æ•°å†…éƒ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼ŒåŒ…æ‹¬è°ƒç”¨mainå‡½æ•°æ—¶ã€‚å½“<code>envp</code>å»ºç«‹äº†ä¹‹åï¼Œ<code>__libc_start_main</code>å‡½æ•°ä¼šä½¿ç”¨ç›¸åŒçš„å°æŠ€å·§ï¼Œè¶Šè¿‡envpæ•°ç»„ä¹‹åçš„<code>NULL</code>å­—ç¬¦ï¼Œè·å–å¦ä¸€ä¸ªå‘é‡â€”â€”ELFè¾…åŠ©å‘é‡ï¼ˆåŠ è½½å™¨ä½¿ç”¨å®ƒç»™è¿›ç¨‹ä¼ é€’ä¸€äº›ä¿¡æ¯ï¼‰</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">__libc_init_first</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">arg0</span><span class="p">,</span> <span class="p">...)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">arg0</span><span class="p">,</span> <span class="o">**</span><span class="n">envp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">argv</span><span class="p">[</span><span class="n">argc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">__environ</span> <span class="o">=</span> <span class="n">envp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">__libc_init</span> <span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">envp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¿è¡Œç¨‹åºå‰ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡<code>LD_SHOW_AUXV=1</code>,å¯ä»¥æŸ¥çœ‹é‡Œé¢çš„å†…å®¹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ <span class="nv">LD_SHOW_AUXV</span><span class="o">=</span><span class="m">1</span> ./prog1
</span></span><span class="line"><span class="cl">AT_SYSINFO:      0xe62414
</span></span><span class="line"><span class="cl">AT_SYSINFO_EHDR: 0xe62000
</span></span><span class="line"><span class="cl">AT_HWCAP:    fpu vme de pse tsc msr pae mce cx8 apic
</span></span><span class="line"><span class="cl">             mtrr pge mca cmov pat pse36 clflush dts
</span></span><span class="line"><span class="cl">             acpi mmx fxsr sse sse2 ss ht tm pbe
</span></span><span class="line"><span class="cl">AT_PAGESZ:       <span class="m">4096</span>
</span></span><span class="line"><span class="cl">AT_CLKTCK:       <span class="m">100</span>
</span></span><span class="line"><span class="cl">AT_PHDR:         0x8048034
</span></span><span class="line"><span class="cl">AT_PHENT:        <span class="m">32</span>
</span></span><span class="line"><span class="cl">AT_PHNUM:        <span class="m">8</span>
</span></span><span class="line"><span class="cl">AT_BASE:         0x686000
</span></span><span class="line"><span class="cl">AT_FLAGS:        0x0
</span></span><span class="line"><span class="cl">AT_ENTRY:        0x80482e0
</span></span><span class="line"><span class="cl">AT_UID:          <span class="m">1002</span>
</span></span><span class="line"><span class="cl">AT_EUID:         <span class="m">1002</span>
</span></span><span class="line"><span class="cl">AT_GID:          <span class="m">1000</span>
</span></span><span class="line"><span class="cl">AT_EGID:         <span class="m">1000</span>
</span></span><span class="line"><span class="cl">AT_SECURE:       <span class="m">0</span>
</span></span><span class="line"><span class="cl">AT_RANDOM:       0xbff09acb
</span></span><span class="line"><span class="cl">AT_EXECFN:       ./prog1
</span></span><span class="line"><span class="cl">AT_PLATFORM:     i686
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>å„ç§å„æ ·çš„ä¿¡æ¯ã€‚<code>AT_ENTRY</code>æ˜¯<code>_start</code>çš„åœ°å€ï¼Œè¿˜æœ‰æˆ‘ä»¬çš„UIDã€æœ‰æ•ˆUIDå’ŒGID</p>
</li>
<li>
<p><b>__libc_start_mainåŠŸèƒ½æ€»ç»“</b></p>
<ul>
<li>å¤„ç†å…³äºsetuidã€setgidç¨‹åºçš„å®‰å…¨é—®é¢˜</li>
<li>å¯åŠ¨çº¿ç¨‹</li>
<li>æŠŠ<code>fini</code>å‡½æ•°å’Œ<code>rtld_fini</code>å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™<code>at_exit</code>è°ƒç”¨ï¼Œä½¿å®ƒä»¬åœ¨<code>at_exit</code>é‡Œè¢«è°ƒç”¨ï¼Œä»è€Œå®Œæˆç”¨æˆ·ç¨‹åºå’ŒåŠ è½½å™¨çš„è°ƒç”¨ç»“æŸä¹‹åçš„æ¸…ç†å·¥ä½œ</li>
<li>è°ƒç”¨å…¶<code>init</code>å‚æ•°</li>
<li>è°ƒç”¨<code>main</code>å‡½æ•°ï¼Œå¹¶æŠŠ<code>argc</code>å’Œ<code>argv</code>å‚æ•°ã€ç¯å¢ƒå˜é‡ä¼ é€’ç»™å®ƒ</li>
<li>è°ƒç”¨<code>exit</code>å‡½æ•°ï¼Œå¹¶å°†mainå‡½æ•°çš„è¿”å›å€¼ä¼ é€’ç»™å®ƒ</li>
</ul>
</li>
</ul>
<h4 id="__libc_csu_init">__libc_csu_init</h4>
<ul>
<li><code>__libc_start_main</code>å‡½æ•°çš„<code>init</code>å‚æ•°è¢«è®¾ç½®æˆäº†<code>__libc_csu_init</code>å‡½æ•°ï¼Œå®ƒä¹Ÿæ˜¯è¢«é“¾æ¥è¿›æˆ‘ä»¬ä»£ç çš„ã€‚å®ƒæ¥æºäºglibcæºä»£ç ä¸­çš„csu/elf-init.cã€‚å…¶Cä»£ç å¦‚ä¸‹ï¼ˆåŸä»£ç åªä¸è¿‡å¤šäº†ä¸€äº›#ifdefï¼‰ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">__libc_csu_init</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">_init</span> <span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">size_t</span> <span class="n">size</span> <span class="o">=</span> <span class="n">__init_array_end</span> <span class="o">-</span> <span class="n">__init_array_start</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="o">*</span><span class="n">__init_array_start</span> <span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">envp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>åŠŸèƒ½ï¼š<b>ç”¨æˆ·åº”ç”¨ç¨‹åºçš„æ„é€ å‡½æ•°</b></p>
</li>
<li>
<p><code>__libc_csu_init</code>å‡½æ•°ç›¸å½“é‡è¦ï¼Œå› ä¸ºå®ƒæ˜¯æˆ‘ä»¬<b>å¯æ‰§è¡Œç¨‹åºçš„æ„é€ å‡½æ•°</b></p>
<ul>
<li>ï¼Ÿï¼Ÿï¼Ÿè¿™ä¸æ˜¯C++ï¼Œå“ªé‡Œæ¥çš„æ„é€ å‡½æ•°ï¼Ÿï¼Ÿï¼Ÿ $\Longrightarrow$ æ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„æ¦‚å¿µå¹¶éå±äºC++ï¼Œå®ƒè¯ç”Ÿæ—©äºC++</li>
<li>å¯¹äºä»»æ„çš„å¯æ‰§è¡Œç¨‹åºéƒ½å¯ä»¥æœ‰ä¸€ä¸ªCå‡½æ•°çš„<b>æ„é€ å‡½æ•°</b><code>__libc_csu_init</code>å’ŒCå‡½æ•°çš„<b>ææ„å‡½æ•°</b><code>__libc_csu_fini</code>ã€‚<u>åœ¨æ„é€ å‡½æ•°å†…éƒ¨ï¼Œå¯æ‰§è¡Œç¨‹åºä¼šæ‰¾åˆ°å…¨å±€Cå‡½æ•°ç»„æˆçš„æ„é€ å‡½æ•°é›†ï¼Œå¹¶ä¸”è°ƒç”¨å®ƒä»¬</u>ã€‚ï¼ˆä»»ä½•ä¸€ä¸ªCç¨‹åºéƒ½æ˜¯å¯ä»¥æœ‰æ„é€ å‡½æ•°é›†çš„ï¼‰ $\Longrightarrow$ <u>the executable will look for global C level constructors and call any that it finds. It&rsquo;s possible for a C program to also have these</u>ï¼ˆåŸæ–‡ï¼‰</li>
</ul>
</li>
<li>
<p><code>__libc_csu_init</code>å‡½æ•°çš„åæ±‡ç¼–ä»£ç </p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">080483a0 &lt;__libc_csu_init&gt;:
</span></span><span class="line"><span class="cl"> 80483a0:       55                      push   %ebp
</span></span><span class="line"><span class="cl"> 80483a1:       89 e5                   mov    %esp,%ebp
</span></span><span class="line"><span class="cl"> 80483a3:       57                      push   %edi
</span></span><span class="line"><span class="cl"> 80483a4:       56                      push   %esi
</span></span><span class="line"><span class="cl"> 80483a5:       53                      push   %ebx
</span></span><span class="line"><span class="cl"> 80483a6:       e8 5a 00 00 00          call   8048405 &lt;__i686.get_pc_thunk.bx&gt;
</span></span><span class="line"><span class="cl"> 80483ab:       81 c3 49 1c 00 00       add    $0x1c49,%ebx
</span></span><span class="line"><span class="cl"> 80483b1:       83 ec 1c                sub    $0x1c,%esp
</span></span><span class="line"><span class="cl"> 80483b4:       e8 bb fe ff ff          call   8048274 &lt;_init&gt;
</span></span><span class="line"><span class="cl"> 80483b9:       8d bb 20 ff ff ff       lea    -0xe0(%ebx),%edi
</span></span><span class="line"><span class="cl"> 80483bf:       8d 83 20 ff ff ff       lea    -0xe0(%ebx),%eax
</span></span><span class="line"><span class="cl"> 80483c5:       29 c7                   sub    %eax,%edi
</span></span><span class="line"><span class="cl"> 80483c7:       c1 ff 02                sar    $0x2,%edi
</span></span><span class="line"><span class="cl"> 80483ca:       85 ff                   test   %edi,%edi
</span></span><span class="line"><span class="cl"> 80483cc:       74 24                   je     80483f2 &lt;__libc_csu_init+0x52&gt;
</span></span><span class="line"><span class="cl"> 80483ce:       31 f6                   xor    %esi,%esi
</span></span><span class="line"><span class="cl"> 80483d0:       8b 45 10                mov    0x10(%ebp),%eax
</span></span><span class="line"><span class="cl"> 80483d3:       89 44 24 08             mov    %eax,0x8(%esp)
</span></span><span class="line"><span class="cl"> 80483d7:       8b 45 0c                mov    0xc(%ebp),%eax
</span></span><span class="line"><span class="cl"> 80483da:       89 44 24 04             mov    %eax,0x4(%esp)
</span></span><span class="line"><span class="cl"> 80483de:       8b 45 08                mov    0x8(%ebp),%eax
</span></span><span class="line"><span class="cl"> 80483e1:       89 04 24                mov    %eax,(%esp)
</span></span><span class="line"><span class="cl"> 80483e4:       ff 94 b3 20 ff ff ff    call   *-0xe0(%ebx,%esi,4)
</span></span><span class="line"><span class="cl"> 80483eb:       83 c6 01                add    $0x1,%esi
</span></span><span class="line"><span class="cl"> 80483ee:       39 fe                   cmp    %edi,%esi
</span></span><span class="line"><span class="cl"> 80483f0:       72 de                   jb     80483d0 &lt;__libc_csu_init+0x30&gt;
</span></span><span class="line"><span class="cl"> 80483f2:       83 c4 1c                add    $0x1c,%esp
</span></span><span class="line"><span class="cl"> 80483f5:       5b                      pop    %ebx
</span></span><span class="line"><span class="cl"> 80483f6:       5e                      pop    %esi
</span></span><span class="line"><span class="cl"> 80483f7:       5f                      pop    %edi
</span></span><span class="line"><span class="cl"> 80483f8:       5d                      pop    %ebp
</span></span><span class="line"><span class="cl"> 80483f9:       c3                      ret
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="è¿™ä¸ªå‡½æ•°éƒ½åšäº†ä»€ä¹ˆ">è¿™ä¸ªå‡½æ•°éƒ½åšäº†ä»€ä¹ˆï¼Ÿ</h5>
<h6 id="get_pc_truckå‡½æ•°">get_pc_truckå‡½æ•°</h6>
<ul>
<li>è¯¥å‡½æ•°æ˜¯ç»™ä½ç½®æ— å…³ç ä½¿ç”¨çš„ã€‚è®¾ç½®å®ƒä»¬å¯ä»¥è®©ä½ç½®æ— å…³ç æ­£å¸¸å·¥ä½œã€‚ä¸ºäº†è®©å®ƒä»¬å·¥ä½œï¼ŒåŸºå€å¯„å­˜å™¨ï¼ˆ%ebpï¼‰éœ€è¦çŸ¥é“<code>GLOBAL_OFFSET_TABLE</code>ã€‚å…¶éƒ¨åˆ†ä»£ç å¦‚ä¸‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">push %ebx
</span></span><span class="line"><span class="cl">call __get_pc_thunk_bx
</span></span><span class="line"><span class="cl">add  $_GLOBAL_OFFSET_TABLE_,%ebx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">__get_pc_thunk_bx:
</span></span><span class="line"><span class="cl">movel (%esp),%ebx
</span></span><span class="line"><span class="cl">return
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>è¿‡ç¨‹åˆ†æ</p>
<ul>
<li>
<p>è°ƒç”¨<code>__get_pc_thunk_bx</code>æ—¶ï¼Œåƒæ‰€æœ‰å…¶ä»–å‡½æ•°è°ƒç”¨ä¸€æ ·ï¼Œå°†ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å‹å…¥æ ˆä¸­ï¼ˆè®¡ç»„ï¼šä¿å­˜ä¸Šä¸€çº§ç¨‹åºçš„<b>PC</b>ï¼‰ã€‚è¿™æ ·ï¼Œå½“å‡½æ•°è¿”å›æ—¶ï¼Œå°±ä¼šç»§ç»­æ‰§è¡Œä¸‹æ¡æŒ‡ä»¤</p>
</li>
<li>
<p>åœ¨<code>__get_pc_thunk_bx</code>ä¸­ï¼Œæˆ‘ä»¬å°†è¿”å›åœ°å€ä»æ ˆä¸­å¤åˆ¶åˆ°<code>%ebx</code>ä¸­ã€‚å½“è¿”å›çš„æ—¶å€™ï¼Œä¸‹æ¡æŒ‡ä»¤ä¼šæŠŠ<code>_GLOBAL_OFFSET_TABLE_</code>åŠ åˆ°<code>%ebx</code>ä¸Šå»ï¼ˆå‰3å¥ï¼‰</p>
</li>
<li>
<p>å…¶ä¸­<code>_GLOBAL_OFFSET_TABLE_</code>ä»£è¡¨äº†å½“å‰åœ°å€å’Œä½ç½®æ— å…³ç ä½¿ç”¨çš„<code>GOT(global offset table)</code>çš„å·®å€¼</p>
</li>
<li>
<p>åœ¨<code>GOT</code>ä¸­ä¿å­˜äº†æˆ‘ä»¬æƒ³è®¿é—®çš„å˜é‡çš„æŒ‡é’ˆçš„é›†åˆï¼Œ<b>å¹¶ä¸”æˆ‘ä»¬åªéœ€è¦çŸ¥é“æ•°æ®åœ¨è¿™ä¸ªè¡¨ä¸­çš„åç§»é‡å°±è¡Œ</b></p>
</li>
<li>
<p>åŠ è½½å™¨ä¼šä¸ºæˆ‘ä»¬ä¿®æ”¹è¿™ä¸ªè¡¨é‡Œé¢çš„åœ°å€ã€‚å¯¹äºå‡½æ•°æ¥è®²ï¼Œä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼çš„è¡¨ï¼ˆPLTï¼‰</p>
</li>
<li>
<p><u>æ±‡ç¼–é‡Œé¢è¿™ä¹ˆç¼–å†™å®åœ¨æ˜¯å¤ªçƒ¦äººäº†ï¼Œä½†æ˜¯ï¼Œåœ¨Cæˆ–è€…C++ä¸­ï¼Œä½ å¯ä»¥å°†-picå‚æ•°ä¼ é€’ç»™ç¼–è¯‘å™¨ï¼Œå®ƒå°†ä¼šè‡ªåŠ¨å¸®ä½ å®Œæˆè¿™ä¸ªå·¥ä½œ</u><b>ï¼ˆä½ çŸ¥é“ä½ ä¸ç”¨å…³å¿ƒè¿™ä¸ªäº‹æƒ…å°±å¯ä»¥äº†ï¼ˆmdå°±æ€•è‡ªå·±å†â„¢ï¸é’»ç‰›è§’å°–ï¼‰ï¼‰</b></p>
</li>
</ul>
</li>
<li>
<p>å’Œ64ä½æœ‰å…³çš„åŒºåˆ«</p>
</li>
</ul>
<blockquote>
<p><em>ä¸Šè¿°Â·get_pc_truckÂ·å‡½æ•°çš„ä¸»è¦ç›®çš„å…¶å®æ˜¯è·å–å˜é‡å¯¹åº”çš„GOTï¼Œä»¥é€šè¿‡å®ƒè·å–å˜é‡çœŸæ­£çš„å€¼ã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆå†™ï¼Œæ˜¯å› ä¸ºåœ¨32ä½ç³»ç»Ÿé‡Œï¼Œæ²¡æœ‰ç±»ä¼¼äºripçš„å¯„å­˜å™¨ï¼Œå› æ­¤å¹¶ä¸èƒ½ç›´æ¥è·å–å½“å‰æŒ‡ä»¤çš„åœ°å€ï¼Œè€Œåœ¨64ä½ç³»ç»Ÿé‡Œå°±ä¸ç”¨è¿™ç§å°æŠ€å·§äº†</em></p>
<ul>
<li>
<p>æœ‰å…³é˜…è¯»</p>
<ul>
<li>
<p><a href="https://blog.csdn.net/mw_nice/article/details/100022610" target="_blank" rel="noopener noreffer">ã€ŠLinuxä¸­çš„GOTå’ŒPLTåˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿã€‹</a> ï¼ˆåŸæ¥çš„åšå®¢å¯„äº†ï¼Œåœ¨CSDNæ‰¾åˆ°äº†è½¬è½½ï¼‰</p>
</li>
<li>
<p><a href="https://www.technovelty.org/linux/plt-and-got-the-key-to-code-sharing-and-dynamic-libraries.html" target="_blank" rel="noopener noreffer">ã€ŠPLT and GOT - the key to code sharing and dynamic librariesã€‹</a> ï¼ˆè‹±æ–‡åŸæ–‡ï¼‰</p>
</li>
</ul>
</li>
</ul>
</blockquote>
<h6 id="å‰©ä¸‹çš„å¾ªç¯åœ¨å¹²ä»€ä¹ˆ">å‰©ä¸‹çš„å¾ªç¯åœ¨å¹²ä»€ä¹ˆï¼Ÿ</h6>
<ul>
<li>ç°åœ¨æˆ‘ä»¬åªè¦è®°ä½ï¼š<b>ç¿»è¯‘çš„ä¸å¥½ï¼Œè¿™é‡Œå»ºè®®çœ‹åŸæ–‡</b></li>
</ul>
<blockquote>
<p>For now, just remember that it calls any C level initializers for our program.</p>
</blockquote>
<p>ä¸­æ–‡ç¿»è¯‘ç‰ˆï¼š</p>
<blockquote>
<p><b>å®ƒè°ƒç”¨äº†ç”¨æˆ·ç¨‹åºä¸­æ‰€æœ‰ç”¨Cä»£ç ç¼–å†™çš„<code>initializers</code></b></p>
</blockquote>
<ul>
<li>ä¸­æ–‡è¿™ä¸ªç‰ˆæœ¬å®¹æ˜“è®©äººçœ‹è·‘äº†ï¼Œè¿™ä¸ªCä»£ç ä¸ä¸€å®šæ˜¯è‡ªå·±ç¼–å†™çš„ï¼Œåªè¦æ˜¯<b>C level</b>çº§åˆ«çš„<b>initializers</b>ï¼ˆåé¢æœ‰é¢„å¤„ç†ï¼Œé“¾æ¥ï¼Œä¸­è¯‘å®¹æ˜“è®©äººçœ‹è·‘ï¼‰</li>
</ul>
<h4 id="_initå‡½æ•°åˆ†æ">_initå‡½æ•°åˆ†æ</h4>
<h5 id="æºç ">æºç </h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">08048274 &lt;_init&gt;:
</span></span><span class="line"><span class="cl"> 8048274:       55                      push   %ebp
</span></span><span class="line"><span class="cl"> 8048275:       89 e5                   mov    %esp,%ebp
</span></span><span class="line"><span class="cl"> 8048277:       53                      push   %ebx
</span></span><span class="line"><span class="cl"> 8048278:       83 ec 04                sub    $0x4,%esp
</span></span><span class="line"><span class="cl"> 804827b:       e8 00 00 00 00          call   8048280 &lt;_init+0xc&gt;
</span></span><span class="line"><span class="cl"> 8048280:       5b                      pop    %ebx
</span></span><span class="line"><span class="cl"> 8048281:       81 c3 74 1d 00 00       add    $0x1d74,%ebx        (.got.plt)
</span></span><span class="line"><span class="cl"> 8048287:       8b 93 fc ff ff ff       mov    -0x4(%ebx),%edx
</span></span><span class="line"><span class="cl"> 804828d:       85 d2                   test   %edx,%edx
</span></span><span class="line"><span class="cl"> 804828f:       74 05                   je     8048296 &lt;_init+0x22&gt;
</span></span><span class="line"><span class="cl"> 8048291:       e8 1e 00 00 00          call   80482b4 &lt;__gmon_start__@plt&gt;
</span></span><span class="line"><span class="cl"> 8048296:       e8 d5 00 00 00          call   8048370 &lt;frame_dummy&gt;
</span></span><span class="line"><span class="cl"> 804829b:       e8 70 01 00 00          call   8048410 &lt;__do_global_ctors_aux&gt;
</span></span><span class="line"><span class="cl"> 80482a0:       58                      pop    %eax
</span></span><span class="line"><span class="cl"> 80482a1:       5b                      pop    %ebx
</span></span><span class="line"><span class="cl"> 80482a2:       c9                      leave
</span></span><span class="line"><span class="cl"> 80482a3:       c3                      ret
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="è°ƒç”¨">è°ƒç”¨</h5>
<ul>
<li>å½“åŠ è½½å™¨å°†æ§åˆ¶æƒäº¤ç»™<code>_start</code>å‡½æ•°ä¹‹åï¼Œ<code>_start</code>å‡½æ•°å°†ä¼šè°ƒç”¨<code>__libc_start_main</code>å‡½æ•°ï¼Œ<code>__libc_start_main</code>å‡½æ•°ä¼šè°ƒç”¨<code>__libc_csu_init</code>å‡½æ•°, <code>__libc_csu_init</code>å‡½æ•°ä¼šè°ƒç”¨<code>_init</code>å‡½æ•°</li>
</ul>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Update<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>End in 2023-03-08 0:44</p>
<p>è¿™ç§çœŸğŸ”8ï¸âƒ£ğŸ‘¨çš„æ–‡ç« çœŸæ˜¯çœ‹ç‚¹å°±çœ‹ä¸ä¸‹å»äº†ï¼Œæ˜å¤©æ¦‚ç‡è®ºï¼Œå…ˆç¡</p>
<p>æŸ<a href="https://daonan233.github.io" target="_blank" rel="noopener noreffer">55</a>ä»Šå¤©ç©äº†5h âšªï¼Œæ™šä¸Šå¸è½½ä¹‹åğŸ è‡ªå·±æ˜¯<b>S</b>ğŸ…±ï¸ï¼Œåªèƒ½è¯´æ˜¯dinnerè¡Œä¸ºäº†å§</p>
</div>
        </div>
    </div>
<h5 id="_initå‡½æ•°èµ·å§‹äºå¸¸è§„çš„cå‡½æ•°è°ƒç”¨"><code>_init</code>å‡½æ•°èµ·å§‹äºå¸¸è§„çš„Cå‡½æ•°è°ƒç”¨</h5>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Update<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>Update in 2023-03-08 10:04</p>
<p>ç¡é†’äº†ï¼Œæ„Ÿè§‰çœ‹äº†èƒ½æœ‰ä¸€åŠå¤šäº†ï¼Œä»Šå¤©å†çœ‹ç‚¹</p>
</div>
        </div>
    </div>
<ul>
<li>
<p>å¦‚æœæƒ³è¦è¯¦ç»†äº†è§£Cå‡½æ•°è°ƒç”¨è§„èŒƒï¼Œè¯·é˜…è¯»<a href="http://dbp-consulting.com/tutorials/debugging/basicAsmDebuggingGDB.html" target="_blank" rel="noopener noreffer">ã€ŠBasic Assembler Debugging with GDBã€‹</a></p>
</li>
<li>
<p>å¤§è‡´è¿‡ç¨‹</p>
<ul>
<li>è°ƒç”¨è€…çš„åŸºå€å¯„å­˜å™¨ï¼ˆ<code>%ebp</code>ï¼‰ä¼šè¢«ä¿å­˜åˆ°æ ˆé‡Œ(8048274)</li>
<li>å½“å‰å‡½æ•°çš„åŸºå€å¯„å­˜å™¨ï¼ˆ<code>%ebp</code>ï¼‰ä¼š<b>æŒ‡å‘æ ˆé¡¶</b>(8048275)</li>
<li>ç„¶åï¼Œ<b>ä¿ç•™4ä¸ªå­—èŠ‚ç©ºé—´</b>(8048278) $\Longrightarrow$ <u>æ›´å¥½çš„è§£é‡Šæ˜¯pushä¹‹å<code>%esp</code>è¦sub $0x4 æ¥ä¿è¯æ ˆæŒ‡é’ˆä»ç„¶æŒ‡å‘æ ˆé¡¶ï¼ˆæ ˆå‘ä¸‹å¢é•¿ï¼‰</u></li>
<li>è¿™ä¸ªè¿‡ç¨‹å’Œè°ƒç”¨<code>get_pc_trunk</code>éå¸¸åƒ</li>
</ul>
</li>
<li>
<p>è¦å¤§è‡´äº†è§£ä¸€ä¸‹stackå’Œfunctionè°ƒç”¨çš„å…³ç³»ï¼Œé˜…è¯»æ–‡ç« <a href="https://blog.csdn.net/max_ii_min/article/details/116047509?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167824270516800182771276%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=167824270516800182771276&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-116047509-null-null.142%5ev73%5ewechat,201%5ev4%5eadd_ask,239%5ev2%5einsert_chatgpt&amp;utm_term=esp%E5%AF%84%E5%AD%98%E5%99%A8&amp;spm=1018.2226.3001.4187" target="_blank" rel="noopener noreffer">ã€Šæ±‡ç¼–-æ ˆå¸§-å¯„å­˜å™¨esp, ebpã€‹</a></p>
</li>
<li>
<p>å¦‚æœä½ ä»”ç»†çœ‹çš„è¯ï¼Œå‘ç°è°ƒç”¨çš„æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Ÿï¼Ÿï¼Ÿå•¥æ“ä½œï¼Ÿï¼Ÿï¼Ÿ</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> 804827b:       e8 00 00 00 00          call   8048280 &lt;_init+0xc&gt;
</span></span><span class="line"><span class="cl"> 8048280:       5b                      pop    %ebx
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç»™äººæ„Ÿè§‰è¿™å°±æ˜¯åœ¨é¡ºåºæ‰§è¡Œï¼Œä¸è¿‡ä½ è¦ç”¨å‡½æ•°è°ƒç”¨çš„å‹æ ˆå‡ºæ ˆæ¥å¹²ä»€ä¹ˆï¼Ÿ
<ul>
<li>$\Longrightarrow$ <b>å½“å‰çš„åœ°å€è¢«å‹å…¥äº†æ ˆä¸­ã€‚ç„¶åé€šè¿‡å¼¹å‡ºæ ˆæ“ä½œï¼ŒåˆæŠŠå®ƒæ”¾åˆ°äº†<code>%ebx</code>ä¸­ï¼Œä¹‹åå°±å¯ä»¥ç”¨å®ƒæ¥è®¾ç½®è®¿é—®å…¨å±€è®¿é—®è¡¨äº†(.got.plt)</b></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> 8048277:       53                      push   %ebx
</span></span><span class="line"><span class="cl"> 8048278:       83 ec 04                sub    $0x4,%esp
</span></span><span class="line"><span class="cl"> 804827b:       e8 00 00 00 00          call   8048280 &lt;_init+0xc&gt;
</span></span><span class="line"><span class="cl"> 8048280:       5b                      pop    %ebx
</span></span><span class="line"><span class="cl"> 8048281:       81 c3 74 1d 00 00       add    $0x1d74,%ebx        (.got.plt)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="gmon_startå‡½æ•°åˆ†æ">gmon_startå‡½æ•°åˆ†æ</h4>
<h5 id="ç”Ÿæˆprofilehttpsenwikipediaorgwikiprofiling_computer_programmingæ–‡ä»¶">ç”Ÿæˆ<a href="https://en.wikipedia.org/wiki/Profiling_%28computer_programming%29" target="_blank" rel="noopener noreffer">profile</a>æ–‡ä»¶</h5>
<ul>
<li><code>gmon_start</code>å‡½æ•°ã€‚å¦‚æœå®ƒæ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬è·³è¿‡å®ƒï¼Œä¸è°ƒç”¨å®ƒã€‚å¦åˆ™ï¼Œè°ƒç”¨å®ƒæ¥è®¾ç½®profilingã€‚è¯¥å‡½æ•°è°ƒç”¨ä¸€ä¸ªä¾‹ç¨‹å¼€å§‹profilingï¼Œå¹¶ä¸”è°ƒç”¨<code>at_exit</code>å»è°ƒç”¨å¦ä¸€ä¸ªç¨‹åºè¿è¡Œ,å¹¶ä¸”åœ¨è¿è¡Œç»“æŸçš„æ—¶å€™ç”Ÿæˆgmon.out</li>
</ul>
<blockquote>
<p><em>ä¸ºäº†ä¼˜åŒ–è½¯ä»¶ä¸­é¢‘ç¹è°ƒç”¨çš„éƒ¨åˆ†ï¼Œä»è€Œæé«˜ç¨‹åºæ•´ä½“æ‰§è¡Œçš„æ•ˆç‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨gccç¼–è¯‘çš„æ—¶å€™åŠ ä¸Š</em> <code>-pg</code><em>æ ‡å¿—ã€‚è¿™æ ·åœ¨ç¨‹åºè¿è¡Œç»“æŸçš„æ—¶å€™ä¼šç”Ÿæˆä¸€ä¸ªè®°å½•ç¨‹åºè¿è¡ŒçŠ¶æ€çš„æ–‡ä»¶å«åš</em><code>gmon.out</code><em>ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåä¸º</em><code>gprof</code><em>çš„GNU profilerå·¥å…·æ¥åˆ†æè¯¥æ–‡ä»¶ä»è€Œè·å¾—ç¨‹åºå„éƒ¨åˆ†çš„è¿è¡Œæ—¶é—´ï¼Œæ¥åæ˜ å…¶è¿è¡Œæ€§èƒ½</em></p>
<p>ç›¸å…³æ–‡ç« ï¼š<a href="https://developer.ibm.com/" target="_blank" rel="noopener noreffer">ã€ŠHome IBM Developerã€‹</a></p>
</blockquote>
<h4 id="frame_dummyå‡½æ•°åˆ†æ">frame_dummyå‡½æ•°åˆ†æ</h4>
<ul>
<li><u>æ— è®ºé‚£ç§æƒ…å†µï¼ˆå‰é¢å‡½æ•°çš„æ‰§è¡Œæƒ…å†µï¼‰</u>(åŸæ–‡æ˜¯In either case)ï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬å°†è°ƒç”¨<code>frame_dummy</code>å‡½æ•°</li>
<li><code>frame_dummy</code>å‡½æ•°çš„ç›®çš„æ˜¯è°ƒç”¨<code>__register_frame_info</code>å‡½æ•°ï¼Œä½†æ˜¯ï¼Œè°ƒç”¨<code>frame_dummy</code>æ˜¯ä¸ºäº†ç»™ä¸Šè¿°å‡½æ•°è®¾ç½®å‚æ•°ã€‚è¿™ä¹ˆåšçš„ç›®çš„æ˜¯ä¸ºäº†åœ¨å‡ºé”™æ—¶è®¾ç½®<code>unwinding stack frames</code> $\Longrightarrow$ ä¸æ˜¯æœ¬æ¬¡é‡ç‚¹ï¼Œæƒ³äº†è§£è¯·é˜…è¯»<a href="https://stackoverflow.com/questions/2331316/what-is-stack-unwinding" target="_blank" rel="noopener noreffer">ã€ŠWhat is stack unwinding?ã€‹</a></li>
</ul>
<h4 id="_do_global_ctors_aux-longrightarrow-finally-were-getting-constructive"><code>_do_global_ctors_aux</code> $\Longrightarrow$ Finally we&rsquo;re getting constructive!</h4>
<ul>
<li>å¦‚æœåœ¨è°ƒç”¨mainå‡½æ•°ä¹‹å‰ï¼Œä½ çš„ç¨‹åºå‡ºäº†é—®é¢˜ï¼Œä½ å¾ˆå¯èƒ½éœ€è¦çœ‹çœ‹è¿™ä¸ªå‡½æ•°ã€‚å½“ç„¶ï¼Œè¿™é‡Œå­˜æ”¾äº†å…¨å±€C++å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œä½†æ˜¯ï¼Œè¿™é‡Œä¹Ÿèƒ½å­˜æ”¾å…¶ä»–ä¸œè¥¿ã€‚</li>
</ul>
<h5 id="example">Example</h5>
<ul>
<li>æˆ‘ä»¬æŠŠprog1.cä¿®æ”¹ä¸ºprog2.c</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">__attribute__</span> <span class="p">((</span><span class="n">constructor</span><span class="p">))</span> <span class="n">a_constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><code>void __attribute__ ((constructor)) a_constructor()</code>ï¼šå®ƒå‘Šè¯‰GCCï¼šé“¾æ¥å™¨åº”è¯¥åœ¨<code>__do_global_ctors_aux</code>ä½¿ç”¨çš„è¡¨é‡Œåˆ›å»ºä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘è¿™é‡Œ</p>
</li>
<li>
<p><code>__FUNCTION__</code>è¢«ç¼–è¯‘å™¨æ›¿æ¢æˆäº†å½“å‰å‡½æ•°çš„åå­—</p>
</li>
<li>
<p>è¿è¡Œ</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ./prog2
</span></span><span class="line"><span class="cl">a_constructor
</span></span><span class="line"><span class="cl">main
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åç¼–è¯‘çœ‹ä¸€ä¸‹<code>_init</code>çš„æ±‡ç¼–ï¼ˆè‡ªå·±çš„Linuxä¸Šé¢ç¼–ä¸å‡ºæ¥çš„å¯ä»¥çœ‹ä¸€ä¸‹<a href="https://stackoverflow.com/questions/27900834/do-global-ctors-aux-not-shown-in-objdump" target="_blank" rel="noopener noreffer">ã€Š__do_global_ctors_aux not shown in objdumpã€‹</a>ï¼Œä¸è¿‡çœ‹æ–‡ç« å°±è¡Œäº†ï¼‰</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">08048290 &lt;_init&gt;:
</span></span><span class="line"><span class="cl"> 8048290:       55                      push   %ebp
</span></span><span class="line"><span class="cl"> 8048291:       89 e5                   mov    %esp,%ebp
</span></span><span class="line"><span class="cl"> 8048293:       53                      push   %ebx
</span></span><span class="line"><span class="cl"> 8048294:       83 ec 04                sub    $0x4,%esp
</span></span><span class="line"><span class="cl"> 8048297:       e8 00 00 00 00          call   804829c &lt;_init+0xc&gt;
</span></span><span class="line"><span class="cl"> 804829c:       5b                      pop    %ebx
</span></span><span class="line"><span class="cl"> 804829d:       81 c3 58 1d 00 00       add    $0x1d58,%ebx
</span></span><span class="line"><span class="cl"> 80482a3:       8b 93 fc ff ff ff       mov    -0x4(%ebx),%edx
</span></span><span class="line"><span class="cl"> 80482a9:       85 d2                   test   %edx,%edx
</span></span><span class="line"><span class="cl"> 80482ab:       74 05                   je     80482b2 &lt;_init+0x22&gt;
</span></span><span class="line"><span class="cl"> 80482ad:       e8 1e 00 00 00          call   80482d0 &lt;__gmon_start__@plt&gt;
</span></span><span class="line"><span class="cl"> 80482b2:       e8 d9 00 00 00          call   8048390 &lt;frame_dummy&gt;
</span></span><span class="line"><span class="cl"> 80482b7:       e8 94 01 00 00          call   8048450 &lt;__do_global_ctors_aux&gt;
</span></span><span class="line"><span class="cl"> 80482bc:       58                      pop    %eax
</span></span><span class="line"><span class="cl"> 80482bd:       5b                      pop    %ebx
</span></span><span class="line"><span class="cl"> 80482be:       c9                      leave
</span></span><span class="line"><span class="cl"> 80482bf:       c3                      ret
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸Šè¿°çš„åœ°å€å’Œprog1çš„åœ°å€ç•¥å¾®æœ‰æ‰€ä¸åŒã€‚<u>è¿™äº›æœ‰å·®å¼‚çš„åœ°å€ä¼¼ä¹ç›¸å¯¹äºprog1ç§»åŠ¨äº†28ä¸ªå­—èŠ‚</u>ã€‚<b>è¿™é‡Œï¼Œæœ‰ä¸¤ä¸ªå‡½æ•°ï¼š<code>&quot;a_constructor&quot;</code>ï¼ˆåŠ ä¸Šç»“æŸç¬¦ä¸€å…±14ä¸ªå­—èŠ‚ï¼‰ã€<code>&quot;main&quot;</code>ï¼ˆåŠ ä¸Šç»“æŸç¬¦ä¸€å…±5ä¸ªå­—èŠ‚ï¼‰å’Œä¸¤ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²<code>&quot;%s\n&quot;</code>ï¼ˆ2*4ä¸ªå­—èŠ‚ï¼ŒåŠ ä¸Šä¸€ä¸ª1å­—èŠ‚çš„æ¢è¡Œç¬¦å’Œç»ˆæ­¢ç¬¦ï¼‰ï¼Œæ‰€ä»¥14 + 5 + 4 + 4 = 27ï¼Ÿ ä¼¼ä¹è¿˜å·®ä¸€ä¸ª</b>ã€‚ä¸ç®¡æ€æ ·ï¼Œè¿™åªæ˜¯ä¸ªçŒœæƒ³ï¼Œæˆ‘å°±ä¸ä»”ç»†ç ”ç©¶äº†ã€‚ç„¶åæˆ‘ä»¬å°±è¦è·³å…¥åˆ°<code>__do_global_ctors_aux</code>å‡½æ•°ä¸­å»ï¼Œçœ‹çœ‹åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚</li>
</ul>
<h5 id="æºç -1">æºç </h5>
<ul>
<li>ä½äºGCCæºç ä¸­çš„gcc/crtstuff.cé‡Œ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">__do_global_ctors_aux</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">func_ptr</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">p</span> <span class="o">=</span> <span class="n">__CTOR_END__</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">*</span><span class="n">p</span> <span class="o">!=</span> <span class="p">(</span><span class="n">func_ptr</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">p</span><span class="o">--</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¦‚ä¸Šæ‰€ç¤ºï¼Œpçš„å€¼è¢«åˆå§‹åŒ–æˆ<code>__CTOR_END__</code>å‡å»ä¸€ä¸ªå­—èŠ‚ã€‚è¿™æ˜¯ä¸€ç§æŒ‡é’ˆç®—æ³•
<ul>
<li><b>å¦‚æœæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ-1è¡¨ç¤ºå‘ä¸Šç§»åŠ¨ä¸€ä¸ªæŒ‡é’ˆæˆ–è€…è¯´4ä¸ªå­—èŠ‚</b>ã€‚<u>We&rsquo;ll see that in the assembler as well. While the pointer doesn&rsquo;t have a value of -1 (cast to a pointer), we&rsquo;ll call the function we&rsquo;re pointing at, and then back the pointer up again</u></li>
<li>è¿™ä¸ªæŒ‡é’ˆæ•°ç»„èµ·å§‹äº-1ï¼Œå¹¶ä¸”åŒ…å«è‹¥å¹²ä¸ªå‡½æ•°æŒ‡é’ˆ</li>
</ul>
</li>
</ul>
<h5 id="å¯¹åº”çš„æ±‡ç¼–">å¯¹åº”çš„æ±‡ç¼–</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">08048450 &lt;__do_global_ctors_aux&gt;:
</span></span><span class="line"><span class="cl"> 8048450:       55                      push   %ebp
</span></span><span class="line"><span class="cl"> 8048451:       89 e5                   mov    %esp,%ebp
</span></span><span class="line"><span class="cl"> 8048453:       53                      push   %ebx
</span></span><span class="line"><span class="cl"> 8048454:       83 ec 04                sub    $0x4,%esp
</span></span><span class="line"><span class="cl"> 8048457:       a1 14 9f 04 08          mov    0x8049f14,%eax
</span></span><span class="line"><span class="cl"> 804845c:       83 f8 ff                cmp    $0xffffffff,%eax
</span></span><span class="line"><span class="cl"> 804845f:       74 13                   je     8048474 &lt;__do_global_ctors_aux+0x24&gt;
</span></span><span class="line"><span class="cl"> 8048461:       bb 14 9f 04 08          mov    $0x8049f14,%ebx
</span></span><span class="line"><span class="cl"> 8048466:       66 90                   xchg   %ax,%ax
</span></span><span class="line"><span class="cl"> 8048468:       83 eb 04                sub    $0x4,%ebx
</span></span><span class="line"><span class="cl"> 804846b:       ff d0                   call   *%eax
</span></span><span class="line"><span class="cl"> 804846d:       8b 03                   mov    (%ebx),%eax
</span></span><span class="line"><span class="cl"> 804846f:       83 f8 ff                cmp    $0xffffffff,%eax
</span></span><span class="line"><span class="cl"> 8048472:       75 f4                   jne    8048468 &lt;__do_global_ctors_aux+0x18&gt;
</span></span><span class="line"><span class="cl"> 8048474:       83 c4 04                add    $0x4,%esp
</span></span><span class="line"><span class="cl"> 8048477:       5b                      pop    %ebx
</span></span><span class="line"><span class="cl"> 8048478:       5d                      pop    %ebp
</span></span><span class="line"><span class="cl"> 8048479:       c3                      ret
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="å‡½æ•°æœ€å¼€å§‹çš„éƒ¨åˆ†">å‡½æ•°æœ€å¼€å§‹çš„éƒ¨åˆ†</h5>
<ul>
<li>å‡½æ•°æœ€å¼€å§‹çš„éƒ¨åˆ†ä¾ç„¶éµä»äº†Cå‡½æ•°æ­£å¸¸çš„è°ƒç”¨æƒ¯ä¾‹ï¼ˆä¿å­˜è°ƒç”¨è€…çš„æ ˆåŸºå€å¯„å­˜å™¨ï¼Œè®¾ç½®å½“å‰å‡½æ•°çš„æ ˆåŸºå€å¯„å­˜å™¨ï¼‰ï¼Œæœ¬å‡½æ•°ä¸­è¿˜å¢åŠ äº†ä¸€ç‚¹ï¼šé¢å¤–æŠŠ<code>%ebx</code>ä¿å­˜åˆ°äº†æ ˆä¸­ï¼Œå› ä¸ºè¿™ä¸ªå‡½æ•°åé¢ä¼šä½¿ç”¨åˆ°å®ƒã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¸ºï¼ˆCä»£ç ä¸­çš„ï¼‰æŒ‡é’ˆpä¿ç•™äº†ç©ºé—´ã€‚ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œå³ä½¿æˆ‘ä»¬åœ¨æ ˆä¸Šä¸ºå…¶å¼€è¾Ÿäº†ç©ºé—´ï¼Œä½†æ˜¯ä»æœªä½¿ç”¨è¿™éƒ¨åˆ†ç©ºé—´ã€‚<b>å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œ<code>p</code>å°†ä¼šä¿å­˜åˆ°<code>%ebx</code>ä¸­ï¼Œ<code>*p</code>ä¼šä¿å­˜åˆ°<code>%eax</code>ä¸­</b>ã€‚$\Longrightarrow$ æ³¨æ„çœ‹å‰é¢_initçš„æ±‡ç¼–ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ ˆé‡Œé¢å¼¹å‡ºæ¥çš„ä¸œè¥¿ï¼Œåœ¨æœ¬å‡½æ•°çš„æ±‡ç¼–é‡Œé¢æ²¡æ‰¾åˆ° ï¼ˆâ“œï¸Dï¼ŒçœŸTMéš¾æ‰¾ï¼‰</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> 80482b7:       e8 94 01 00 00          call   8048450 &lt;__do_global_ctors_aux&gt;
</span></span><span class="line"><span class="cl"> 80482bc:       58                      pop    %eax
</span></span><span class="line"><span class="cl"> 80482bd:       5b                      pop    %ebx
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="å¾ªç¯ä¹‹å‰çš„è®¾ç½®">å¾ªç¯ä¹‹å‰çš„è®¾ç½®</h5>
<ul>
<li>çœ‹èµ·æ¥ç¼–è¯‘å™¨åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œç¼–è¯‘å™¨å¹¶æ²¡æœ‰ç›´æ¥â€œåŠ è½½<code>__CTOR_END__</code>ï¼Œç„¶åå°†å…¶å€¼å‡å»1ï¼Œå†æŸ¥æ‰¾å®ƒæŒ‡å‘çš„å†…å®¹â€ï¼Œè€Œæ˜¯ç›´æ¥åŠ è½½<code>*(__CTOR_END__ - 1)</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªç«‹å³æ•°<code>0x8049f14</code>ï¼ˆæ³¨æ„ï¼Œ<code>$0x8049f14</code>æ„æ€æ˜¯ä¸€ä¸ªç«‹å³æ•°ï¼Œè€Œä¸å¸¦<code>$</code>ï¼Œåªå†™<code>0x8049f14</code>çš„æ„æ€æ˜¯è¿™ä¸ªåœ°å€æŒ‡å‘çš„å†…å®¹ï¼‰ã€‚è¿™ä¸ªæ•°é‡Œé¢çš„å†…å®¹è¢«ç›´æ¥æ”¾åˆ°äº†%eaxä¸­ï¼Œç„¶åç«‹åˆ»æ¯”è¾ƒ%eaxå’Œ-1ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™è·³è½¬åˆ°åœ°å€0x8048474ï¼Œå›æ”¶æ ˆï¼Œå¼¹å‡ºæˆ‘ä»¬ä¿å­˜åœ¨æ ˆé‡Œçš„å†…å®¹ï¼Œå‡½æ•°è°ƒç”¨ç»“æŸï¼Œè¿”å›ã€‚</li>
<li>å‡è®¾åœ¨å‡½æ•°è¡¨ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå€¼ï¼Œç«‹å³æ•°<code>0x8049f14</code>è¢«å­˜æ”¾åˆ°<code>%ebx</code>ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°æŒ‡é’ˆ<code>p</code>ï¼Œç„¶åæ‰§è¡ŒæŒ‡ä»¤<code>xchg %ax,%ax</code>ï¼Œè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ$\Downarrow$</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> 8048461:       bb 14 9f 04 08          mov    $0x8049f14,%ebx
</span></span><span class="line"><span class="cl"> 8048466:       66 90                   xchg   %ax,%ax
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><b>åŸæ¥è¿™æ˜¯X86 16æˆ–è€…32ä½é‡Œçš„ä¸€ä¸ªnopï¼ˆNo Operationï¼‰è¯­å¥ã€‚å®ƒä»€ä¹ˆä¹Ÿä¸åšï¼Œåªæ˜¯å æ®äº†ä¸€ä¸ªæŒ‡ä»¤å‘¨æœŸï¼Œèµ·ä¸€ä¸ªå ä½ç¬¦ä½œç”¨è€Œå·²ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿å¾ªç¯å¼€å§‹äº<code>8048468</code>ï¼Œè€Œä¸æ˜¯<code>8048466</code>ã€‚<u>è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯ä½¿å¾ªç¯å¼€å§‹çš„åœ°æ–¹ä»¥4å­—èŠ‚å¯¹é½ï¼Œè¿™æ ·æ•´ä¸ªå¾ªç¯å°†ä¼šæå¤§å¯èƒ½çš„è¢«ä¿å­˜åˆ°ä¸€ä¸ªcache lineé‡Œï¼Œè€Œä¸ä¼šè¢«åˆ†æˆä¸¤æ®µï¼Œä»è€Œèµ·åˆ°åŠ é€Ÿæ‰§è¡Œçš„ä½œç”¨</u></b> ï¼ˆè¿™æ®µæ„Ÿè§‰ç¼–è¯‘å™¨å¥½ğŸ®ğŸ…±ï¸å•Šï¼‰</li>
<li>æ¥ä¸‹æ¥ï¼Œå°†<code>%ebx</code>å‡å»4ï¼Œä»è€Œä¸ºä¸‹ä¸€æ¬¡å¾ªç¯åšå¥½å‡†å¤‡ï¼Œè°ƒç”¨<code>%eax</code>é‡Œä¿å­˜çš„åœ°å€å¯¹åº”çš„å‡½æ•°ï¼Œç„¶åå°†ä¸‹ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆç§»è‡³<code>%eax</code>ä¸­ï¼Œå¹¶ä¸”å’Œ-1æ¯”è¾ƒï¼Œå¦‚æœä¸ç­‰äº-1ï¼Œå†æ¬¡è°ƒå›åˆ°ä¸Šè¿°å¾ªç¯</li>
</ul>
<h5 id="and-finally-the-epilogue">And finally the epilogue</h5>
<p>Otherwise we fall through into our function epilogue and return to <strong>_init</strong>, which immediately falls through into its epilogue and returns to <strong><strong>libc_csu_init</strong></strong>. Bet you forgot all about him. There&rsquo;s still a loop to deal with there but first&ndash;</p>
<h5 id="ä½¿ç”¨gdbæ£€æµ‹prog2">ä½¿ç”¨gdbæ£€æµ‹prog2</h5>
<ul>
<li><b>GDBæ€»æ˜¯æ˜¾ç¤ºä½ å°†è¦æ‰§è¡Œçš„ä¸‹ä¸€è¡Œæˆ–è€…ä¸‹ä¸€æ¡æŒ‡ä»¤</b></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ !gdb
</span></span><span class="line"><span class="cl">gdb prog2
</span></span><span class="line"><span class="cl">Reading symbols from /home/patrick/src/asm/prog2...done.
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> <span class="nb">set</span> disassemble-next-line on
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> b *0x80482b7
</span></span><span class="line"><span class="cl">Breakpoint <span class="m">1</span> at 0x80482b7
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¿è¡Œè°ƒè¯•å™¨ï¼Œæ‰“å¼€<code>disassemble-next-line</code>ï¼Œè¿™æ ·å®ƒå°±ä¼šæ€»æ˜¯æ˜¾ç¤ºä¸‹ä¸€æ¡å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„æ±‡ç¼–ä»£ç ï¼Œç„¶åæˆ‘ä»¬åœ¨<code>_init</code>å‡½æ•°å°†è¦è°ƒç”¨<code>__do_global_ctors_aux</code>å‡½æ•°çš„åœ°æ–¹è®¾ç½®ä¸€ä¸ªæ–­ç‚¹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> r
</span></span><span class="line"><span class="cl">Starting program: /home/patrick/src/asm/prog2 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Breakpoint 1, 0x080482b7 in _init <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080482b7 &lt;_init+39&gt;:    e8 <span class="m">94</span> <span class="m">01</span> <span class="m">00</span> <span class="m">00</span> call   0x8048450 &lt;__do_global_ctors_aux&gt;
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> si
</span></span><span class="line"><span class="cl">0x08048450 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048450 &lt;__do_global_ctors_aux+0&gt;:     <span class="m">55</span> push   %ebp
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¾“å…¥<code>r</code>ç»§ç»­è¿è¡Œç¨‹åºï¼Œåˆ°è¾¾æ–­ç‚¹å¤„ã€‚å†è¾“å…¥<code>si</code>å•æ­¥æ‰§è¡ŒæŒ‡ä»¤ï¼Œç°åœ¨æˆ‘ä»¬è¿›å…¥äº†<code>__do_global_ctors_aux</code>å‡½æ•°å†…éƒ¨ã€‚åé¢ä½ ä¼šçœ‹åˆ°è‹¥å¹²æ¬¡æˆ‘å¹¶æ²¡è¾“å…¥ä»»ä½•æŒ‡ä»¤ï¼Œä½†æ˜¯GDBå´ç»§ç»­æ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸ºæˆ‘åªæ˜¯æŒ‰äº†å›è½¦è€Œå·²ï¼ŒGDBé»˜è®¤ä¼šé‡å¤ä¸Šæ¡æŒ‡ä»¤ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘æŒ‰ä¸‹å›è½¦ï¼ŒGDBå°†ä¼šæŒ‰ç…§è¾“å…¥<code>si</code>ç»§ç»­æ‰§è¡Œ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span>
</span></span><span class="line"><span class="cl">0x08048451 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048451 &lt;__do_global_ctors_aux+1&gt;:     <span class="m">89</span> e5  mov    %esp,%ebp
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048453 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048453 &lt;__do_global_ctors_aux+3&gt;:     <span class="m">53</span> push   %ebx
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048454 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048454 &lt;__do_global_ctors_aux+4&gt;:     <span class="m">83</span> ec <span class="m">04</span>   sub    <span class="nv">$0</span>x4,%esp
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048457 in __do_global_ctors_aux <span class="o">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¥½çš„ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»æ‰§è¡Œå®Œç¨‹åºæœ€å¼€å§‹çš„éƒ¨åˆ†ï¼Œæ¥ä¸‹æ¥å°†è¦æ‰§è¡ŒçœŸæ­£çš„ä»£ç äº†ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048457 &lt;__do_global_ctors_aux+7&gt;:     a1 <span class="m">14</span> 9f <span class="m">04</span> <span class="m">08</span> mov    0x8049f14,%eax
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x0804845c in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x0804845c &lt;__do_global_ctors_aux+12&gt;:    <span class="m">83</span> f8 ff   cmp    <span class="nv">$0</span>xffffffff,%eax
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> p/x <span class="nv">$eax</span>
</span></span><span class="line"><span class="cl"><span class="nv">$1</span> <span class="o">=</span> 0x80483b4
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æˆ‘æƒ³çŸ¥é“åŠ è½½å®ŒæŒ‡é’ˆä¹‹åä¼šæ˜¯ä»€ä¹ˆæ ·ï¼Œæ‰€ä»¥è¾“å…¥äº†<code>p/x $eax</code>ï¼Œæ„æ€æ˜¯ä»¥åå…­è¿›åˆ¶çš„å½¢å¼æ‰“å°å¯„å­˜å™¨<code>%eax</code>çš„å†…å®¹ã€‚å®ƒä¸ç­‰äº-1ï¼Œæ‰€ä»¥æˆ‘ä»¬å‡å®šç¨‹åºå°†ç»§ç»­æ‰§è¡Œå¾ªç¯ã€‚ç°åœ¨ç”±äºæˆ‘çš„æœ€åä¸€æ¡æŒ‡ä»¤æ˜¯printæŒ‡ä»¤ï¼Œæ‰€ä»¥æˆ‘ä¸èƒ½æŒ‰å›è½¦ç»§ç»­æ‰§è¡Œäº†ï¼Œä¸‹æ¬¡æˆ‘å°±å¾—è¾“å…¥<code>si</code>äº†</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> si
</span></span><span class="line"><span class="cl">0x0804845f in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x0804845f &lt;__do_global_ctors_aux+15&gt;:    <span class="m">74</span> <span class="m">13</span>  je     0x8048474 &lt;__do_global_ctors_aux+36&gt;
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048461 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048461 &lt;__do_global_ctors_aux+17&gt;:    bb <span class="m">14</span> 9f <span class="m">04</span> <span class="m">08</span> mov    <span class="nv">$0</span>x8049f14,%ebx
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048466 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048466 &lt;__do_global_ctors_aux+22&gt;:    <span class="m">66</span> <span class="m">90</span>  xchg   %ax,%ax
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048468 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048468 &lt;__do_global_ctors_aux+24&gt;:    <span class="m">83</span> eb <span class="m">04</span>   sub    <span class="nv">$0</span>x4,%ebx
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x0804846b in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x0804846b &lt;__do_global_ctors_aux+27&gt;:    ff d0  call   *%eax
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">a_constructor <span class="o">()</span> at prog2.c:3
</span></span><span class="line"><span class="cl"><span class="m">3</span>   void __attribute__ <span class="o">((</span>constructor<span class="o">))</span> a_constructor<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080483b4 &lt;a_constructor+0&gt;:     <span class="m">55</span> push   %ebp
</span></span><span class="line"><span class="cl">   0x080483b5 &lt;a_constructor+1&gt;:     <span class="m">89</span> e5  mov    %esp,%ebp
</span></span><span class="line"><span class="cl">   0x080483b7 &lt;a_constructor+3&gt;:     <span class="m">83</span> ec <span class="m">18</span>   sub    <span class="nv">$0</span>x18,%esp
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>è¿™éƒ¨åˆ†ä»£ç å¾ˆæœ‰æ„æ€ã€‚æˆ‘ä»¬ä¸€æ­¥æ­¥è°ƒç”¨æ¥çœ‹çœ‹ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»è¿›å…¥äº†æˆ‘ä»¬è‡ªå·±å†™çš„å‡½æ•°<code>a_constructor</code>ã€‚å› ä¸ºGDBæ˜¯èƒ½çœ‹åˆ°æˆ‘ä»¬çš„æºä»£ç çš„ï¼Œæ‰€ä»¥å®ƒåœ¨ä¸‹ä¸€è¡Œç»™å‡ºäº†æˆ‘ä»¬æºç ã€‚åˆå› ä¸ºæˆ‘æ‰“å¼€äº†<code>disassemble-next-line</code>ï¼Œæ‰€ä»¥å®ƒä¹Ÿä¼šç»™å‡ºå¯¹åº”çš„æ±‡ç¼–ä»£ç ã€‚è¿™ä¸ªä¾‹å­ä¸­è¾“å‡ºäº†å‡½æ•°æœ€å¼€å§‹çš„éƒ¨åˆ†ï¼Œå¯¹åº”äº†å‡½æ•°çš„å£°æ˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°äº†ä¸‰è¡Œæ±‡ç¼–ã€‚æœ‰æ„æ€å§ï¼Ÿç°åœ¨ï¼Œæˆ‘è¾“å…¥<code>n</code>å‘½ä»¤ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†™çš„<code>prinf</code>å°±ä¼šè¢«è°ƒç”¨äº†ã€‚ç¬¬ä¸€ä¸ªnè·³è¿‡äº†ç¨‹åºæœ€å¼€å§‹çš„éƒ¨åˆ†ï¼Œç¬¬äºŒä¸ªnæ‰§è¡Œprinfï¼Œç¬¬ä¸‰ä¸ªnæ‰§è¡Œäº†å‡½æ•°çš„ç»“å°¾éƒ¨åˆ†ã€‚å¦‚æœä½ æƒ³çŸ¥é“ä¸ºä»€ä¹ˆä½ éœ€è¦åœ¨å‡½æ•°æœ€å¼€å§‹å’Œç»“æŸéƒ¨åˆ†åšäº›å¤„ç†çš„è¯ï¼Œç°åœ¨ï¼Œä½ ä½¿ç”¨GDBçš„å•æ­¥è°ƒè¯•åº”è¯¥èƒ½çŸ¥é“ç­”æ¡ˆäº†å§ã€‚</p>
</li>
<li>
<p>ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»æŠŠ<code>a_constructor</code>å­—ç¬¦ä¸²çš„åœ°å€ä½œä¸º<code>printf</code>çš„å‚æ•°ä¿å­˜åˆ°äº†æ ˆé‡Œï¼Œå› ä¸ºç¼–è¯‘å™¨è¶³å¤Ÿçš„æ™ºèƒ½ï¼Œå‘ç°å®é™…ä¸Š<code>puts</code>å‡½æ•°æ‰æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæ‰€ä»¥å®ƒè°ƒç”¨äº†<code>puts</code>å‡½æ•°ã€‚</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(gdb) n
</span></span><span class="line"><span class="cl">4       printf(&#34;%s\n&#34;, __FUNCTION__);
</span></span><span class="line"><span class="cl">=&gt; 0x080483ba &lt;a_constructor+6&gt;:     c7 04 24 a5 84 04 08   movl   $0x80484a5,(%esp)
</span></span><span class="line"><span class="cl">   0x080483c1 &lt;a_constructor+13&gt;:    e8 2a ff ff ff call   0x80482f0 &lt;puts@plt&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å› ä¸ºæˆ‘ä»¬æ­£åœ¨è¿è¡Œä¸­æ¥è°ƒè¯•ç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°äº†a_constructoræ‰“å°å‡ºäº†ä¸Šé¢çš„å†…å®¹ã€‚åæ‹¬å·}å¯¹åº”äº†å‡½æ•°çš„ç»“å°¾éƒ¨åˆ†</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> n
</span></span><span class="line"><span class="cl">a_constructor
</span></span><span class="line"><span class="cl"><span class="m">5</span>   <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080483c6 &lt;a_constructor+18&gt;:    c9 leave  
</span></span><span class="line"><span class="cl">   0x080483c7 &lt;a_constructor+19&gt;:    c3 ret 
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æœ‰å…³<code>leave</code>æŒ‡ä»¤å®é™…æ“ä½œ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> movl %ebp, %esp
</span></span><span class="line"><span class="cl"> popl %ebp
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç»§ç»­æ‰§è¡Œï¼Œæˆ‘ä»¬å°±é€€å‡ºäº†å‡½æ•°ï¼Œå¹¶è¿”å›äº†è°ƒç”¨å‡½æ•°ã€‚è¿™é‡Œæˆ‘åˆä¸å¾—ä¸è¾“å…¥<code>si</code>äº†ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> n
</span></span><span class="line"><span class="cl">0x0804846d in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x0804846d &lt;__do_global_ctors_aux+29&gt;:    8b <span class="m">03</span>  mov    <span class="o">(</span>%ebx<span class="o">)</span>,%eax
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> si
</span></span><span class="line"><span class="cl">0x0804846f in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x0804846f &lt;__do_global_ctors_aux+31&gt;:    <span class="m">83</span> f8 ff   cmp    <span class="nv">$0</span>xffffffff,%eax
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048472 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048472 &lt;__do_global_ctors_aux+34&gt;:    <span class="m">75</span> f4  jne    0x8048468 &lt;__do_global_ctors_aux+24&gt;
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> p/x <span class="nv">$eax</span>
</span></span><span class="line"><span class="cl"><span class="nv">$2</span> <span class="o">=</span> 0xffffffff
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æˆ‘æ¯”è¾ƒå¥½å¥‡ï¼Œå¹¶ä¸”å†æ¬¡çœ‹äº†ä¸€ä¸‹ï¼šè¿™æ¬¡ï¼Œæˆ‘ä»¬çš„å‡½æ•°æŒ‡é’ˆæŒ‡å‘äº†-1ï¼Œæ‰€ä»¥ï¼Œç¨‹åºé€€å‡ºäº†å¾ªç¯</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> si
</span></span><span class="line"><span class="cl">0x08048474 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048474 &lt;__do_global_ctors_aux+36&gt;:    <span class="m">83</span> c4 <span class="m">04</span>   add    <span class="nv">$0</span>x4,%esp
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048477 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048477 &lt;__do_global_ctors_aux+39&gt;:    5b pop    %ebx
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048478 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048478 &lt;__do_global_ctors_aux+40&gt;:    5d pop    %ebp
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x08048479 in __do_global_ctors_aux <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x08048479 &lt;__do_global_ctors_aux+41&gt;:    c3 ret    
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x080482bc in _init <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080482bc &lt;_init+44&gt;:    <span class="m">58</span> pop    %eax
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æˆ‘ä»¬ç°åœ¨é€€å›åˆ°äº†<code>_init</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x080482bd in _init <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080482bd &lt;_init+45&gt;:    5b pop    %ebx
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x080482be in _init <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080482be &lt;_init+46&gt;:    c9 leave  
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x080482bf in _init <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080482bf &lt;_init+47&gt;:    c3 ret    
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> 
</span></span><span class="line"><span class="cl">0x080483f9 in __libc_csu_init <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span>&gt; 0x080483f9 &lt;__libc_csu_init+25&gt;:  8d bb 1c ff ff ff  lea    -0xe4<span class="o">(</span>%ebx<span class="o">)</span>,%edi
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> q
</span></span><span class="line"><span class="cl">A debugging session is active.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Inferior <span class="m">1</span> <span class="o">[</span>process 17368<span class="o">]</span> will be killed.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Quit anyway? <span class="o">(</span>y or n<span class="o">)</span> y
</span></span><span class="line"><span class="cl">$
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å›åˆ°__libc_csu_init__">å›åˆ°<code>__libc_csu_init__</code></h4>
<ul>
<li>æºç </li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">__libc_csu_init</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">_init</span> <span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">size_t</span> <span class="n">size</span> <span class="o">=</span> <span class="n">__init_array_end</span> <span class="o">-</span> <span class="n">__init_array_start</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="o">*</span><span class="n">__init_array_start</span> <span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">envp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="è¿™æ˜¯å¦ä¸€ä¸ªå‡½æ•°çš„å¾ªç¯è°ƒç”¨">è¿™æ˜¯å¦ä¸€ä¸ªå‡½æ•°çš„å¾ªç¯è°ƒç”¨</h5>
<ul>
<li><code>__init__</code>æ•°ç»„é‡Œé¢æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä½ è‚¯å®šä¸ä¼šæƒ³åˆ°ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨è¿™ä¸ªé˜¶æ®µè‡ªå®šä¹‰ä»£ç ã€‚è¿™æ—¶åˆšåˆšä»è¿è¡Œæˆ‘ä»¬è‡ªå®šä¹‰çš„æ„é€ å‡½æ•°çš„<code>_init</code>å‡½æ•°è¿”å›ï¼Œè¿™æ„å‘³ç€ï¼Œåœ¨è¿™ä¸ªæ•°ç»„é‡Œé¢çš„å†…å®¹å°†ä¼šåœ¨æ„é€ å‡½æ•°å®Œæˆä¹‹åè¿è¡Œã€‚ä½ èƒ½é€šè¿‡æŸç§æ–¹å¼å‘Šè¯‰ç¼–è¯‘å™¨ä½ æƒ³åœ¨è¿™ä¸ªé˜¶æ®µè¿è¡ŒæŸä¸ªä½ è‡ªå®šä¹‰çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¹Ÿä¼šæ”¶åˆ°å’Œmainå‡½æ•°ç›¸åŒçš„å‚æ•°</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">&#34;.init_array&#34;</span><span class="p">)))</span> <span class="n">typeof</span><span class="p">(</span><span class="n">init</span><span class="p">)</span> <span class="o">*</span><span class="n">__init</span> <span class="o">=</span> <span class="n">init</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ç¨‹åºå°†è¿”å›__libc_start_main__">ç¨‹åºå°†è¿”å›<code>__libc_start_main__</code></h4>
<ul>
<li>å®ƒè°ƒç”¨äº†æˆ‘ä»¬çš„mainå‡½æ•°ï¼Œç„¶åæŠŠmainå‡½æ•°çš„è¿”å›å€¼ä¼ é€’ç»™exit()å‡½æ•°</li>
</ul>
<h5 id="exitå‡½æ•°è¿è¡Œäº†æ›´å¤šçš„å¾ªç¯">exit()å‡½æ•°è¿è¡Œäº†æ›´å¤šçš„å¾ªç¯</h5>
<ul>
<li>exit()å‡½æ•°æŒ‰ç…§æ³¨å†Œé¡ºåºä¾æ¬¡è¿è¡Œäº†åœ¨at_exit()ä¸­æ³¨å†Œçš„å‡½æ•°ã€‚ç„¶åä¼šè¿è¡Œå¦å¤–ä¸€ä¸ªå¾ªç¯ï¼Œè¿™æ¬¡çš„å¾ªç¯æ˜¯åœ¨<code>__fini_</code>æ•°ç»„ä¸­å®šä¹‰çš„ã€‚åœ¨è¿è¡Œå®Œè¿™äº›å‡½æ•°ä¹‹åï¼Œå°±ä¼šè°ƒç”¨ææ„å‡½æ•°ã€‚</li>
</ul>
<h3 id="è¿™ä¸ªç¨‹åºæŠŠä¸Šé¢æ‰€æœ‰çš„è¿‡ç¨‹è”ç³»äº†èµ·æ¥">è¿™ä¸ªç¨‹åºï¼ŒæŠŠä¸Šé¢æ‰€æœ‰çš„è¿‡ç¨‹è”ç³»äº†èµ·æ¥</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">preinit</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">fini</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">&#34;.init_array&#34;</span><span class="p">)))</span> <span class="n">typeof</span><span class="p">(</span><span class="n">init</span><span class="p">)</span> <span class="o">*</span><span class="n">__init</span> <span class="o">=</span> <span class="n">init</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">&#34;.preinit_array&#34;</span><span class="p">)))</span> <span class="n">typeof</span><span class="p">(</span><span class="n">preinit</span><span class="p">)</span> <span class="o">*</span><span class="n">__preinit</span> <span class="o">=</span> <span class="n">preinit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">&#34;.fini_array&#34;</span><span class="p">)))</span> <span class="n">typeof</span><span class="p">(</span><span class="n">fini</span><span class="p">)</span> <span class="o">*</span><span class="n">__fini</span> <span class="o">=</span> <span class="n">fini</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span>  <span class="nf">__attribute__</span> <span class="p">((</span><span class="n">constructor</span><span class="p">))</span> <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">__attribute__</span> <span class="p">((</span><span class="n">destructor</span><span class="p">))</span> <span class="n">destructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">my_atexit</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">my_atexit2</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">atexit</span><span class="p">(</span><span class="n">my_atexit</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="n">atexit</span><span class="p">(</span><span class="n">my_atexit2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç¼–è¯‘å¹¶è¿è¡Œè¿™ä¸ªå‡½æ•°ï¼ˆè¿™é‡Œæˆ‘å°†å…¶å‘½åä¸ºhooks.cï¼‰ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ./hooks
</span></span><span class="line"><span class="cl">preinit
</span></span><span class="line"><span class="cl">constructor
</span></span><span class="line"><span class="cl">init
</span></span><span class="line"><span class="cl">my_atexit2
</span></span><span class="line"><span class="cl">my_atexit
</span></span><span class="line"><span class="cl">fini
</span></span><span class="line"><span class="cl">destructor
</span></span><span class="line"><span class="cl">$
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å›é¡¾">å›é¡¾</h2>
<ul>
<li>è¿˜æ˜¯è¿™å¼ å›¾</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/support2-1.png" title="/img/Operating System/support2-1.png" data-thumbnail="/img/Operating System/support2-1.png" data-sub-html="<h2>æ€»ä½“æµç¨‹å›¾</h2>">
        
    </a><figcaption class="image-caption">æ€»ä½“æµç¨‹å›¾</figcaption>
    </figure>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<ul>
<li>æ±‡ç¼–çœŸTMéš¾åˆ†æ</li>
<li>ç”±äºæ˜¯32ä½çš„è€Linuxï¼Œæ‰€ä»¥æ²¡èƒ½åœ¨è‡ªå·±çš„è™šæ‹Ÿæœºä¸Šé¢å¤ç°</li>
<li>æ¶‰åŠç¼–è¯‘å’Œé“¾æ¥çš„è¿‡ç¨‹ï¼Œåº”è¯¥å»è¡¥<a href="https://luomuxiaoxiao.com/?p=137" target="_blank" rel="noopener noreffer">ã€Šè®¡ç®—æœºåŸç†ç³»åˆ—ä¹‹ä¸‰ â€”â€”â€“ å¦‚ä½•ç¼–è¯‘ç›®æ ‡æ–‡ä»¶ã€‹</a>è¿™ç¯‡æ–‡ç« </li>
</ul>
<h2 id="ç›¸å…³å‚è€ƒèµ„æ–™">ç›¸å…³å‚è€ƒèµ„æ–™</h2>
<ul>
<li>å‚è€ƒæ–‡ç« 
<ul>
<li>
<p><a href="http://dbp-consulting.com/tutorials/debugging/linuxProgramStartup.html" target="_blank" rel="noopener noreffer">ã€ŠLinux x86 Program Start Up or - How the heck do we get to main()? by Patrick Horganã€‹</a></p>
</li>
<li>
<p><a href="https://luomuxiaoxiao.com/?p=516" target="_blank" rel="noopener noreffer">ã€ŠLinux X86 ç¨‹åºå¯åŠ¨ â€“ mainå‡½æ•°æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„ï¼Ÿâ€”â€”è½æœ¨è§è§çš„åšå®¢ã€‹</a>ï¼ˆå·²ä¸ä½œè€…æ²Ÿé€šï¼ŒåŒæ„éƒ¨åˆ†è½¬è½½ï¼‰</p>
</li>
<li>
<p><a href="https://www.gnu.org/software/hurd/glibc/startup.html" target="_blank" rel="noopener noreffer">ã€ŠHow libc startup in a process worksã€‹</a></p>
</li>
</ul>
</li>
</ul>
]]></description>
</item>
<item>
    <title>é€Ÿé€šBigInteger</title>
    <link>https://Jungle430.github.io/posts/java/biginteger/</link>
    <pubDate>Tue, 28 Feb 2023 23:59:46 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/java/biginteger/</guid>
    <description><![CDATA[<h1 id="é€Ÿé€šbiginteger">é€Ÿé€šBigInteger</h1>
<ul>
<li>é¦–å…ˆéœ€è¦å¯¼åŒ…</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.math.BigInteger</span><span class="o">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><table border="2" >
	<tr>
		<td colspan="2">BigIntegerçš„ä¸€äº›æ–¹æ³•</td>
    </tr>
    <tr>
        <td>BigInteger bigInteger = new BigInteger("123456");</td>
        <td>ä½¿ç”¨Stringè¿›è¡Œåˆå§‹åŒ–</td>
    </tr>
    <tr>
        <td>abs()</td>
        <td>è¿”å›ä¸€ä¸ªBigIntegerã€‚å€¼ä¸ºå½“å‰å¯¹è±¡çš„ç»å¯¹å€¼</td>
    </tr>
    <tr>
        <td>add(BigInteger)</td>
        <td>ç›¸åŠ :<br>
            bigInteger = bigInteger.add(new BigInteger("123456"));</td>
    </tr>
    <tr>
        <td>and(BigInteger)</td>
        <td>äºŒè¿›åˆ¶AND(&)è¿ç®—ç¬¦:<br>
            bigInteger = bigInteger.and(new BigInteger("123456"));</td>
    </tr>
    <tr>
        <td>andNot(BigInteger)</td>
        <td>äºŒè¿›åˆ¶æŒ‰ä½ä¸éè¿ç®—ç¬¦,ç­‰åŒäºand(BigTnteger.not()):<br>
            bigInteger = bigInteger.andNot(new BigInteger("123456"));</td>
    </tr>
    <tr>
        <td>bitCount()</td>
        <td>è¯¥æ–¹æ³•ç”¨äºè¿”å›è¯¥BigIntegerçš„<u>è¡¥ç è¡¨ç¤ºä¸­ä¸ç¬¦å·ä½ä¸åŒçš„ä½æ•°</u></td>
    </tr>
    <tr>
        <td>bitLength()</td>
        <td>è¿”å›äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„é•¿åº¦</td>
    </tr>
    <tr>
        <td>compareTo(BigInteger)</td>
        <td>è¿”å›äºŒè€…æ¯”è¾ƒç»“æœ:å°äº -1ï¼Œ ç­‰äº 0ï¼Œ å¤§äº 1</td>
    </tr>
    <tr>
        <td>divide(BigInteger)</td>
        <td>ç›¸é™¤ï¼Œç›¸å½“äº"/"</td>
    </tr>
    <tr>
        <td>divideAndRemainder(BigInteger)</td>
        <td>è¿”å›ä¸€ä¸ªBigIntegeræ•°ç»„ï¼Œç¬¬ä¸€ä½æ˜¯æˆªæ–­ç»“æœ(/)ï¼Œç¬¬äºŒä½æ˜¯ä½™æ•°(%)</td>
    </tr>
    <tr>
        <td>doubleValue()</td>
        <td>è¿”å›å¯¹åº”çš„doubleå€¼</td>
    </tr>
    <tr>
        <td>gcd()</td>
        <td>gcd(abs(val1), abs(val2)),ä½¿ç”¨gcdç®—æ³•</td>
    </tr>
    <tr>
        <td>intValue(), longValue()</td>
        <td>è¿”å›å¯¹åº”ç±»å‹çš„å€¼</td>
    </tr>
    <tr>
        <td>max(), min()</td>
        <td>æœ€å¤§æœ€å°å€¼</td>
    </tr>
    <tr>
        <td>mod(BigInteger)</td>
        <td>ç›¸å½“äº%</td>
    </tr>
    <tr>
        <td>multiply(BigInteger)</td>
        <td>ç›¸å½“äºX</td>
    </tr>
    <tr>
    	<td>negate()</td>
        <td>å–ç›¸åæ•°</td>
    </tr>
    <tr>
        <td>pow(int)</td>
        <td>ä»¥è¯¥å¯¹è±¡ä¸ºåŸºåº•ï¼Œå‚æ•°ä¸ºå¹‚</td>
    </tr>
    <tr>
        <td>isProbablePrime(int certainty)</td>
        <td>æ˜¯å¦æ˜¯è´¨æ•°,certaintyÂ - è¿™ä¸€æªæ–½çš„è°ƒç”¨è€…èƒ½å®¹å¿çš„ä¸ç¡®å®šæ€§,æ­¤æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´æ­£æ¯”äºè¯¥å‚æ•°çš„å€¼</td>
    </tr>
    <tr>
        <td>shiftLeft(),shiftRight()</td>
        <td>å·¦ç§»,å³ç§»</td>
    </tr>
    <tr>
        <td>subtract()</td>
        <td>ç›¸å‡</td>
    </tr>
</table>    
]]></description>
</item>
<item>
    <title>Chapter2-éƒ¨åˆ†äºŒåˆ·-ä¸ªäººç†è§£System call</title>
    <link>https://Jungle430.github.io/posts/operating-system/support1/</link>
    <pubDate>Sun, 26 Feb 2023 21:02:57 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/operating-system/support1/</guid>
    <description><![CDATA[<h1 id="äºŒåˆ·éƒ¨åˆ†chapter2-longrightarrow-å¦‚ä½•ç†è§£system-call">äºŒåˆ·éƒ¨åˆ†Chapter2 $\Longrightarrow$ å¦‚ä½•ç†è§£<code>System call</code></h1>
<h2 id="é—®é¢˜æ„é€ æœ€å°çš„hello-worldç¨‹åº">é—®é¢˜ï¼šæ„é€ æœ€å°çš„â€Hello worldâ€ç¨‹åº</h2>
<h3 id="åŸºæœ¬ç¨‹åºå’Œé™æ€ç¼–è¯‘">åŸºæœ¬ç¨‹åºå’Œé™æ€ç¼–è¯‘</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello world&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -static hello.c -o hello <span class="o">&amp;&amp;</span> ./hello
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–è¯‘å‡ºæ¥å¾ˆå¤§(Ubuntuä¸Šçº¦900KB)</p>
<ul>
<li>å¦‚æœåªç¼–è¯‘ï¼Œä¸é“¾æ¥ï¼Œçœ‹ä¸€ä¸‹objæ–‡ä»¶çš„åæ±‡ç¼–</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gcc -c hello.c <span class="o">&amp;&amp;</span> objdump -d hello.o
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">hello.oï¼š     æ–‡ä»¶æ ¼å¼ elf64-x86-64
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Disassembly of section .text:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">0000000000000000</span> &lt;main&gt;:
</span></span><span class="line"><span class="cl">   0:	f3 0f 1e fa          	endbr64 
</span></span><span class="line"><span class="cl">   4:	<span class="m">55</span>                   	push   %rbp
</span></span><span class="line"><span class="cl">   5:	<span class="m">48</span> <span class="m">89</span> e5             	mov    %rsp,%rbp
</span></span><span class="line"><span class="cl">   8:	<span class="m">48</span> 8d <span class="m">05</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> 	lea    0x0<span class="o">(</span>%rip<span class="o">)</span>,%rax        <span class="c1"># f &lt;main+0xf&gt;</span>
</span></span><span class="line"><span class="cl">   f:	<span class="m">48</span> <span class="m">89</span> c7             	mov    %rax,%rdi
</span></span><span class="line"><span class="cl">  12:	b8 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>       	mov    <span class="nv">$0</span>x0,%eax
</span></span><span class="line"><span class="cl">  17:	e8 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>       	call   1c &lt;main+0x1c&gt;
</span></span><span class="line"><span class="cl">  1c:	b8 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>       	mov    <span class="nv">$0</span>x0,%eax
</span></span><span class="line"><span class="cl">  21:	5d                   	pop    %rbp
</span></span><span class="line"><span class="cl">  22:	c3                   	ret    
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å°±å’Œæ™®é€šçš„å‡½æ•°å·®ä¸å¤šï¼Œåªæœ‰å‚æ•°å‹æ ˆï¼Œcallå’Œå‚æ•°å‡ºæ ˆçš„è¿‡ç¨‹
<ul>
<li>æ™®é€šå‡½æ•°<code>fun.c</code></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">f</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -c fun.c <span class="o">&amp;&amp;</span> objdump -d fun.o 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fun.oï¼š     æ–‡ä»¶æ ¼å¼ elf64-x86-64
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Disassembly of section .text:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">0000000000000000</span> &lt;f&gt;:
</span></span><span class="line"><span class="cl">   0:	f3 0f 1e fa          	endbr64 
</span></span><span class="line"><span class="cl">   4:	<span class="m">55</span>                   	push   %rbp
</span></span><span class="line"><span class="cl">   5:	<span class="m">48</span> <span class="m">89</span> e5             	mov    %rsp,%rbp
</span></span><span class="line"><span class="cl">   8:	<span class="m">90</span>                   	nop
</span></span><span class="line"><span class="cl">   9:	5d                   	pop    %rbp
</span></span><span class="line"><span class="cl">   a:	c3                   	ret
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>å¯ä»¥çœ‹åˆ°ä¸é“¾æ¥çš„è¯å’Œæ™®é€šçš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹å·®ä¸å¤š</p>
</li>
<li>
<p>é“¾æ¥å¤±è´¥ï¼</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â—‹ â†’ ld hello.o
</span></span><span class="line"><span class="cl">ld: è­¦å‘Š: æ— æ³•æ‰¾åˆ°é¡¹ç›®ç¬¦å· _start<span class="p">;</span> ç¼ºçœä¸º <span class="m">0000000000401000</span>
</span></span><span class="line"><span class="cl">ld: hello.o: in <span class="k">function</span> <span class="sb">`</span>main<span class="s1">&#39;:
</span></span></span><span class="line"><span class="cl"><span class="s1">hello.c:(.text+0x18): undefined reference to `printf&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æœ¬æ¥ä»¥ä¸ºæ‰¾çš„<code>main</code>ï¼Œä½†æ˜¯å®ƒå®é™…ä¸Šåœ¨æ‰¾<code>_start</code>è¿™ä¸ªä¸œè¥¿ï¼Ÿ</li>
</ul>
<h3 id="é‚£æˆ‘ä»¬å°±æŠŠmainæ”¹æˆ_start">é‚£æˆ‘ä»¬å°±æŠŠ<code>main</code>æ”¹æˆ<code>_start</code></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">_start</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello world&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><figure><a class="lightgallery" href="/img/Operating%20System/support1-1.png" title="/img/Operating System/support1-1.png" data-thumbnail="/img/Operating System/support1-1.png" data-sub-html="<h2>ldä»ç„¶ä¸äºˆé€šè¿‡-&gt; æ‰¾ä¸åˆ°printf?</h2>">
        
    </a><figcaption class="image-caption"><code>ldä»ç„¶ä¸äºˆé€šè¿‡</code>-&gt; æ‰¾ä¸åˆ°printf?</figcaption>
    </figure>
<ul>
<li>é‚£æŠŠprintfä¹Ÿç»™å»äº†</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">_start</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç¼–è¯‘ä¸é“¾æ¥å…¨éƒ¨æˆåŠŸï¼</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â—‹ â†’ gcc -c hello.c <span class="o">&amp;&amp;</span> objdump -d hello.o <span class="o">&amp;&amp;</span> ld hello.o
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">hello.oï¼š     æ–‡ä»¶æ ¼å¼ elf64-x86-64
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Disassembly of section .text:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">0000000000000000</span> &lt;_start&gt;:
</span></span><span class="line"><span class="cl">   0:	f3 0f 1e fa          	endbr64 
</span></span><span class="line"><span class="cl">   4:	<span class="m">55</span>                   	push   %rbp
</span></span><span class="line"><span class="cl">   5:	<span class="m">48</span> <span class="m">89</span> e5             	mov    %rsp,%rbp
</span></span><span class="line"><span class="cl">   8:	<span class="m">90</span>                   	nop
</span></span><span class="line"><span class="cl">   9:	5d                   	pop    %rbp
</span></span><span class="line"><span class="cl">   a:	c3                   	ret    
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>ç¨‹åºå¾ˆå°ï¼Œåªæœ‰99ä¸ªå­—èŠ‚</p>
</li>
<li>
<p>ä½†æ˜¯è¿è¡Œ $\Longrightarrow$ æ®µé”™è¯¯ï¼</p>
</li>
<li>
<p>ä½†æ˜¯é‡Œé¢åŠ å…¥while(1)è¿™ç§æ­»å¾ªç¯å°±æ²¡äº‹äº†</p>
</li>
</ul>
<hr>
<ul>
<li>å¯¹äºæ²¡æœ‰while(1)çš„a.outï¼Œä½¿ç”¨gdbç‹ ç‹ çš„æ‹·æ‰“è°ƒè¯•</li>
</ul>
<a class="lightgallery" href="/img/Operating%20System/support1-2.jpg" title="/img/Operating System/support1-2.jpg" data-thumbnail="/img/Operating System/support1-2.jpg">
        
    </a>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çœ‹åˆ°rspçš„åœ°å€æ˜¯åˆæ³•çš„ï¼Œé‡Œé¢çš„å€¼æ˜¯1ï¼Œå½“æ‰§è¡Œretåï¼Œrspå°†æ ˆé¡¶çš„å€¼1èµ‹ç»™äº†pcï¼Œgdbæ˜¾ç¤ºpcè®¿é—®äº†éæ³•ä½ç½®</p>
<figure><a class="lightgallery" href="/img/Operating%20System/support1-3.png" title="/img/Operating System/support1-3.png" data-thumbnail="/img/Operating System/support1-3.png" data-sub-html="<h2>ğŸ¤¡å‘¦å¼ï¼Œå´©æºƒäº†ï¼</h2>">
        
    </a><figcaption class="image-caption">ğŸ¤¡å‘¦å¼ï¼Œå´©æºƒäº†ï¼</figcaption>
    </figure>
<ul>
<li>CPUåªä¼šæ‰§è¡ŒæŒ‡ä»¤ï¼Œè¯¥æ€ä¹ˆåœä¸‹æ¥ï¼Ÿ(mov,addè¿™äº›æŒ‡ä»¤åœä¸ä¸‹æ¥)</li>
<li>éœ€è¦ä»€ä¹ˆæŒ‡ä»¤è®©å®ƒåœä¸‹æ¥ï¼Ÿ $\Longrightarrow$ <code>System call</code> ä¹Ÿå°±æ˜¯ç®¡æ€</li>
</ul>
<h3 id="æœ€å°çš„hello-worldç¨‹åº">æœ€å°çš„<code>Hello world</code>ç¨‹åº</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/syscall.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="n">globl</span> <span class="n">_start</span>
</span></span><span class="line"><span class="cl"><span class="nl">_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="n">SYS_write</span><span class="p">,</span> <span class="o">%</span><span class="n">rax</span>   <span class="err">#</span> <span class="n">write</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span>         <span class="o">%</span><span class="n">rdi</span>   <span class="err">#</span>   <span class="n">fd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="n">st</span><span class="p">,</span>        <span class="o">%</span><span class="n">rsi</span>   <span class="err">#</span>   <span class="n">buf</span><span class="o">=</span><span class="n">st</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="p">(</span><span class="n">ed</span> <span class="o">-</span> <span class="n">st</span><span class="p">),</span> <span class="o">%</span><span class="n">rdx</span>   <span class="err">#</span>   <span class="n">count</span><span class="o">=</span><span class="n">ed</span><span class="o">-</span><span class="n">st</span>
</span></span><span class="line"><span class="cl">  <span class="n">syscall</span>                 <span class="err">#</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="n">SYS_exit</span><span class="p">,</span>  <span class="o">%</span><span class="n">rax</span>   <span class="err">#</span> <span class="n">exit</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span>         <span class="o">%</span><span class="n">rdi</span>   <span class="err">#</span>   <span class="n">status</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="n">syscall</span>                 <span class="err">#</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">st</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="n">ascii</span> <span class="s">&#34;</span><span class="se">\033</span><span class="s">[01;31mHello, OS World</span><span class="se">\033</span><span class="s">[0m</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nl">ed</span><span class="p">:</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å®ƒåœ¨å¹²ä»€ä¹ˆ
<ul>
<li>ç»™è®¸å¤šå¯„å­˜å™¨èµ‹å€¼ï¼Œç„¶åcalläº†syscall</li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/support1-4.png" title="/img/Operating System/support1-4.png" data-thumbnail="/img/Operating System/support1-4.png" data-sub-html="<h2>ç¼–è¯‘åæŸ¥çœ‹åæ±‡ç¼–ä»£ç </h2>">
        
    </a><figcaption class="image-caption">ç¼–è¯‘åæŸ¥çœ‹åæ±‡ç¼–ä»£ç </figcaption>
    </figure>
<ul>
<li>ldé“¾æ¥ï¼Œç¼–è¯‘æˆåŠŸï¼Œè¿è¡ŒæˆåŠŸï¼</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â—‹ â†’ objdump -d a.out <span class="p">|</span> less
</span></span></code></pre></td></tr></table>
</div>
</div><figure><a class="lightgallery" href="/img/Operating%20System/support1-5.png" title="/img/Operating System/support1-5.png" data-thumbnail="/img/Operating System/support1-5.png" data-sub-html="<h2>æŸ¥çœ‹åæ±‡ç¼–ä»£ç </h2>">
        
    </a><figcaption class="image-caption">æŸ¥çœ‹åæ±‡ç¼–ä»£ç </figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/support1-6.png" title="/img/Operating System/support1-6.png" data-thumbnail="/img/Operating System/support1-6.png" data-sub-html="<h2>man syscallæŸ¥çœ‹syscallçš„æ–‡æ¡£</h2>">
        
    </a><figcaption class="image-caption"><code>man syscall</code>æŸ¥çœ‹syscallçš„æ–‡æ¡£</figcaption>
    </figure>
<p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œsyscallä¼šå‘Šè¯‰æˆ‘ä»¬åœ¨å„ç§æ¶æ„çš„è®¡ç®—æœºä¸­è¯¥å¦‚ä½•é€šè¿‡å¯„å­˜å™¨ä¸ºsyscallä¼ å…¥å‚æ•°,<code>man syscalls</code>ä¼šå‘Šè¯‰æˆ‘ä»¬Linuxæ“ä½œç³»ç»Ÿçš„æ¥å£</p>
<ul>
<li>æ‰€ä»¥ç¨‹åºçš„æ‰§è¡Œæ¨¡å¼</li>
</ul>
<div class="mermaid" id="id-1"></div>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>æ„Ÿè°¢<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="typeit"><div id="id-2" class=""></div></div>
<p>æ„Ÿè°¢jyyäº’åŠ©ç¾¤é‡Œ<b>zweix</b>å¤§ä½¬æä¾›çš„<a href="https://github.com/zweix123/jyyslide-md" target="_blank" rel="noopener noreffer">
jyyslide-md</a></p>
<p>ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°å› ä¸ºWindowså¾ˆçƒ‚çš„ç¼–ç é—®é¢˜å§‹ç»ˆä¼šå‡ºç°gbkè§£ç é”™è¯¯çš„errorï¼Œå’Œ<b>zweix</b>å¤§ä½¬å·®ä¸å¤šæ²Ÿé€šäº†å¤§åŠä¸ªä¸‹åˆï¼Œç”±äºæ‡’å¾—ç»™vscodeé…ç¯å¢ƒç›´æ¥æ”¹æˆæ‰‹åŠ¨printçœ‹æ•°æ®ğŸ¤£ï¼Œæ„Ÿè§‰å°±æ˜¯å‘½ä»¤è¡Œä¼ å‚ç¼–ç çš„é—®é¢˜ï¼Œæœ€åç»ˆäºæ‰¾åˆ°äº†è§£å†³æ–¹æ³•ğŸ˜†ï¼Œåªèƒ½è¯´Windowsè¿™ä¸ªç¼–ç è®¾ç½®ä¹Ÿæ˜¯æ²¡è°äº†ã€‚</p>
</div>
        </div>
    </div>
]]></description>
</item>
<item>
    <title>ã€ŠC&#43;&#43; Primerã€‹ å­—ç¬¦ä¸²ï¼Œå‘é‡å’Œæ•°ç»„</title>
    <link>https://Jungle430.github.io/posts/cpp-primer/chapter3/</link>
    <pubDate>Wed, 22 Feb 2023 22:31:49 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/cpp-primer/chapter3/</guid>
    <description><![CDATA[<h1 id="c-primer">C++ Primer</h1>
<h2 id="å­—ç¬¦ä¸²å‘é‡å’Œæ•°ç»„">å­—ç¬¦ä¸²ï¼Œå‘é‡å’Œæ•°ç»„</h2>
<h3 id="æ ‡å‡†åº“ç±»å‹string">æ ‡å‡†åº“ç±»å‹string</h3>
<ul>
<li>æ ‡å‡†åº“ç±»å‹<code>string</code>è¡¨ç¤ºå¯å˜é•¿çš„å­—ç¬¦åºåˆ—ï¼Œä½¿ç”¨<code>string</code>ç±»å‹å¿…é¡»å…ˆåŒ…å«å¤´æ–‡ä»¶ï¼Œ<code>string</code>å®šä¹‰åœ¨å‘½åç©ºé—´<code>std</code>ä¸­</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å®šä¹‰å’Œåˆå§‹åŒ–<code>string</code>å¯¹è±¡</li>
</ul>
<table border="2" >
	<tr>
		<td colspan="2">åˆå§‹åŒ–stringå¯¹è±¡çš„æ–¹å¼</td>
	</tr>
	<tr>
		<td>string s1</td>
		<td>é»˜è®¤åˆå§‹åŒ–ï¼Œs1æ˜¯ä¸€ä¸ªç©ºä¸²</td>
	</tr>
	<tr>
		<td>string s2(s1)</td>
        <td>s2æ˜¯s1çš„å‰¯æœ¬</td>
	</tr>
	<tr>
		<td>string s2 = s1</td>
		<td>ç­‰ä»·äºs2(s1),s2æ˜¯s1çš„å‰¯æœ¬</td>
	</tr>
	<tr>
		<td>string s3("value")</td>
		<td>s3æ˜¯å­—é¢å€¼"value"çš„å‰¯æœ¬ï¼Œé™¤äº†å­—é¢å€¼æœ€åçš„é‚£ä¸ªç©ºå­—ç¬¦å¤–</td>
	</tr>
	<tr>
		<td>string s3 = "value"</td>
		<td>ç­‰ä»·äºs3("value"),s3æ˜¯å­—é¢å€¼"value"çš„å‰¯æœ¬
	</tr>
	<tr>
		<td>string s4(n, 'c')</td>
		<td>æŠŠs4åˆå§‹åŒ–ä¸ºç”±è¿ç»­nä¸ªå­—ç¬¦cç»„æˆçš„ä¸²</td>
	</tr>
</table>
<ul>
<li>
<p>ç›´æ¥åˆå§‹åŒ–å’Œæ‹·è´åˆå§‹åŒ–</p>
<ul>
<li>ä½¿ç”¨ç­‰å·(=) $\rightarrow$ <strong>æ‹·è´åˆå§‹åŒ–</strong>(copy initialization),ç¼–è¯‘å™¨æŠŠç­‰å·å³ä¾§çš„åˆå§‹å€¼æ‹·è´åˆ°æ–°åˆ›å»ºçš„å¯¹è±¡ä¸­å»</li>
<li>ä¸ä½¿ç”¨ç­‰å·ï¼Œæ‰§è¡Œçš„æ˜¯<strong>ç›´æ¥åˆå§‹åŒ–</strong>(direct initialization)</li>
</ul>
</li>
<li>
<p>å¦‚ä½•ä½¿ç”¨</p>
<ul>
<li>åˆå§‹åŒ–éœ€è¦ä¸€ä¸ªå€¼ï¼šæ‹·è´åˆå§‹åŒ–å’Œç›´æ¥åˆå§‹åŒ–éƒ½è¡Œ</li>
<li>åˆå§‹åŒ–éœ€è¦å¤šä¸ªå€¼
<ul>
<li>å°½é‡ç”¨ç›´æ¥åˆå§‹åŒ–</li>
<li>æ‹·è´åˆå§‹åŒ–éœ€è¦æ˜¾å¼åœ°åˆ›å»ºä¸€ä¸ªï¼ˆä¸´æ—¶ï¼‰å¯¹è±¡æ¥è¿›è¡Œæ‹·è´ï¼š<code>string s8 = string(10, 'c');</code>ï¼ˆå¯è¯»æ€§å·®ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•è¡¥å¿ä¼˜åŠ¿ï¼‰</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>string</code>å¯¹è±¡ä¸Šçš„æ“ä½œ</p>
</li>
</ul>
<table border="2" >
	<tr>
		<td colspan="2">stringçš„æ“ä½œ</td>
	</tr>
	<tr>
		<td>os << s</td>
		<td>å°†så†™åˆ°è¾“å‡ºæµoså½“ä¸­ï¼Œè¿”å›os</td>
	</tr>
	<tr>
		<td>is >> s</td>
		<td>ä»isä¸­è¯»å–å­—ç¬¦ä¸²èµ‹ç»™sï¼Œå­—ç¬¦ä¸²ä»¥ç©ºç™½åˆ†éš”ï¼Œè¿”å›is</td>
	</tr>
	<tr>
		<td>getline(is, s)</td>
		<td>ä»isä¸­è¯»å–ä¸€è¡Œèµ‹ç»™sï¼Œè¿”å›is(æ¢è¡Œç¬¦ä¹Ÿè¢«è¯»äº†è¿›æ¥,ä½†æ˜¯ä¸ä¼šå­˜å…¥è¯»å…¥çš„å­—ç¬¦ä¸²ä¸­å»)</td>
	</tr>
	<tr>
		<td>s.empty()</td>
		<td>sä¸ºç©ºè¿”å›trueï¼Œå¦åˆ™è¿”å›false</td>
	</tr>
	<tr>
		<td>s.size()</td>
		<td>è¿”å›sä¸­å­—ç¬¦çš„ä¸ªæ•°</td>
	</tr>
	<tr>
		<td>s[n]</td>
		<td>è¿”å›sä¸­ç¬¬nä¸ªå­—ç¬¦çš„<b>å¼•ç”¨</b></td>
	</tr>
    <tr>
        <td>s1 + s2</td>
        <td>è¿”å›s1å’Œs2è¿æ¥åçš„ç»“æœ</td>
    </tr>
    <tr>
        <td>s1 = s2</td>
        <td>ç”¨s2çš„å‰¯æœ¬æ›¿ä»£s1ä¸­åŸæ¥çš„å­—ç¬¦</td>
    </tr>
    <tr>
    	<td>s1 == s2</td>
        <td>å¦‚æœs1ä¸ªs2ä¸­æ‰€å«çš„å­—ç¬¦å®Œå…¨ä¸€æ ·ï¼Œåˆ™è¿”å›true,å¦åˆ™è¿”å›false</td>
    </tr>
    <tr>
    	<td>s1 != s2</td>
        <td>ç­‰æ€§åˆ¤æ–­å¯¹å­—æ¯çš„å¤§å°å†™æ•æ„Ÿ</td>
    </tr>
    <tr>
        <td><, <=, >, >=</td>
        <td>åˆ©ç”¨å­—å…¸åºè¿›è¡Œæ¯”è¾ƒï¼Œå¯¹å­—æ¯å¤§å°å†™æ•æ„Ÿ</td>
    </tr>
</table>    
<ul>
<li>æŠ€å·§:è¯»å–æœªçŸ¥æ•°é‡çš„stringå¯¹è±¡</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">word</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">word</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">word</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŸç†ï¼š<u>CTRL+Z/è¯»åˆ°æ–‡ä»¶æœ«å°¾ -&gt; å¼•å‘å¼‚å¸¸ -&gt; è®°å½•å¼‚å¸¸ -&gt; fail() è¿”å›true-&gt; operator void*() è¿”å› 0 -&gt; whileç»“æŸ</u>ï¼Œå‚è€ƒæ–‡ç« :<a href="https://www.zhangjiee.com/blog/2013/deep-into-while-cin.html" target="_blank" rel="noopener noreffer">C++ æ·±å…¥æ¢ç©¶ while(cin)</a></p>
<ul>
<li>å¦‚æœæ˜¯æŒ‰è¡Œè¯»</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">line</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">line</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>string::size_typeç±»å‹</p>
<ul>
<li>
<p>stringç±»çš„sizeå‡½æ•°è¿”å›çš„æ˜¯æ˜¯ä¸€ä¸ªstring::size_typeç±»å‹çš„å€¼ï¼Œæ— ç¬¦å·ç±»å‹ï¼Œè¶³ä»¥å­˜æ”¾ä¸‹ä»»ä½•<code>string</code>å¯¹è±¡çš„å¤§å°ï¼Œä¸‹æ ‡è¿ç®—ç¬¦å‚æ•°ç±»å‹ä¹Ÿæ˜¯å¦‚æ­¤</p>
</li>
<li>
<p>stringç±»ä»¥åŠå…¶ä»–å¤§å¤šæ•°æ ‡å‡†åº“ç±»å‹éƒ½å®šä¹‰äº†å‡ ç§é…å¥—çš„ç±»å‹ã€‚<u>è¿™äº›é…å¥—ç±»å‹ä½“ç°äº†æ ‡å‡†åº“ç±»å‹ä¸æœºå™¨æ— å…³çš„ç‰¹æ€§ï¼Œç±»å‹<b>size_type</b>å³æ˜¯å…¶ä¸­çš„ä¸€ç§</u>ã€‚æ ‡å‡†åº“ä¼šæ ¹æ®è¿è¡Œçš„æœºå™¨å‹å·åˆ†é…é€‚å½“çš„ç±»å‹ï¼Œæˆ‘ä»¬ä¸éœ€è¿‡å¤šå…³å¿ƒï¼Œå¦‚æœè¦çœ‹ç±»å‹åœ¨C++11ä»¥åå¯ä»¥å€ŸåŠ©<code>auto</code>å’Œ<code>decltype</code>æ¥æ¨æ–­å˜é‡ç±»å‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">len</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ç”±äºstring::size_typeæ˜¯ä¸€ä¸ªæ— ç¬¦å·ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å¯¹å­—ç¬¦ä¸²è¿›è¡Œæœ‰å…³sizeçš„ç›¸å…³æ“ä½œæ—¶ï¼Œå°½é‡é¿å…intä¸unsignedæ··ç”¨ï¼Œå¦åˆ™ä¼šç”±äºåè¡¥ç æœºåˆ¶å‡ºç°æ„æƒ³ä¸åˆ°çš„ä¸€äº›bugï¼Œæ­£ç¡®åšæ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">line</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span><span class="p">(</span><span class="k">decltype</span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">str</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">............</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>å­—å…¸åºç›¸å…³æ¯”è¾ƒæœºåˆ¶</p>
</li>
</ul>
<ol>
<li>è¾ƒçŸ­çš„stringå¯¹è±¡å°äºè¾ƒé•¿çš„stringå¯¹è±¡(å‰é¢çš„å†…å®¹éƒ½å®Œå…¨ç›¸åŒ)</li>
<li>å¦‚æœä¸¤ä¸ªstringå¯¹è±¡åœ¨æŸäº›å¯¹åº”çš„ä½ç½®ä¸Šä¸ä¸€è‡´ï¼Œåˆ™stringå¯¹è±¡æ¯”è¾ƒçš„ç»“æœå…¶å®æ˜¯stringå¯¹è±¡ä¸­ç¬¬ä¸€å¯¹ç›¸å¼‚å­—ç¬¦æ¯”è¾ƒçš„ç»“æœ</li>
</ol>
<ul>
<li>
<p>å­—é¢å€¼å’Œstringå¯¹è±¡ç›¸åŠ </p>
<ul>
<li>
<p>é€šè¿‡é‡è½½+å’Œ+=è¿ç®—ç¬¦å®ç°ï¼Œä½¿ç”¨æ—¶ä¸€å®šè¦æ³¨æ„è¿”å›å€¼çš„é—®é¢˜ï¼Œä¸è¦ä¸¤è¾¹ç±»å‹ä¸åŒ¹é…ï¼ˆä¾‹å¦‚ä¸¤ä¸ªå­—é¢å€¼ç›¸åŠ ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s3</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">+</span> <span class="s">&#34;, &#34;</span> <span class="o">+</span> <span class="n">s2</span> <span class="o">+</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>é˜²æ­¢ä¸Šè¿°é—®é¢˜ï¼š<b>å¿…é¡»ç¡®ä¿æ¯ä¸ªåŠ æ³•è¿ç®—ç¬¦(+)çš„ä¸¤ä¾§è¿ç®—å¯¹è±¡è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯string</b></p>
</li>
</ul>
</li>
<li>
<p>å¤„ç†stringå¯¹è±¡ä¸­çš„å­—ç¬¦</p>
<ul>
<li>ä¸»è¦åˆ©ç”¨åˆ°äº†å¤´æ–‡ä»¶<code>&lt;cctype&gt;</code></li>
</ul>
</li>
</ul>
<table border="2" >
	<tr>
		<td colspan="2">&ltccytpe&gtä¸­çš„å¸¸ç”¨å‡½æ•°</td>
	</tr>
    <tr>
        <td>isdigit(c)</td>
        <td>å½“cæ˜¯æ•°å­—çš„æ—¶å€™ä¸ºçœŸ</td>
    </tr>
    <tr>
        <td>islower(c)</td>
        <td>cæ˜¯å°å†™å­—æ¯çš„æ—¶å€™ä¸ºçœŸ</td>
    </tr>
    <tr>
        <td>isupper(c)</td>
        <td>cæ˜¯å¤§å†™å­—æ¯çš„æ—¶å€™ä¸ºçœŸ</td>
    </tr>
    <tr>
        <td>isspace(c)</td>
        <td>cæ˜¯ç©ºæ ¼çš„æ—¶å€™ä¸ºçœŸ</td>
    </tr>
    <tr>
        <td>tolower(c)</td>
        <td>å¦‚æœcæ˜¯å¤§å†™å­—æ¯ï¼Œåˆ™è¾“å‡ºå¯¹åº”çš„å°å†™å­—æ¯ï¼Œå¦åˆ™åŸæ ·è¾“å‡ºc</td>
    </tr>
    <tr>
        <td>toupper(c)</td>
        <td>å¦‚æœcæ˜¯å°å†™å­—æ¯ï¼Œåˆ™è¾“å‡ºå¯¹åº”çš„å¤§å†™å­—æ¯ï¼Œå¦åˆ™åŸæ ·è¾“å‡ºc</td>
    </tr>
</table> 
<blockquote>
<p>ä¸ºäº†å‘åå…¼å®¹Cï¼ŒC++ä¿ç•™äº†Cçš„æ ‡å‡†åº“ï¼Œä½†æ˜¯ä¸ºäº†æ›´å¥½åœ°ç¬¦åˆC++çš„è¦æ±‚ï¼ŒC++è‡ªå·±åˆå¼€å‘å‡ºäº†ä¸€å¥—æ–°çš„æ ‡å‡†åº“ï¼Œå»æ‰Cåº“ä¸­çš„.h,å‰é¢åŠ ä¸Šcï¼Œå³&lt;name.h&gt; $\rightarrow$ &lt;cname&gt;ï¼Œä¸Šé¢&lt;cctype&gt;å°±æ˜¯ç”±Cä¸­çš„&lt;ctype.h&gt;è¡ç”Ÿè¿‡æ¥çš„ï¼ŒC++åº“ä¸­çš„å‡½æ•°ä¸ºäº†é˜²æ­¢ä¸Cæ ‡å‡†åº“ä¸­çš„å†…å®¹å‘ç”Ÿå‘½åå†²çªï¼Œéƒ½åœ¨stdå‘½åç©ºé—´ä¸­</p>
</blockquote>
<ul>
<li>åŸºäºèŒƒå›´çš„forè¯­å¥
<ul>
<li>C++11çš„æ–°ç‰¹æ€§</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="nl">declaration</span> <span class="p">:</span> <span class="n">expression</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">statement</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//example    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span><span class="p">(</span><span class="s">&#34;Some string&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">c</span> <span class="p">:</span> <span class="n">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>é‡è½½çš„ä¸‹æ ‡è¿ç®—ç¬¦
<ul>
<li>operator[] -&gt; æ¥æ”¶è¾“å…¥æ˜¯std::string::size_typeç±»å‹çš„å€¼ï¼Œè¿”å›stringå¯¹åº”ä½ç½®å­—ç¬¦çš„å¼•ç”¨</li>
<li>è¶…å‡ºèŒƒå›´ä¸‹æ ‡å°†å¼•å‘ä¸å¯é¢„çŸ¥çš„ç»“æœï¼ˆå†…å­˜éæ³•è¶Šç•Œè®¿é—®æˆ–è€…è®¿é—®åˆ°<code>nullptr</code> $\rightarrow$ ç©ºå­—ç¬¦ä¸²ï¼ŒC++ä¸ºäº†æ€§èƒ½å¹¶ä¸ä¼šåƒJavaé‚£æ ·åœ¨ä¸‹æ ‡è®¿é—®æ—¶è¿›è¡Œæ£€æŸ¥ï¼Œä¼šæœ‰å¾ˆå¤§é£é™©ï¼‰</li>
</ul>
</li>
</ul>
<h3 id="æ ‡å‡†åº“ç±»å‹vector">æ ‡å‡†åº“ç±»å‹vector</h3>
<ul>
<li>
<p>vectoræœ¬è´¨æ˜¯ä¸€ç§å˜é•¿æ•°ç»„</p>
</li>
<li>
<p>vectorä¹Ÿæ˜¯ä¸€ç§å®¹å™¨(container)</p>
</li>
<li>
<p>vectoråŒ…å«äºå¤´æ–‡ä»¶&lt;vector&gt;ä¸­ï¼Œå®šä¹‰åœ¨stdå‘½åç©ºé—´ä¸‹</p>
</li>
<li>
<p>vectoræ˜¯ç±»æ¨¡æ¿ï¼Œä½¿ç”¨æ—¶å¿…é¡»å£°æ˜å…¶ç±»å‹ï¼ˆå…¶å®åœ¨Modern C++ä¸­ç¼–è¯‘å™¨ä¹Ÿèƒ½è‡ªå·±æ¨å¯¼ä¸€éƒ¨åˆ†äº†ï¼‰ï¼Œç¼–è¯‘å™¨æ ¹æ®æ¨¡æ¿åˆ›å»ºç±»æˆ–å‡½æ•°å‡½æ•°çš„è¿‡ç¨‹ç§°ä¸º<b>å®ä¾‹åŒ–</b>(instantiation),ç”±äºC++çš„åˆ†ç¦»å¼ç¼–è¯‘ï¼Œ<b>è‡ªå·±å†™æ¨¡æ¿çš„æ—¶å€™ä¸€å®šè¦å°†å£°æ˜ä¸å®ç°éƒ½å†™åœ¨.hé‡Œï¼Œä¸è¦å°†å®ç°åˆ†ç¦»åˆ°.cppä¸­ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥</b></p>
</li>
</ul>
<figure><a class="lightgallery" href="/img/C&#43;&#43;%20Primer/chapter3-1.jpg" title="/img/C&#43;&#43; Primer/chapter3-1.jpg" data-thumbnail="/img/C&#43;&#43; Primer/chapter3-1.jpg" data-sub-html="<h2>ç”±äºæ¨¡æ¿çš„å£°æ˜ä¸å®ç°åˆ†ç¦»å¯¼è‡´ç¼–è¯‘å¤±è´¥</h2>">
        
    </a><figcaption class="image-caption"><code>ç”±äºæ¨¡æ¿çš„å£°æ˜ä¸å®ç°åˆ†ç¦»å¯¼è‡´ç¼–è¯‘å¤±è´¥</code></figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/C&#43;&#43;%20Primer/chapter3-2.jpg" title="/img/C&#43;&#43; Primer/chapter3-2.jpg" data-thumbnail="/img/C&#43;&#43; Primer/chapter3-2.jpg" data-sub-html="<h2>å…¨éƒ¨å†™å…¥å¤´æ–‡ä»¶åç¼–è¯‘æˆåŠŸ</h2>">
        
    </a><figcaption class="image-caption"><code>å…¨éƒ¨å†™å…¥å¤´æ–‡ä»¶åç¼–è¯‘æˆåŠŸ</code></figcaption>
    </figure>
<ul>
<li>vectorèƒ½å®¹çº³ç»å¤§å¤šæ•°ç±»å‹çš„å¯¹è±¡ä½œä¸ºå…¶å…ƒç´ ï¼Œä½†æ˜¯å› ä¸º<u>å¼•ç”¨ä¸æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥ä¸å­˜åœ¨åŒ…å«å¼•ç”¨çš„vector</u></li>
</ul>
<hr>
<ul>
<li>å®šä¹‰å’Œåˆå§‹åŒ–vectorå¯¹è±¡</li>
</ul>
<table border="2" >
	<tr>
		<td colspan="2">åˆå§‹åŒ–vectorå¯¹è±¡çš„æ–¹æ³•</td>
	</tr>
    <tr>
        <td>vector&ltT&gt v1</td>
        <td>v1æ˜¯ä¸€ä¸ªç©ºvectorï¼Œå®ƒæ½œåœ¨çš„å…ƒç´ æ˜¯Tç±»å‹çš„ï¼Œæ‰§è¡Œé»˜è®¤åˆå§‹åŒ–</td>
    </tr>
    <tr>
    	<td>vector&ltT&gt v2(v1)</td>
        <td>v2ä¸­åŒ…å«æœ‰v1æ‰€æœ‰å…ƒç´ çš„å‰¯æœ¬</td>
    </tr>
    <tr>
        <td>vector&ltT&gt v2 = v1</td>
        <td>ç­‰ä»·äºv2(v1),v2ä¸­åŒ…å«æœ‰v1æ‰€æœ‰å…ƒç´ çš„å‰¯æœ¬</td>
    </tr>
    <tr>
        <td>vector&ltT&gt v3(n, val)</td>
        <td>v3åŒ…å«äº†nä¸ªé‡å¤å…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ çš„å€¼éƒ½æ˜¯val</td>
    </tr>
    <tr>
    	<td>vector&ltT&gt v4(n)</td>
        <td>v4é‡å¤åŒ…å«äº†nä¸ªé‡å¤åœ°æ‰§è¡Œäº†å€¼åˆå§‹åŒ–çš„å¯¹è±¡ï¼ˆé»˜è®¤åˆå§‹åŒ–ï¼‰</td>
    </tr>
    <tr>
        <td>vector&ltT&gt v5{a, b, c, ...}</td>
        <td>v5åŒ…å«äº†åˆå§‹å€¼ä¸ªæ•°çš„å…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ éƒ½è¢«èµ‹äºˆäº†ç›¸åº”çš„åˆå§‹å€¼(æ³¨æ„ä½¿ç”¨èŠ±æ‹¬å·)</td>
    </tr>
    <tr>
        <td>vector&ltT&gt v5 = {a, b, c, ...}</td>
        <td>ç­‰ä»·äºv5{a, b, c, ...}</td>
    </tr>
</table>    
<ul>
<li>
<p>åœ†æ‹¬å·ä¸èŠ±æ‹¬å·</p>
<ul>
<li>åœ†æ‹¬å·æ˜¯æä¾›çš„å€¼ç”¨æ¥æ„é€ (construct)vectorå¯¹è±¡çš„</li>
<li>èŠ±æ‹¬å·æ˜¯ç”¨æ¥è¿›è¡Œåˆ—è¡¨åˆå§‹åŒ–çš„(list initialize),åˆå§‹åŒ–è¿‡ç¨‹ä¼šå°½å¯èƒ½çš„æŠŠèŠ±æ‹¬å·å†…çš„å€¼å½“æˆæ˜¯å…ƒç´ åˆå§‹å€¼çš„åˆ—è¡¨æ¥å¤„ç†ï¼Œåªæœ‰åœ¨<u>æ— æ³•æ‰§è¡Œåˆ—è¡¨åˆå§‹åŒ–æ—¶æ‰ä¼šè€ƒè™‘å…¶ä»–åˆå§‹åŒ–æ–¹å¼</u> $\Longrightarrow$ åˆ—è¡¨å†…æ•°æ®ä¸æ‰€éœ€å…ƒç´ ç±»å‹ä¸åŒ</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v1</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// -&gt; {0, 0, 0, 0, 0, 0, 0, 0, 0, 0} 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v2</span><span class="p">{</span><span class="mi">10</span><span class="p">};</span> <span class="c1">// -&gt; {10}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v3</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// -&gt; {1, 1, 1, 1, 1, 1, 1, 1, 1, 1}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v4</span><span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">};</span> <span class="c1">// -&gt; {10, 1}
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åˆ—è¡¨åˆå§‹åŒ–æ„é€ å¤±è´¥è½¬ä¸ºç›´æ¥æ„é€ </li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">v5</span><span class="p">{</span><span class="mi">10</span><span class="p">};</span> <span class="c1">//10ä¸ªé»˜è®¤åˆå§‹åŒ–string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">v8</span><span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="s">&#34;hi&#34;</span><span class="p">};</span> <span class="c1">//10ä¸ª&#34;hi&#34;
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<ul>
<li>vectoræœ‰å…³æ“ä½œ</li>
</ul>
<table border="2" >
	<tr>
		<td colspan="2">vectoræ”¯æŒçš„æ“ä½œ</td>
	</tr>
    <tr>
        <td>v.empty()</td>
        <td>è¿”å›å…ƒç´ ä¸ªæ•°æ˜¯å¦ä¸ºç©º</td>
    </tr>
    <tr>
        <td>v.size()</td>
        <td>è¿”å›å…ƒç´ ä¸ªæ•°</td>
    </tr>
    <tr>
        <td>v.push_back(t)</td>
        <td>å‘vçš„å°¾ç«¯æ·»åŠ ä¸€ä¸ªå€¼ä¸ºtçš„å…ƒç´ </td>
    </tr>
    <tr>
        <td>v[n]</td>
        <td>ä¸‹æ ‡è®¿é—®ï¼Œè¿”å›ç¬¬nä¸ªä½ç½®ä¸Šå…ƒç´ çš„å¼•ç”¨</td>
    </tr>
    <tr>
        <td>v1 = v2</td>
        <td>ç”¨v2ä¸­å…ƒç´ çš„æ‹·è´æ›¿æ¢v1ä¸­çš„å…ƒç´ </td>
    </tr>
    <tr>
        <td>v1 = {a, b, c...}</td>
        <td>ç”¨åˆ—è¡¨ä¸­çš„å…ƒç´ æ‹·è´æ›¿æ¢v1ä¸­çš„å…ƒç´ </td>
    </tr>
    <tr>
        <td>v1 == v2; v1 != v2</td>
        <td>åˆ¤ç­‰æ¡ä»¶ï¼šå…ƒç´ æ•°é‡ç›¸ç­‰ä¸”å¯¹åº”ä½ç½®çš„å…ƒç´ å€¼ç›¸ç­‰(å¯¹è±¡éœ€è¦é‡è½½==å’Œ!=è¿ç®—ç¬¦)</td>
    </tr>
    <tr>
        <td>&lt, &lt=, &gt, &gt=</td>
        <td>å­—å…¸åºæ¯”è¾ƒï¼Œå¯¹è±¡éœ€è¦é‡è½½ç›¸åº”è¿ç®—ç¬¦</td>
    </tr>
</table> 
<ul>
<li>æœ‰å…³ä½¿ç”¨push_backçš„å»ºè®®</li>
</ul>
<ol>
<li>ä¸éœ€è¦åœ¨åˆ›å»º<code>vector</code>æ—¶ç¡®å®šå…¶ä¸­çš„å…ƒç´ åŠå…¶å¤§å°ï¼Œåç»­ä½¿ç”¨push_backå³å¯</li>
<li>åœ¨å¾ªç¯ä½“å†…éƒ¨åŒ…å«å‘<code>vector</code>å¯¹è±¡æ·»åŠ å…ƒç´ çš„æ“ä½œæ—¶ï¼Œä¸åº”è¯¥ä½¿ç”¨<code>foreach</code>å¾ªç¯</li>
</ol>
<ul>
<li>
<p>size()è¿”å›çš„ç±»å‹ä¸ºvector::size_type,åŒstring::size_type,ç”±å¤´æ–‡ä»¶å’Œæœºå™¨æ¥å†³å®šç±»å‹ï¼Œä¸‹æ ‡è¿ç®—ç¬¦å‚æ•°ç±»å‹ä¹Ÿæ˜¯å¦‚æ­¤(åŒstring)</p>
</li>
<li>
<p>è™½ç„¶vectorå¯ä»¥æ‰©å®¹ï¼Œä½†æ˜¯ä¸èƒ½é€šè¿‡ä¸‹æ ‡æ¥æ·»åŠ å…ƒç´ ï¼Œé€šè¿‡ä¸‹æ ‡è®¿é—®ä¸å­˜åœ¨çš„å…ƒç´ ä¼šäº§ç”Ÿéå¸¸ä¸¥é‡çš„åæœï¼Œä¾‹å¦‚ç¼“å†²åŒºæº¢å‡º(<code>buffer overflow</code>),ä¼šå¯¼è‡´å‡ºç°å®‰å…¨é—®é¢˜</p>
</li>
</ul>
<h3 id="è¿­ä»£å™¨ä»‹ç»ä¸ä½¿ç”¨">è¿­ä»£å™¨ä»‹ç»ä¸ä½¿ç”¨</h3>
<ul>
<li>ç›®çš„ï¼šè®¿é—®å¯¹è±¡ä¸­çš„å…ƒç´ </li>
<li>è¿­ä»£å™¨ç±»ä¼¼äºæŒ‡é’ˆç±»å‹ï¼Œ<u>ä¹Ÿæä¾›äº†å¯¹å¯¹è±¡çš„é—´æ¥è®¿é—®</u>ï¼Œä½¿ç”¨è¿­ä»£å™¨å¯ä»¥è®¿é—®æŸä¸ªå…ƒç´ ï¼Œä¹Ÿå¯ä»¥ä»ä¸€ä¸ªå…ƒç´ ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå…ƒç´ </li>
<li>æœ‰æ•ˆä¸æ— æ•ˆè¿­ä»£å™¨
<ul>
<li>æœ‰æ•ˆï¼šè¿­ä»£å™¨æŒ‡å‘<u>æŸä¸ªå…ƒç´ æˆ–è€…å®¹å™¨ä¸­å°¾å…ƒç´ çš„ä¸‹ä¸€ä½ç½®</u></li>
<li>æ— æ•ˆï¼šé™¤äº†ä¸Šè¿°æŒ‡å‘çš„è¿­ä»£å™¨éƒ½æ— æ•ˆ</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>è·å–è¿­ä»£å™¨ï¼šè·å–è¿­ä»£å™¨ä¸èƒ½ä½¿ç”¨å–åœ°å€ç¬¦ï¼Œæœ‰ä¸“é—¨çš„æ–¹æ³•è¿›è¡Œè·å–ï¼Œå®¹å™¨ä¸€èˆ¬éƒ½æ”¯æŒ<b>begin</b>å’Œ<b>end</b>æ–¹æ³•
<ul>
<li>beginè¿”å›æŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ çš„è¿­ä»£å™¨</li>
<li>endè¿”å›æŒ‡å‘å®¹å™¨<b>â€œå°¾å…ƒç´ çš„ä¸‹ä¸€ä½ç½®(one past the end)â€çš„è¿­ä»£å™¨</b>,è¿™æ ·çš„è¿­ä»£å™¨æ²¡æœ‰ä»€ä¹ˆå®é™…æ„ä¹‰ï¼Œåªæ˜¯ä¸€ä¸ªæ ‡è®°ï¼Œè¡¨ç¤ºæˆ‘ä»¬å·²ç»å¤„ç†å®Œäº†å®¹å™¨ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚endæˆå‘˜è¿”å›çš„è¿­ä»£å™¨é€šå¸¸è¢«ç§°ä¸º<b>å°¾åè¿­ä»£å™¨(off-the-end iterator)æˆ–å°¾è¿­ä»£å™¨(end iterator)</b></li>
<li><b>å¦‚æœå®¹å™¨ä¸ºç©ºï¼Œbeginå’Œendè¿”å›çš„æ˜¯åŒä¸€ä¸ªè¿­ä»£å™¨,éƒ½æ˜¯å°¾åè¿­ä»£å™¨(å¯ä»¥ä½œä¸ºå®¹å™¨çš„åˆ¤ç©ºæ‰‹æ®µï¼‰</b></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">b</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">e</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><table border="2" >
	<tr>
		<td colspan="2">æ ‡å‡†å®¹å™¨è¿­ä»£å™¨çš„è¿ç®—ç¬¦</td>
	</tr>
    <tr>
        <td>*iter</td>
        <td>è¿”å›è¿­ä»£å™¨iteræ‰€æŒ‡å…ƒç´ çš„å¼•ç”¨</td>
    </tr>
    <tr>
        <td>iter->men</td>
        <td>è§£å¼•ç”¨iterå¹¶è·å¾—è¯¥å…ƒç´ çš„åä¸ºmençš„æˆå‘˜ï¼Œç­‰ä»·äº(*iter).men</td>
    </tr>
    <tr>
        <td>++iter</td>
        <td>ä»¤iteræŒ‡ç¤ºå®¹å™¨ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ </td>
    </tr>
    <tr>
        <td>--iter</td>
        <td>ä»¤iteræŒ‡ç¤ºå®¹å™¨ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ </td>
    </tr>
    <tr>
        <td>iter1 == iter2; iter1 != iter2</td>
        <td>åˆ¤ç­‰æ¡ä»¶ï¼šä¸¤ä¸ªè¿­ä»£å™¨æŒ‡ç¤ºçš„æ˜¯åŒä¸€ä¸ªå…ƒç´ æˆ–è€…ä»–ä»¬æ˜¯åŒä¸€ä¸ªå®¹å™¨çš„å°¾åè¿­ä»£å™¨ï¼Œåˆ™ç›¸ç­‰ï¼›åä¹‹åˆ™ä¸ç­‰</td>
    </tr>
</table>    
<ul>
<li>è¯•å›¾è§£å¼•ç”¨ä¸€ä¸ªéæ³•è¿­ä»£å™¨æˆ–è€…å°¾åè¿­ä»£å™¨ä¹Ÿæ˜¯å±é™©è¡Œä¸ºï¼</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">string</span> <span class="nf">s</span><span class="p">(</span><span class="s">&#34;Some thing&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">!=</span> <span class="n">s</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span> <span class="c1">// -&gt; is empty?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">it</span> <span class="o">=</span> <span class="n">toupper</span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€èˆ¬å¾ªç¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">ii</span> <span class="o">!=</span> <span class="n">s</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//......
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>å¤§å¤šæ•°æ ‡å‡†åº“å®¹å™¨çš„è¿­ä»£å™¨éƒ½å®šä¹‰äº†<code>==</code>å’Œ<code>!=</code>ï¼Œä½†æ˜¯å®ƒä»¬ä¸­çš„å¤§å¤šæ•°éƒ½æ²¡æœ‰å®šä¹‰<code>&lt;</code>è¿ç®—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨è¿­ä»£å™¨æ˜¯å°½é‡ä½¿ç”¨<code>==</code>å’Œ<code>!=</code></p>
</li>
<li>
<p>è¿­ä»£å™¨ç±»å‹</p>
<ul>
<li>iteratorå¯è¯»å¯å†™</li>
<li>const_iteratoråªè¯»</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">it</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">it</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>å®é™…ä½¿ç”¨ä¸­ä½¿ç”¨autoè®©ç¼–è¯‘å™¨å†³å®šå³å¯</p>
</li>
<li>
<p><code>begin()</code>å’Œ<code>end</code>è‡ªå·±å†³å®šè¿”å›çš„æ˜¯å¦ä¸ºconstï¼Œå¦‚æœå¿…é¡»è¦ç”¨const_iterator,ä½¿ç”¨<code>cbegin()</code>å’Œ<code>cend()</code>å³å¯<code>C++ 11</code></p>
</li>
<li>
<p>æ³¨æ„ï¼Œå‡¡æ˜¯ä½¿ç”¨äº†è¿­ä»£å™¨çš„å¾ªç¯ä½“ï¼Œéƒ½ä¸è¦å‘è¿­ä»£å™¨æ‰€å±çš„å®¹å™¨ä¸­æ·»åŠ å…ƒç´ ï¼Œå¦åˆ™å¯èƒ½ä¼šé€ æˆè¿­ä»£å™¨å¤±æ•ˆ</p>
</li>
</ul>
<hr>
<ul>
<li>è¿­ä»£å™¨è¿ç®—</li>
</ul>
<table border="2" >
	<tr>
		<td colspan="2">è¿­ä»£å™¨è¿ç®—</td>
	</tr>
    <tr>
        <td>iter + n</td>
        <td>è¿­ä»£å™¨åŠ ä¸Šäº†ä¸€ä¸ªæ•´æ•°å€¼ä»å¾—ä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿­ä»£å™¨æŒ‡ç¤ºçš„æ–°ä½ç½®ä¸åŸæ¥ç›¸æ¯”å‘åç§»åŠ¨äº†è‹¥å¹²å…ƒç´ </td>
    </tr>
    <tr>
        <td>iter - n</td>
        <td>è¿­ä»£å™¨å‡å»äº†ä¸€ä¸ªæ•´æ•°å€¼ä»å¾—ä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿­ä»£å™¨æŒ‡ç¤ºçš„æ–°ä½ç½®ä¸åŸæ¥ç›¸æ¯”å‘å‰ç§»åŠ¨äº†è‹¥å¹²å…ƒç´ </td>
    </tr>
    <tr>
        <td>iter += n</td>
        <td>iter = iter + n</td>
    </tr>
    <tr>
        <td>iter -= n</td>
        <td>iter = iter - n</td>
    </tr>
    <tr>
        <td>iter1 - iter2</td>
        <td>ä¸¤ä¸ªè¿­ä»£å™¨ç›¸å‡çš„ç»“æœæ˜¯å®ƒä»¬ä¹‹é—´çš„è·ç¦»ï¼Œä¸¤ä¸ªè¿­ä»£å™¨å¿…é¡»æ˜¯åŒä¸€ä¸ªå®¹å™¨çš„æœ‰æ•ˆè¿­ä»£å™¨ï¼Œè¿”å›å€¼ç±»å‹ä¸º<b>difference_type(å¸¦ç¬¦å·ç±»å‹)</b></td>
    </tr>
    <tr>
        <td>&gt, &gt=, &lt, &lt=</td>
        <td>å…³ç³»è¿ç®—ç¬¦ï¼Œæ³¨æ„ä¸¤ä¸ªè¿­ä»£å™¨å¿…é¡»æ˜¯åŒä¸€ä¸ªå®¹å™¨çš„æœ‰æ•ˆè¿­ä»£å™¨</td>
    </tr>
</table>    
<h3 id="æ•°ç»„">æ•°ç»„</h3>
<ul>
<li>ç¼–è¯‘çš„æ—¶å€™æ•°ç»„çš„ç»´åº¦åº”è¯¥æ˜¯å·²çŸ¥çš„ï¼Œ<b>ç»´åº¦å¿…é¡»æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼</b></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="c1">// ä¸æ˜¯å¸¸é‡è¡¨è¾¾å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">constexpr</span> <span class="kt">unsigned</span> <span class="n">sz</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>  <span class="c1">//å¸¸é‡è¡¨è¾¾å¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><u>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ ä¼šè¢«é»˜è®¤åˆå§‹åŒ–</u> $\Longrightarrow$ <b>è¿™é‡Œæ³¨æ„å¦‚æœé‡åˆ°äº†<code>new</code>å’Œ<code>delete</code>ç›¸å…³çš„ä¸€äº›æ“ä½œï¼Œä¸€å®šè¦é˜²æ­¢é»˜è®¤åˆå§‹åŒ–æ”¹å˜æŒ‡é’ˆæœ€åå¯¼è‡´<code>delete</code>é‡Šæ”¾å†…å­˜çš„æ—¶å€™ç¨‹åºå´©æºƒ</b></li>
</ul>
<figure><a class="lightgallery" href="/img/C&#43;&#43;%20Primer/chapter3-3.png" title="/img/C&#43;&#43; Primer/chapter3-3.png" data-thumbnail="/img/C&#43;&#43; Primer/chapter3-3.png" data-sub-html="<h2>HEAP CORRUPTION DETECTEDæŠ¥é”™è¯´æ˜åŠè§£å†³æ–¹æ¡ˆ</h2>">
        
    </a><figcaption class="image-caption"><a href="https://blog.csdn.net/weixin_44426759/article/details/107194567?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167729932416800182739726%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=167729932416800182739726&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-107194567-null-null.142%5ev73%5ewechat,201%5ev4%5eadd_ask,239%5ev2%5einsert_chatgpt&amp;utm_term=heap%20corruption%20detected&amp;spm=1018.2226.3001.4187" target="_blank" rel="noopener noreffer">HEAP CORRUPTION DETECTEDæŠ¥é”™è¯´æ˜åŠè§£å†³æ–¹æ¡ˆ</a></figcaption>
    </figure>
<ul>
<li>æ˜¾å¼åˆå§‹åŒ– $\Longrightarrow$ é€šè¿‡åˆ—è¡¨åˆå§‹åŒ–æ•°ç»„</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">const</span> <span class="kt">unsigned</span> <span class="n">sz</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">ia1</span><span class="p">[</span><span class="n">sz</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">a2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span> <span class="c1">//ç»´åº¦ä¸º3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">a3</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span> <span class="c1">// {0, 1, 2, 0, 0} åé¢ä¼šé»˜è®¤åˆå§‹åŒ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">a5</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span> <span class="c1">//é”™è¯¯ï¼Œåˆå§‹å€¼è¿‡å¤š
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å­—ç¬¦æ•°ç»„
<ul>
<li>å­—ç¬¦æ•°ç»„å¯ä»¥ç”¨å­—ç¬¦ä¸²å­—é¢å€¼è¿›è¡Œèµ‹å€¼ï¼Œä½†æ˜¯è¦æ³¨æ„æœ€åè¿˜æœ‰ä¸€ä¸ªç»ˆæ­¢ç¬¦</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">char</span> <span class="n">a</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&#34;Hello world&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span> <span class="n">b</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;Daniel&#34;</span><span class="p">;</span> <span class="c1">//é”™è¯¯ï¼Œå¿½ç•¥äº†æœ€åçš„&#39;\0&#39;
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä¸èƒ½å°†æ•°ç»„çš„å†…å®¹æ‹·è´ç»™å…¶ä»–æ•°ç»„ä½œä¸ºå…¶åˆå§‹å€¼ï¼Œä¹Ÿä¸èƒ½ç”¨æ•°ç»„ä¸ºå…¶ä»–æ•°ç»„èµ‹å€¼</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">a</span><span class="p">[]{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">a2</span><span class="p">[]</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span> <span class="c1">//é”™è¯¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">a2</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span> <span class="c1">//é”™è¯¯
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æœ¬è´¨æ˜¯æŒ‡é’ˆçš„æ‹·è´ï¼Œæœ€åå®¹æ˜“å¯¼è‡´å‡ºç°å†…å­˜æ³„æ¼å’Œé‡æŒ‡é’ˆé—®é¢˜ï¼Œè™½ç„¶éƒ¨åˆ†ç¼–è¯‘å™¨æ”¯æŒä¸Šè¿°è¡Œä¸ºï¼Œä½†æ˜¯ä¸ºäº†å®‰å…¨æ€§å’Œé€šç”¨æ€§ï¼Œå°½é‡ä¸è¦å‡ºç°ä¸Šè¿°ä»£ç </p>
</blockquote>
<ul>
<li>
<p>é˜…è¯»æ•°ç»„å£°æ˜å«ä¹‰ï¼šç”±å†…å‘å¤–è¯»</p>
</li>
<li>
<p>æ•°ç»„ä¹Ÿå¯ä»¥ç”¨åŸºäºèŒƒå›´çš„forå¾ªç¯</p>
</li>
<li>
<p>è®¿é—®æ•°ç»„å…ƒç´ ä½¿ç”¨çš„ä¸‹æ ‡ç”¨çš„ç±»å‹ä¸º<code>size_t</code>ï¼Œä¹Ÿæ˜¯ä¸€ç§æœºå™¨ç›¸å…³ç±»å‹ï¼Œå¤´æ–‡ä»¶Cï¼š<b>&lt;stddef.h&gt;</b> $\Longrightarrow$ C++ï¼š<b>&lt;cstddef&gt;</b>ï¼Œä½†æ˜¯å†…ç½®ä¸‹æ ‡è¿ç®—ç¬¦ä¹Ÿå¯ä»¥ä½¿ç”¨è´Ÿæ•°(ä¸åŒäºvectorå’Œstring)</p>
</li>
<li>
<p>æ•°ç»„çš„ä¸‹æ ‡è®¿é—®åŒæ ·åªç”±ç¨‹åºå‘˜è´Ÿè´£æ£€æŸ¥ï¼Œä¸€å®šè¦é˜²æ­¢éæ³•è®¿é—®</p>
</li>
<li>
<p><code>auto</code>è¿”å›çš„æ˜¯æŒ‡é’ˆ,<code>decltype</code>è¿”å›çš„æ˜¯æ•°ç»„</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//æŒ‡é’ˆè¿­ä»£å™¨ç”¨æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">arr</span><span class="p">[</span><span class="mi">10</span><span class="p">]{};</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="o">*</span><span class="n">e</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">arr</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="n">arr</span><span class="p">;</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">e</span><span class="p">;</span> <span class="n">b</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">do_something</span><span class="p">(</span><span class="o">*</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>C++11åå¼•å…¥äº†beginå’Œendå‡½æ•°(å®šä¹‰äº&lt;iterator&gt;ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªå‡½æ•°è·å¾—çš„æŒ‡é’ˆæ¥æ¨¡æ‹Ÿè¿­ä»£å™¨</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">arr</span><span class="p">[]{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="o">*</span><span class="n">begin</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">begin</span><span class="p">(</span><span class="n">arr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="o">*</span><span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">end</span><span class="p">(</span><span class="n">arr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(;</span> <span class="n">begin</span> <span class="o">!=</span> <span class="n">end</span><span class="p">;</span> <span class="n">begin</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">begin</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>ä¸¤ä¸ªæŒ‡é’ˆç›¸å‡çš„ç»“æœç±»å‹æ˜¯<code>ptrdiff_t</code>çš„æœºå™¨ç›¸å…³æœ‰ç¬¦å·ç±»å‹ï¼Œå®šä¹‰äº&lt;cstddef&gt;æ–‡ä»¶ä¸­</p>
</li>
<li>
<p>åŒä¸€æ•°ç»„çš„ä¸¤ä¸ªæœ‰æ•ˆæŒ‡é’ˆå¯ä»¥è¿›è¡Œæ¯”è¾ƒ</p>
</li>
<li>
<p>Cé£æ ¼çš„å­—ç¬¦ä¸²å¤„ç†å‡½æ•°ä½äºå¤´æ–‡ä»¶&lt;cstring&gt;ä¸­ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿æ€§å’Œå®‰å…¨æ€§ï¼ŒC++ç¨‹åºä¸­å°½é‡ä½¿ç”¨std::string</p>
</li>
<li>
<p>Cé£æ ¼çš„å­—ç¬¦ä¸²æ¯”è¾ƒå®é™…æ˜¯åœ¨æ¯”è¾ƒå­—ç¬¦ä¸²æ•°ç»„é¦–åœ°å€</p>
</li>
<li>
<p>æ—§ä»£ç æ¥å£</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">string</span> <span class="n">s</span> <span class="p">{</span><span class="s">&#34;Hello world&#34;</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ä½†æ˜¯åœ¨åç»­ç”±äºæ‰©å®¹ç­‰æœºåˆ¶c_str()çš„æŒ‡é’ˆå¯èƒ½ä¼šå¤±å»ä½œç”¨ï¼Œæœ€å¥½é€šè¿‡s.c_str()æ‹·è´å¤åˆ¶ä¸€ä»½
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="o">*</span><span class="n">arr</span><span class="p">[]{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">vector</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">arr</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">arr</span><span class="p">));</span> <span class="c1">// -&gt; {0, 1, 2, 3, 4, 5}
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><u>å»ºè®®ï¼šå°½é‡ä½¿ç”¨æ ‡å‡†åº“è€ŒéæŒ‡é’ˆå’Œæ•°ç»„</u></li>
</ul>
<blockquote>
<p>å¤šç»´æ•°ç»„åŸºäºèŒƒå›´çš„forå¾ªç¯ï¼Œé™¤äº†æœ€å†…å±‚ï¼Œå…¶ä»–æ‰€æœ‰å¾ªç¯çš„æ§åˆ¶å˜é‡éƒ½åº”è¯¥æ˜¯å¼•ç”¨ï¼ˆè½¬åŒ–ä¸ºæ•°ç»„ï¼Œå¦‚æœä¸æ˜¯å¼•ç”¨ä¼šè½¬åŒ–ä¸ºæŒ‡é’ˆ)</p>
<p>for (auto &amp;i : arr)</p>
<p>â€‹	for (auto &amp;j : i)</p>
<p>â€‹		for (auto k : j) {</p>
<p>â€‹			do_something(k);</p>
<p>}</p>
</blockquote>
<div id="id-1"><strong>Ending</strong></div>
]]></description>
</item>
<item>
    <title>CMU 15-445 Lecture #01: Course Overview &amp; Relational Model</title>
    <link>https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter1/</link>
    <pubDate>Wed, 22 Feb 2023 15:23:14 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/cmu-15-445-database-systems/chapter1/</guid>
    <description><![CDATA[<h1 id="cmu-15-445-database-systems">CMU 15-445 Database Systems</h1>
<h2 id="lecture-01-course-overview--relational-model">Lecture #01: Course Overview &amp; Relational Model</h2>
<h3 id="outline">Outline</h3>
<ul>
<li>Course Logistics</li>
<li>Relational Model</li>
<li>Relational Algebra</li>
</ul>
<h3 id="course-overiew">Course overiew</h3>
<ul>
<li>This course is about the design/implementation of database management systems (<code>DBMSs</code>)</li>
<li>This is <strong>not</strong> a course ($\rightarrow Key\ point\ is\ the\ theory\ and\ the\ concept$) about how to use a DBMS to build applications or how to administer a DBMS.â†’ See <a href="http://www.heinz.cmu.edu/academic-resources/course-results/course-details/index.aspx?cid=273" target="_blank" rel="noopener noreffer">CMU 95-703</a> (Heinz College)</li>
</ul>
<h3 id="projects">PROJECTS</h3>
<ul>
<li>
<p>All projects will use the CMU DB Group <a href="https://github.com/cmu-db/bustub" target="_blank" rel="noopener noreffer">BusTub</a> academic DBMS.</p>
<ul>
<li>â†’ Each project builds on the previous one.</li>
<li>â†’ We will not teach you how to write/debug C++17</li>
</ul>
</li>
<li>
<p><strong>complete <a href="https://15445.courses.cs.cmu.edu/fall2022/project0/" target="_blank" rel="noopener noreffer">Project #0</a> ! ! !</strong></p>
</li>
</ul>
<h3 id="database">Database</h3>
<ul>
<li>
<p><strong>Organized collection of inter-related data that models some aspect of the real-world</strong></p>
</li>
<li>
<p><strong>Databases are the core component of most computer applications</strong></p>
</li>
</ul>
<h4 id="example">Example</h4>
<p>Create a database that models a digital music store to keep track of artists and albums</p>
<ul>
<li>Things we need for our store
<ul>
<li>Information about <code>Artists</code></li>
<li>What <code>Albums</code> those Artists released</li>
</ul>
</li>
</ul>
<h5 id="flat-file-strawman">FLAT FILE STRAWMAN</h5>
<ul>
<li>
<p>Store our database as <strong>comma-separated value (CSV)</strong> files that we manage ourselves in our application code</p>
<ul>
<li>
<p>Use a separate file per entity</p>
</li>
<li>
<p>The application must parse the files each time they want to read/update records</p>
</li>
</ul>
</li>
<li>
<p>Create a database that models a digital music store</p>
</li>
</ul>
<p>Artist(name, year, country)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;Wu-Tang Clan&#34;</span><span class="err">,</span><span class="mi">1992</span><span class="err">,</span><span class="s2">&#34;USA&#34;</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;Notorious BIG&#34;</span><span class="err">,</span><span class="mi">1992</span><span class="err">,</span><span class="s2">&#34;USA&#34;</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;GZA&#34;</span><span class="err">,</span><span class="mi">1990</span><span class="err">,</span><span class="s2">&#34;USA&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Album(name, artist, year)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;Enter the Wu-Tang&#34;</span><span class="err">,</span><span class="s2">&#34;Wu-Tang Clan&#34;</span><span class="err">,</span><span class="mi">1993</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;St.Ides Mix Tape&#34;</span><span class="err">,</span><span class="s2">&#34;Wu-Tang Clan&#34;</span><span class="err">,</span><span class="mi">1994</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;Liquid Swords&#34;</span><span class="err">,</span><span class="s2">&#34;GZA&#34;</span><span class="err">,</span><span class="mi">1990</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="our-code">Our Code</h5>
<ul>
<li>Example: Get the year that GZA went solo $\rightarrow$ Artist</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">	<span class="n">record</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;GZA&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="nb">print</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="problem-about-flat-files-rightarrow-data-integrity">Problem about FLAT FILES $\rightarrow$ DATA-INTEGRITY</h4>
<ul>
<li>
<p>How do we ensure that the artist is the same for each album entry?</p>
</li>
<li>
<p>What if somebody overwrites the album year with an invalid string?</p>
</li>
<li>
<p>What if there are multiple artists on an album?</p>
</li>
<li>
<p>What happens if we delete an artist that has albums?</p>
</li>
</ul>
<h4 id="problem-about-flat-files-rightarrow-implementation">Problem about FLAT FILES $\rightarrow$ IMPLEMENTATION</h4>
<ul>
<li>
<p>How do you find a particular record?</p>
</li>
<li>
<p>What if we now want to create a new application that uses the same database?</p>
</li>
<li>
<p>What if two threads try to write to the same file at the same time?</p>
</li>
</ul>
<h4 id="problem-about-flat-files-rightarrow-durability">Problem about FLAT FILES $\rightarrow$ DURABILITY</h4>
<ul>
<li>
<p>What if the machine crashes while our program is updating a record?</p>
</li>
<li>
<p>What if we want to replicate the database on multiple machines for high availability?</p>
</li>
</ul>
<h3 id="database-management-system">DATABASE MANAGEMENT SYSTEM</h3>
<ul>
<li>
<p>A <u>database management system</u> (<strong>DBMS</strong>) is software that allows applications to <strong>store and analyze information in a database</strong></p>
</li>
<li>
<p>A general-purpose DBMS supports the <u>definition, creation, querying, update, and administration of databases</u> in accordance with some <u>data model</u></p>
</li>
</ul>
<h4 id="early-dbmss">EARLY DBMSs</h4>
<blockquote>
<p>Early database applications were difficult to build and maintain on available DBMSs in the 1960s</p>
<blockquote>
<p>Examples: IDS, IMS, CODASYL</p>
<p>Computers were expensive, humans were cheapğŸ˜‚</p>
</blockquote>
</blockquote>
<ul>
<li><u>Tight coupling</u> between <strong>logical</strong> and <strong>physical</strong> layers</li>
<li>Programmers had to (roughly) know what queries the application would execute before they could deploy the databaseğŸ˜Ÿ</li>
</ul>
<blockquote>
<p><strong>Ted Codd</strong> was a <u>mathematician</u> working at IBM Research in the late 1960s</p>
<p>He saw IBM&rsquo;s developers spending their time <strong>rewriting database programs</strong> every time <u>the databaseâ€™s schema or layout changed</u>ğŸ˜¨</p>
<p>Devised the <strong>relational model</strong> in 1969</p>
</blockquote>
<h3 id="relational-model">RELATIONAL MODEL</h3>
<ul>
<li>
<p>The relational model defines a database abstraction based on relations to avoid maintenance overhead</p>
</li>
<li>
<p>Key tenets</p>
<ul>
<li>Store database in simple data structures (relations)</li>
<li>Physical storage left up to the DBMS implementation</li>
<li>Access data through high-level language, DBMS figures out best execution strategy</li>
</ul>
</li>
<li>
<p><strong>Structure:</strong> The definition of the database&rsquo;s relations and their contents</p>
</li>
<li>
<p><strong>Integrity:</strong> Ensure the database&rsquo;s contents satisfy constraints</p>
</li>
<li>
<p><strong>Manipulation:</strong> Programming interface for accessing and modifying a database&rsquo;s contents</p>
</li>
</ul>
<hr>
<ul>
<li>A <u>relation</u> is an unordered set that contain the relationship of attributes that represent entities</li>
<li>A <u>tuple</u> is a set of attribute values (also known as its <u>domain</u>) in the relation
<ul>
<li>Values are (normally) atomic/scalar</li>
<li>The special value <strong>NULL</strong> is a member of every domain (if allowed)</li>
</ul>
</li>
</ul>
<p>Artist(name, year, country)</p>
<table>
<thead>
<tr>
<th>name</th>
<th>year</th>
<th>country</th>
</tr>
</thead>
<tbody>
<tr>
<td>Wu-Tang Clan</td>
<td>1992</td>
<td>USA</td>
</tr>
<tr>
<td>Notorious BIG</td>
<td>1992</td>
<td>USA</td>
</tr>
<tr>
<td>GZA</td>
<td>1990</td>
<td>USA</td>
</tr>
</tbody>
</table>
<p>$$
n-ary\ Relation=Table\ with\ n\ columns\newline
$$</p>
<h4 id="relational-model-primary-keys">RELATIONAL MODEL: PRIMARY KEYS</h4>
<ul>
<li>A relation&rsquo;s <u>primary key</u> <strong>uniquely</strong> identifies a single tuple</li>
<li>Some <code>DBMSs</code> automatically create an internal primary key if a table does not define one</li>
<li>Auto-generation of unique integer primary keys
<ul>
<li>â†’ <strong>SEQUENCE</strong> (SQL:2003)</li>
<li>â†’ <strong>AUTO_INCREMENT</strong> (MySQL)</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>year</th>
<th>country</th>
</tr>
</thead>
<tbody>
<tr>
<td>123</td>
<td>Wu-Tang Clan</td>
<td>1992</td>
<td>USA</td>
</tr>
<tr>
<td>456</td>
<td>Notorious BIG</td>
<td>1992</td>
<td>USA</td>
</tr>
<tr>
<td>789</td>
<td>GZA</td>
<td>1990</td>
<td>USA</td>
</tr>
</tbody>
</table>
<h4 id="relational-model-foreign-keys">RELATIONAL MODEL: FOREIGN KEYS</h4>
<ul>
<li>A <u>foreign key</u> specifies that an attribute <strong>from one relation</strong> has to <strong>map to a tuple in another relation</strong></li>
</ul>
<a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter1-1.png" title="/img/CMU 15-445 Database Systems/chapter1-1.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter1-1.png">
        
    </a>
<h3 id="data-models">DATA MODELS</h3>
<ul>
<li>
<p>A <u>data model</u> is a collection of concepts for describing the data in a database</p>
</li>
<li>
<p>A <u>schema</u> is a description of a particular collection of data, <u>using a given data model</u></p>
</li>
</ul>
<hr>
<ul>
<li>
<p>Example</p>
<ul>
<li>
<p><strong>Relational</strong> $\leftarrow This\ Course\newline$</p>
</li>
<li>
<p>Key/Value</p>
</li>
<li>
<p>Graph</p>
</li>
<li>
<p>Document / Object</p>
</li>
<li>
<p>Wide-Column / Column-family</p>
</li>
<li>
<p>Array / Matrix / Vectors</p>
</li>
<li>
<p>Hierarchical</p>
</li>
<li>
<p>Network</p>
</li>
<li>
<p>Multi-Value</p>
</li>
</ul>
</li>
</ul>
<h3 id="data-manipulation-languages-dml">DATA MANIPULATION LANGUAGES (DML)</h3>
<ul>
<li>
<p>Methods to store and retrieve information from a database</p>
</li>
<li>
<p><strong>Procedural:</strong></p>
<ul>
<li>â†’ The query specifies the (high-level) strategy to find the desired result based on sets / bags $\leftarrow Relational\ Algebra\newline$</li>
</ul>
</li>
<li>
<p><strong>Non-Procedural (Declarative):</strong></p>
<ul>
<li>â†’ The query specifies only what data is wanted and not how to find it. $\leftarrow Relational\ Calculus\newline$</li>
</ul>
</li>
</ul>
<h3 id="relational-algebra">RELATIONAL ALGEBRA</h3>
<ul>
<li>
<p>Fundamental operations to retrieve and manipulate tuples in a relation</p>
<ul>
<li>â†’ Based on set algebra</li>
</ul>
</li>
<li>
<p>Each operator takes one or more relations as its inputs and outputs a new relation</p>
<ul>
<li>â†’ We can &ldquo;chain&rdquo; operators together to create more complex operations</li>
</ul>
</li>
</ul>
<p>$$
\begin{align}
&amp;\sigma\Longrightarrow Select\newline
&amp;\prod\Longrightarrow Projection\newline
&amp;\cup\Longrightarrow Union\newline
&amp;\cap\Longrightarrow Intersection\newline
&amp;-\Longrightarrow Difference\newline
&amp;\times\Longrightarrow Product\newline
&amp;\bowtie\Longrightarrow Join\newline
\end{align}
$$</p>
<h4 id="select">SELECT</h4>
<ul>
<li>
<p>Choose a subset of the tuples from a relation that satisfies a selection predicate</p>
<ul>
<li>
<p>Predicate acts as a filter to retain only tuples that fulfill its qualifying requirement</p>
</li>
<li>
<p>Can combine multiple predicates using conjunctions / disjunctions</p>
</li>
</ul>
</li>
</ul>
<p>$$
Syntax:\sigma_{predicate}(R)
$$</p>
<a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter1-2.png" title="/img/CMU 15-445 Database Systems/chapter1-2.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter1-2.png">
        
    </a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">R</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">WHERE</span><span class="w"> </span><span class="n">a_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;a2&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">b_id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">102</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="projection">PROJECTION</h4>
<ul>
<li>
<p>Generate a relation with tuples that contains only the specified attributes</p>
<ul>
<li>
<p>Can rearrange attributesâ€™ ordering</p>
</li>
<li>
<p>Can manipulate the values</p>
</li>
</ul>
</li>
</ul>
<p>$$
Syntax:\prod_{A_1, A_2, &hellip;A_n}(R)
$$</p>
<a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter1-3.png" title="/img/CMU 15-445 Database Systems/chapter1-3.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter1-3.png">
        
    </a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">b_id</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">a_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">FROM</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">a_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;a2&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="union">UNION</h4>
<ul>
<li>Generate a relation that contains all tuples that <strong>appear in either only one or both input relations</strong></li>
</ul>
<p>$$
Syntax:(R\cup S)
$$</p>
<a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter1-4.png" title="/img/CMU 15-445 Database Systems/chapter1-4.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter1-4.png">
        
    </a>
<a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter1-5.png" title="/img/CMU 15-445 Database Systems/chapter1-5.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter1-5.png">
        
    </a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">S</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="intersection">INTERSECTION</h4>
<ul>
<li>Generate a relation that contains only the tuples that <strong>appear in both of the input relations</strong></li>
</ul>
<p>$$
Syntax:(R\cap S)
$$</p>
<a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter1-6.png" title="/img/CMU 15-445 Database Systems/chapter1-6.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter1-6.png">
        
    </a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="k">INTERSECT</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">S</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="difference">DIFFERENCE</h4>
<ul>
<li>Generate a relation that contains only the tuples that appear in the first and not the second of the input relations</li>
</ul>
<p>$$
Syntax:(R-S)
$$</p>
<a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter1-7.png" title="/img/CMU 15-445 Database Systems/chapter1-7.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter1-7.png">
        
    </a>
<a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter1-8.png" title="/img/CMU 15-445 Database Systems/chapter1-8.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter1-8.png">
        
    </a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="k">EXCEPT</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">S</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="product">PRODUCT</h4>
<ul>
<li>Generate a relation that contains all possible combinations of tuples from the input relations(<code>combination</code>)</li>
</ul>
<p>$$
Syntax:(R\times S)
$$</p>
<a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter1-9.png" title="/img/CMU 15-445 Database Systems/chapter1-9.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter1-9.png">
        
    </a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">S</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="join-">JOIN !</h4>
<ul>
<li>Generate a relation that contains all tuples that are a combination of two tuples (one from each input relation) with a common value(s) for one or more attributes</li>
</ul>
<p>$$
Syntax:(R\bowtie S)
$$</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="k">NATURAL</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">S</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>R</li>
</ul>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
</tr>
</thead>
<tbody>
<tr>
<td>a</td>
<td>1</td>
</tr>
<tr>
<td>b</td>
<td>2</td>
</tr>
</tbody>
</table>
<ul>
<li>S</li>
</ul>
<table>
<thead>
<tr>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>x</td>
</tr>
<tr>
<td>1</td>
<td>y</td>
</tr>
<tr>
<td>3</td>
<td>z</td>
</tr>
</tbody>
</table>
<ul>
<li>$R\bowtie S$</li>
</ul>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr>
<td>a</td>
<td>1</td>
<td>x</td>
</tr>
<tr>
<td>a</td>
<td>1</td>
<td>y</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">a_id</span><span class="p">,</span><span class="w"> </span><span class="n">b_id</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter1-10.png" title="/img/CMU 15-445 Database Systems/chapter1-10.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter1-10.png">
        
    </a>
<h4 id="extra-operators">EXTRA OPERATORS</h4>
<ul>
<li>
<p>Rename($\rho$)</p>
</li>
<li>
<p>Assignment($R \leftarrow S$)</p>
</li>
<li>
<p>Duplicate Elimination($\delta$)</p>
</li>
<li>
<p>Aggregation($\gamma$)</p>
</li>
<li>
<p>Sorting($\tau$)</p>
</li>
<li>
<p>Division($R\div S$)</p>
</li>
</ul>
<h4 id="observation">OBSERVATION</h4>
<blockquote>
<p>Relational algebra is a procedural language because it defines the high level-steps of how to compute a query. For example, $\sigma_{b_id=102}(R\bowtie S)$ is saying to first do the join of R and S and then do the select,whereas $(R \bowtie (\sigma_{b_id=102}(S)))$ will do the select on S first, and then do the join. These two statements will actually produce the same answer, but if there is only 1 tuple in S with b_id=102 out of a billion tuples, then$(R \bowtie (\sigma_{b_id=102}(S)))$ will be significantly faster than $\sigma_{b_id=102}(R\bowtie S)$ğŸ˜‚</p>
</blockquote>
<blockquote>
<p>A better approach is to say the result you want (state $\rightarrow$<u>retrieve the joined tuples from R and S where b_id equals 102</u>), and let the DBMS decide the steps it wants to take to compute the query. SQL will do exactly this,and it is the de facto standard for writing queries on relational model databasesğŸ®</p>
</blockquote>
<h4 id="queries">QUERIES</h4>
<ul>
<li>
<p>The relational model is independent of any query language implementation.</p>
</li>
<li>
<p><strong>SQL</strong> is the <em>de facto</em> standard (many dialects)</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">	<span class="n">record</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;GZA&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="nb">print</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">artists</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;GZA&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="document-data-model">DOCUMENT DATA MODEL</h3>
<ul>
<li>Embed data hierarchy into a single objectâŒ</li>
</ul>
<a class="lightgallery" href="/img/CMU%2015-445%20Database%20Systems/chapter1-11.png" title="/img/CMU 15-445 Database Systems/chapter1-11.png" data-thumbnail="/img/CMU 15-445 Database Systems/chapter1-11.png">
        
    </a>
<div class="mermaid" id="id-1"></div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">Artist</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">year</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Album</span> <span class="n">albums</span><span class="o">[];</span>
</span></span><span class="line"><span class="cl"><span class="o">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">Album</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">year</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>$$
\Downarrow
$$</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;GZA&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;year&#34;</span><span class="p">:</span> <span class="mi">1990</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;albums&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Liquid Swords&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;year&#34;</span><span class="p">:</span> <span class="mi">1995</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Beneath the Surface&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;year&#34;</span><span class="p">:</span> <span class="mi">1999</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="conclusion">CONCLUSION</h3>
<ul>
<li>
<p>Databases are ubiquitous</p>
</li>
<li>
<p>Relational algebra defines the primitives for processing queries on a relational database.</p>
</li>
<li>
<p>We will see relational algebra again when we talk about query optimization + execution</p>
</li>
</ul>
]]></description>
</item>
<item>
    <title>Computer Organization and Architecture Parallel Process &amp; Multicore Computers</title>
    <link>https://Jungle430.github.io/posts/computer-organization-and-architecture/computer-organization-and-architecture-parallel-process-multicore-computers/</link>
    <pubDate>Wed, 01 Feb 2023 01:31:38 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/computer-organization-and-architecture/computer-organization-and-architecture-parallel-process-multicore-computers/</guid>
    <description><![CDATA[<h1 id="computer-organization-and-architecture">Computer Organization and Architecture</h1>
<h2 id="parallel-process--multicore-computers">Parallel Process &amp; Multicore Computers</h2>
<h3 id="outline">Outline</h3>
<ul>
<li>
<p>Parallel Processing</p>
<ul>
<li>Multiple Processor Organizations</li>
<li>Symmetric Multiprocessors</li>
<li>Clusters</li>
<li>Nonuniform Memory Access</li>
<li>Vector Computation</li>
</ul>
</li>
<li>
<p>Multicore Computers</p>
</li>
</ul>
<h3 id="multiple-processor-organizations">Multiple Processor Organizations</h3>
<h4 id="types-of-multiple-processor">Types of multiple processor</h4>
<ul>
<li>
<p>Single instruction, single data stream â€“ <code>SISD</code></p>
</li>
<li>
<p>Single instruction, multiple data stream â€“ <code>SIMD</code></p>
</li>
<li>
<p>Multiple instruction, single data stream â€“ <code>MISD</code></p>
</li>
<li>
<p>Multiple instruction, multiple data stream - <code>MIMD</code></p>
</li>
</ul>
<h4 id="sisd-organizations">SISD Organizations</h4>
<div class="mermaid" id="id-1"></div>
<ul>
<li>
<p>SISDçš„ç»“æ„ä¸­åŒ…å«1ä¸ªCUæ§åˆ¶å•å…ƒï¼Œ1ä¸ªPUå¤„ç†å•å…ƒï¼Œä»¥åŠ1ä¸ªMUå­˜å‚¨å•å…ƒ</p>
</li>
<li>
<p>CUå‘PUå‘é€æŒ‡ä»¤æµï¼ŒMUå‘PUå‘é€æ•°æ®æµ</p>
</li>
<li>
<p>PUæ ¹æ®CUå‘é€çš„æŒ‡ä»¤æµï¼Œå¯¹æ¥è‡ªMUçš„æ•°æ®æµè¿›è¡Œæ“ä½œï¼Œå¹¶äº§ç”Ÿç»“æœã€‚</p>
</li>
<li>
<p>SISDå¹¶æ²¡æœ‰å¹¶è¡Œçš„èƒ½åŠ›ï¼ŒPUæŒ‰ç…§CUæä¾›çš„æŒ‡ä»¤æµï¼Œè¿›è¡Œç›¸åº”çš„æ“ä½œ</p>
</li>
</ul>
<div class="mermaid" id="id-2"></div>
<ul>
<li>
<p>SIMDï¼Œå•æŒ‡ä»¤å¤šæ•°æ®æµï¼Œç»“æ„ä¸­åŒ…å«1ä¸ªæ§åˆ¶å•å…ƒï¼Œå¤šä¸ªå¤„ç†å•å…ƒã€‚æ¯ä¸ªå¤„ç†å•å…ƒæœ‰è‡ªå·±çš„å­˜å‚¨å™¨</p>
</li>
<li>
<p>æ§åˆ¶å•å…ƒå°†æŒ‡ä»¤æµå‘é€ç»™å¤šä¸ªå¤„ç†å•å…ƒè¿›è¡ŒåŒæ­¥å¤„ç†ï¼ŒåŒæ­¥å¤„ç†é‡‡ç”¨çš„æ˜¯é”æ­¥æ–¹å¼</p>
</li>
<li>
<p>ä¸åŒçš„å¤„ç†å™¨åœ¨ä¸åŒçš„æ•°æ®é›†ä¸Šæ‰§è¡Œç›¸åŒçš„æŒ‡ä»¤ï¼Œäº§ç”Ÿä¸åŒçš„å¤„ç†ç»“æœ</p>
</li>
<li>
<p>å®è´¨æ˜¯å¯¹ä¸åŒçš„æ•°æ®é›†è¿›è¡Œç›¸åŒçš„å¤„ç†ï¼Œé€šè¿‡å¹¶è¡Œå¾—åˆ°ä¸€ç»„ç»“æœï¼Œå¹¶è¡Œå¤„ç†æé«˜æ•ˆç‡</p>
</li>
<li>
<p>çŸ¢é‡å’Œé˜µåˆ—å¤„ç†å™¨å±äºSIMDç±»å‹</p>
</li>
</ul>
<h4 id="misd">MISD</h4>
<ul>
<li>
<p>Sequence of data</p>
</li>
<li>
<p>Transmitted to set of processors</p>
</li>
<li>
<p>Each processor executes different instruction sequence</p>
</li>
<li>
<p>Never been implemented</p>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter17-1.png" title="/img/Computer Organization and Architecture/chapter17-1.png" data-thumbnail="/img/Computer Organization and Architecture/chapter17-1.png" data-sub-html="<h2>MIMD Organizations</h2>">
        
    </a><figcaption class="image-caption"><code>MIMD Organizations</code></figcaption>
    </figure>
<ul>
<li>
<p>MIMDï¼Œå¤šæŒ‡ä»¤å¤šæ•°æ®æµæ¶æ„ï¼Œå¤šä¸ªæ§åˆ¶å•å…ƒCUï¼Œå¤šä¸ªå¤„ç†å•å…ƒPUã€‚å­˜å‚¨æ–¹é¢ï¼Œæœ‰ä¸¤ç§ç»“æ„</p>
<ul>
<li>
<p>å…±äº«å­˜å‚¨å™¨ï¼šæ‰€æœ‰çš„PUå…±äº«ä¸€ä¸ªå­˜å‚¨å™¨ï¼Œæ•°æ®éƒ½å­˜å‚¨åœ¨å…±äº«å­˜å‚¨å™¨ä¸­</p>
</li>
<li>
<p>åˆ†å¸ƒå¼å­˜å‚¨ï¼šæ¯ä¸ªPUéƒ½æœ‰è‡ªå·±çš„LMï¼Œè¿™äº›æœºå™¨é€šè¿‡äº’è”ç½‘è¿æ¥åœ¨ä¸€èµ·</p>
</li>
</ul>
</li>
<li>
<p>ä¸€ç»„å¤„ç†å™¨ï¼Œèƒ½å¤ŸåŒæ—¶æ‰§è¡Œä¸åŒçš„æŒ‡ä»¤åºåˆ—ã€‚æ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰è‡ªå·±çš„æ•°æ®é›†ã€‚</p>
</li>
<li>
<p>å¯¹ç§°å¤šå¤„ç†SMPï¼Œé›†ç¾¤ï¼Œéå‡åŒ€å­˜å‚¨å™¨è®¿é—®NUMAç­‰ï¼Œéƒ½å±äºMIMDæ¶æ„</p>
</li>
</ul>
<h3 id="symmetric-multiprocessors">Symmetric Multiprocessors</h3>
<h4 id="smp">SMP</h4>
<ul>
<li>
<p>Tightly Coupled</p>
</li>
<li>
<p>Processors share memory and I/O</p>
<ul>
<li>
<p>Share single memory or pool</p>
</li>
<li>
<p>Shared bus to access memory</p>
</li>
<li>
<p>Public area set in shared storage stores status information to achieve communication between processors</p>
</li>
<li>
<p>Memory access time to given area of memory is approximately the same for each processor</p>
</li>
</ul>
</li>
</ul>
<h4 id="characteristic-of-smp">Characteristic of SMP</h4>
<ul>
<li>
<p>Two or more processors with similar function</p>
<ul>
<li>
<p>All processors share memory and I/O</p>
</li>
<li>
<p>All processors share access to I/O</p>
</li>
<li>
<p>Perform the same function</p>
</li>
</ul>
</li>
<li>
<p>Controlled by a centralized operating system</p>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter17-2.png" title="/img/Computer Organization and Architecture/chapter17-2.png" data-thumbnail="/img/Computer Organization and Architecture/chapter17-2.png" data-sub-html="<h2>Symmetric Multiprocessor Organization</h2>">
        
    </a><figcaption class="image-caption"><code>Symmetric Multiprocessor Organization</code></figcaption>
    </figure>
<ul>
<li>
<p>æ¯ä¸ªå¤„ç†å™¨æœ‰è‡ªå·±çš„$L1\ cache$ï¼Œä¹Ÿå¯èƒ½ä¼šé…ç½®å„è‡ªçš„$L2\ cache\newline$</p>
</li>
<li>
<p>å¤„ç†å™¨éƒ½æŒ‚åœ¨å…±äº«çš„ç³»ç»Ÿæ€»çº¿ä¸Šï¼Œå…±äº«å¯¹ä¸»å­˜å‚¨å™¨çš„è®¿é—®</p>
</li>
<li>
<p>I/Oç³»ç»Ÿä¹ŸæŒ‚åœ¨ç³»ç»Ÿæ€»çº¿ä¸Šï¼Œå„ä¸ªå¤„ç†å™¨å¯¹I/Oç³»ç»Ÿè¿›è¡Œå…±äº«è®¿é—®</p>
</li>
</ul>
<h4 id="smp-advantages">SMP Advantages</h4>
<ul>
<li>
<p>High performance</p>
<ul>
<li>Greatly improved performance if some work can be done in parallel</li>
</ul>
</li>
<li>
<p>High availability</p>
<ul>
<li>
<p>All processors can perform the same functions</p>
</li>
<li>
<p>Failure of a single processor does not halt the system</p>
</li>
</ul>
</li>
<li>
<p>Incremental growth</p>
<ul>
<li>
<p>Flexible system expansion</p>
</li>
<li>
<p>User can enhance performance by adding additional processors</p>
</li>
</ul>
</li>
<li>
<p>Scaling</p>
<ul>
<li>
<p>Vendors can offer range of products based on number of processors</p>
</li>
<li>
<p>Different products have different prices and performance, which can give users more choices</p>
</li>
</ul>
</li>
</ul>
<h4 id="design-issues">Design issues</h4>
<ul>
<li>
<p>SMP system is managed by a unified operating system</p>
</li>
<li>
<p>Operating system is responsible for scheduling processes and resources</p>
</li>
<li>
<p>Operating system needs to complete</p>
<ul>
<li>
<p>Simultaneous concurrent processes</p>
</li>
<li>
<p>Scheduling</p>
</li>
<li>
<p>Synchronization</p>
</li>
<li>
<p>Memory management</p>
</li>
<li>
<p>Reliability and fault tolerance</p>
</li>
</ul>
</li>
<li>
<p>Simultaneous concurrent processes</p>
<ul>
<li>
<p>Allow multiple processors to execute the same piece of OS code at the same time</p>
</li>
<li>
<p>Manage OS tables and other structures to avoid deadlocks</p>
</li>
</ul>
</li>
<li>
<p>Scheduling</p>
<ul>
<li>Reasonably schedule the processor execution process</li>
</ul>
</li>
<li>
<p>Synchronization</p>
<ul>
<li>Provide synchronization mechanism to ensure mutual exclusion and order of memory and I/O access</li>
</ul>
</li>
<li>
<p>Memory management</p>
<ul>
<li>Solve concurrency and consistency problems</li>
<li>Ensure the performance and correctness under multiprocessors</li>
</ul>
</li>
<li>
<p>Reliability and fault tolerance</p>
<ul>
<li>For a processor failure, the operating system shall be able to reconstruct the system so that the system can be degraded for use</li>
</ul>
</li>
</ul>
<h3 id="clusters">Clusters</h3>
<ul>
<li>
<p>Loosely Coupled</p>
</li>
<li>
<p>Collection of independent uniprocessors or <code>SMPs</code></p>
</li>
<li>
<p>Interconnected to form a cluster</p>
</li>
<li>
<p>Communication via fixed path or network connections</p>
</li>
</ul>
<hr>
<ul>
<li>
<p>Composition of cluster</p>
<ul>
<li>
<p>A group of interconnected whole computers</p>
</li>
<li>
<p>Working together as unified resource</p>
</li>
<li>
<p>Illusion of being one machine</p>
</li>
<li>
<p>Each computer called a node</p>
</li>
</ul>
</li>
<li>
<p>Characteristics</p>
<ul>
<li>
<p>High performance</p>
</li>
<li>
<p>High availability</p>
</li>
<li>
<p>Alternative to SMP</p>
</li>
</ul>
</li>
<li>
<p>Server applications</p>
</li>
</ul>
<h4 id="cluster-benefits">Cluster Benefits</h4>
<ul>
<li>
<p>Absolute scalability</p>
<ul>
<li>
<p>Build hundreds of thousands of independent computers into a large cluster system, and the processing capacity may far exceed that of the largest independent computer</p>
</li>
<li>
<p>Each machine in the cluster can be a single processing system or a multiprocessor architecture</p>
</li>
</ul>
</li>
<li>
<p>Incremental scalability</p>
<ul>
<li>
<p>New nodes can be added to the cluster system step by step to improve processing capacity and gradually expand</p>
</li>
<li>
<p>Very flexible capacity expansion</p>
</li>
</ul>
</li>
<li>
<p>High availability</p>
<ul>
<li>
<p>Each node is an independent computer</p>
</li>
<li>
<p>The failure of one or more nodes will not affect the use of the cluster system</p>
</li>
<li>
<p>Node fault diagnosis and fault tolerance are automatically completed by the system</p>
</li>
</ul>
</li>
<li>
<p>Superior price/performance</p>
<ul>
<li>
<p>Combine mature commercial computers into a cluster</p>
</li>
<li>
<p>The system performance is far greater than that of a single large server</p>
</li>
<li>
<p>High cost performance</p>
</li>
</ul>
</li>
</ul>
<h4 id="blade-servers">Blade Servers</h4>
<ul>
<li>
<p><strong>Common implementation of cluster</strong></p>
</li>
<li>
<p>Server houses multiple server modules (blades) in single chassis</p>
<ul>
<li>
<p>Save space</p>
</li>
<li>
<p>Improve system management</p>
</li>
<li>
<p>Chassis provides power supply</p>
</li>
<li>
<p>Each blade has processor, memory, disk</p>
</li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter17-3.png" title="/img/Computer Organization and Architecture/chapter17-3.png" data-thumbnail="/img/Computer Organization and Architecture/chapter17-3.png" data-sub-html="<h2>Blade Servers</h2>">
        
    </a><figcaption class="image-caption"><code>Blade Servers</code></figcaption>
    </figure>
<h4 id="cluster-v-smp">Cluster v. SMP</h4>
<ul>
<li>
<p>Both provide multiprocessor support to high demand applications</p>
</li>
<li>
<p>Both available commercially</p>
</li>
<li>
<p>SMP for longer</p>
</li>
</ul>
<hr>
<ul>
<li>
<p><code>SMP</code></p>
<ul>
<li>
<p>Easier to manage and control</p>
</li>
<li>
<p>Closer to single processor systems</p>
</li>
<li>
<p>Scheduling is important</p>
</li>
<li>
<p>Less physical space</p>
</li>
<li>
<p>Lower power consumption</p>
</li>
</ul>
</li>
<li>
<p>Clustering</p>
<ul>
<li>
<p>Superior incremental &amp; absolute scalability</p>
</li>
<li>
<p>Superior availability</p>
<ul>
<li>Redundancy</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="nonuniform-memory-access">Nonuniform Memory Access</h3>
<h4 id="numa">NUMA</h4>
<ul>
<li>
<p>Tightly Coupled</p>
</li>
<li>
<p>Nonuniform memory access</p>
<ul>
<li>Access times to different regions of memory may differ</li>
</ul>
</li>
<li>
<p>Main object</p>
<ul>
<li>
<p>Overcoming the limitation on the number of processors in SMP</p>
</li>
<li>
<p>It solves the problem caused by the independent memory used by each node in the cluster system</p>
</li>
</ul>
</li>
<li>
<p>Alternative to SMP &amp; clustering</p>
</li>
</ul>
<hr>
<ul>
<li>
<p>Uniform memory access</p>
<ul>
<li>
<p>All processors have access to all parts of memory</p>
</li>
<li>
<p>Using load &amp; store</p>
</li>
<li>
<p>Access time to all regions of memory is the same</p>
</li>
<li>
<p>Access time to memory for different processors same</p>
</li>
<li>
<p>As used by SMP</p>
</li>
</ul>
</li>
</ul>
<h4 id="nonuniform-memory-access-1">Nonuniform Memory Access</h4>
<ul>
<li>
<p>All processors have access to all parts of memory</p>
</li>
<li>
<p>Using load &amp; store</p>
</li>
<li>
<p>Access time of processor differs depending on region of memory</p>
</li>
<li>
<p>Different processors access different regions of memory at different speeds</p>
</li>
</ul>
<hr>
<ul>
<li>
<p>Cache coherent NUMA(<code>CC-NUMA</code>)</p>
<ul>
<li>
<p>Cache coherence is maintained among the caches of the various processors</p>
</li>
<li>
<p>For a system without cache consistency maintenance, it is similar to a cluster system</p>
</li>
<li>
<p><code>CC-NUMA</code> is discussed here</p>
</li>
<li>
<p>Significantly different from SMP and clusters</p>
</li>
</ul>
</li>
</ul>
<h4 id="motivation">Motivation</h4>
<ul>
<li>
<p>SMP has practical limit to number of processors</p>
<ul>
<li>Bus traffic limits to between 16 and 64 processors</li>
</ul>
</li>
<li>
<p>In clusterï¼Œeach node has own memory</p>
<ul>
<li>Apps do not see large global memory</li>
<li>Coherence maintained by software not hardware</li>
</ul>
</li>
<li>
<p>NUMA retains SMP flavour while giving large scale multiprocessing</p>
<ul>
<li>e.g. Silicon Graphics Origin NUMA 1024 MIPS R10000 processors</li>
</ul>
</li>
<li>
<p>Objective</p>
<ul>
<li>
<p>maintain transparent system wide memory while permitting multiprocessor nodes</p>
</li>
<li>
<p>each with own bus or internal interconnection system</p>
</li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter17-4.png" title="/img/Computer Organization and Architecture/chapter17-4.png" data-thumbnail="/img/Computer Organization and Architecture/chapter17-4.png" data-sub-html="<h2>CC-NUMA Organization</h2>">
        
    </a><figcaption class="image-caption"><code>CC-NUMA Organization</code></figcaption>
    </figure>
<ul>
<li>
<p>NUMAç³»ç»Ÿç”±å¤šä¸ªç»“ç‚¹ç»„æˆã€‚æ¯ä¸ªèŠ‚ç‚¹åŒ…å«æœ‰è‹¥å¹²ä¸ªå¤„ç†å™¨ï¼Œæ¯ä¸ªå¤„ç†å™¨æœ‰è‡ªå·±çš„L1 cacheå’ŒL2 cacheï¼Œæœ‰è‡ªå·±çš„å†…éƒ¨æ€»çº¿ï¼Œå¹¶ä¸”æœ‰è‡ªå·±çš„ä¸»å­˜å’ŒI/O</p>
</li>
<li>
<p>å¤„ç†å™¨è®¿é—®å­˜å‚¨å™¨çš„æ—¶å€™ï¼Œé¦–å…ˆçœ‹æ˜¯å¦åœ¨cacheä¸­ï¼Œå¦‚æœä¸åœ¨ï¼Œcacheä¼šå»è®¿é—®æœ¬åœ°å­˜å‚¨å™¨ã€‚å¦‚æœåœ¨çš„è¯ï¼Œå°±é€šè¿‡å†…éƒ¨æ€»çº¿å–è¿‡æ¥ã€‚å¦‚æœä¸åœ¨æœ¬åœ°å­˜å‚¨å™¨ä¸­ï¼Œcacheä¼šå‘å‡ºä¸€ä¸ªè¯·æ±‚ï¼Œé€šè¿‡äº’è”ç½‘ç»œä»è¿œç«¯å–è¿‡æ¥ï¼Œæ”¾åˆ°æ€»çº¿ä¸Šï¼Œå‘å‡ºè¯·æ±‚çš„cacheä»æ€»çº¿ä¸Šè¯»å–ã€‚è¿™äº›åŠ¨ä½œéƒ½æ˜¯è‡ªåŠ¨çš„ï¼Œå¯¹å¤„ç†å™¨å’Œcacheéƒ½æ˜¯é€æ˜çš„ã€‚</p>
</li>
</ul>
<h3 id="vector-computation">Vector Computation</h3>
<ul>
<li>
<p>Maths problems involving physical processes present different difficulties for computation</p>
<ul>
<li>
<p>Aerodynamics, seismology, meteorology</p>
</li>
<li>
<p>Continuous field simulation</p>
</li>
</ul>
</li>
<li>
<p>Requirement</p>
<ul>
<li>
<p>High precision</p>
</li>
<li>
<p>Repeated floating point calculations on large arrays of numbers</p>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>
<p>Solution 1: supercomputer</p>
<ul>
<li>
<p>Hundreds of millions of float</p>
</li>
<li>
<p>Optimized for Vector Computation</p>
</li>
<li>
<p>$10-15 million</p>
</li>
<li>
<p>Limited market</p>
</li>
<li>
<p>Research, government agencies, meteorology</p>
</li>
</ul>
</li>
<li>
<p>Solution 2:  Array processor</p>
<ul>
<li>
<p>Alternative to supercomputer</p>
</li>
<li>
<p>Configured as peripherals to mainframe &amp; mini</p>
</li>
<li>
<p>Just run vector portion of problems</p>
</li>
</ul>
</li>
</ul>
<h3 id="multicore-computers">Multicore Computers</h3>
<h4 id="what-is-multicore-computers">What is Multicore Computers?</h4>
<ul>
<li>
<p>Also known as single chip multiprocessor</p>
</li>
<li>
<p>Two or more processors are integrated on a single chip, and each processor is called a core</p>
</li>
<li>
<p>Each core consists of all components of an independent processor, including register set, ALU, pipeline hardware, control unit, and L1 data and instruction cache</p>
</li>
<li>
<p>Some multicore processors also include L2 cache and L3 cache on the chip</p>
</li>
</ul>
<h3 id="hardware-performance-issues">Hardware Performance Issues</h3>
<ul>
<li>
<p>Microprocessors have seen an exponential increase in performance</p>
<ul>
<li>
<p>Improved organization</p>
</li>
<li>
<p>Increased clock frequency</p>
</li>
</ul>
</li>
<li>
<p>Increase in Parallelism</p>
<ul>
<li>
<p>Pipelining</p>
</li>
<li>
<p>Superscalar</p>
</li>
<li>
<p>Simultaneous multithreading</p>
</li>
</ul>
</li>
</ul>
<h4 id="simultaneous-multithreading">Simultaneous multithreading</h4>
<ul>
<li>
<p>åŒæ­¥å¤šçº¿ç¨‹èƒ½å¤Ÿä»å¤šä¸ªçº¿ç¨‹ä¸­å–å‡ºæŒ‡ä»¤æ¥è¿è¡Œï¼Œå®ƒèƒ½å¤ŸåŒæ—¶æ‰§è¡Œä¸åŒçº¿ç¨‹çš„æŒ‡ä»¤</p>
</li>
<li>
<p>åŒæ­¥å¤šçº¿ç¨‹æ¶æ„ä¸­ï¼Œé…ç½®äº†å¤šä¸ªPCå’Œå¤šä¸ªå¯„å­˜å™¨ç»„ï¼Œåº•å±‚å…±äº«æŒ‡ä»¤cacheå’Œæ•°æ®cacheã€‚è¿™æ ·å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«æµæ°´çº¿èµ„æº</p>
</li>
<li>
<p>é€šè¿‡åŒæ­¥å¤šçº¿ç¨‹æŠ€æœ¯ï¼Œç³»ç»Ÿèƒ½å¤ŸåŠ¨æ€è°ƒæ•´ç³»ç»Ÿç¯å¢ƒï¼Œå¦‚æœ‰å¯èƒ½åŒæ—¶æ‰§è¡Œä¸åŒçº¿ç¨‹çš„æŒ‡ä»¤ã€‚å½“ä¸€ä¸ªçº¿ç¨‹é‡åˆ°é•¿å»¶è¿Ÿäº‹ä»¶æ—¶ï¼Œå…è®¸å¦ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨æ‰€æœ‰çš„å¤„ç†å•å…ƒ</p>
</li>
</ul>
<h4 id="hardware-performance-issues-1">Hardware Performance Issues</h4>
<ul>
<li>
<p>Processor performance continues to improve</p>
<ul>
<li>
<p>Adjustment of chip architecture</p>
</li>
<li>
<p>Improvement of main frequency</p>
</li>
</ul>
</li>
<li>
<p>Diminishing returns</p>
<ul>
<li>
<p>More complexity requires more logic</p>
</li>
<li>
<p>Need more chip area for coordinating and signal transfer logic</p>
</li>
<li>
<p>Harder to design, make and debug</p>
</li>
<li>
<p>Hardware performance reaches the bottleneck, which is very difficult to improve</p>
</li>
</ul>
</li>
</ul>
<h4 id="power-consumption">Power consumption</h4>
<ul>
<li>
<p>Power requirements grow exponentially with chip density and clock frequency</p>
</li>
<li>
<p>Increased power consumption causes CPU cooling problems</p>
</li>
<li>
<p>It is increasingly difficult to improve performance by improving chip integration</p>
</li>
</ul>
<hr>
<ul>
<li>
<p>One solution is use more chip area for cache</p>
<ul>
<li>
<p>Storage transistors require low power consumption</p>
</li>
<li>
<p>Cache is close to CPU and fast</p>
</li>
<li>
<p>By 2015ï¼Œ100 billion transistors on 300mm2 ï¼ŒCache of 100MB ï¼Œ1 billion transistors for logic</p>
</li>
</ul>
</li>
<li>
<p>Large capacity cache provides basic resources for multi-core processors</p>
</li>
</ul>
<h4 id="pollacks-rule">Pollackâ€™s rule</h4>
<ul>
<li>
<p>Pollackâ€™s rule</p>
<ul>
<li>
<p>Performance is roughly proportional to square root of increase in complexity</p>
</li>
<li>
<p>Double complexity gives 40% more performance</p>
</li>
</ul>
</li>
<li>
<p>So,integrating multiple processor cores on one chip becomes a better solution</p>
<ul>
<li>
<p>Multicore makes performance close to linear improvement</p>
</li>
<li>
<p>Unlikely that one core can use all cache effectively</p>
</li>
</ul>
</li>
</ul>
<h3 id="software-performance-issues">Software Performance Issues</h3>
<ul>
<li>
<p>Performance benefits dependent on effective exploitation of parallel resources</p>
<ul>
<li>
<p>Amdahlâ€™s Law</p>
</li>
<li>
<p>Even small amounts of serial code impact performance</p>
</li>
<li>
<p>10% inherently serial on 8 processor system gives only 4.7 times performance</p>
</li>
</ul>
</li>
<li>
<p>Other factors affecting performance: communication, distribution of work and cache coherence overheads</p>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter17-5.png" title="/img/Computer Organization and Architecture/chapter17-5.png" data-thumbnail="/img/Computer Organization and Architecture/chapter17-5.png" data-sub-html="<h2>Performance Effect of Multiple Cores</h2>">
        
    </a><figcaption class="image-caption"><code>Performance Effect of Multiple Cores</code></figcaption>
    </figure>
<ul>
<li>
<p>å›¾ï¼ˆaï¼‰ç»™å‡ºäº†ä¸²è¡Œä»£ç æ¯”ä¾‹å¯¹åŠ é€Ÿæ¯”çš„å½±å“ã€‚å¦‚æœæ²¡æœ‰ä¸²è¡Œä»£ç ï¼Œç†è®ºä¸ŠåŠ é€Ÿæ¯”å’Œæ€§èƒ½çš„æå‡æˆæ­£æ¯”ã€‚ä½†æ˜¯ï¼Œç”±äºä¸²è¡Œå¤„ç†çš„é—®é¢˜ï¼Œå¯¼è‡´åŠ é€Ÿæ¯”æ¯”ç†è®ºå€¼å°äº†å¾ˆå¤šã€‚</p>
</li>
<li>
<p>å›¾ï¼ˆbï¼‰æŒ‡å‡ºç®¡ç†å¼€é”€å¯¹åŠ é€Ÿæ¯”çš„å½±å“ã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨5ä¸ªå¤„ç†å™¨çš„æ—¶å€™ï¼ŒåŠ é€Ÿæ¯”æœ€å¤§ï¼Œéšç€æ ¸æ•°çš„å¢åŠ ï¼Œç®¡ç†å¼€é”€ä¼šå¯¼è‡´æ€§èƒ½æ”¶ç›Šé€’å‡</p>
</li>
</ul>
<h4 id="effective-applications">Effective Applications</h4>
<ul>
<li>
<p>Some applications effectively exploit multicore processors</p>
<ul>
<li>
<p>Database</p>
</li>
<li>
<p>Servers handling independent transactions</p>
</li>
<li>
<p>Multi-threaded native applicationsï¼Œsuch as Lotus Domino, Siebel CRM</p>
</li>
<li>
<p>Multi-process applications, such as Oracle, SAP, PeopleSoft</p>
</li>
</ul>
</li>
<li>
<p>Java applications</p>
<ul>
<li>
<p><code>JVM</code> is multi-thread with scheduling and memory management</p>
</li>
<li>
<p>Sunâ€™s Java Application Server, BEAâ€™s Weblogic, IBM Websphere, Tomcat</p>
</li>
</ul>
</li>
<li>
<p>Multi-instance applications</p>
<ul>
<li>One application running multiple times</li>
</ul>
</li>
<li>
<p>Game Software</p>
</li>
</ul>
<h3 id="multicore-organization">Multicore Organization</h3>
<ul>
<li>
<p>Number of core processors on chip</p>
</li>
<li>
<p>Number of levels of cache on chip</p>
</li>
<li>
<p>Amount of shared cache</p>
</li>
<li>
<p>Next slide examples of each organization</p>
<ul>
<li>
<p>(a) ARM11 MPCore</p>
</li>
<li>
<p>(b) AMD Opteron</p>
</li>
<li>
<p>(c) Intel Core Duo</p>
</li>
<li>
<p>(d) Intel Core i7</p>
</li>
</ul>
</li>
</ul>
<h4 id="individual-core-architecture">Individual Core Architecture</h4>
<ul>
<li>
<p>Intel Core Duo uses superscalar cores</p>
</li>
<li>
<p>Intel Core i7 uses simultaneous multi-threading (SMT)</p>
<ul>
<li>Scales up number of threads supported</li>
<li>4 SMT cores, each supporting 4 threads appears as 16 core</li>
</ul>
</li>
</ul>
<h3 id="intel-x86-multicore-organization">Intel x86 Multicore Organization</h3>
<p>Example: Core Duo and Core i7</p>
<h3 id="arm11-mpcore">ARM11 MPCore</h3>
<ul>
<li>
<p>Up to 4 processors each with own L1 instruction and data cache</p>
</li>
<li>
<p>Distributed interrupt controller</p>
</li>
<li>
<p>Timer per CPU</p>
</li>
<li>
<p>Watchdog</p>
<ul>
<li>Warning alerts for software failures</li>
<li>Counts down from predetermined values</li>
<li>Issues warning at zero</li>
</ul>
</li>
<li>
<p>CPU interface</p>
<ul>
<li>Interrupt acknowledgement, masking and completion acknowledgement</li>
</ul>
</li>
<li>
<p>CPU</p>
<ul>
<li>Single ARM11 called MP11</li>
</ul>
</li>
<li>
<p>Vector floating-point unit</p>
<ul>
<li>FP co-processor</li>
</ul>
</li>
<li>
<p>L1 cache</p>
</li>
<li>
<p>Snoop control unit</p>
<ul>
<li>Maintain L1 cache coherency</li>
</ul>
</li>
</ul>
<h4 id="summary-of-parallel">Summary of parallel</h4>
<ul>
<li>
<p>Internal of CPU</p>
<ul>
<li>
<p>Pipeline</p>
</li>
<li>
<p>Superscalar</p>
</li>
<li>
<p>simultaneous multi-threading(SMT)</p>
</li>
</ul>
</li>
<li>
<p>On chip</p>
<ul>
<li>Multicore</li>
</ul>
</li>
<li>
<p>Internal of machine</p>
<ul>
<li>
<p>SMP</p>
</li>
<li>
<p>NUMA</p>
</li>
<li>
<p>Array processor</p>
</li>
</ul>
</li>
<li>
<p>Multi-machine</p>
<ul>
<li>Cluster</li>
</ul>
</li>
</ul>
]]></description>
</item>
<item>
    <title>Computer Organization and Architecture Control Unit Operation &amp; Microprogrammed Control</title>
    <link>https://Jungle430.github.io/posts/computer-organization-and-architecture/computer-organization-and-architecture-control-unit-operation-microprogrammed-control/</link>
    <pubDate>Tue, 31 Jan 2023 15:20:52 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/computer-organization-and-architecture/computer-organization-and-architecture-control-unit-operation-microprogrammed-control/</guid>
    <description><![CDATA[<h1 id="computer-organization-and-architecture">Computer Organization and Architecture</h1>
<h2 id="control-unit-operation--microprogrammed-control">Control Unit Operation &amp; Microprogrammed Control</h2>
<h3 id="outline">Outline</h3>
<ul>
<li>
<p>Control Unit Operation</p>
<ul>
<li>
<p>Micro-Operations</p>
</li>
<li>
<p>Control of the Processor</p>
</li>
<li>
<p>Hardwired Implementation</p>
</li>
</ul>
</li>
<li>
<p>Microprogrammed Control</p>
<ul>
<li>Basic Concepts</li>
<li>Microinstruction Sequencing</li>
<li>Microinstruction Execution</li>
</ul>
</li>
</ul>
<h3 id="control-unit-operation">Control Unit Operation</h3>
<h4 id="the-function-of-a-processor">The function of a processor</h4>
<ul>
<li>
<p>Instruction Fetch and Execute</p>
<ul>
<li>Execute program</li>
</ul>
</li>
<li>
<p>Interrupts</p>
<ul>
<li>Handling performance differences between CPU and other components</li>
</ul>
</li>
<li>
<p>I/O Function</p>
<ul>
<li>Inter-working with peripherals</li>
</ul>
</li>
</ul>
<h4 id="composition-of-instructions">Composition of instructions</h4>
<ul>
<li>
<p>Instructions include opcodes and operands</p>
</li>
<li>
<p>Opcodes</p>
<ul>
<li>Determines what type of operation the instruction does</li>
</ul>
</li>
<li>
<p>Operands</p>
<ul>
<li>
<p>Determine the object of instruction operation</p>
</li>
<li>
<p>Operands may be in registers, memory, I/O, or immediate</p>
</li>
<li>
<p>Finding operands through addressing mode</p>
</li>
</ul>
</li>
</ul>
<h4 id="micro-operations">Micro-operations</h4>
<ul>
<li>
<p>A computer executes a program to complete user specified functions</p>
<ul>
<li>
<p>Program contains many instructions</p>
</li>
<li>
<p>Instruction execution includes several cycles, such as fetch cycle, execution cycle, indirect cycle, etc</p>
</li>
</ul>
</li>
<li>
<p><strong>Each cycle has a number of steps</strong></p>
<ul>
<li>
<p><strong>Called micro-operations</strong></p>
</li>
<li>
<p><strong>Each step does very little</strong></p>
</li>
<li>
<p><strong>Atomic operation of CPU</strong></p>
</li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter15-1.png" title="/img/Computer Organization and Architecture/chapter15-1.png" data-thumbnail="/img/Computer Organization and Architecture/chapter15-1.png" data-sub-html="<h2>Constituent of program</h2>">
        
    </a><figcaption class="image-caption"><code>Constituent of program</code></figcaption>
    </figure>
<ul>
<li>
<p><strong>ç¨‹åºçš„æ‰§è¡Œæ˜¯ç”±è‹¥å¹²ä¸ªæŒ‡ä»¤æ‰§è¡Œç»„æˆçš„</strong></p>
</li>
<li>
<p><strong>æ¯ä¸ªæŒ‡ä»¤çš„æ‰§è¡Œå°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤å‘¨æœŸ</strong></p>
</li>
<li>
<p><strong>æŒ‡ä»¤å‘¨æœŸç”±è‹¥å¹²ä¸ªå­å‘¨æœŸç»„æˆï¼Œæ¯”å¦‚å–æŒ‡å‘¨æœŸã€æ‰§è¡Œå‘¨æœŸç­‰</strong></p>
</li>
<li>
<p><strong>æ¯ä¸ªå­å‘¨æœŸåŒ…å«è‹¥å¹²ä¸ªæ›´å°çš„æ“ä½œï¼Œè¿™äº›æ“ä½œç§°ä¸ºå¾®æ“ä½œ</strong></p>
</li>
</ul>
<h5 id="fetch">Fetch</h5>
<ul>
<li>
<p>Program Counter (PC)</p>
<ul>
<li>Holds address of next instruction to be fetched</li>
</ul>
</li>
<li>
<p>Memory Address Register (MAR)</p>
<ul>
<li>
<p>Connected to address bus</p>
</li>
<li>
<p>Specifies address for read or write op</p>
</li>
</ul>
</li>
<li>
<p>Memory Buffer Register (MBR)</p>
<ul>
<li>
<p>Connected to data bus</p>
</li>
<li>
<p>Holds data to write or last data read</p>
</li>
</ul>
</li>
<li>
<p>Instruction Register (IR)</p>
<ul>
<li>Holds last instruction fetched</li>
</ul>
</li>
</ul>
<hr>
<p><strong>Step1</strong></p>
<a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter15-2.png" title="/img/Computer Organization and Architecture/chapter15-2.png" data-thumbnail="/img/Computer Organization and Architecture/chapter15-2.png">
        
    </a>
<ul>
<li>
<p><strong>ä¸‹ä¸€ä¸ªæŒ‡ä»¤çš„åœ°å€æ˜¯æ”¾åœ¨PCé‡Œ</strong></p>
</li>
<li>
<p><strong>MARæ˜¯ä¸åœ°å€æ€»çº¿è¿æ¥çš„å”¯ä¸€å¯„å­˜å™¨</strong></p>
</li>
<li>
<p><strong>å–æŒ‡çš„ç¬¬ä¸€æ­¥æ˜¯PCæŠŠä¸‹ä¸€ä¸ªæŒ‡ä»¤çš„åœ°å€ç»™MAR</strong></p>
</li>
<li>
<p><strong>ç»è¿‡ç¬¬ä¸€æ­¥ä¹‹åï¼ŒPCå¯„å­˜å™¨çš„å†…å®¹å¤åˆ¶åˆ°MARå¯„å­˜å™¨ä¸­</strong></p>
</li>
</ul>
<hr>
<p><strong>Step2</strong></p>
<a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter15-3.png" title="/img/Computer Organization and Architecture/chapter15-3.png" data-thumbnail="/img/Computer Organization and Architecture/chapter15-3.png">
        
    </a>
<ul>
<li>
<p>MARæ”¶åˆ°åœ°å€åï¼ŒæŠŠåœ°å€æ”¾åˆ°åœ°å€æ€»çº¿ä¸Š</p>
</li>
<li>
<p>æ§åˆ¶å•å…ƒå‘ä¸€ä¸ªè¯»å‘½ä»¤åˆ°æ§åˆ¶æ€»çº¿ä¸Š</p>
</li>
<li>
<p>å­˜å‚¨å™¨æ”¶åˆ°è¯»å‘½ä»¤åï¼Œæ ¹æ®åœ°å€è¯»å‡ºæŒ‡ä»¤å†…å®¹ï¼Œå¹¶æ”¾åˆ°æ•°æ®æ€»çº¿</p>
</li>
<li>
<p>æ•°æ®æ€»çº¿ä¸Šçš„æ•°æ®è¯»åˆ°MBR</p>
</li>
<li>
<p>PCä¸­è¿˜éœ€è¦é€’å¢ä¸€ä¸ªæŒ‡ä»¤é•¿åº¦ï¼Œä»¥å¾—åˆ°ä¸‹ä¸€ä¸ªæŒ‡ä»¤çš„åœ°å€</p>
</li>
</ul>
<hr>
<p><strong>Step3</strong></p>
<a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter15-4.png" title="/img/Computer Organization and Architecture/chapter15-4.png" data-thumbnail="/img/Computer Organization and Architecture/chapter15-4.png">
        
    </a>
<ul>
<li>
<p>MBRçš„å†…å®¹ä¼ é€ç»™IR</p>
</li>
<li>
<p>ä¼ é€å®Œæˆåï¼ŒMBRå°±å¯ä»¥é‡Šæ”¾ï¼Œç”¨äºä¸‹ä¸€æ­¥æ“ä½œ</p>
</li>
<li>
<p>IRä¸­ä¿å­˜çš„å°±æ˜¯ä¸‹ä¸€ä¸ªéœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤</p>
</li>
<li>
<p>é€šè¿‡è¿™å‡ ä¸ªå¾®æ“ä½œï¼Œå®Œæˆäº†å–æŒ‡</p>
</li>
</ul>
<hr>
<p><strong>Fetch sequence</strong></p>
<ul>
<li>
<p>å–æŒ‡å‘¨æœŸå®é™…ä¸Šç”±ä¸‰æ­¥ã€å››ä¸ªå¾®æ“ä½œç»„æˆã€‚æ¯ä¸ªå¾®æ“ä½œéƒ½æ¶‰åŠåˆ°æ•°æ®åœ¨å¯„å­˜å™¨ä¹‹é—´çš„æµåŠ¨</p>
</li>
<li>
<p>å¦‚æœæ•°æ®çš„æµåŠ¨æ˜¯ç‹¬ç«‹çš„ï¼Œè¿™äº›æ“ä½œå¯ä»¥åœ¨åŒä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…å®Œæˆ</p>
</li>
<li>
<p>PCé€’å¢å¾®æ“ä½œï¼Œæ—¢å¯ä»¥åœ¨t2å®Œæˆï¼Œä¹Ÿå¯ä»¥åœ¨t3å®Œæˆ</p>
</li>
</ul>
<hr>
<p><strong>Rules for Micro-operations grouping</strong></p>
<ul>
<li>
<p>Proper sequence must be followed</p>
<ul>
<li>MAR &lt;- (PC) must precede MBR &lt;- (memory)</li>
</ul>
</li>
<li>
<p>Conflicts must be avoided</p>
<ul>
<li>
<p>Must not read &amp; write same register at same time</p>
</li>
<li>
<p>MBR &lt;- (memory) &amp; IR &lt;- (MBR) must not be in same cycle</p>
</li>
</ul>
</li>
<li>
<p>Also: PC &lt;- (PC) +1 involves addition</p>
<ul>
<li>
<p>Use ALU</p>
</li>
<li>
<p>May need additional micro-operations</p>
</li>
</ul>
</li>
</ul>
<hr>
<p><strong>Indirect cycle</strong></p>
<ul>
<li>In indirect addressing, it is necessary to get the address of the operand from the memory first. This process is called indirect cycle</li>
</ul>
<hr>
<p><strong>Interrupt cycle</strong></p>
<ul>
<li>
<p>After instruction processing is completed, check whether there is an interrupt</p>
</li>
<li>
<p>Interrupt cycle needs to complete these operations</p>
<ul>
<li>
<p>The instruction address before the interrupt needs to be saved</p>
</li>
<li>
<p>Get the instruction address of the start of the interrupt handler to the PC</p>
</li>
</ul>
</li>
<li>
<p>After the PC gets the interrupt processing address, it enters the index retrieval cycle</p>
</li>
</ul>
<hr>
<p><strong>Execute cycle</strong></p>
<ul>
<li>
<p>Fetching, indirect and interruption cycle can be determined in advance</p>
<ul>
<li>Each cycle contains a fixed sequence of micro operations</li>
</ul>
</li>
<li>
<p>For execution cycle</p>
<ul>
<li>
<p>Different operation codes correspond to different operations</p>
</li>
<li>
<p>Each operation has a specific micro operation sequence</p>
</li>
</ul>
</li>
</ul>
<h4 id="flowchart-for-instruction-cycle">Flowchart for instruction cycle</h4>
<a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter15-5.png" title="/img/Computer Organization and Architecture/chapter15-5.png" data-thumbnail="/img/Computer Organization and Architecture/chapter15-5.png">
        
    </a>
<ul>
<li>
<p>å–æŒ‡å‘¨æœŸåï¼Œçœ‹æ˜¯å¦æ˜¯é—´æ¥å¯»å€ã€‚å¦‚æœæ˜¯é—´æ¥å¯»å€ï¼Œè¿›å…¥01é—´æ¥å‘¨æœŸï¼Œå¦‚æœä¸æ˜¯ï¼Œè¿›å…¥æ‰§è¡Œå‘¨æœŸã€‚</p>
</li>
<li>
<p>é—´æ¥å‘¨æœŸåï¼Œè¯»å–åœ°å€ï¼Œç„¶åè¿›å…¥10æ‰§è¡Œå‘¨æœŸ</p>
</li>
<li>
<p>æ‰§è¡Œå‘¨æœŸï¼Œæ ¹æ®æ“ä½œç æ¥ç¡®å®šåšä»€ä¹ˆæ“ä½œã€‚ç„¶ååˆ¤æ–­æ˜¯å¦æœ‰ä¸­æ–­ã€‚å¦‚æœæœ‰ä¸­æ–­ï¼Œè¿›å…¥11ä¸­æ–­å‘¨æœŸã€‚å¦‚æœæ²¡æœ‰ï¼Œè¿›å…¥00å–æŒ‡å‘¨æœŸã€‚</p>
</li>
<li>
<p>ä¸­æ–­å‘¨æœŸï¼Œè®¾ç½®ä¸­æ–­ï¼Œç„¶åè¿›å…¥ä¸­æ–­å¤„ç†ç¨‹åºçš„å–æŒ‡å‘¨æœŸï¼Œç»§ç»­å–æŒ‡</p>
</li>
</ul>
<hr>
<ul>
<li>
<p>Control of the Processor</p>
<ul>
<li>
<p>Functional Requirements</p>
</li>
<li>
<p>Control Signals</p>
</li>
<li>
<p>A Control Signals Example</p>
</li>
<li>
<p>Internal Processor Organization</p>
</li>
</ul>
</li>
</ul>
<h4 id="functional-requirement">Functional requirement</h4>
<ul>
<li>
<p>Micro-operations are the most basic function of the processor</p>
</li>
<li>
<p>Three elements of the controller include</p>
<ul>
<li>
<p>Basic elements of processor</p>
</li>
<li>
<p>Micro-operations that processor performs</p>
</li>
<li>
<p>How to control</p>
</li>
<li>
<p>ALU</p>
</li>
<li>
<p>Registers</p>
</li>
<li>
<p>Internal data paths</p>
</li>
<li>
<p>External data paths</p>
</li>
<li>
<p>Control Unit</p>
</li>
</ul>
</li>
</ul>
<h4 id="types-of-micro-operation">Types of micro-operation</h4>
<ul>
<li>
<p>Micro-operations can be divided into the following four categories</p>
<ul>
<li>
<p>Transfer data between registers</p>
</li>
<li>
<p>Transfer data from register to external</p>
</li>
<li>
<p>Transfer data from external to register</p>
</li>
<li>
<p>Perform arithmetic or logical ops</p>
</li>
</ul>
</li>
</ul>
<h4 id="functions-of-control-unit">Functions of control unit</h4>
<ul>
<li>
<p>Operation object and operation type have been determined</p>
</li>
<li>
<p>Function of the controller is to determine how to do it</p>
<ul>
<li>
<p>Sequencing</p>
</li>
<li>
<p>Execution</p>
</li>
<li>
<p>This is done using Control Signals</p>
</li>
</ul>
</li>
</ul>
<h4 id="model-of-control-unit">Model of control unit</h4>
<a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter15-6.png" title="/img/Computer Organization and Architecture/chapter15-6.png" data-thumbnail="/img/Computer Organization and Architecture/chapter15-6.png">
        
    </a>
<ul>
<li>
<p>æ§åˆ¶å™¨çš„è¾“å…¥åŒ…æ‹¬ï¼šæ—¶é’Ÿä¿¡å·ï¼Œå„ç§æ ‡å¿—ï¼ŒæŒ‡ä»¤å¯„å­˜å™¨ä¸­çš„æŒ‡ä»¤ï¼Œæ¥è‡ªæ§åˆ¶æ€»çº¿çš„æ§åˆ¶ä¿¡å·(ä¸­æ–­)</p>
</li>
<li>
<p>æ§åˆ¶å™¨çš„è¾“å‡ºåŒ…æ‹¬ï¼šCPUå†…éƒ¨çš„æ§åˆ¶ä¿¡å·ï¼Œåˆ°æ§åˆ¶æ€»çº¿çš„æ§åˆ¶ä¿¡å·</p>
</li>
<li>
<p><strong>æ§åˆ¶å™¨å†…éƒ¨å°±æ˜¯å¦‚ä½•æ ¹æ®è¾“å…¥ï¼Œæ¥ç”Ÿæˆæ§åˆ¶ä¿¡å·</strong></p>
</li>
</ul>
<hr>
<p><strong>Control signals</strong></p>
<ul>
<li>
<p>Clock</p>
<ul>
<li>Provide clock signal for timing of controller</li>
<li>One micro-instruction (or set of parallel micro-instructions) per clock cycle</li>
</ul>
</li>
<li>
<p>Instruction register</p>
<ul>
<li>
<p>Op-code for current instruction</p>
</li>
<li>
<p>Addressing mode</p>
</li>
<li>
<p>Determines which micro-instructions are performed</p>
</li>
</ul>
</li>
<li>
<p>Flags</p>
<ul>
<li>
<p>State of CPU</p>
</li>
<li>
<p>Results of previous operations</p>
</li>
</ul>
</li>
<li>
<p>Control signal from control bus</p>
<ul>
<li>
<p>Interrupts</p>
</li>
<li>
<p>Acknowledgements</p>
</li>
</ul>
</li>
<li>
<p>output</p>
<ul>
<li>
<p>Within CPU</p>
<ul>
<li>
<p>Cause data movement</p>
</li>
<li>
<p>Activate specific functions</p>
</li>
</ul>
</li>
<li>
<p>Via control bus</p>
<ul>
<li>
<p>To memoryï¼Œcontrol read or write</p>
</li>
<li>
<p>To I/O modules</p>
</li>
</ul>
</li>
<li>
<p><strong>It generates three types of output control signals</strong></p>
<ul>
<li>
<p>Data paths: the signals control the internal flow of data</p>
</li>
<li>
<p>ALU: the signals control the operation of the ALU</p>
</li>
<li>
<p>System bus: the control unit sends these signals to the control lines of the system bus</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="internal-organization">Internal organization</h4>
<ul>
<li>
<p>CPU adopts single bus structure</p>
<ul>
<li>
<p>All components, including ALU and registers, are connected to the bus</p>
</li>
<li>
<p>A gate is set between each component and the bus to control the data transmission between the component and the bus</p>
</li>
</ul>
</li>
<li>
<p>Data transfer to and from external systems bus is controlled by the control signal</p>
</li>
<li>
<p>Temporary registers needed for proper operation of ALU</p>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter15-7.png" title="/img/Computer Organization and Architecture/chapter15-7.png" data-thumbnail="/img/Computer Organization and Architecture/chapter15-7.png" data-sub-html="<h2>Internal processor organization</h2>">
        
    </a><figcaption class="image-caption"><code>Internal processor organization</code></figcaption>
    </figure>
<ul>
<li>
<p>å„ä¸ªå¯„å­˜å™¨éƒ½é“¾æ¥åˆ°å†…éƒ¨æ€»çº¿ä¸Šã€‚å¯„å­˜å™¨å’Œå†…éƒ¨æ€»çº¿ä¹‹é—´æœ‰ä¸ªé€»è¾‘é—¨ï¼Œç”¨äºå¯„å­˜å™¨å’Œå†…éƒ¨æ€»çº¿çš„è¿æ¥æ§åˆ¶</p>
</li>
<li>
<p>ALUæ²¡æœ‰å†…éƒ¨å­˜å‚¨éƒ¨ä»¶ã€‚å¦‚æœALUçš„æ“ä½œæ¶‰åŠ2ä¸ªæ“ä½œæ•°çš„è¯ï¼Œä¸€ä¸ªç”±å†…éƒ¨æ€»çº¿å¾—åˆ°ï¼Œå¦ä¸€ä¸ªå¿…é¡»é€šè¿‡å…¶ä»–çš„æ•°æ®æºæ¥å¾—åˆ°ï¼Œä¸èƒ½éƒ½åœ¨å†…éƒ¨æ€»çº¿ä¸Šã€‚éœ€è¦å¢åŠ ä¸€ä¸ªYå¯„å­˜å™¨ï¼Œç”¨äºä¸´æ—¶ä¿å­˜æºæ“ä½œæ•°</p>
</li>
<li>
<p>ALUè¿˜éœ€è¦æœ‰ä¸€ä¸ªå¯„å­˜å™¨ï¼Œæ¥ä¸´æ—¶ä¿å­˜è¾“å‡ºç»“æœã€‚è¿™ä¸ªç»“æœä¸èƒ½æ€»çº¿ä¸Šï¼Œå› ä¸ºå¦‚æœæ”¾æ€»çº¿ä¸Šçš„è¯ï¼Œå®ƒåˆä¼šå½“ä½œALUçš„è¾“å…¥</p>
</li>
</ul>
<h4 id="implementation-of-control-unit">Implementation of control unit</h4>
<ul>
<li>
<p>The control unit implementation can be done by two methods</p>
<ul>
<li>
<p>Hardwired implementation</p>
</li>
<li>
<p>Microprogrammed implementation</p>
</li>
</ul>
</li>
<li>
<p>Hardwired implementation: the control unit is a combinational circuit</p>
<ul>
<li>The input signals are transferred into a set of output control signals</li>
</ul>
</li>
<li>
<p>æ—¶é’Ÿå‘ç”Ÿå™¨ï¼šäº§ç”Ÿæ—¶é’Ÿä¿¡å·ï¼Œå¹¶æä¾›è®¡æ•°å™¨</p>
</li>
<li>
<p>è¯‘ç å™¨ï¼šæ ¹æ®æŒ‡ä»¤å¯„å­˜å™¨ä¸­çš„æŒ‡ä»¤æ“ä½œç ï¼Œç”Ÿæˆæ“ä½œç å¯¹åº”çš„å”¯ä¸€è¾“å‡ºï¼Œæä¾›ç»™è¾“å‡ºæ§åˆ¶å•å…ƒ</p>
</li>
<li>
<p>æ ‡å¿—ï¼šä¸ºæ§åˆ¶å•å…ƒæä¾›ç›¸å…³çš„æ ‡å¿—ä¿¡å·</p>
</li>
<li>
<p>æ§åˆ¶å•å…ƒï¼šæ˜¯æ§åˆ¶å™¨çš„æ ¸å¿ƒï¼Œè´Ÿè´£äº§ç”Ÿæ§åˆ¶ä¿¡å·</p>
</li>
</ul>
<h4 id="control-matrix">Control matrix</h4>
<ul>
<li>
<p>Programmable arrays may also be numerous</p>
</li>
<li>
<p>Large control matrices are implemented hierarchically for speed</p>
</li>
</ul>
<h4 id="problems-with-hard-wired">Problems With Hard Wired</h4>
<ul>
<li>
<p>Complex micro-operation logic</p>
</li>
<li>
<p>Difficult to design and test</p>
</li>
<li>
<p>Inflexible design</p>
</li>
<li>
<p>Difficult to add new instructions</p>
</li>
</ul>
<h4 id="summary">Summary</h4>
<ul>
<li>
<p>The instructions are divided into a sequence of stages</p>
</li>
<li>
<p>Fetch, indirect, execute, interrupt</p>
</li>
<li>
<p>Each stage is further divided into a sequence of microoperations</p>
<ul>
<li>T1, T2, T3, â€¦</li>
</ul>
</li>
<li>
<p>Each micro-operation occupies one clock unit</p>
</li>
<li>
<p>The function of the control unit is to produce a sequence of timed control signals to control the data paths and ALU operations</p>
</li>
<li>
<p>The control unit is a combinational circuit that transfers inputs to a group of control signals</p>
<ul>
<li>
<p>Inputs: flags, instruction registers, clock, control signals from system bus</p>
</li>
<li>
<p>Outputs: control signals to system bus and within CPU</p>
</li>
</ul>
</li>
</ul>
<h3 id="microprogrammed-control">Microprogrammed Control</h3>
<h4 id="basic-concepts">Basic Concepts</h4>
<ul>
<li>
<p>Control unit can be implemented by a more flexible technique called microprogrammed control unit</p>
<ul>
<li>
<p>The logic of the control unit is specified by a microprogram</p>
</li>
<li>
<p>Each line in microprogram describes a group of micro-operations in one timeï¼Œcalled microinstruction</p>
</li>
<li>
<p>Construct a control word corresponding to this microinstruction</p>
</li>
<li>
<p>The control word determines the opening or closing of all doors</p>
</li>
</ul>
</li>
<li>
<p>å¾®æŒ‡ä»¤ä¸­åŒ…æ‹¬CPUå†…æ§åˆ¶ä¿¡å·ã€ç³»ç»Ÿæ€»çº¿æ§åˆ¶ä¿¡å·ã€è·³è½¬æ¡ä»¶ã€å¾®æŒ‡ä»¤åœ°å€</p>
</li>
<li>
<p>æ‰§è¡Œè¿™æ¡å¾®æŒ‡ä»¤çš„æ•ˆæœæ˜¯ï¼Œæ‰“å¼€CPUå†…å¤–æ‰€æœ‰ä¸º1çš„æ§åˆ¶çº¿ï¼Œå…³é—­æ‰€æœ‰ä¸º0çš„æ§åˆ¶çº¿</p>
</li>
<li>
<p>å¦‚æœæ¡ä»¶æ¡ä»¶ä¸ºå‡ï¼Œè‡ªåŠ¨æ‰§è¡Œä¸‹ä¸€ä¸ªé¡ºåºçš„å¾®æŒ‡ä»¤</p>
</li>
<li>
<p>å¦‚æœè·³è½¬æ¡ä»¶ä¸ºçœŸï¼Œåˆ™æ‰§è¡Œâ€œå¾®æŒ‡ä»¤åœ°å€â€ä¸­å¯¹åº”çš„å¾®æŒ‡ä»¤</p>
</li>
</ul>
<p><strong>Micro-instruction Types</strong></p>
<ul>
<li>
<p><strong>horizontal microinstruction</strong></p>
<ul>
<li>
<p>æ°´å¹³å¾®æŒ‡ä»¤åŒ…æ‹¬å››ä¸ªéƒ¨åˆ†</p>
<ul>
<li>å†…éƒ¨æ§åˆ¶ä¿¡å·ï¼šCPUå†…çš„æ¯ä¸€ä¸ªæ§åˆ¶çº¿éƒ½æœ‰ç›¸åº”çš„1ä½</li>
<li>æ€»çº¿æ§åˆ¶ä¿¡å·ï¼šæ¯ä¸€ä¸ªç³»ç»Ÿæ§åˆ¶æ€»çº¿éƒ½æœ‰ç›¸åº”çš„1ä½</li>
<li>æ¡ä»¶å­—æ®µï¼šæŒ‡ç¤ºè½¬ç§»å‘ç”Ÿæ¡ä»¶çš„å­—æ®µ</li>
<li>å¾®æŒ‡ä»¤åœ°å€ï¼šè½¬ç§»çš„ç›®æ ‡æŒ‡ä»¤åœ°å€</li>
</ul>
</li>
<li>
<p>æ‰“å¼€ä½å€¼ä¸º1çš„æ§åˆ¶çº¿ï¼Œå…³é—­æ‰€æœ‰ä½å€¼ä¸º0çš„æ§åˆ¶çº¿ã€‚æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªå¾®æ“ä½œ</p>
</li>
<li>
<p>å¦‚æœè·³è½¬æ¡ä»¶ä¸ºå‡ï¼Œé¡ºåºæ‰§è¡Œä¸‹ä¸€ä¸ªæŒ‡ä»¤ã€‚å¦‚æœè·³è½¬æ¡ä»¶ä¸ºçœŸï¼Œæ‰§è¡Œâ€œå¾®æŒ‡ä»¤åœ°å€â€ æŒ‡å‘çš„å¾®æŒ‡ä»¤</p>
</li>
<li>
<p><strong>Characteristic</strong></p>
<ul>
<li>
<p>Each control line inside the CPU and bus needs to have a separate control bit</p>
<ul>
<li>The width of the control word is very large</li>
</ul>
</li>
<li>
<p>Each line is a separate control bit</p>
<ul>
<li>Each control line can be controlled independently</li>
<li>More kinds of micro operations that can be supported</li>
</ul>
</li>
</ul>
</li>
<li>
<p>The control lines are controlled by one bit of the control word independently</p>
<ul>
<li>The coding of control signal is not compact</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>vertical microinstruction</strong></p>
<ul>
<li>
<p>å‚ç›´å¾®æŒ‡ä»¤ä¹ŸåŒ…æ‹¬æ¡ä»¶å’Œè·³è½¬å¾®æŒ‡ä»¤åœ°å€ï¼Œè·Ÿæ°´å¹³å¾®æŒ‡ä»¤ç±»ä¼¼</p>
</li>
<li>
<p>åœ¨æ§åˆ¶æ–¹é¢ï¼Œå’Œæ°´å¹³å¾®æŒ‡ä»¤çš„æ¯ä¸€ä½å¯¹åº”ä¸€ä¸ªæ§åˆ¶çº¿ä¸åŒï¼Œå‚ç›´å¾®æŒ‡ä»¤åˆåšäº†ä¸€æ¬¡ç¼–ç </p>
</li>
<li>
<p>è§£å†³æ°´å¹³å¾®æŒ‡ä»¤çš„æ§åˆ¶å­—å¤ªé•¿çš„é—®é¢˜</p>
</li>
<li>
<p>ç¼–ç åï¼Œç”±ä¸€ä¸ªè§£ç å™¨å†ç¿»è¯‘æˆæ§åˆ¶çº¿çš„æ§åˆ¶ä¿¡å·</p>
</li>
<li>
<p><strong>Characteristic</strong></p>
<ul>
<li>
<p>Width is narrow</p>
<ul>
<li>
<p>n control signals encoded into $\log_2 n$ bits($n \rightarrow 2^n$)</p>
</li>
<li>
<p>Limited number of micro operations supported</p>
</li>
</ul>
</li>
<li>
<p>Additional steps required</p>
<ul>
<li>External memory word decode is needed</li>
<li>Identify the exact control line being manipulated</li>
<li>Send control signal</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="micro-program-word-length">Micro-program Word Length</h4>
<ul>
<li>
<p><strong>Word length is an important factor in microprogram</strong></p>
</li>
<li>
<p><strong>Word length is determined by three factors</strong>\</p>
<ul>
<li>
<p><strong>Maximum number of simultaneous micro-operations supported</strong></p>
</li>
<li>
<p><strong>The way control information is represented or encoded</strong></p>
</li>
<li>
<p><strong>The way in which the next micro-instruction address is specified</strong></p>
</li>
</ul>
</li>
</ul>
<hr>
<p><strong>Compromise</strong></p>
<ul>
<li>
<p>Divide control signals into disjoint groups</p>
</li>
<li>
<p>Implement each group as separate field in memory word</p>
</li>
<li>
<p>Supports reasonable levels of parallelism without too much complexity</p>
</li>
</ul>
<h4 id="the-control-memory">The control memory</h4>
<ul>
<li>
<p>The control words are put into a special memory block called control memory, with each word having a unique address</p>
</li>
<li>
<p>The microinstructions are organized as different routines</p>
<ul>
<li>
<p>The microinstructions in each routine are executed sequentially</p>
</li>
<li>
<p>Each routine ends with a branch instruction points to the next routine</p>
</li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter15-8.png" title="/img/Computer Organization and Architecture/chapter15-8.png" data-thumbnail="/img/Computer Organization and Architecture/chapter15-8.png" data-sub-html="<h2>Control memory</h2>">
        
    </a><figcaption class="image-caption"><code>Control memory</code></figcaption>
    </figure>
<ul>
<li>
<p>å­˜å‚¨æ§åˆ¶å™¨ä¸­å­˜å‚¨äº†å–æŒ‡ä¾‹ç¨‹ã€é—´æ¥ä¾‹ç¨‹ã€ä¸­æ–­ä¾‹ç¨‹ã€æ‰§è¡Œä¾‹ç¨‹ç­‰ï¼Œè¿™äº›ä¾‹ç¨‹è§„å®šäº†åœ¨æ¯ä¸ªå‘¨æœŸå†…éœ€è¦æ‰§è¡Œçš„å¾®æ“ä½œåºåˆ—</p>
</li>
<li>
<p>ä¾‹ç¨‹ä¸­è¿˜è§„å®šäº†åœ¨æ‰§è¡Œç»“æŸåè½¬ç§»åˆ°ä¸‹é¢å“ªä¸€ä¸ªä¾‹ç¨‹ï¼Œä¹Ÿå°±æ˜¯æŒ‡å®šäº†å‘¨æœŸçš„æ‰§è¡Œé¡ºåº</p>
</li>
<li>
<p>ä¾‹å¦‚ï¼Œå–æŒ‡å‘¨æœŸåï¼Œå¯èƒ½ä¼šåˆ°é—´æ¥å‘¨æœŸï¼Œä¹Ÿå¯èƒ½åˆ°æ‰§è¡Œå‘¨æœŸï¼Œéœ€è¦æ ¹æ®å–æŒ‡å‘¨æœŸæ¥ç¡®å®š</p>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter15-9.png" title="/img/Computer Organization and Architecture/chapter15-9.png" data-thumbnail="/img/Computer Organization and Architecture/chapter15-9.png" data-sub-html="<h2>Control Unit Microarchitecture</h2>">
        
    </a><figcaption class="image-caption"><code>Control Unit Microarchitecture</code></figcaption>
    </figure>
<ul>
<li>
<p><strong>Sequencing logic</strong></p>
</li>
<li>
<p><strong>Control address register</strong></p>
</li>
<li>
<p><strong>Control memory</strong></p>
</li>
<li>
<p><strong>Control buffer register</strong></p>
</li>
<li>
<p>æ§åˆ¶å­˜å‚¨å™¨ï¼šå­˜å‚¨å¾®æŒ‡ä»¤</p>
</li>
<li>
<p>æ§åˆ¶åœ°å€å¯„å­˜å™¨ï¼šåŒ…å«ä¸‹ä¸€ä¸ªå°†è¦è¢«è¯»å–çš„å¾®æŒ‡ä»¤åœ°å€ã€‚ç±»ä¼¼äºPC</p>
</li>
<li>
<p>æ§åˆ¶ç¼“å†²å¯„å­˜å™¨ï¼šå¾®æŒ‡ä»¤ç”±æ§åˆ¶å­˜å‚¨å™¨è¯»å–ä¹‹åï¼Œæ”¾åˆ°æ§åˆ¶ç¼“å†²å¯„å­˜å™¨ä¸­ã€‚æ§åˆ¶ç¼“å†²å¯„å­˜å™¨çš„å·¦åŠéƒ¨åˆ†ç›´æ¥å’Œæ§åˆ¶çº¿è¿æ¥ï¼Œè¯»å–å¾®æŒ‡ä»¤ç›´æ¥ç”Ÿæˆæ§åˆ¶ä¿¡å·ï¼Œæ§åˆ¶é—¨çš„å¼€æˆ–å…³</p>
</li>
<li>
<p>å®šåºé€»è¾‘ï¼šè´Ÿè´£ä¸ºæ§åˆ¶åœ°å€å¯„å­˜å™¨æä¾›åœ°å€ï¼Œå¹¶å‘å‡ºè¯»å‘½ä»¤</p>
</li>
</ul>
<h4 id="control-unit-function">Control Unit Function</h4>
<ul>
<li>
<p>Sequence logic unit issues read command</p>
<ul>
<li>
<p>Word specified in control address register is read into control buffer register</p>
</li>
<li>
<p>Control buffer register contents generates control signals and next address information</p>
</li>
</ul>
</li>
<li>
<p>Sequence logic loads new address into control address register based on next address information from control buffer register and ALU flags</p>
</li>
</ul>
<h4 id="next-address-decision">Next Address Decision</h4>
<ul>
<li>
<p>Sequencing logic needs to determine the next microinstruction</p>
<ul>
<li>At the end of each microinstruction, the next microinstruction address is loaded into the control address register</li>
</ul>
</li>
<li>
<p>Depending on ALU flags and control buffer register</p>
<ul>
<li>
<p>Next microinstruction in sequence</p>
</li>
<li>
<p>Jump to a new routine based on jump instructions</p>
</li>
<li>
<p>Jump to a machine instruction routine</p>
</li>
</ul>
</li>
</ul>
<h4 id="next-address">Next Address</h4>
<ul>
<li>
<p>Next microinstruction in sequence</p>
<ul>
<li>Add 1 to control address register</li>
</ul>
</li>
<li>
<p>Jump to new routine based on jump microinstruction</p>
<ul>
<li>Load address field of control buffer register into control address register</li>
</ul>
</li>
<li>
<p>Jump to machine instruction routine</p>
<ul>
<li>Load control address register based on opcode in IR</li>
</ul>
</li>
</ul>
<hr>
<ol>
<li>
<p>æŒ‡ä»¤è¯‘ç å™¨æ˜¯å°†æŒ‡ä»¤å¯„å­˜å™¨ä¸­çš„æ“ä½œç ç¿»è¯‘æˆæ§åˆ¶å¯„å­˜å™¨åœ°å€</p>
</li>
<li>
<p>æ§åˆ¶åœ°å€å¯„å­˜å™¨åˆ°æ§åˆ¶å­˜å‚¨å™¨ä¸­æ‰¾åˆ°æ§åˆ¶å­—ï¼Œå¹¶æ”¾åˆ°æ§åˆ¶ç¼“å†²å¯„å­˜å™¨ä¸­</p>
</li>
<li>
<p><strong>æ§åˆ¶ç¼“å†²å¯„å­˜å™¨è¿›è¡Œæ§åˆ¶æ“ä½œã€‚å¦‚æœæ˜¯å‚ç›´å¾®æŒ‡ä»¤ï¼Œåˆ™éœ€è¦è¯‘ç å™¨è¿›è¡Œè¯‘ç åç”Ÿæˆæ§åˆ¶ä¿¡å·</strong></p>
</li>
<li>
<p>æ§åˆ¶ä¿¡å·è¯‘ç å™¨ç”¨äºå‚ç›´å¾®æŒ‡ä»¤ï¼Œå°†æ§åˆ¶å­—ç¿»è¯‘æˆæ§åˆ¶çº¿çš„æ§åˆ¶ä¿¡å·ï¼Œå‘é€åˆ°CPUå†…éƒ¨å’Œç³»ç»Ÿæ€»çº¿</p>
</li>
<li>
<p>å¯¹äºå‚ç›´å¾®æŒ‡ä»¤ï¼Œæœ‰ä¸€ä¸ªé™„åŠ é€»è¾‘å’Œæ—¶é—´å»¶è¿Ÿ</p>
</li>
<li>
<p>ä¸‹ä¸€ä¸ªå¾®æŒ‡ä»¤åœ°å€ç»™å®šåºé€»è¾‘ï¼Œä»¥ç¡®å®šæ‰§è¡Œå“ªä¸€ä¸ªå¾®æŒ‡ä»¤</p>
</li>
</ol>
<h4 id="simple-summary">Simple summary</h4>
<ul>
<li>
<p>All the control unit does is generate a set of control signals</p>
<ul>
<li>
<p>Control the opening and closing of each gate</p>
</li>
<li>
<p>Use one control bit to represent the control signal of a door</p>
</li>
<li>
<p>Control bits of all gates constitute control words</p>
</li>
</ul>
</li>
<li>
<p>Have a control word for each group of micro-operations in one time</p>
</li>
<li>
<p>The next microinstruction can be specified in the microinstruction and executed conditionally</p>
</li>
</ul>
<hr>
<ul>
<li>
<p>For machine code instruction</p>
<ul>
<li>
<p>It is generally divided into multiple cycles, such as fetch cycle, execution cycle, etc</p>
</li>
<li>
<p>Multiple microoperations need to be completed</p>
</li>
<li>
<p>Each microoperation corresponds to one control word</p>
</li>
<li>
<p>A group of control words realizes the control function of a machine code</p>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>
<p>Todayâ€™s large microprocessor</p>
<ul>
<li>
<p>Many instructions and associated register-level hardware</p>
</li>
<li>
<p>Many control points to be manipulated</p>
</li>
</ul>
</li>
<li>
<p>This results in control memory that</p>
<ul>
<li>
<p>Contains a large number of wordsï¼Œco-responding to the number of instructions to be executed</p>
</li>
<li>
<p>Has a wide word widthï¼Œdue to the large number of control points to be manipulated</p>
</li>
</ul>
</li>
</ul>
<h4 id="advantages-and-disadvantages">Advantages and Disadvantages</h4>
<ul>
<li>
<p>Advantages</p>
<ul>
<li>
<p>Simplifies design of control unit</p>
</li>
<li>
<p>Cheaper</p>
</li>
<li>
<p>Less error-prone</p>
</li>
</ul>
</li>
<li>
<p>Disadvantages</p>
<ul>
<li>
<p>Additional processing required</p>
</li>
<li>
<p>Slower</p>
</li>
</ul>
</li>
</ul>
<h4 id="microinstruction-sequencing">Microinstruction Sequencing</h4>
<ul>
<li>
<p>Microinstruction controller has two basic tasks</p>
<ul>
<li>
<p>Microinstruction sequencingï¼š Get the next microinstruction from the control memory</p>
</li>
<li>
<p>Microinstruction execution : Through control word generates control signal for executing the micro instruction</p>
</li>
</ul>
</li>
<li>
<p>Must consider both together</p>
<ul>
<li>Affects instruction format and controller timing</li>
</ul>
</li>
</ul>
<h4 id="sequencing-techniques">Sequencing Techniques</h4>
<ul>
<li>
<p>Two problems must be considered</p>
<ul>
<li>
<p>Size of microinstructions</p>
</li>
<li>
<p>Address generation time</p>
</li>
</ul>
</li>
<li>
<p>Size of microinstructions</p>
<ul>
<li>The larger the microinstruction, the larger the control memory, and the more expensive</li>
<li>Size of microinstructions should be reduced</li>
</ul>
</li>
<li>
<p>Address generation time</p>
<ul>
<li>The requirement to execute microinstructions as quickly as possible</li>
</ul>
</li>
</ul>
<h5 id="address-generation-time">Address generation time</h5>
<ul>
<li>
<p>Determined by instruction register</p>
<ul>
<li>Once per cycle, after instruction is fetched</li>
</ul>
</li>
<li>
<p>Next sequential address</p>
<ul>
<li>Use in most cases</li>
</ul>
</li>
<li>
<p>Branch</p>
<ul>
<li>
<p>Both conditional and unconditional</p>
</li>
<li>
<p>Generally, there is a jump after 3-4 microinstructions</p>
</li>
<li>
<p>Very important</p>
</li>
</ul>
</li>
</ul>
<h5 id="sequencing-techniques-1">Sequencing Techniques</h5>
<ul>
<li>
<p>Based on current microinstruction, condition flags, contents of IR, generate control memory address of next microinstruction</p>
</li>
<li>
<p>The jump of microinstructions can be divided into three modes according to the address information format in the microinstructions</p>
<ul>
<li>
<p>Two address fields</p>
<ul>
<li>
<p>å¯¹äºåŒåœ°å€å­—æ®µæ¨¡å¼ï¼Œå¾®æŒ‡ä»¤ä¸­æä¾›äº†2ä¸ªåœ°å€å­—æ®µ</p>
</li>
<li>
<p>æ§åˆ¶ç¼“å†²å¯„å­˜å™¨è¯»å–å¾®æŒ‡ä»¤åï¼Œç¬¬ä¸€éƒ¨åˆ†äº§ç”Ÿæ§åˆ¶ä¿¡å·ï¼Œç¬¬äºŒéƒ¨åˆ†å’Œç¬¬ä¸‰éƒ¨åˆ†æ˜¯2ä¸ªåœ°å€ï¼Œè¿™2ä¸ªåœ°å€ï¼ŒåŠ ä¸ŠæŒ‡ä»¤å¯„å­˜å™¨çš„å†…å®¹ï¼Œè¿æ¥åˆ°ä¸€ä¸ªå¤šè·¯å™¨ä¸­ã€‚å¤šè·¯å™¨é€‰æ‹©ä¸€ä¸ªé€åˆ°æ§åˆ¶åœ°å€å¯„å­˜å™¨ä¸­</p>
</li>
<li>
<p>æ§åˆ¶åœ°å€å¯„å­˜å™¨é€šè¿‡è¯‘ç ï¼Œäº§ç”Ÿä¸‹ä¸€ä¸ªå¾®æŒ‡ä»¤çš„åœ°å€ã€‚åœ°å€é€‰æ‹©çš„è¾“å…¥æ˜¯ç”±è½¬ç§»é€»è¾‘æ¨¡å—æ¥å®Œæˆçš„ï¼Œå®ƒæ ¹æ®å¾®æŒ‡ä»¤ä¸­çš„æ§åˆ¶éƒ¨åˆ†ï¼Œä»¥åŠæ ‡å¿—ä½ï¼Œå‘å¤šè·¯å™¨æä¾›é€‰æ‹©ä¿¡å·</p>
</li>
<li>
<p>åŒåœ°å€å­—æ®µæ–¹å¼æ¯”è¾ƒç®€å•ï¼Œå¾®æŒ‡ä»¤ä¸­æœ‰2ä¸ªåœ°å€ï¼Œéœ€è¦æ›´å¤šçš„ä½</p>
</li>
</ul>
</li>
<li>
<p>Single address field</p>
<ul>
<li>
<p>å•åœ°å€å­—æ®µæ–¹å¼ä¸­ï¼Œå¾®æŒ‡ä»¤ä¸­åªæœ‰ä¸€ä¸ªåœ°å€ã€‚ä¸‹ä¸€ä¸ªåœ°å€çš„é€‰æ‹©æ–¹æ³•æ˜¯ï¼š</p>
<ul>
<li>
<p>åœ°å€å­—æ®µä¸­æŒ‡å®šçš„åœ°å€</p>
</li>
<li>
<p>æŒ‡ä»¤å¯„å­˜å™¨ä¸­çš„ä»£ç </p>
</li>
<li>
<p>ä¸‹ä¸€ä¸ªé¡ºåºåœ°å€</p>
</li>
</ul>
</li>
<li>
<p>ä¸‹ä¸€ä¸ªé¡ºåºåœ°å€æ˜¯ç”¨ä¸Šä¸€æ¬¡çš„æ§åˆ¶åœ°å€å¯„å­˜å™¨ä¸­çš„åœ°å€+1æ¥å¾—åˆ°çš„</p>
</li>
</ul>
</li>
<li>
<p>Variable format</p>
<ul>
<li>
<p>å¯å˜æ ¼å¼æä¾›ä¸¤ç§ä¸åŒæ ¼å¼çš„æŒ‡ä»¤ã€‚ç”¨1ä½æ¥æ ‡è¯†å½“å‰æ˜¯å“ªç§æ ¼å¼ã€‚</p>
</li>
<li>
<p>åœ¨ä¸€ç§æ ¼å¼ä¸­ï¼Œæ‰€æœ‰ä½éƒ½ç”¨äºäº§ç”Ÿæ§åˆ¶ä¿¡å·ã€‚æ‰€ä»¥ï¼Œä¸‹ä¸€ä¸ªå¾®æŒ‡ä»¤çš„åœ°å€ï¼Œæˆ–è€…æ˜¯ä¸‹ä¸€é¡ºåºåœ°å€ï¼Œæˆ–è€…æ˜¯ç”±æŒ‡ä»¤å¯„å­˜å™¨æ¥æŒ‡å®š</p>
</li>
<li>
<p>å¦ä¸€ç§æ ¼å¼ä¸­ï¼Œæœ‰ä¸€äº›ä½ç”¨äºå¯åŠ¨è½¬ç§»é€»è¾‘æ¨¡å—ï¼Œå…¶ä½™çš„ä½æ¥æä¾›åœ°å€ã€‚è¿™æ ·å°±å¯ä»¥è¿›è¡Œæ¡ä»¶æˆ–è€…æ— æ¡ä»¶è½¬ç§»</p>
</li>
<li>
<p>è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯è½¬ç§»å¾®æŒ‡ä»¤éœ€è¦èŠ±è´¹ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸ</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="microinstruction-execution">Microinstruction Execution</h4>
<ul>
<li>
<p>Microinstruction execution is a periodic basic even</p>
</li>
<li>
<p>Each cycle is made up of two events</p>
<ul>
<li>
<p>Fetch</p>
</li>
<li>
<p>Execute</p>
</li>
</ul>
</li>
<li>
<p>Fetch</p>
<ul>
<li>Get the microinstruction from the control memory according to the generated microinstruction address</li>
</ul>
</li>
<li>
<p>Execute</p>
<ul>
<li>Execute microinstructions and generate control signals</li>
</ul>
</li>
</ul>
<h4 id="execution-effect">Execution effect</h4>
<ul>
<li>
<p>Effect is to generate control signals</p>
</li>
<li>
<p>Internal</p>
<ul>
<li>
<p>Control signals inside the processor</p>
</li>
<li>
<p>Control the internal components of the processor</p>
</li>
</ul>
</li>
<li>
<p>External</p>
<ul>
<li>
<p>Control signals to external control bus or other interface</p>
</li>
<li>
<p>Control disk read-write, I/O read-write etc</p>
</li>
</ul>
</li>
<li>
<p>With the function to generate next address</p>
</li>
</ul>
<h4 id="summary-1">Summary</h4>
<ul>
<li>
<p>A microprogrammed control unit is a relatively simple logic circuit that is capable of</p>
<ul>
<li>
<p>Sequencing through microinstructions</p>
</li>
<li>
<p>Generating control signals to execute each microinstruction</p>
</li>
</ul>
</li>
</ul>
]]></description>
</item>
<item>
    <title>Computer Organization and Architecture Instruction Level Parallelism and Superscalar Processors</title>
    <link>https://Jungle430.github.io/posts/computer-organization-and-architecture/computer-organization-and-architecture-instruction-level-parallelism-and-superscalar-processors/</link>
    <pubDate>Mon, 30 Jan 2023 16:28:39 &#43;0800</pubDate><author>1239946358@qq.com (Jungle)</author><guid>https://Jungle430.github.io/posts/computer-organization-and-architecture/computer-organization-and-architecture-instruction-level-parallelism-and-superscalar-processors/</guid>
    <description><![CDATA[<h1 id="computer-organization-and-architecture">Computer Organization and Architecture</h1>
<h2 id="instruction-level-parallelism-and-superscalar-processors">Instruction Level Parallelism and Superscalar Processors</h2>
<h3 id="outline">Outline</h3>
<ul>
<li>
<p>Overview of Superscalar</p>
</li>
<li>
<p>Design Issues of Superscalar</p>
</li>
<li>
<p>Superscalar in Pentium</p>
</li>
<li>
<p>Superscalar in ARM CORTEX-A8</p>
</li>
</ul>
<h3 id="overview-of-superscalar">Overview of Superscalar</h3>
<figure><a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter14-1.png" title="/img/Computer Organization and Architecture/chapter14-1.png" data-thumbnail="/img/Computer Organization and Architecture/chapter14-1.png" data-sub-html="<h2>Ideal pipeline</h2>">
        
    </a><figcaption class="image-caption"><code>Ideal pipeline</code></figcaption>
    </figure>
<ul>
<li>
<p>ç†æƒ³çš„æŒ‡ä»¤æµæ°´çº¿çš„æ‰§è¡Œè¿‡ç¨‹</p>
</li>
<li>
<p>æŒ‡ä»¤æ‰§è¡Œåˆ†ä¸º6ä¸ªé˜¶æ®µï¼Œä¸”ä¸å…±äº«èµ„æº</p>
</li>
<li>
<p>æ¯ä¸ªæ—¶é—´å•ä½éƒ½ä¼šæœ‰1ä¸ªæŒ‡ä»¤å®Œæˆæ‰§è¡Œ</p>
</li>
<li>
<p>æŒ‡ä»¤æ•°é‡è¶³å¤Ÿå¤šæ—¶ï¼Œæ‰§è¡Œæ•ˆç‡ä¸ºåŸæ¥çš„6å€</p>
</li>
</ul>
<hr>
<p><strong>Actual pipeline</strong></p>
<ul>
<li>
<p>Not all instructions require the same steps</p>
<ul>
<li>Some pipeline stages are idle</li>
</ul>
</li>
<li>
<p>Running time of different pipeline stages is different</p>
<ul>
<li>running time of some pipeline stages is wasted</li>
</ul>
</li>
<li>
<p>Instructions are not independent of each other</p>
<ul>
<li>Poor operation of the pipeline</li>
</ul>
</li>
</ul>
<h4 id="problem-about-pipeline">Problem about pipeline</h4>
<ul>
<li>
<p>The pipeline pauses due to dependencies between instructions, which is called pipeline risk</p>
</li>
<li>
<p>There are three types of dependencies</p>
<ul>
<li>
<p>Data dependence</p>
</li>
<li>
<p>Control dependence</p>
</li>
<li>
<p>resource dependence</p>
</li>
</ul>
</li>
</ul>
<h4 id="question">Question</h4>
<ul>
<li>
<p>Is instruction pipelining truly parallel?</p>
<ul>
<li>
<p>Yes: There are indeed multiple instructions in the pipeline being processed at the same time</p>
</li>
<li>
<p>No: multiple instructions do not enter the pipeline at the same time</p>
</li>
</ul>
</li>
<li>
<p>How to further improve the execution efficiency of instructions?</p>
<ul>
<li>
<p>Optimize pipeline: super pipeline</p>
</li>
<li>
<p>True instruction level parallelism: superscalar pipelining</p>
</li>
</ul>
</li>
</ul>
<h4 id="superpipeline">Superpipeline</h4>
<ul>
<li>
<p>In an ordinary pipeline, each clock cycle can complete processing of one pipeline stage</p>
</li>
<li>
<p>Many pipeline stages need less than half a clock cycle</p>
</li>
<li>
<p>Superpipeline</p>
<ul>
<li>
<p>Double internal clock rate is adopted for instruction scheduling</p>
</li>
<li>
<p>Double internal clock speed gets two tasks per external clock cycle</p>
</li>
</ul>
</li>
<li>
<p>Get twice the instruction throughput</p>
</li>
</ul>
<a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter14-2.png" title="/img/Computer Organization and Architecture/chapter14-2.png" data-thumbnail="/img/Computer Organization and Architecture/chapter14-2.png">
        
    </a>
<ul>
<li>
<p>å››é˜¶æ®µæµæ°´çº¿ï¼ŒæŒ‡ä»¤åˆ’åˆ†ä¸º4ä¸ªé˜¶æ®µ</p>
</li>
<li>
<p>æ™®é€šæµæ°´çº¿ä¸­ï¼Œæ¯ä¸ªé˜¶æ®µéœ€è¦1ä¸ªæ—¶é’Ÿå‘¨æœŸæ¥å®Œæˆã€‚æœ€é«˜èƒ½è¾¾åˆ°4å€çš„æŒ‡ä»¤æ‰§è¡Œæ•ˆç‡ï¼Œæ¯ä¸ªæ—¶é’Ÿå‘¨æœŸå¯ä»¥è¾“å‡º1ä¸ªæŒ‡ä»¤çš„æ‰§è¡Œç»“æœ</p>
</li>
<li>
<p>è¶…çº§æµæ°´çº¿ã€‚é€šè¿‡é‡‡ç”¨åŒå€å†…éƒ¨æ—¶é’Ÿçš„æ–¹å¼ï¼Œæ¯0.5ä¸ªå¤–éƒ¨æ—¶é’Ÿå‘¨æœŸï¼Œå°±èƒ½å®Œæˆ1ä¸ªæŒ‡ä»¤é˜¶æ®µçš„æ‰§è¡Œã€‚æœ€é«˜èƒ½è¾¾åˆ°8å€çš„æ‰§è¡Œæ•ˆç‡</p>
</li>
</ul>
<h5 id="limit-of-superpipeline">Limit of Superpipeline</h5>
<ul>
<li>
<p>The effect is similar to that of increasing the main frequency</p>
</li>
<li>
<p><strong>It is still not really instruction level parallelism</strong></p>
</li>
<li>
<p>The overall performance is limited by the clock cycle and the length of time the instruction phase executes</p>
<ul>
<li>Long execution phases affect overall performance</li>
</ul>
</li>
<li>
<p><strong>Another technology-superscalar</strong></p>
</li>
</ul>
<h4 id="vector-and-scalar">Vector and Scalar</h4>
<ul>
<li>
<p>Scalar</p>
<ul>
<li>
<p>Also called â€œvector freeâ€. Some physical quantities have only numerical value, but no direction. Some of them are positive or negative</p>
</li>
<li>
<p>A single number used to represent a single attribute of a thing</p>
</li>
<li>
<p>For example: temperature, length</p>
</li>
</ul>
</li>
<li>
<p>Vector</p>
<ul>
<li>
<p>Originally refers to a quantity with size and direction</p>
</li>
<li>
<p>A group of orderly arranged numbers used to demarcate the quantitative characteristics of things</p>
</li>
<li>
<p>For example: the position of a point in the plane coordinate system$ (x, y) $</p>
</li>
</ul>
</li>
</ul>
<h5 id="scalar-instruction">Scalar instruction</h5>
<ul>
<li>
<p>The instructions that do not have vector processing functions and only operate on a single quantity, namely a scalar quantity, are called scalar instructions</p>
</li>
<li>
<p>Most instructions are scalar</p>
</li>
</ul>
<h5 id="vector-instruction">Vector instruction</h5>
<ul>
<li>
<p>The basic operating object is a vector, that is, a group of numbers arranged in order</p>
</li>
<li>
<p>The instruction determines the address of the vector operand and directly or implicitly specifies vector parameters such as increment, vector length, etc</p>
</li>
<li>
<p>The vector instruction specifies that the processor processes vector according to the same operation, which can effectively improve the operation speed</p>
</li>
<li>
<p>Some mainframes are equipped with vector operation instruction systems with complete functions</p>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter14-3.png" title="/img/Computer Organization and Architecture/chapter14-3.png" data-thumbnail="/img/Computer Organization and Architecture/chapter14-3.png" data-sub-html="<h2>Superscalar</h2>">
        
    </a><figcaption class="image-caption"><code>Superscalar</code></figcaption>
    </figure>
<ul>
<li>
<p>è¶…æ ‡é‡é‡‡ç”¨äº†2ä¸ªç‹¬ç«‹çš„æµæ°´çº¿</p>
</li>
<li>
<p>æ¯ä¸ªæµæ°´çº¿éƒ½å¯ä»¥å†è¿›è¡ŒæŒ‡ä»¤çš„å¹¶è¡Œè¿è¡Œ</p>
</li>
<li>
<p>èƒ½å¤Ÿå¹¶è¡Œæ‰§è¡Œæ¯ä¸ªé˜¶æ®µçš„2ä¸ªæŒ‡ä»¤</p>
</li>
<li>
<p>åœ¨ç¨³å®šè¿è¡Œçš„çŠ¶æ€ä¸‹ï¼Œå¯ä»¥è¾¾åˆ°8å€çš„æ‰§è¡Œæ•ˆç‡</p>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter14-4.png" title="/img/Computer Organization and Architecture/chapter14-4.png" data-thumbnail="/img/Computer Organization and Architecture/chapter14-4.png" data-sub-html="<h2>Ceneral Superscalar organization</h2>">
        
    </a><figcaption class="image-caption"><code>Ceneral Superscalar organization</code></figcaption>
    </figure>
<ul>
<li>
<p>åŒ…å«äº†2ä¸ªæ•´æ•°è¿ç®—å•å…ƒï¼Œ2ä¸ªæµ®ç‚¹æ•°è¿ç®—å•å…ƒï¼Œä¸€ä¸ªå­˜å‚¨å•å…ƒ</p>
</li>
<li>
<p>æ•´æ•°è¿ç®—å•å…ƒä¸­ï¼Œå…è®¸æœ‰2ä¸ªæŒ‡ä»¤å¹¶è¡Œæ‰§è¡Œï¼Œæµ®ç‚¹æ•°è¿ç®—å•å…ƒä¹Ÿå…è®¸2ä¸ªæµ®ç‚¹æŒ‡ä»¤åŒæ—¶è¿è¡Œã€‚ä¸æ­¤åŒæ—¶ï¼Œ1ä¸ªå­˜å‚¨å™¨æ“ä½œä¹Ÿå¯ä»¥å¹¶è¡Œæ¥æ‰§è¡Œ</p>
</li>
<li>
<p>è¿™ä¸ªç»“æ„ä¸­ï¼ŒåŒæ—¶å…è®¸5ä¸ªæŒ‡ä»¤å¹¶è¡Œæ‰§è¡Œ</p>
</li>
</ul>
<h4 id="key-problem-of-superscalar">Key problem of superscalar</h4>
<ul>
<li>
<p>Superscalar implementations raise a number of complex design issues related to the instruction pipeline</p>
<ul>
<li>
<p>First, the relevance of the pipeline itself still exists</p>
</li>
<li>
<p>Multiple pipelines bring more complex correlation problems</p>
</li>
</ul>
</li>
<li>
<p>The compiler is required to have more complex optimization techniques to achieve greater instruction level parallelism</p>
</li>
</ul>
<h5 id="application-of-superscalar">Application of superscalar</h5>
<ul>
<li>
<p><strong>Superscalar technology itself is proposed and developed with the development of RISC technology</strong></p>
</li>
<li>
<p>RISC processors also tend to use superscalar technology</p>
</li>
<li>
<p><strong>Although RISC machine lends itself readily to superscalar techniques, the superscalar approach can be used on either a RISC or CISC architecture</strong></p>
</li>
<li>
<p><strong>Superscalar approach has now become the standard method for implementing high-performance microprocessors</strong></p>
</li>
</ul>
<h4 id="factors-limiting-parallelism">Factors limiting parallelism</h4>
<ul>
<li>
<p>Instruction level parallelism</p>
<ul>
<li>The degree to which program instructions can be executed in parallel</li>
</ul>
</li>
<li>
<p>Compiler capabilities</p>
<ul>
<li>The compiler can maximize instruction level parallelism of programs</li>
</ul>
</li>
<li>
<p>Hardware techniques</p>
<ul>
<li>Hardware capability supports parallel operation of instructions</li>
</ul>
</li>
</ul>
<h4 id="limitations">Limitations</h4>
<ul>
<li>
<p>The most important reason for limiting instruction level parallelism is the correlation between instructions in the program</p>
</li>
<li>
<p>The dependencies between instructions include</p>
<ul>
<li>
<p>True data dependency</p>
</li>
<li>
<p>Output dependency</p>
</li>
<li>
<p>Anti-dependency</p>
</li>
<li>
<p>Procedural dependency</p>
</li>
<li>
<p>Resource conflicts</p>
</li>
</ul>
</li>
</ul>
<hr>
<p><strong>True Data Dependency</strong></p>
<a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter14-5.png" title="/img/Computer Organization and Architecture/chapter14-5.png" data-thumbnail="/img/Computer Organization and Architecture/chapter14-5.png">
        
    </a>
<ul>
<li>
<p>I0å’Œi1èƒ½å¤ŸåŒæ—¶è¿›è¡Œå–æŒ‡å’Œè§£ç </p>
</li>
<li>
<p><strong>ä½†æ˜¯ç”±äºi1å–çš„æ“ä½œæ•°æ˜¯i0çš„ç»“æœï¼Œæ‰€ä»¥å¿…é¡»è¦ç­‰åˆ°i0æ‰§è¡Œå®Œä¹‹åï¼Œi1æ‰èƒ½è¿›è¡Œå–æŒ‡</strong></p>
</li>
<li>
<p>ç¬¬äºŒæ¡æŒ‡ä»¤å­˜åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸçš„å»¶è¿Ÿ</p>
</li>
<li>
<p><strong>å…ˆå†™åè¯»ï¼Œä¹Ÿç§°ä¸ºâ€œå†™åè¯»ç›¸å…³æ€§â€</strong></p>
</li>
<li>
<p><strong>è¿™ç§ç›¸å…³æ€§å’ŒæŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºä¸¥æ ¼ç›¸å…³ï¼Œæ˜¯çœŸå®çš„ç›¸å…³æ€§</strong></p>
</li>
</ul>
<hr>
<p><strong>Procedural dependency</strong></p>
<a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter14-6.png" title="/img/Computer Organization and Architecture/chapter14-6.png" data-thumbnail="/img/Computer Organization and Architecture/chapter14-6.png">
        
    </a>
<ul>
<li>
<p>åˆ†æ”¯å‰å’Œåˆ†æ”¯åçš„æŒ‡ä»¤ä¸èƒ½å¹¶è¡Œæ‰§è¡Œ</p>
</li>
<li>
<p>å¦‚æœæŒ‡ä»¤éå®šé•¿ï¼Œåˆ™å¿…é¡»å¯¹æŒ‡ä»¤è¿›è¡Œè§£ç ï¼Œæ‰èƒ½ç¡®å®šå–å¤šé•¿çš„æŒ‡ä»¤</p>
</li>
<li>
<p><strong>å¦‚æœä½¿ç”¨çš„æ˜¯å˜é•¿æŒ‡ä»¤ï¼Œåœ¨å–åç»­æŒ‡ä»¤ä¹‹å‰ï¼Œå‰ä¸€ä¸ªæŒ‡ä»¤å¿…é¡»è¦éƒ¨åˆ†è¯‘ç ï¼Œå¦åˆ™ä¸‹ä¸€ä¸ªæŒ‡ä»¤ä¸çŸ¥é“ä»å†…å­˜çš„å“ªä¸ªä½ç½®å»å–ï¼Œè¿™é˜»æ­¢äº†åŒæ—¶å–æŒ‡çš„æ“ä½œ</strong></p>
</li>
<li>
<p>è¶…æ ‡é‡æ›´é€‚åˆRISCæ¶æ„çš„ç†ç”±ä¹‹ä¸€ï¼Œå› ä¸ºRISCçš„æŒ‡ä»¤éƒ½æ˜¯å®šé•¿çš„ï¼Œä¸ä¼šæœ‰è¿™ç§ç›¸å…³æ€§</p>
</li>
</ul>
<hr>
<p><strong>Resource conflict</strong></p>
<ul>
<li>
<p>èµ„æºå†²çªï¼Œä¹Ÿç§°ä¸ºèµ„æºç›¸å…³æ€§</p>
</li>
<li>
<p>æŒ‡ä»¤i0å’Œi1åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéƒ½éœ€è¦ç”¨åˆ°åŒä¸€ä¸ªåŠŸèƒ½å•å…ƒï¼Œæ‰€ä»¥ä»–ä»¬ä¸èƒ½å¹¶è¡Œæ‰§è¡Œï¼Œåªèƒ½ä¸²è¡Œå¤„ç†ã€‚è¿™é‡Œæµªè´¹äº†ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸ</p>
</li>
<li>
<p>èµ„æºå†²çªå’Œæ•°æ®ç›¸å…³æ€§çš„è¡¨ç°å·®ä¸å¤šï¼Œä½†æ˜¯èµ„æºå†²çªå¯ä»¥é€šè¿‡å¤åˆ¶èµ„æºæ¥è§£å†³ï¼Œä¾‹å¦‚åœ¨å‰é¢è®²åˆ°çš„å¢åŠ å¹²è¡£æœº</p>
</li>
</ul>
<h3 id="design-issues-of-superscalar">Design Issues of Superscalar</h3>
<h4 id="parallelism">Parallelism</h4>
<ul>
<li>
<p><strong>Factors limiting parallelism</strong></p>
<ul>
<li>
<p><strong>Instruction level parallelism</strong></p>
</li>
<li>
<p><strong>Compiler capabilities</strong></p>
</li>
<li>
<p><strong>Hardware techniques</strong></p>
</li>
</ul>
</li>
<li>
<p>Instruction level parallelism</p>
<ul>
<li>
<p>Instructions have the characteristics of parallel execution</p>
</li>
<li>
<p>Instructions in a sequence are independent</p>
</li>
<li>
<p>Execution can be overlapped</p>
</li>
<li>
<p>Governed by data and procedural dependency</p>
</li>
</ul>
</li>
</ul>
<h5 id="machine-parallelism">Machine Parallelism</h5>
<ul>
<li>
<p>Machine Parallelism</p>
<ul>
<li>
<p>Ability to take advantage of instruction level parallelism</p>
</li>
<li>
<p>Governed by number of parallel pipelines</p>
</li>
<li>
<p>The ability to find independent instructions and obtain instruction level parallelism</p>
</li>
</ul>
</li>
<li>
<p>Instructions that can be executed in parallel</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Load R1 &lt;- R2(23)
</span></span><span class="line"><span class="cl">Add R3 &lt;- R3, &#34;1&#34;
</span></span><span class="line"><span class="cl">Add R4 &lt;- R4, R2
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Instructions that cannot be executed in parallel</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Add R3 &lt;- R3, &#34;1&#34;
</span></span><span class="line"><span class="cl">Add R4 &lt;- R3, R2
</span></span><span class="line"><span class="cl">Store[R4] &lt;- R0
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="instruction-issue">Instruction issue</h4>
<ul>
<li>
<p><strong>Instruction issueï¼š the process of starting instructions to be executed by the functional unit of the processor</strong></p>
<ul>
<li>Instruction issue occurs when instruction moves from the decode stage of the pipeline to the first execute stage of the pipeline</li>
</ul>
</li>
<li>
<p><strong>In order to improve the parallelism, it is necessary to use a reasonable issue order, instead of the original order</strong></p>
</li>
<li>
<p>In essence, instruction emission is a strategy to find instructions that can enter the pipeline and be executed</p>
</li>
</ul>
<h5 id="order-about-instruction-issue">Order about instruction issue</h5>
<ul>
<li>
<p>Three sequences are involved in the command sending process</p>
<ul>
<li>
<p>Order in which instructions are fetched</p>
</li>
<li>
<p>Order in which instructions are executed</p>
</li>
<li>
<p>Order in which instructions change registers and memory</p>
</li>
</ul>
</li>
<li>
<p>The one constraint on the processor is that the result must be correct</p>
</li>
<li>
<p>Instruction issue policy refers to the protocol used to start the execution of the command</p>
</li>
</ul>
<h5 id="instruction-issue-policy">Instruction issue policy</h5>
<ul>
<li>
<p><strong>The original instruction stream itself has dependencies</strong></p>
</li>
<li>
<p>To improve the parallelism of execution, the processor may change the order in which instructions are executed</p>
</li>
<li>
<p>The more sophisticated the processor, the less it is bound by a strict relationship between these orderings</p>
</li>
<li>
<p><strong>There are three issue policy</strong></p>
<ul>
<li>
<p><strong>In-order issue with in-order completion</strong></p>
</li>
<li>
<p><strong>In-order issue with out-of-order completion</strong></p>
</li>
<li>
<p><strong>Out-of order issue with out-of â€“order completion</strong></p>
</li>
</ul>
</li>
</ul>
<h6 id="in-order-issuein-order-completion">In-order issue/in-order completion</h6>
<ul>
<li>
<p>Issue instructions in the order they occur</p>
</li>
<li>
<p>Write the results in the same order to complete the execution of instructions</p>
</li>
<li>
<p><strong>Very inefficientï¼Œeven scalar pipeline will not use policy</strong></p>
</li>
<li>
<p>In Superscalar pipeline</p>
<ul>
<li>
<p>May fetch more than one instruction</p>
</li>
<li>
<p><strong>To ensure orderly completion, when the functional units conflict, or the execution of the functional units requires multiple cycles, instruction issue must wait</strong></p>
</li>
</ul>
</li>
</ul>
<a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter14-7.png" title="/img/Computer Organization and Architecture/chapter14-7.png" data-thumbnail="/img/Computer Organization and Architecture/chapter14-7.png">
        
    </a>
<ul>
<li>
<p><strong>è¶…æ ‡é‡å¤„ç†å™¨æœ‰2ä¸ªç‹¬ç«‹çš„æµæ°´çº¿ï¼Œèƒ½å¤ŸåŒæ—¶å–2ä¸ªæŒ‡ä»¤</strong></p>
</li>
<li>
<p><strong>æœ‰3ä¸ªæ‰§è¡Œå•å…ƒï¼Œä»¥åŠ2ä¸ªå†™å›çš„å•å…ƒ</strong></p>
</li>
<li>
<p>I1éœ€è¦2ä¸ªå‘¨æœŸå®Œæˆæ‰§è¡Œï¼›I3å’ŒI4éœ€è¦åŒæ—¶ä½¿ç”¨æŸä¸ªåŠŸèƒ½å•å…ƒï¼Œå¯¼è‡´å‡ºç°å†²çªï¼›I5ä¾èµ–äºI4çš„ç»“æœï¼›I5å’ŒI6éœ€è¦åŒæ—¶ä½¿ç”¨æŸä¸ªåŠŸèƒ½å•å…ƒï¼Œå¯¼è‡´å‡ºç°å†²çª</p>
</li>
<li>
<p>æˆå¯¹å–æŒ‡å¹¶é€åˆ°è¯‘ç å•å…ƒè¿›è¡Œè¯‘ç ã€‚I1éœ€è¦èŠ±è´¹2ä¸ªæ—¶é’Ÿå‘¨æœŸæ‰§è¡Œã€‚æ‰€ä»¥I3å’ŒI4éœ€è¦åœ¨ç¬¬å››ä¸ªå‘¨æœŸå¼€å§‹æ‰§è¡Œã€‚ç”±äºI3å’ŒI4èµ„æºå†²çªï¼Œæ‰€ä»¥I3å’ŒI4éœ€è¦é¡ºåºæ‰§è¡Œã€‚I5éœ€è¦ä¾èµ–I4çš„ç»“æœï¼Œå¹¶ä¸”I5å’ŒI6å­˜åœ¨èµ„æºå†²çªï¼Œæ‰€ä»¥I5å’ŒI6éœ€è¦ä¸²è¡Œæ‰§è¡Œ</p>
</li>
<li>
<p>8ä¸ªæŒ‡ä»¤ï¼Œæ€»å…±éœ€è¦8ä¸ªæ—¶é’Ÿå‘¨æœŸæ‰èƒ½å®Œæˆ</p>
</li>
<li>
<p>ç”±äºæŒ‡ä»¤æ‰§è¡Œçš„æ—¶é—´ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¦‚æœåŒæ—¶å‘å°„çš„æŒ‡ä»¤ç»™æ‰§è¡Œå•å…ƒï¼Œéœ€è¦ç­‰å…¨éƒ¨æ‰§è¡Œå®Œæˆä¹‹åï¼Œæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ¬¡å‘å°„</p>
</li>
<li>
<p>å¦‚æœæŒ‡ä»¤é—´å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œéœ€è¦åœæ­¢è°ƒåº¦è¡Œä¸ºï¼Œç­‰å…·å¤‡æ¡ä»¶ä¹‹åï¼Œæ‰èƒ½è¿›è¡ŒæŒ‡ä»¤å‘å°„</p>
</li>
</ul>
<hr>
<h6 id="in-order-issueout-of-order-completion">In-order issue/out-of-order completion</h6>
<a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter14-8.png" title="/img/Computer Organization and Architecture/chapter14-8.png" data-thumbnail="/img/Computer Organization and Architecture/chapter14-8.png">
        
    </a>
<ul>
<li>
<p>I1å’ŒI2åŒæ—¶å‘å°„åˆ°æ‰§è¡Œå•å…ƒï¼Œç”±äºI2åªéœ€è¦1ä¸ªå‘¨æœŸå®Œæˆï¼Œæ‰€ä»¥I2å¯ä»¥å…ˆå®Œæˆã€‚I3å¯ä»¥å’ŒI1åŒæ—¶æ‰§è¡Œï¼Œå¹¶è¿›å…¥å†™çš„é˜¶æ®µ</p>
</li>
<li>
<p>I4ç”±äºå’ŒI3èµ„æºå†²çªï¼Œæ‰€ä»¥éœ€è¦ç­‰I3å®Œæˆä¹‹åæ‰èƒ½æ‰§è¡Œã€‚I5ä¾èµ–äºI4çš„ç»“æœï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦ç­‰å¾…I4ï¼ŒåŒç†I6éœ€è¦ç­‰å¾…I5</p>
</li>
<li>
<p>æ•´ä½“ä¸Šéœ€è¦7ä¸ªå‘¨æœŸå®ŒæˆæŒ‡ä»¤çš„æ‰§è¡Œ</p>
</li>
</ul>
<hr>
<p><strong>Output (write-write) dependency</strong></p>
<ul>
<li>In the process of out of sequence completion, the execution order is different from the original order, which may lead to output dependency problems</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">R3 = R3 + R5 ;(l1)
</span></span><span class="line"><span class="cl">R4 = R3 + 1  ;(l2)
</span></span><span class="line"><span class="cl">R3 = R5 + 1  ;(l3)
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Analyze
<ul>
<li>I2 depends on result of I1 - data dependency</li>
<li>If I3 completes before I1, the result from I1 will be wrong - output (write-write) dependency</li>
</ul>
</li>
</ul>
<hr>
<p><strong>How?</strong></p>
<ul>
<li>
<p><strong>Adopt dynamic scheduling strategy</strong></p>
</li>
<li>
<p>Idea: Move the dependent instructions out of the way of independent ones (s.t. independent ones can execute)</p>
<ul>
<li>Rest areas for dependent instructions: Reservation stations</li>
</ul>
</li>
<li>
<p>Monitor the source â€œvaluesâ€ of each instruction in the resting area</p>
</li>
<li>
<p>When all source â€œvaluesâ€ of an instruction are available, â€œfireâ€ (i.e. dispatch) the instruction</p>
<ul>
<li>Instructions dispatched in <strong>data-flow orderï¼Œnot control-flow</strong></li>
</ul>
</li>
<li>
<p>Benefit</p>
<ul>
<li>
<p>Latency tolerance: Allows independent instructions to execute and complete in the presence of a long latency operation</p>
</li>
<li>
<p>Reasonably schedule instructions with dependencies</p>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>
<p><strong>Problem about In-order issue</strong></p>
</li>
<li>
<p>When decoding instructions, if there are related points or conflicting points, the decoding needs to stop</p>
</li>
<li>
<p>In this way, subsequent instructions cannot be decoded</p>
</li>
<li>
<p>At this time, the processor cannot check whether any instruction is independent and can be executed on the pipeline</p>
</li>
</ul>
<hr>
<h6 id="out-of-order-issueout-of-order-completion">Out-of-order issue/out-of-order completion</h6>
<ul>
<li>
<p>Solution: decouple decode from execution</p>
</li>
<li>
<p>Decode</p>
<ul>
<li>
<p>Decode stage can continuously fetch and decode</p>
</li>
<li>
<p>Decoded instruction is put into the buffer</p>
</li>
<li>
<p>As long as the buffer is not full, fetching and decoding can continue</p>
</li>
</ul>
</li>
<li>
<p>Execution</p>
<ul>
<li>
<p>When the functional unit is available, transmit the executable instructions to execute</p>
</li>
<li>
<p>Since the instruction has been decoded, the processor can first identify whether the instruction can be executed</p>
</li>
</ul>
</li>
</ul>
<a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter14-9.png" title="/img/Computer Organization and Architecture/chapter14-9.png" data-thumbnail="/img/Computer Organization and Architecture/chapter14-9.png">
        
    </a>
<ul>
<li>ç¬¬ä¸€ä¸ªå‘¨æœŸï¼ŒI1å’ŒI2è¿›è¡Œè§£ç ï¼Œå®Œæˆè§£ç åè¿›å…¥å‘å°„ç¼“å†²åŒºã€‚æ‰§è¡Œå•å…ƒä¸ºç©ºï¼ŒI1å’ŒI2è¢«å‘å°„å‡ºå»æ‰§è¡Œ</li>
<li>ç¬¬äºŒä¸ªå‘¨æœŸï¼ŒI3å’ŒI4è¿›è¡Œè§£ç ï¼Œå®Œæˆè§£ç åè¿›å…¥å‘å°„ç¼“å†²åŒºã€‚ç”±äºI3å’ŒI4å…±ç”¨æ‰§è¡Œå•å…ƒï¼ŒI3å‘å°„å‡ºå»è¿›è¡Œæ‰§è¡Œ</li>
<li>ç¬¬ä¸‰ä¸ªå‘¨æœŸï¼ŒI5å’ŒI6è¿›è¡Œè§£ç ï¼Œå®Œæˆè§£ç åè¿›å…¥å‘å°„ç¼“å†²åŒºã€‚æ­¤æ—¶ï¼ŒI3æ‰§è¡Œå®Œäº†ï¼Œæ‰€ä»¥I4å¯ä»¥å‘å°„äº†ã€‚åŒæ—¶ç”±äºI5å’ŒI4æœ‰æ•°æ®ç›¸å…³æ€§ï¼Œæ‰€ä»¥I5ä¸èƒ½å‘å°„ï¼Œäºæ˜¯æŠŠI6å‘å°„å‡ºå»æ‰§è¡Œ</li>
<li>ç¬¬å››ä¸ªå‘¨æœŸï¼Œæ²¡æœ‰æŒ‡ä»¤éœ€è¦è§£ç </li>
<li>ç¬¬äº”ä¸ªå‘¨æœŸï¼Œæ²¡æœ‰æŒ‡ä»¤éœ€è¦è§£ç ã€‚æ­¤æ—¶å‘å°„ç¼“å†²åŒºåªæœ‰I5ã€‚I6æ‰§è¡Œå®Œæˆï¼Œå¯ä»¥å‘å°„I5æŒ‡ä»¤ã€‚I5åœ¨ç¬¬äº”ä¸ªæ—¶é’Ÿå‘¨æœŸå®Œæˆæ‰§è¡Œï¼Œå¹¶åœ¨ç¬¬å…­ä¸ªæ—¶é’Ÿå‘¨æœŸå®Œæˆå†™å…¥æ“ä½œ</li>
<li>æ•´ä¸ªè¿‡ç¨‹éœ€è¦6ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚æ¯”ä¹‹å‰çš„åˆç¼©çŸ­äº†1ä¸ªå‘¨æœŸ</li>
</ul>
<h6 id="anti-dependencywrite-after-read">Anti-dependency(Write-after-read)</h6>
<ul>
<li>
<p>Out-of-order issue/out-of-order completion also need to comply with restrictions</p>
</li>
<li>
<p>Anti correlation occurs</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">R3 = R3 + R5 ;l1
</span></span><span class="line"><span class="cl">R4 = R3 + 1  ;l2
</span></span><span class="line"><span class="cl">R3 = R5 + 1  ;l3
</span></span><span class="line"><span class="cl">R7 = R3 + R4 ;l4
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Analyze
<ul>
<li>I3 can not complete before I2 starts as I2 needs a value in R3 and I3 changes R3</li>
</ul>
</li>
</ul>
<hr>
<p><strong>Dependency Analyzing</strong></p>
<ul>
<li>
<p>True data dependency reflects the real dependency between data</p>
</li>
<li>
<p>In essence, anti dependency and output dependency are caused by register conflict</p>
<ul>
<li>Register contents may not reflect the correct ordering from the program</li>
</ul>
</li>
<li>
<p>Instruction issue stops, pipeline stall</p>
<ul>
<li>Processor pauses for one cycle</li>
</ul>
</li>
<li>
<p>This situation is more serious when register optimization technology is used</p>
<ul>
<li>
<p>Register optimization technology maximizes the use of registers to improve performance</p>
</li>
<li>
<p>Register conflicts will be more significant</p>
</li>
</ul>
</li>
</ul>
<hr>
<p><strong>Register renaming</strong></p>
<ul>
<li>
<p>Registers are dynamically allocated by hardware</p>
</li>
<li>
<p>When an instruction with a register as the destination operand is executed, a new register is allocated</p>
</li>
<li>
<p><strong>The instruction that accesses the original register after this instruction must be modified to the newly allocated register to maintain consistency</strong></p>
</li>
<li>
<p>Avoid dependencies caused by register conflicts</p>
</li>
</ul>
<hr>
<ul>
<li><strong>Original</strong></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">R3 = R3 + R5 ;I1
</span></span><span class="line"><span class="cl">R4 = R3 + 1  ;I2
</span></span><span class="line"><span class="cl">R3 = R5 + 1  ;I3
</span></span><span class="line"><span class="cl">R7 = R3 + R4 ;I4
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>I1å’ŒI2å­˜åœ¨çœŸå®æ•°æ®ç›¸å…³æ€§</p>
</li>
<li>
<p>I3å’ŒI4å­˜åœ¨çœŸå®æ•°æ®ç›¸å…³æ€§</p>
</li>
<li>
<p>I3å’ŒI2å­˜åœ¨åç›¸å…³æ€§ï¼Œè¯»åå†™</p>
</li>
<li>
<p>I3å’ŒI1å­˜åœ¨è¾“å‡ºç›¸å…³æ€§ï¼Œå†™åå†™</p>
</li>
<li>
<p><strong>Register renaming</strong></p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">R3b = R3a + R5a ;l1
</span></span><span class="line"><span class="cl">R4b = R3b + 1   ;l2
</span></span><span class="line"><span class="cl">R3c = R5a + 1   ;l3
</span></span><span class="line"><span class="cl">R7 = R3c + R4b  ;l4
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>é‡‡ç”¨å¯„å­˜å™¨é‡å‘½åçš„è§„åˆ™ï¼ŒI1çš„R3ä¿®æ”¹æˆR3bï¼ŒI3ä¸­çš„R3ï¼Œä¿®æ”¹æˆR3cã€‚</p>
</li>
<li>
<p><strong>I3å’ŒI2ä¹‹é—´çš„åç›¸å…³æ€§æ²¡æœ‰äº†ï¼ŒI3å’ŒI1ä¹‹é—´çš„è¾“å‡ºç›¸å…³æ€§ä¹Ÿæ²¡æœ‰äº†ï¼ŒI3å¯ä»¥ç«‹å³å‘å°„</strong></p>
</li>
<li>
<p><strong>çœŸå®æ•°æ®ç›¸å…³æ€§æ— æ³•é€šè¿‡å¯„å­˜å™¨é‡å‘½åæ¥è§£å†³</strong></p>
</li>
</ul>
<h4 id="analysis-of-three-technologies---">Analysis of three technologies ! ! !</h4>
<ul>
<li>
<p><strong>Techniques for improving performance in superscalar processors</strong></p>
<ul>
<li>
<p><strong>Duplication of Resources</strong></p>
</li>
<li>
<p><strong>Out of order issue</strong></p>
</li>
<li>
<p><strong>Renaming</strong></p>
</li>
</ul>
</li>
<li>
<p><strong>Resources are the foundation</strong></p>
<ul>
<li>Sufficient resources to execute multiple pipelines</li>
</ul>
</li>
<li>
<p><strong>Out of order issue is the method</strong></p>
<ul>
<li>Provide executable instructions through disordered transmissionRenaming is a guarantee</li>
</ul>
</li>
<li>
<p><strong>Renaming is a guarantee</strong></p>
<ul>
<li>Rename mechanism reduces the correlation between instructions</li>
</ul>
</li>
</ul>
<h4 id="about-instruction-window">About instruction window</h4>
<ul>
<li>
<p>Out of order issue: register window is used to cache instructions after decoding</p>
</li>
<li>
<p>Through the register window, the processor can identify independent instructions that can be placed in the execution segment</p>
</li>
<li>
<p><strong>If the instruction window is very small, the probability of successful recognition is very low</strong></p>
</li>
<li>
<p><strong>The instruction window needs to be large enough to find independent instructions and use the hardware more effectively</strong></p>
</li>
<li>
<p><strong>Need instruction window large enough (more than 8)</strong></p>
</li>
</ul>
<hr>
<p><strong>Effect of technology</strong></p>
<figure><a class="lightgallery" href="/img/Computer%20Organization%20and%20Architecture/chapter14-10.png" title="/img/Computer Organization and Architecture/chapter14-10.png" data-thumbnail="/img/Computer Organization and Architecture/chapter14-10.png" data-sub-html="<h2>Without Procedural Dependencies</h2>">
        
    </a><figcaption class="image-caption"><code>Without Procedural Dependencies</code></figcaption>
    </figure>
<ul>
<li>
<p>Baseï¼šä¸å¤åˆ¶ä»»ä½•åŠŸèƒ½å•å…ƒ</p>
</li>
<li>
<p>+Id/stï¼šå¢åŠ äº†è£…å…¥/å­˜å‚¨å•å…ƒ</p>
</li>
<li>
<p>+aluï¼šå¢åŠ äº†ALUå•å…ƒ</p>
</li>
<li>
<p>+bothï¼šå¢åŠ äº†ALUå’ŒId/st</p>
</li>
<li>
<p>ä¸è€ƒè™‘è¿‡ç¨‹ç›¸å…³æ€§</p>
</li>
<li>
<p>æ²¡æœ‰é‡‡ç”¨å¯„å­˜å™¨é‡å‘½åï¼Œå¢åŠ ç¡¬ä»¶æ‰§è¡Œæ•ˆæœå¹¶ä¸æ˜æ˜¾ã€‚è€Œé‡‡ç”¨å¯„å­˜å™¨é‡å‘½ååï¼Œå¢åŠ äº†ALUä¼šæ˜æ˜¾æé«˜åŠ é€Ÿæ¯”</p>
</li>
<li>
<p>ä»å‘å°„çª—å£çš„è§’åº¦æ¥çœ‹ï¼Œçª—å£æ•°é‡ä»8ä¸ªå¢åŠ åˆ°16ä¸ªï¼Œæ•ˆæœå°±å¾ˆæ˜æ˜¾ã€‚ä½†ä»16ä¸ªåˆ°32ä¸ªï¼Œæ•ˆæœç¨å·®ä¸€äº›</p>
</li>
<li>
<p><strong>èµ„æºå¤åˆ¶ã€ä¹±åºå‘å°„ã€å¯„å­˜å™¨é‡å‘½åä¸‰è€…ç›¸äº’å½±å“</strong></p>
</li>
</ul>
<h4 id="consideration-of-control-dependence">Consideration of control dependence</h4>
<ul>
<li>
<p>Also called branch hazard</p>
</li>
<li>
<p>When branching instructions, it is not possible to determine which instruction to execute after the branch</p>
</li>
<li>
<p>In the pipeline, after prefetching the wrong instruction, it is necessary to discard and re fetch the instruction, which causes the pipeline to fail to run with full load</p>
</li>
</ul>
<p><strong>Methods</strong></p>
<ul>
<li>
<p>Processing method of control dependence</p>
<ul>
<li>
<p>Multiple Streams</p>
</li>
<li>
<p>Prefetch Branch Target</p>
</li>
<li>
<p>Loop buffer</p>
</li>
<li>
<p>Branch prediction</p>
</li>
<li>
<p>Delayed branching</p>
</li>
</ul>
</li>
<li>
<p>Goal: Keep the pipeline running full</p>
</li>
</ul>
<p><strong>About delayed branch</strong></p>
<ul>
<li>
<p>Delayed branching is often used in RIS</p>
</li>
<li>
<p>Calculate result of branch before unusable instructions pre-fetched</p>
<ul>
<li>
<p>Instructions that are not affected by branches are immediately followed by branch</p>
</li>
<li>
<p>Keeps pipeline full while fetching new instruction stream</p>
</li>
</ul>
</li>
<li>
<p>Not as good for superscalar</p>
<ul>
<li>Multiple instructions need to execute in delay slot</li>
<li>Instruction dependence problems</li>
<li>Often use branch prediction</li>
</ul>
</li>
</ul>
<p><strong>Superscalar execution</strong></p>
<ul>
<li>
<p>é™æ€ç¨‹åºé€šè¿‡å–æŒ‡å’Œåˆ†æ”¯é¢„æµ‹ï¼Œå½¢æˆåŠ¨æ€çš„æŒ‡ä»¤æµ</p>
</li>
<li>
<p>æŒ‡ä»¤æµç»è¿‡å¤„ç†å™¨çš„ç›¸å…³æ€§æ£€æŸ¥ï¼Œä¼šå»æ‰ä¸å¿…è¦çš„ç›¸å…³æ€§ï¼Œæ¯”å¦‚åç›¸å…³å’Œè¾“å‡ºç›¸å…³ã€‚ç„¶åå°†æŒ‡ä»¤æ”¾åˆ°æ‰§è¡Œçª—å£ä¸­ï¼Œç­‰å¾…æ‰§è¡Œ</p>
</li>
<li>
<p>åœ¨æ‰§è¡Œçª—å£ä¸­çš„æŒ‡ä»¤ï¼Œæ ¹æ®çœŸå®æ•°æ®ç›¸å…³æ€§æ¥æ’åºã€‚å¤„ç†å™¨æ ¹æ®çœŸå®æ•°æ®ç›¸å…³æ€§å’Œèµ„æºå¯ç”¨æ€§ï¼Œæ¥å‘å°„æŒ‡ä»¤åˆ°æ‰§è¡Œå•å…ƒè¿›è¡Œæ‰§è¡Œ</p>
</li>
<li>
<p>æœ€åçš„æ‰§è¡Œç»“æœéœ€è¦æœ‰ä¸€ä¸ªæäº¤çš„æ­¥éª¤ã€‚å› ä¸ºæŒ‡ä»¤ä¸æ˜¯æŒ‰ç…§åŸæœ‰çš„é¡ºåºæ¥æ‰§è¡Œçš„ï¼ŒåŒæ—¶åˆ†æ”¯é¢„æµ‹å’Œæ¨æµ‹æ‰§è¡Œä½¿å¾—æœ‰äº›æ‰§è¡Œçš„ç»“æœéœ€è¦ä¸¢å¼ƒ</p>
</li>
</ul>
<hr>
<ul>
<li>
<p>Simultaneously fetch multiple instructions</p>
<ul>
<li>
<p>Multiple fetching and decoding</p>
</li>
<li>
<p>Branch prediction logic</p>
</li>
</ul>
</li>
<li>
<p>Logic to determine true dependencies involving register values</p>
<ul>
<li>Determine instruction position of true correlation</li>
</ul>
</li>
<li>
<p>Dealing with unnecessary dependencies</p>
<ul>
<li>Anti-dependency and output dependency</li>
</ul>
</li>
<li>
<p>Mechanisms to initiate multiple instructions in parallel</p>
<ul>
<li>
<p>Instruction window</p>
</li>
<li>
<p>Out of order issue logic</p>
</li>
</ul>
</li>
<li>
<p>Resources for parallel execution of multiple instructions</p>
<ul>
<li>The system has sufficient resources</li>
</ul>
</li>
<li>
<p>Mechanisms for committing process state in correct order</p>
<ul>
<li>Submit results according to the order of instructions</li>
</ul>
</li>
</ul>
<h4 id="summary">Summary</h4>
<ul>
<li>
<p><strong>Resources are the foundation</strong></p>
<ul>
<li><strong>Machine parallelism</strong></li>
</ul>
</li>
<li>
<p><strong>Out of order issue is the method</strong></p>
<ul>
<li><strong>Instruction level parallelism</strong></li>
</ul>
</li>
<li>
<p><strong>Renaming is a guarantee</strong></p>
<ul>
<li><strong>Methods of improving instruction level parallelism</strong></li>
</ul>
</li>
<li>
<p>Through superscalar pipeline, multiple pipelines can run at the same time to achieve truly parallel operation at the instruction level</p>
</li>
</ul>
]]></description>
</item>
</channel>
</rss>
