<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Operating System Chapter10 çŠ¶æ€æœºæ¨¡å‹çš„åº”ç”¨ - Jungle&#39;s Blog</title><meta name="description" content="Welcome to Jungle&#39;s blog."><meta property="og:title" content="Operating System Chapter10 çŠ¶æ€æœºæ¨¡å‹çš„åº”ç”¨" />
<meta property="og:description" content="Operating System $Nanjing\ University\rightarrow Yanyan\ Jiang\newline$ Overview å¤ä¹  çŠ¶æ€æœºï¼šç†è®º æ•°å­—ç”µè·¯ï¼šlogisim.c å’Œ seven-seg.py Model checker: ç†è§£å¹¶å‘ç¨‹åºæ‰§è¡Œçš„æ–°æ–¹æ³• çŠ¶æ€æœºï¼šå®è·µ thread-os.c æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜ Q: çŠ¶æ€æœºæ¨¡å‹å¦‚æ­¤æœ‰ç”¨" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Jungle430.github.io/posts/operating-system/operating-system-chapter10/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-28T13:10:52+08:00" />
<meta property="article:modified_time" content="2023-03-28T13:10:52+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Operating System Chapter10 çŠ¶æ€æœºæ¨¡å‹çš„åº”ç”¨"/>
<meta name="twitter:description" content="Operating System $Nanjing\ University\rightarrow Yanyan\ Jiang\newline$ Overview å¤ä¹  çŠ¶æ€æœºï¼šç†è®º æ•°å­—ç”µè·¯ï¼šlogisim.c å’Œ seven-seg.py Model checker: ç†è§£å¹¶å‘ç¨‹åºæ‰§è¡Œçš„æ–°æ–¹æ³• çŠ¶æ€æœºï¼šå®è·µ thread-os.c æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜ Q: çŠ¶æ€æœºæ¨¡å‹å¦‚æ­¤æœ‰ç”¨"/>
<meta name="application-name" content="Jungle&#39;s blog">
<meta name="apple-mobile-web-app-title" content="Jungle&#39;s blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://Jungle430.github.io/posts/operating-system/operating-system-chapter10/" /><link rel="prev" href="https://Jungle430.github.io/posts/operating-system/operating-system-chapter9/" /><link rel="next" href="https://Jungle430.github.io/posts/operating-system/support3/" /><link rel="stylesheet" href="/css/page.min.css"><link rel="stylesheet" href="/css/home.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Operating System Chapter10 çŠ¶æ€æœºæ¨¡å‹çš„åº”ç”¨",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/Jungle430.github.io\/posts\/operating-system\/operating-system-chapter10\/"
        },"genre": "posts","keywords": "Operating System, Linux","wordcount":  4403 ,
        "url": "https:\/\/Jungle430.github.io\/posts\/operating-system\/operating-system-chapter10\/","datePublished": "2023-03-28T13:10:52+08:00","dateModified": "2023-03-28T13:10:52+08:00","publisher": {
            "@type": "Organization",
            "name": "Jungle"},"author": {
                "@type": "Person",
                "name": "Jungle"
            },"description": ""
    }
    </script></head><body data-header-desktop="fixed" data-header-mobile="auto"><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Jungle&#39;s Blog">Jungle&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/">ğŸ“š æ–‡ç«  </a><a class="menu-item" href="/tags/">ğŸ·ï¸ æ ‡ç­¾ </a><a class="menu-item" href="/categories/">ğŸ—ƒï¸ åˆ†ç±» </a><a class="menu-item" href="/about/">ğŸ‘´ å…³äº </a><a class="menu-item" href="https://github.com/Jungle430" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-desktop">
                        <a href="#" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Jungle&#39;s Blog">Jungle&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-mobile">
                        <a href="#" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="#" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="">ğŸ“šæ–‡ç« </a><a class="menu-item" href="/tags/" title="">ğŸ·ï¸æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">ğŸ—ƒï¸åˆ†ç±»</a><a class="menu-item" href="/about/" title="">ğŸ‘´å…³äº</a><a class="menu-item" href="https://github.com/Jungle430" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><div class="menu-item"><a href="javascript:void(0);" class="theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div></div>
    </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single" data-toc="enable"><div class="single-card" ><h2 class="single-title animated flipInX">Operating System Chapter10 çŠ¶æ€æœºæ¨¡å‹çš„åº”ç”¨</h2><div class="post-meta">
                <div class="post-meta-line"><span class="post-author"><a href="https://github.com/Jungle430" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Jungle</a></span>&nbsp;<span class="post-category">å‡ºç‰ˆäº  <a href="/categories/operating-system/"><i class="far fa-folder fa-fw"></i>Operating System</a></span></div>
                <div class="post-meta-line"><span><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2023-03-28">2023-03-28</time></span>&nbsp;<span><i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 4403 å­—</span>&nbsp;
                    <span><i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 9 åˆ†é’Ÿ</span>&nbsp;</div>
            </div>
            
            <hr><div class="details toc" id="toc-static"  data-kept="">
                    <div class="details-summary toc-title">
                        <span>ç›®å½•</span>
                        <span><i class="details-icon fas fa-angle-right"></i></span>
                    </div>
                    <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#çŠ¶æ€æœºç†è§£æˆ‘ä»¬çš„ä¸–ç•Œ">çŠ¶æ€æœºï¼šç†è§£æˆ‘ä»¬çš„ä¸–ç•Œ</a>
      <ul>
        <li><a href="#å“²--å­¦æ¢è®¨">å“² â™‚ å­¦æ¢è®¨</a></li>
        <li><a href="#å“²--å­¦æ¢è®¨-contd">å“² â™‚ å­¦æ¢è®¨ (cont&rsquo;d)</a></li>
        <li><a href="#çŠ¶æ€æœºæ¨¡å‹ç†è§£ç¼–è¯‘å™¨å’Œç°ä»£-cpu">çŠ¶æ€æœºæ¨¡å‹ï¼šç†è§£ç¼–è¯‘å™¨å’Œç°ä»£ CPU</a></li>
      </ul>
    </li>
    <li><a href="#æŸ¥çœ‹çŠ¶æ€æœºæ‰§è¡Œ">æŸ¥çœ‹çŠ¶æ€æœºæ‰§è¡Œ</a>
      <ul>
        <li><a href="#trace-å’Œè°ƒè¯•å™¨">Trace å’Œè°ƒè¯•å™¨</a></li>
        <li><a href="#åº”ç”¨-1-time-travel-debugging">åº”ç”¨ (1): Time-Travel Debugging</a></li>
        <li><a href="#åº”ç”¨-1-time-travel-debugging-contd">åº”ç”¨ (1): Time-Travel Debugging (cont&rsquo;d)</a></li>
        <li><a href="#åº”ç”¨-2-record--replay">åº”ç”¨ (2): Record &amp; Replay</a></li>
        <li><a href="#åº”ç”¨-2-record--replay-contd">åº”ç”¨ (2): Record &amp; Replay (cont&rsquo;d)</a></li>
      </ul>
    </li>
    <li><a href="#é‡‡æ ·çŠ¶æ€æœºæ‰§è¡Œ">é‡‡æ ·çŠ¶æ€æœºæ‰§è¡Œ</a>
      <ul>
        <li><a href="#å…³äºæ€§èƒ½ä¼˜åŒ–">å…³äºæ€§èƒ½ä¼˜åŒ–</a></li>
        <li><a href="#profiler-å’Œæ€§èƒ½æ‘˜è¦">Profiler å’Œæ€§èƒ½æ‘˜è¦</a></li>
        <li><a href="#å®é™…ä¸­çš„æ€§èƒ½ä¼˜åŒ–">å®é™…ä¸­çš„æ€§èƒ½ä¼˜åŒ–</a></li>
      </ul>
    </li>
    <li><a href="#model-checkerverifier">Model Checker/Verifier</a>
      <ul>
        <li><a href="#model-checker-çš„å¨åŠ›å¤§å®¶å·²ç»çŸ¥é“äº†">Model Checker çš„å¨åŠ›å¤§å®¶å·²ç»çŸ¥é“äº†</a></li>
        <li><a href="#model-checker-ä¸ä»…æ˜¯å¹¶å‘">Model Checker: ä¸ä»…æ˜¯å¹¶å‘</a></li>
      </ul>
    </li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
  </ul>
</nav></div>
                </div><div class="content" id="content"><h1 id="operating-system">Operating System</h1>
<p>$Nanjing\ University\rightarrow Yanyan\ Jiang\newline$</p>
<h2 id="overview">Overview</h2>
<p>å¤ä¹ </p>
<ul>
<li>çŠ¶æ€æœºï¼šç†è®º
<ul>
<li>æ•°å­—ç”µè·¯ï¼š<a href="https://jyywiki.cn/pages/OS/2022/demos/logisim.c" target="_blank" rel="noopener noreffer">logisim.c</a> å’Œ <a href="https://jyywiki.cn/pages/OS/2022/demos/seven-seg.py" target="_blank" rel="noopener noreffer">seven-seg.py</a></li>
<li>Model checker: ç†è§£å¹¶å‘ç¨‹åºæ‰§è¡Œçš„æ–°æ–¹æ³•</li>
</ul>
</li>
<li>çŠ¶æ€æœºï¼šå®è·µ
<ul>
<li><a href="https://jyywiki.cn/pages/OS/2022/demos/thread-os.c" target="_blank" rel="noopener noreffer">thread-os.c</a></li>
</ul>
</li>
</ul>
<hr>
<p>æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜</p>
<ul>
<li><strong>Q</strong>: çŠ¶æ€æœºæ¨¡å‹å¦‚æ­¤æœ‰ç”¨ï¼Œè¿˜èƒ½æ›´æœ‰ç”¨ä¸€ç‚¹å—ï¼Ÿ</li>
</ul>
<hr>
<p>æœ¬æ¬¡è¯¾ä¸»è¦å†…å®¹</p>
<ul>
<li>ç»ˆäºåšå®Œäº†é“ºå«ï¼Œæ˜¯æ—¶å€™è®©ä½ æ„Ÿå—åˆ° â€œçœŸæ­£çš„åŠ›é‡â€ äº†
<ul>
<li>éƒ½æ˜¯æ²¡ç”¨çš„å†…å®¹ï¼Œå½“æˆ‘å£èƒ¡å°±è¡Œäº†</li>
</ul>
</li>
</ul>
<h2 id="çŠ¶æ€æœºç†è§£æˆ‘ä»¬çš„ä¸–ç•Œ">çŠ¶æ€æœºï¼šç†è§£æˆ‘ä»¬çš„ä¸–ç•Œ</h2>
<h3 id="å“²--å­¦æ¢è®¨">å“² â™‚ å­¦æ¢è®¨</h3>
<ul>
<li>
<p>æˆ‘ä»¬çš„ç‰©ç†ä¸–ç•Œæ˜¯ â€œç¡®å®šè§„åˆ™â€ çš„çŠ¶æ€æœºå—ï¼Ÿ</p>
<ul>
<li>
<p>å®è§‚ç‰©ç†ä¸–ç•Œè¿‘ä¼¼äº deterministic çš„çŠ¶æ€æœº (ç»å…¸åŠ›å­¦)</p>
</li>
<li>
<p>å¾®è§‚ä¸–ç•Œå¯èƒ½æ˜¯ non-deterministic çš„ (é‡å­åŠ›å­¦)</p>
</li>
</ul>
</li>
</ul>
<p>æŠŠç‰©ç†ä¸–ç•Œå»ºæ¨¡æˆåŸºæœ¬ç²’å­çš„è¿åŠ¨</p>
<ul>
<li><a href="https://playgameoflife.com/" target="_blank" rel="noopener noreffer">Conway&rsquo;s game of life</a> $\Longrightarrow$ <b>Turing Complete</b></li>
</ul>
<h3 id="å“²--å­¦æ¢è®¨-contd">å“² â™‚ å­¦æ¢è®¨ (cont&rsquo;d)</h3>
<p>å¯ä»¥åœ¨è¿™ä¸ªæ¨¡å‹ä¸Šä¸¥è‚ƒåœ°å®šä¹‰å¾ˆå¤šæ¦‚å¿µï¼šé¢„æµ‹æœªæ¥ã€æ—¶é—´æ—…è¡Œâ€¦â€¦</p>
<ul>
<li>æˆä¸ºä½ ç†è§£ç‰©ç† (å’Œè®¡ç®—æœº) ä¸–ç•Œçš„å‚è€ƒ</li>
</ul>
<hr>
<ul>
<li>ä¾‹å­
<ul>
<li>Cellular automata ä¸æ”¯æŒ â€œæ—¶é—´æ—…è¡Œâ€
<ul>
<li>æ€ä¹ˆæ·»åŠ ä¸€ä¸ªå…¬ç†ä½¿å®ƒå¯ä»¥æ”¯æŒï¼Ÿ
<ul>
<li>å¹³è¡Œå®‡å®™</li>
<li>å¦‚æœä¸–ç•Œçº¿éœ€è¦åˆå¹¶ï¼Ÿå¯ä»¥<a href="https://www.scientificamerican.com/article/time-travel-simulation-resolves-grandfather-paradox/" target="_blank" rel="noopener noreffer">æ”¶æ•›äºæŸä¸ªåˆ†å¸ƒ</a></li>
</ul>
</li>
</ul>
</li>
<li>Cellular automata ä¸æ”¯æŒ â€œé¢„æµ‹å¤–æ¥â€
<ul>
<li>èƒ½å¦æ·»åŠ ä¸€ä¸ª syscall ä½¿å®ƒæ”¯æŒï¼Ÿ
<ul>
<li><a href="https://www.scottaaronson.com/papers/philos.pdf" target="_blank" rel="noopener noreffer">Why philosophers should care about computational complexity, Ch. 10</a> (<b>jyy å¼ºçƒˆæ¨èï¼Œè§£é‡Šéƒ¨åˆ†åœ¨10th-section</b>)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="çŠ¶æ€æœºæ¨¡å‹ç†è§£ç¼–è¯‘å™¨å’Œç°ä»£-cpu">çŠ¶æ€æœºæ¨¡å‹ï¼šç†è§£ç¼–è¯‘å™¨å’Œç°ä»£ CPU</h3>
<ul>
<li>ç¼–è¯‘å™¨ï¼šæºä»£ç $S$(çŠ¶æ€æœº) â†’ äºŒè¿›åˆ¶ä»£ç $C$(çŠ¶æ€æœº)</li>
</ul>
<p>$$
C=compile(S)
$$</p>
<ul>
<li>
<p>ç¼–è¯‘ (ä¼˜åŒ–) çš„æ­£ç¡®æ€§ (Soundness):</p>
<ul>
<li><font color="red"><em>S</em> ä¸Â <em>C</em> çš„å¯è§‚æµ‹è¡Œä¸ºä¸¥æ ¼ä¸€è‡´</font> ï¼ˆäºŒè¿›åˆ¶è½å®åˆ°ç¡¬ä»¶ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¸¥æ ¼ä¸€è‡´ä¸æ˜¯å¥å¥å¯¹åº”ï¼Œè€Œæ˜¯çŠ¶æ€æœºä¸€è‡´ï¼Œæ¯”å¦‚ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…æ‰§è¡Œä¸¤æ¡æŒ‡ä»¤ $\Longrightarrow$ <font color="red">instruction-level parallelism</font>ï¼‰
<ul>
<li>system calls; volatile variable loads/stores; termination</li>
</ul>
</li>
</ul>
</li>
<li>
<p>è¶…æ ‡é‡ (superscalar)/ä¹±åºæ‰§è¡Œå¤„ç†å™¨</p>
<ul>
<li>
<p>å…è®¸åœ¨çŠ¶æ€æœºä¸Š â€œè·³è·ƒâ€</p>
</li>
<li>
<p><a href="https://jyywiki.cn/pages/OS/2022/demos/ilp-demo.c" target="_blank" rel="noopener noreffer">ilp-demo.c</a></p>
</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define LOOP 1000000000ul
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span> <span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">LOOP</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">asm</span> <span class="k">volatile</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;mov $1, %%rax;&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;mov $1, %%rdi;&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;mov $1, %%rsi;&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;mov $1, %%rdx;&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;mov $1, %%rcx;&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;mov $1, %%r10;&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;mov $1, %%r8;&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;mov $1, %%r9;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">:::</span><span class="s">&#34;rax&#34;</span><span class="p">,</span> <span class="s">&#34;rdi&#34;</span><span class="p">,</span> <span class="s">&#34;rsi&#34;</span><span class="p">,</span> <span class="s">&#34;rdx&#34;</span><span class="p">,</span> <span class="s">&#34;rcx&#34;</span><span class="p">,</span> <span class="s">&#34;r10&#34;</span><span class="p">,</span> <span class="s">&#34;r8&#34;</span><span class="p">,</span> <span class="s">&#34;r9&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">clock_t</span> <span class="n">st</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">loop</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">clock_t</span> <span class="n">ed</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kt">double</span> <span class="n">inst</span> <span class="o">=</span> <span class="n">LOOP</span> <span class="o">*</span> <span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000000000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">double</span> <span class="n">ips</span> <span class="o">=</span> <span class="n">inst</span> <span class="o">/</span> <span class="p">((</span><span class="n">ed</span> <span class="o">-</span> <span class="n">st</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">CLOCKS_PER_SEC</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%.2lfG instructions/s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ips</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åœ¨ä¼˜åŒ–ä¸‹æ‰§è¡Œçš„æ•ˆæœ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-<span class="o">[</span>~/chapter9<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ screenfetch            
</span></span><span class="line"><span class="cl">..............                                  
</span></span><span class="line"><span class="cl">            ..,<span class="p">;</span>:ccc,.                           kali@kali
</span></span><span class="line"><span class="cl">          ......<span class="s1">&#39;&#39;&#39;;lxO.                         OS: Kali Linux 
</span></span></span><span class="line"><span class="cl"><span class="s1">.....&#39;&#39;&#39;&#39;..........,:ld;                         Kernel: x86_64 Linux 6.0.0-kali3-amd64
</span></span></span><span class="line"><span class="cl"><span class="s1">           .&#39;</span><span class="p">;;;</span>:::<span class="p">;</span>,,.x,                        Uptime: 49m
</span></span><span class="line"><span class="cl">      ..<span class="s1">&#39;&#39;&#39;.            0Xxoc:,.  ...            Packages: 2707
</span></span></span><span class="line"><span class="cl"><span class="s1">  ....                ,ONkc;,;cokOdc&#39;</span>,.          Shell: zsh 5.9
</span></span><span class="line"><span class="cl"> .                   OMo           <span class="s1">&#39;:ddo.        Resolution: 1714x874
</span></span></span><span class="line"><span class="cl"><span class="s1">                    dMc               :OO;       DE: Xfce
</span></span></span><span class="line"><span class="cl"><span class="s1">                    0M.                 .:o.     WM: Xfwm4
</span></span></span><span class="line"><span class="cl"><span class="s1">                    ;Wd                          WM Theme: Kali-Dark
</span></span></span><span class="line"><span class="cl"><span class="s1">                     ;XO,                        GTK Theme: Kali-Dark [GTK2]
</span></span></span><span class="line"><span class="cl"><span class="s1">                       ,d0Odlc;,..               Icon Theme: Flat-Remix-Blue-Dark
</span></span></span><span class="line"><span class="cl"><span class="s1">                           ..&#39;</span>,<span class="p">;</span>:cdOOd::,.       Font: Cantarell <span class="m">11</span>
</span></span><span class="line"><span class="cl">                                    .:d<span class="p">;</span>.<span class="s1">&#39;:;.    Disk: 19G / 80G (26%)
</span></span></span><span class="line"><span class="cl"><span class="s1">                                       &#39;</span>d,  .<span class="s1">&#39;   CPU: AMD Ryzen 9 5900HX with Radeon Graphics @ 4x 3.294GHz
</span></span></span><span class="line"><span class="cl"><span class="s1">                                         ;l   .. GPU: VMware SVGA II Adapter
</span></span></span><span class="line"><span class="cl"><span class="s1">                                          .o     RAM: 1501MiB / 1972MiB
</span></span></span><span class="line"><span class="cl"><span class="s1">                                            c   
</span></span></span><span class="line"><span class="cl"><span class="s1">                                            .&#39;</span>  
</span></span><span class="line"><span class="cl">                                             .  
</span></span><span class="line"><span class="cl">                                                                                                                                            
</span></span><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-<span class="o">[</span>~/chapter9<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ gcc -O2 ilp-demo.c -o ilp-demo   
</span></span><span class="line"><span class="cl">                                                                                                                                            
</span></span><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-<span class="o">[</span>~/chapter9<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ ./ilp-demo                      
</span></span><span class="line"><span class="cl">19.06G instructions/s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-<span class="o">[</span>~/chapter9<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ ./ilp-demo
</span></span><span class="line"><span class="cl">19.38G instructions/s
</span></span><span class="line"><span class="cl">                                                                                                                                            
</span></span><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-<span class="o">[</span>~/chapter9<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ ./ilp-demo
</span></span><span class="line"><span class="cl">19.19G instructions/s
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä¼˜åŒ–è¿‡åï¼Œ<b>æ¯ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå¯ä»¥æ‰§è¡Œè¿œè¿œè¶…è¿‡ä¸€æ¡æŒ‡ä»¤</b></li>
</ul>
<h2 id="æŸ¥çœ‹çŠ¶æ€æœºæ‰§è¡Œ">æŸ¥çœ‹çŠ¶æ€æœºæ‰§è¡Œ</h2>
<h3 id="trace-å’Œè°ƒè¯•å™¨">Trace å’Œè°ƒè¯•å™¨</h3>
<ul>
<li>
<p>ç¨‹åºæ‰§è¡Œ = çŠ¶æ€æœºæ‰§è¡Œ</p>
<ul>
<li>æˆ‘ä»¬èƒ½ä¸èƒ½ â€œhackâ€ è¿›è¿™ä¸ªçŠ¶æ€æœº
<ul>
<li>è§‚å¯ŸçŠ¶æ€æœºçš„æ‰§è¡Œ
<ul>
<li>strace/gdb</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ç”šè‡³è®°å½•å’Œ<font color="red">æ”¹å˜</font>çŠ¶æ€æœºçš„æ‰§è¡Œ</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-<span class="o">[</span>~/chapter9<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ strace ./ilp-demo 
</span></span><span class="line"><span class="cl">execve<span class="o">(</span><span class="s2">&#34;./ilp-demo&#34;</span>, <span class="o">[</span><span class="s2">&#34;./ilp-demo&#34;</span><span class="o">]</span>, 0x7ffe10420e10 /* <span class="m">55</span> vars */<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">brk<span class="o">(</span>NULL<span class="o">)</span>                               <span class="o">=</span> 0x55de2e4e2000
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>NULL, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7f9eb4b2c000
</span></span><span class="line"><span class="cl">access<span class="o">(</span><span class="s2">&#34;/etc/ld.so.preload&#34;</span>, R_OK<span class="o">)</span>      <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
</span></span><span class="line"><span class="cl">openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/etc/ld.so.cache&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">newfstatat<span class="o">(</span>3, <span class="s2">&#34;&#34;</span>, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0644, <span class="nv">st_size</span><span class="o">=</span>89062, ...<span class="o">}</span>, AT_EMPTY_PATH<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>NULL, 89062, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f9eb4b16000
</span></span><span class="line"><span class="cl">close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/lib/x86_64-linux-gnu/libc.so.6&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">read<span class="o">(</span>3, <span class="s2">&#34;\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0Ps\2\0\0\0\0\0&#34;</span>..., 832<span class="o">)</span> <span class="o">=</span> <span class="m">832</span>
</span></span><span class="line"><span class="cl">pread64<span class="o">(</span>3, <span class="s2">&#34;\6\0\0\0\4\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0&#34;</span>..., 784, 64<span class="o">)</span> <span class="o">=</span> <span class="m">784</span>
</span></span><span class="line"><span class="cl">newfstatat<span class="o">(</span>3, <span class="s2">&#34;&#34;</span>, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0755, <span class="nv">st_size</span><span class="o">=</span>1922136, ...<span class="o">}</span>, AT_EMPTY_PATH<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">pread64<span class="o">(</span>3, <span class="s2">&#34;\6\0\0\0\4\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0&#34;</span>..., 784, 64<span class="o">)</span> <span class="o">=</span> <span class="m">784</span>
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>NULL, 1970000, PROT_READ, MAP_PRIVATE<span class="p">|</span>MAP_DENYWRITE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f9eb4935000
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>0x7f9eb495b000, 1396736, PROT_READ<span class="p">|</span>PROT_EXEC, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x26000<span class="o">)</span> <span class="o">=</span> 0x7f9eb495b000
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>0x7f9eb4ab0000, 339968, PROT_READ, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x17b000<span class="o">)</span> <span class="o">=</span> 0x7f9eb4ab0000
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>0x7f9eb4b03000, 24576, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x1ce000<span class="o">)</span> <span class="o">=</span> 0x7f9eb4b03000
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>0x7f9eb4b09000, 53072, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7f9eb4b09000
</span></span><span class="line"><span class="cl">close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>NULL, 12288, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7f9eb4932000
</span></span><span class="line"><span class="cl">arch_prctl<span class="o">(</span>ARCH_SET_FS, 0x7f9eb4932740<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">set_tid_address<span class="o">(</span>0x7f9eb4932a10<span class="o">)</span>         <span class="o">=</span> <span class="m">5644</span>
</span></span><span class="line"><span class="cl">set_robust_list<span class="o">(</span>0x7f9eb4932a20, 24<span class="o">)</span>     <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">rseq<span class="o">(</span>0x7f9eb4933060, 0x20, 0, 0x53053053<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">mprotect<span class="o">(</span>0x7f9eb4b03000, 16384, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">mprotect<span class="o">(</span>0x55de2e4dc000, 4096, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">mprotect<span class="o">(</span>0x7f9eb4b5e000, 8192, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">prlimit64<span class="o">(</span>0, RLIMIT_STACK, NULL, <span class="o">{</span><span class="nv">rlim_cur</span><span class="o">=</span>8192*1024, <span class="nv">rlim_max</span><span class="o">=</span>RLIM64_INFINITY<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">munmap<span class="o">(</span>0x7f9eb4b16000, 89062<span class="o">)</span>           <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">clock_gettime<span class="o">(</span>CLOCK_PROCESS_CPUTIME_ID, <span class="o">{</span><span class="nv">tv_sec</span><span class="o">=</span>0, <span class="nv">tv_nsec</span><span class="o">=</span>1796473<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">clock_gettime<span class="o">(</span>CLOCK_PROCESS_CPUTIME_ID, <span class="o">{</span><span class="nv">tv_sec</span><span class="o">=</span>0, <span class="nv">tv_nsec</span><span class="o">=</span>514062681<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">newfstatat<span class="o">(</span>1, <span class="s2">&#34;&#34;</span>, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFCHR<span class="p">|</span>0600, <span class="nv">st_rdev</span><span class="o">=</span>makedev<span class="o">(</span>0x88, 0<span class="o">)</span>, ...<span class="o">}</span>, AT_EMPTY_PATH<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">getrandom<span class="o">(</span><span class="s2">&#34;\x2a\x03\xa3\xe2\x7d\xa4\x84\x07&#34;</span>, 8, GRND_NONBLOCK<span class="o">)</span> <span class="o">=</span> <span class="m">8</span>
</span></span><span class="line"><span class="cl">brk<span class="o">(</span>NULL<span class="o">)</span>                               <span class="o">=</span> 0x55de2e4e2000
</span></span><span class="line"><span class="cl">brk<span class="o">(</span>0x55de2e503000<span class="o">)</span>                     <span class="o">=</span> 0x55de2e503000
</span></span><span class="line"><span class="cl">write<span class="o">(</span>1, <span class="s2">&#34;19.52G instructions/s\n&#34;</span>, 2219.52G instructions/s
</span></span><span class="line"><span class="cl"><span class="o">)</span> <span class="o">=</span> <span class="m">22</span>
</span></span><span class="line"><span class="cl">exit_group<span class="o">(</span>0<span class="o">)</span>                           <span class="o">=</span> ?
</span></span><span class="line"><span class="cl">+++ exited with <span class="m">0</span> +++
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>strace</code>è°ƒè¯•æœ€å°çš„Hello OSï¼Œå¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ç³»ç»Ÿè°ƒç”¨</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-<span class="o">[</span>~/chapter9<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ strace ./minimal
</span></span><span class="line"><span class="cl">execve<span class="o">(</span><span class="s2">&#34;./minimal&#34;</span>, <span class="o">[</span><span class="s2">&#34;./minimal&#34;</span><span class="o">]</span>, 0x7ffefc958480 /* <span class="m">55</span> vars */<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">write<span class="o">(</span>1, <span class="s2">&#34;\33[01;31mHello, OS World\33[0m\n&#34;</span>, 28Hello, OS World
</span></span><span class="line"><span class="cl"><span class="o">)</span> <span class="o">=</span> <span class="m">28</span>
</span></span><span class="line"><span class="cl">exit<span class="o">(</span>1<span class="o">)</span>                                 <span class="o">=</span> ?
</span></span><span class="line"><span class="cl">+++ exited with <span class="m">1</span> +++
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>-Tçœ‹æ¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨èŠ±è´¹çš„æ—¶é—´</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-<span class="o">[</span>~/chapter9<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ strace -T ./ilp-demo
</span></span><span class="line"><span class="cl">execve<span class="o">(</span><span class="s2">&#34;./ilp-demo&#34;</span>, <span class="o">[</span><span class="s2">&#34;./ilp-demo&#34;</span><span class="o">]</span>, 0x7ffdfd498e18 /* <span class="m">55</span> vars */<span class="o">)</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000258&gt;
</span></span><span class="line"><span class="cl">brk<span class="o">(</span>NULL<span class="o">)</span>                               <span class="o">=</span> 0x55a0fd277000 &lt;0.000005&gt;
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>NULL, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7fb9c980a000 &lt;0.000113&gt;
</span></span><span class="line"><span class="cl">access<span class="o">(</span><span class="s2">&#34;/etc/ld.so.preload&#34;</span>, R_OK<span class="o">)</span>      <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span> &lt;0.000076&gt;
</span></span><span class="line"><span class="cl">openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/etc/ld.so.cache&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span> &lt;0.000077&gt;
</span></span><span class="line"><span class="cl">newfstatat<span class="o">(</span>3, <span class="s2">&#34;&#34;</span>, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0644, <span class="nv">st_size</span><span class="o">=</span>89062, ...<span class="o">}</span>, AT_EMPTY_PATH<span class="o">)</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000077&gt;
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>NULL, 89062, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7fb9c97f4000 &lt;0.000074&gt;
</span></span><span class="line"><span class="cl">close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span> &lt;0.000072&gt;
</span></span><span class="line"><span class="cl">openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/lib/x86_64-linux-gnu/libc.so.6&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span> &lt;0.000076&gt;
</span></span><span class="line"><span class="cl">read<span class="o">(</span>3, <span class="s2">&#34;\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0Ps\2\0\0\0\0\0&#34;</span>..., 832<span class="o">)</span> <span class="o">=</span> <span class="m">832</span> &lt;0.000072&gt;
</span></span><span class="line"><span class="cl">pread64<span class="o">(</span>3, <span class="s2">&#34;\6\0\0\0\4\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0&#34;</span>..., 784, 64<span class="o">)</span> <span class="o">=</span> <span class="m">784</span> &lt;0.000071&gt;
</span></span><span class="line"><span class="cl">newfstatat<span class="o">(</span>3, <span class="s2">&#34;&#34;</span>, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0755, <span class="nv">st_size</span><span class="o">=</span>1922136, ...<span class="o">}</span>, AT_EMPTY_PATH<span class="o">)</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000076&gt;
</span></span><span class="line"><span class="cl">pread64<span class="o">(</span>3, <span class="s2">&#34;\6\0\0\0\4\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0&#34;</span>..., 784, 64<span class="o">)</span> <span class="o">=</span> <span class="m">784</span> &lt;0.000071&gt;
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>NULL, 1970000, PROT_READ, MAP_PRIVATE<span class="p">|</span>MAP_DENYWRITE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7fb9c9613000 &lt;0.000084&gt;
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>0x7fb9c9639000, 1396736, PROT_READ<span class="p">|</span>PROT_EXEC, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x26000<span class="o">)</span> <span class="o">=</span> 0x7fb9c9639000 &lt;0.000073&gt;
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>0x7fb9c978e000, 339968, PROT_READ, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x17b000<span class="o">)</span> <span class="o">=</span> 0x7fb9c978e000 &lt;0.000073&gt;
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>0x7fb9c97e1000, 24576, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x1ce000<span class="o">)</span> <span class="o">=</span> 0x7fb9c97e1000 &lt;0.000060&gt;
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>0x7fb9c97e7000, 53072, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7fb9c97e7000 &lt;0.000074&gt;
</span></span><span class="line"><span class="cl">close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span> &lt;0.000072&gt;
</span></span><span class="line"><span class="cl">mmap<span class="o">(</span>NULL, 12288, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7fb9c9610000 &lt;0.000074&gt;
</span></span><span class="line"><span class="cl">arch_prctl<span class="o">(</span>ARCH_SET_FS, 0x7fb9c9610740<span class="o">)</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000073&gt;
</span></span><span class="line"><span class="cl">set_tid_address<span class="o">(</span>0x7fb9c9610a10<span class="o">)</span>         <span class="o">=</span> <span class="m">8876</span> &lt;0.000071&gt;
</span></span><span class="line"><span class="cl">set_robust_list<span class="o">(</span>0x7fb9c9610a20, 24<span class="o">)</span>     <span class="o">=</span> <span class="m">0</span> &lt;0.000097&gt;
</span></span><span class="line"><span class="cl">rseq<span class="o">(</span>0x7fb9c9611060, 0x20, 0, 0x53053053<span class="o">)</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000109&gt;
</span></span><span class="line"><span class="cl">mprotect<span class="o">(</span>0x7fb9c97e1000, 16384, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000079&gt;
</span></span><span class="line"><span class="cl">mprotect<span class="o">(</span>0x55a0fcb07000, 4096, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000072&gt;
</span></span><span class="line"><span class="cl">mprotect<span class="o">(</span>0x7fb9c983c000, 8192, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000073&gt;
</span></span><span class="line"><span class="cl">prlimit64<span class="o">(</span>0, RLIMIT_STACK, NULL, <span class="o">{</span><span class="nv">rlim_cur</span><span class="o">=</span>8192*1024, <span class="nv">rlim_max</span><span class="o">=</span>RLIM64_INFINITY<span class="o">})</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000074&gt;
</span></span><span class="line"><span class="cl">munmap<span class="o">(</span>0x7fb9c97f4000, 89062<span class="o">)</span>           <span class="o">=</span> <span class="m">0</span> &lt;0.000094&gt;
</span></span><span class="line"><span class="cl">clock_gettime<span class="o">(</span>CLOCK_PROCESS_CPUTIME_ID, <span class="o">{</span><span class="nv">tv_sec</span><span class="o">=</span>0, <span class="nv">tv_nsec</span><span class="o">=</span>876239<span class="o">})</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000075&gt;
</span></span><span class="line"><span class="cl">clock_gettime<span class="o">(</span>CLOCK_PROCESS_CPUTIME_ID, <span class="o">{</span><span class="nv">tv_sec</span><span class="o">=</span>0, <span class="nv">tv_nsec</span><span class="o">=</span>511881481<span class="o">})</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000199&gt;
</span></span><span class="line"><span class="cl">newfstatat<span class="o">(</span>1, <span class="s2">&#34;&#34;</span>, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFCHR<span class="p">|</span>0600, <span class="nv">st_rdev</span><span class="o">=</span>makedev<span class="o">(</span>0x88, 0<span class="o">)</span>, ...<span class="o">}</span>, AT_EMPTY_PATH<span class="o">)</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000090&gt;
</span></span><span class="line"><span class="cl">getrandom<span class="o">(</span><span class="s2">&#34;\x6e\x63\x59\xe8\xb3\xfe\x8a\x8d&#34;</span>, 8, GRND_NONBLOCK<span class="o">)</span> <span class="o">=</span> <span class="m">8</span> &lt;0.000143&gt;
</span></span><span class="line"><span class="cl">brk<span class="o">(</span>NULL<span class="o">)</span>                               <span class="o">=</span> 0x55a0fd277000 &lt;0.000106&gt;
</span></span><span class="line"><span class="cl">brk<span class="o">(</span>0x55a0fd298000<span class="o">)</span>                     <span class="o">=</span> 0x55a0fd298000 &lt;0.000052&gt;
</span></span><span class="line"><span class="cl">write<span class="o">(</span>1, <span class="s2">&#34;19.57G instructions/s\n&#34;</span>, 2219.57G instructions/s
</span></span><span class="line"><span class="cl"><span class="o">)</span> <span class="o">=</span> <span class="m">22</span> &lt;0.000085&gt;
</span></span><span class="line"><span class="cl">exit_group<span class="o">(</span>0<span class="o">)</span>                           <span class="o">=</span> ?
</span></span><span class="line"><span class="cl">+++ exited with <span class="m">0</span> +++
</span></span></code></pre></td></tr></table>
</div>
</div><figure><a class="lightgallery" href="/img/Operating%20System/chapter10-1.png" title="/img/Operating System/chapter10-1.png" data-thumbnail="/img/Operating System/chapter10-1.png" data-sub-html="<h2>gdb layout src</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/chapter10-1.png"
            data-srcset="/img/Operating%20System/chapter10-1.png, /img/Operating%20System/chapter10-1.png 1.5x, /img/Operating%20System/chapter10-1.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/chapter10-1.png" />
    </a><figcaption class="image-caption"><code>gdb layout src</code></figcaption>
    </figure>
<ul>
<li>æ³¨æ„ä¸ºäº†è®©<code>layout src</code>èƒ½å¤ŸæˆåŠŸæ˜¾ç¤ºï¼Œç¼–è¯‘æ—¶éœ€è¦ä½¿ç”¨<code>gcc</code>çš„<code>-g</code>ç¼–è¯‘é€‰é¡¹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-<span class="o">[</span>~/chapter9<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ gcc -O2 ilp-demo.c -o ilp-demo -g  
</span></span><span class="line"><span class="cl">                                                                                                                                            
</span></span><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-<span class="o">[</span>~/chapter9<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ gdb ilp-demo                     
</span></span><span class="line"><span class="cl">GNU gdb <span class="o">(</span>Debian 13.1-2<span class="o">)</span> 13.1
</span></span><span class="line"><span class="cl">Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2023</span> Free Software Foundation, Inc.
</span></span><span class="line"><span class="cl">License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
</span></span><span class="line"><span class="cl">This is free software: you are free to change and redistribute it.
</span></span><span class="line"><span class="cl">There is NO WARRANTY, to the extent permitted by law.
</span></span><span class="line"><span class="cl">Type <span class="s2">&#34;show copying&#34;</span> and <span class="s2">&#34;show warranty&#34;</span> <span class="k">for</span> details.
</span></span><span class="line"><span class="cl">This GDB was configured as <span class="s2">&#34;x86_64-linux-gnu&#34;</span>.
</span></span><span class="line"><span class="cl">Type <span class="s2">&#34;show configuration&#34;</span> <span class="k">for</span> configuration details.
</span></span><span class="line"><span class="cl">For bug reporting instructions, please see:
</span></span><span class="line"><span class="cl">&lt;https://www.gnu.org/software/gdb/bugs/&gt;.
</span></span><span class="line"><span class="cl">Find the GDB manual and other documentation resources online at:
</span></span><span class="line"><span class="cl">    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">For help, <span class="nb">type</span> <span class="s2">&#34;help&#34;</span>.
</span></span><span class="line"><span class="cl">Type <span class="s2">&#34;apropos word&#34;</span> to search <span class="k">for</span> commands related to <span class="s2">&#34;word&#34;</span>...
</span></span><span class="line"><span class="cl">Reading symbols from ilp-demo...
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> start
</span></span><span class="line"><span class="cl">Temporary breakpoint <span class="m">1</span> at 0x1060: file ilp-demo.c, line 22.
</span></span><span class="line"><span class="cl">Starting program: /home/kali/chapter9/ilp-demo 
</span></span><span class="line"><span class="cl"><span class="o">[</span>Thread debugging using libthread_db enabled<span class="o">]</span>
</span></span><span class="line"><span class="cl">Using host libthread_db library <span class="s2">&#34;/lib/x86_64-linux-gnu/libthread_db.so.1&#34;</span>.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Temporary breakpoint 1, main <span class="o">()</span> at ilp-demo.c:22
</span></span><span class="line"><span class="cl"><span class="m">22</span>        clock_t <span class="nv">st</span> <span class="o">=</span> clock<span class="o">()</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> layout src
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åº”ç”¨-1-time-travel-debugging">åº”ç”¨ (1): Time-Travel Debugging</h3>
<ul>
<li>
<p>ç¨‹åºæ‰§è¡Œæ˜¯éšæ—¶é—´ â€œå‰è¿›â€ çš„$s_0 \rightarrow s_1 \rightarrow s_2 \rightarrow \dots$</p>
</li>
<li>
<p>èƒ½å¦åœ¨æ—¶é—´ä¸Š â€œåé€€â€ï¼Ÿ (time-travel)</p>
<ul>
<li>ç»å¸¸ gdb ä¸å°å¿ƒ step è¿‡äº†ï¼Œä»å¤´å†æ¥â€¦â€¦</li>
<li>è®°å½•æ‰€æœ‰çš„$s_i$ï¼Œå°±èƒ½å®ç°ä»»æ„çš„ time-traveling</li>
</ul>
</li>
</ul>
<blockquote>
<p>å‡‰æ€§å¾ªç¯ï¼Œçœ‹ä¸€ä¼š<code>rust</code></p>
</blockquote>
<ul>
<li>è®°å½•æ‰€æœ‰$s_i$çš„å¼€é”€å¤ªå¤§ï¼ˆ$s_i$ç”±å†…å­˜+å¯„å­˜å™¨ç»„æˆï¼‰
<ul>
<li>ä½†<font color="red">ä¸€æ¡æŒ‡ä»¤çš„side-effecté€šå¸¸æœ‰é™</font></li>
</ul>
</li>
</ul>
<h3 id="åº”ç”¨-1-time-travel-debugging-contd">åº”ç”¨ (1): Time-Travel Debugging (cont&rsquo;d)</h3>
<ul>
<li>
<p>gdb çš„éšè—åŠŸèƒ½ (å¤§å®¶è¯»è¿‡ gdb çš„æ‰‹å†Œäº†å—ï¼Ÿ)</p>
<ul>
<li>
<p><code>record full</code> - å¼€å§‹è®°å½•</p>
</li>
<li>
<p><code>record stop</code> - ç»“æŸè®°å½•</p>
</li>
<li>
<p><code>reverse-step</code>/<code>reverse-stepi</code> - â€œæ—¶é—´æ—…è¡Œè°ƒè¯•â€</p>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>ä¾‹å­ï¼šè°ƒè¯• <a href="https://jyywiki.cn/pages/OS/2022/demos/rdrand.c" target="_blank" rel="noopener noreffer">rdrand.c</a>
<ul>
<li>Reverse execution ä¸æ˜¯ä¸‡èƒ½çš„
<ul>
<li><b><font color="red">æœ‰äº›å¤æ‚çš„æŒ‡ä»¤ (<code>syscall</code>) æ— æ³•ä¿è¯</font></b> $\Longrightarrow$ <code>record and replay</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">uint64_t</span> <span class="n">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">asm</span> <span class="k">volatile</span> <span class="p">(</span><span class="s">&#34;rdrand %0&#34;</span><span class="o">:</span> <span class="s">&#34;=r&#34;</span><span class="p">(</span><span class="n">val</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;rdrand returns %016lx</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>asm volatile (&quot;rdrand %0&quot;: &quot;=r&quot;(val));</code>ä½¿ç”¨äº† <code>GCC</code> å†…è”æ±‡ç¼–ï¼ˆ<code>Inline Assembly</code>ï¼‰çš„è¯­æ³•ï¼Œä½¿ç”¨ Intel çš„ RDRAND æŒ‡ä»¤ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œå¹¶å°†è¯¥éšæœºæ•°ä¿å­˜åˆ°å˜é‡ <code>val</code> ä¸­ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œ<code>%0</code> è¡¨ç¤ºå ä½ç¬¦ï¼Œç”¨æ¥ä»£è¡¨ç¬¬ä¸€ä¸ªè¾“å…¥æˆ–è¾“å‡ºæ“ä½œæ•°ï¼Œè¿™é‡Œæ˜¯ <code>val</code>ã€‚è€Œ <code>=r</code> åˆ™è¡¨ç¤ºå°† <code>val</code> å¯„å­˜å™¨ä¸­çš„å€¼ä½œä¸ºè¾“å‡ºå€¼ï¼ŒåŒæ—¶é€šçŸ¥ç¼–è¯‘å™¨è¯¥å˜é‡ä¼šè¢«ä¿®æ”¹ã€‚</p>
<p>å› æ­¤ï¼Œè¯¥ä»£ç ä½¿ç”¨ RDRAND ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ° <code>val</code> å˜é‡ä¸­ã€‚æœ€åé€šè¿‡ <code>printf</code> æ‰“å°å‡ºè¯¥éšæœºæ•°ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>jungleã‰¿LAPTOP-A7S3TAA4<span class="o">)</span>-<span class="o">[</span>/mnt/d/work <span class="k">for</span> vscode/chapter10<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ gcc -O1 rdrand.c -g -o rdrand   
</span></span><span class="line"><span class="cl">                                                                                         
</span></span><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>jungleã‰¿LAPTOP-A7S3TAA4<span class="o">)</span>-<span class="o">[</span>/mnt/d/work <span class="k">for</span> vscode/chapter10<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ ./rdrand
</span></span><span class="line"><span class="cl">rdrand returns d8112baa2a77dd3e
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>jungleã‰¿LAPTOP-A7S3TAA4<span class="o">)</span>-<span class="o">[</span>/mnt/d/work <span class="k">for</span> vscode/chapter10<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ ./rdrand
</span></span><span class="line"><span class="cl">rdrand returns 106671f827a8f49e                                                           
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>jungleã‰¿LAPTOP-A7S3TAA4<span class="o">)</span>-<span class="o">[</span>/mnt/d/work <span class="k">for</span> vscode/chapter10<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ ./rdrand
</span></span><span class="line"><span class="cl">rdrand returns 04adc0b810ec0565
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>volatile</code>æé†’ç¼–è¯‘å™¨å®ƒåé¢æ‰€å®šä¹‰çš„å˜é‡éšæ—¶éƒ½æœ‰å¯èƒ½æ”¹å˜ï¼Œå› æ­¤ç¼–è¯‘åçš„ç¨‹åºæ¯æ¬¡éœ€è¦å­˜å‚¨æˆ–è¯»å–è¿™ä¸ªå˜é‡çš„æ—¶å€™ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨å¯¹è¯¥å˜é‡ä¸åšä¼˜åŒ–ï¼Œéƒ½ä¼šç›´æ¥ä»å˜é‡å†…å­˜åœ°å€ä¸­è¯»å–æ•°æ®ï¼Œä»è€Œå¯ä»¥æä¾›å¯¹ç‰¹æ®Šåœ°å€çš„ç¨³å®šè®¿é—®ã€‚</p>
<p>å¦‚æœæ²¡æœ‰<code>volatile</code>å…³é”®å­—ï¼Œåˆ™ç¼–è¯‘å™¨å¯èƒ½ä¼˜åŒ–è¯»å–å’Œå­˜å‚¨ï¼Œå¯èƒ½æš‚æ—¶ä½¿ç”¨å¯„å­˜å™¨ä¸­çš„å€¼ï¼Œå¦‚æœè¿™ä¸ªå˜é‡ç”±åˆ«çš„ç¨‹åºæ›´æ–°äº†çš„è¯ï¼Œå°†å‡ºç°ä¸ä¸€è‡´çš„ç°è±¡ã€‚ï¼ˆç®€æ´çš„è¯´å°±æ˜¯ï¼š<code>volatile</code>å…³é”®è¯å½±å“ç¼–è¯‘å™¨ç¼–è¯‘çš„ç»“æœï¼Œç”¨<code>volatile</code>å£°æ˜çš„å˜é‡è¡¨ç¤ºè¯¥å˜é‡éšæ—¶å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œä¸è¯¥å˜é‡æœ‰å…³çš„è¿ç®—ï¼Œä¸è¦è¿›è¡Œç¼–è¯‘ä¼˜åŒ–ï¼Œä»¥å…å‡ºé”™ï¼‰</p>
</blockquote>
<ul>
<li>æ›´æ”¹ä¹‹åè¿›è¡Œ<code>gdb</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">uint64_t</span> <span class="k">volatile</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">114514</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">asm</span> <span class="k">volatile</span> <span class="p">(</span><span class="s">&#34;rdrand %0&#34;</span><span class="o">:</span> <span class="s">&#34;=r&#34;</span><span class="p">(</span><span class="n">val</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;rdrand returns %016lx</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ¯ä¸€æ¬¡çš„è°ƒè¯•ç»“æœéƒ½ä¸ä¸€æ ·ï¼Œé‚£æˆ‘ä»¬åº”è¯¥å¦‚ä½•å¤ç°<code>BUG</code>ï¼Ÿ
<ul>
<li>æ‰“å¼€è®°å½•æ¨¡å¼</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> record full
</span></span></code></pre></td></tr></table>
</div>
</div><figure><a class="lightgallery" href="/img/Operating%20System/chapter10-2.png" title="/img/Operating System/chapter10-2.png" data-thumbnail="/img/Operating System/chapter10-2.png" data-sub-html="<h2>on wsl</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/chapter10-2.png"
            data-srcset="/img/Operating%20System/chapter10-2.png, /img/Operating%20System/chapter10-2.png 1.5x, /img/Operating%20System/chapter10-2.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/chapter10-2.png" />
    </a><figcaption class="image-caption"><code>on wsl</code></figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter10-3.png" title="/img/Operating System/chapter10-3.png" data-thumbnail="/img/Operating System/chapter10-3.png" data-sub-html="<h2>layout asm</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/chapter10-3.png"
            data-srcset="/img/Operating%20System/chapter10-3.png, /img/Operating%20System/chapter10-3.png 1.5x, /img/Operating%20System/chapter10-3.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/chapter10-3.png" />
    </a><figcaption class="image-caption"><code>layout asm</code></figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter10-4.png" title="/img/Operating System/chapter10-4.png" data-thumbnail="/img/Operating System/chapter10-4.png" data-sub-html="<h2>raxå€¼ç›¸åŒ</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/chapter10-4.png"
            data-srcset="/img/Operating%20System/chapter10-4.png, /img/Operating%20System/chapter10-4.png 1.5x, /img/Operating%20System/chapter10-4.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/chapter10-4.png" />
    </a><figcaption class="image-caption"><code>raxå€¼ç›¸åŒ</code></figcaption>
    </figure>
<ul>
<li><code>val</code>çš„å€¼å·²ç»æ”¹å˜ï¼Œå¦‚ä½•å‘ä¸Šå›æº¯ï¼Ÿ
<ul>
<li>ä½¿ç”¨<code>rsi</code>å¾€å›æ‰§è¡Œ</li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter10-5.png" title="/img/Operating System/chapter10-5.png" data-thumbnail="/img/Operating System/chapter10-5.png" data-sub-html="<h2>rsi</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/chapter10-5.png"
            data-srcset="/img/Operating%20System/chapter10-5.png, /img/Operating%20System/chapter10-5.png 1.5x, /img/Operating%20System/chapter10-5.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/chapter10-5.png" />
    </a><figcaption class="image-caption"><code>rsi</code></figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter10-6.png" title="/img/Operating System/chapter10-6.png" data-thumbnail="/img/Operating System/chapter10-6.png" data-sub-html="<h2>è¿”å›æ—§å€¼</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/chapter10-6.png"
            data-srcset="/img/Operating%20System/chapter10-6.png, /img/Operating%20System/chapter10-6.png 1.5x, /img/Operating%20System/chapter10-6.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/chapter10-6.png" />
    </a><figcaption class="image-caption"><code>è¿”å›æ—§å€¼</code></figcaption>
    </figure>
<h3 id="åº”ç”¨-2-record--replay">åº”ç”¨ (2): Record &amp; Replay</h3>
<ul>
<li>åœ¨ç¨‹åºæ‰§è¡Œæ—¶è®°å½•ä¿¡æ¯ï¼Œç»“æŸåé‡ç°ç¨‹åºçš„è¡Œä¸º
<ul>
<li>ç¡®å®šçš„ç¨‹åºä¸éœ€è¦ä»»ä½•è®°å½•
<ul>
<li>å‡è®¾$s_0$æ‰§è¡Œ 1,000,000 æ¡ç¡®å®šçš„æŒ‡ä»¤åå¾—åˆ°$s^{`}$
<ul>
<li>é‚£ä¹ˆåªè¦è®°å½•$s_0$å’Œ1,000,000</li>
<li>å°±èƒ½é€šè¿‡â€œå†æ‰§è¡Œä¸€æ¬¡â€ æ¨å¯¼å‡º$s^{`}$</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>è®°å½•ï¼š[æŒ‡ä»¤æ•°ï¼ˆç¡®å®šæŒ‡ä»¤ï¼‰ + ç»“æœï¼ˆéç¡®å®šæŒ‡ä»¤ï¼‰] $\times n$</li>
</ul>
<h3 id="åº”ç”¨-2-record--replay-contd">åº”ç”¨ (2): Record &amp; Replay (cont&rsquo;d)</h3>
<ul>
<li>
<p><code>Record &amp; Replay</code>: åªéœ€è®°å½• <code>non-deterministic</code> çš„æŒ‡ä»¤çš„<font color="red">æ•ˆæœ</font></p>
</li>
<li>
<p>(å•çº¿ç¨‹) åº”ç”¨ç¨‹åº</p>
<ul>
<li>syscall, rdrand, rdtsc, &hellip;</li>
<li>rr (Mozilla)
<ul>
<li><a href="https://jyywiki.cn/OS/2022/slides/10.slides" target="_blank" rel="noopener noreffer">To catch a failure: The record-and-replay approach to debugging</a> (CACM'20)</li>
</ul>
</li>
</ul>
</li>
<li>
<p>(å•å¤„ç†å™¨) æ“ä½œç³»ç»Ÿ</p>
<ul>
<li>
<p>mmio, in, out, rdrand, rdtsc, ä¸­æ–­, &hellip;</p>
</li>
<li>
<p>QEMU (<code>-icount shift=auto,rr=record,rrfile=replay.bin</code>)</p>
<ul>
<li><a href="https://jyywiki.cn/OS/2022/slides/10.slides" target="_blank" rel="noopener noreffer">ReVirt: Enabling intrusion analysis through virtual-machine logging and replay</a> (OSDI'02, Best Paper ğŸ…)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="é‡‡æ ·çŠ¶æ€æœºæ‰§è¡Œ">é‡‡æ ·çŠ¶æ€æœºæ‰§è¡Œ</h2>
<h3 id="å…³äºæ€§èƒ½ä¼˜åŒ–">å…³äºæ€§èƒ½ä¼˜åŒ–</h3>
<blockquote>
<p>Premature optimization is the root of all evil. (D. E. Knuth)</p>
</blockquote>
<ul>
<li>
<p>é‚£åˆ°åº•æ€ä¹ˆæ ·æ‰ç®— <code>mature</code> å‘¢ï¼Ÿ</p>
<ul>
<li>
<p>çŠ¶æ€æœºçš„æ‰§è¡Œéœ€è¦æ—¶é—´ï¼›å¯¹è±¡éœ€è¦å ç”¨ç©ºé—´</p>
</li>
<li>
<p>éœ€è¦ç†è§£å¥½ â€œæ—¶é—´èŠ±åœ¨å“ªé‡Œâ€ã€â€œä»€ä¹ˆå¯¹è±¡å ç”¨äº†ç©ºé—´â€</p>
</li>
</ul>
</li>
<li>
<p>æˆ‘ä»¬éœ€è¦çœŸå®æ‰§è¡Œçš„<font color="red">æ€§èƒ½æ‘˜è¦</font>ï¼</p>
<ul>
<li>
<p>æœ¬è´¨çš„å›ç­”ï¼šâ€œä¸ºäº†åšæŸä»¶äº‹åˆ°åº•èŠ±å»äº†å¤šå°‘èµ„æºâ€</p>
</li>
<li>
<p>ç®€åŒ–çš„å›ç­”ï¼šâ€œä¸€æ®µæ—¶é—´å†…èµ„æºçš„æ¶ˆè€—æƒ…å†µâ€</p>
</li>
</ul>
</li>
</ul>
<h3 id="profiler-å’Œæ€§èƒ½æ‘˜è¦">Profiler å’Œæ€§èƒ½æ‘˜è¦</h3>
<blockquote>
<p><b>æ€§èƒ½æ‘˜è¦éœ€è¦å¯¹ç¨‹åºæ‰§è¡Œæ€§èƒ½å½±å“æœ€å°ï¼ˆä¸èƒ½å› ä¸ºè¿™ä¸ªè¿›ç¨‹è¿‡å¤šå½±å“ä½ æ£€æµ‹çš„ç¨‹åºï¼‰</b>ï¼Œå¾€å¾€ä¸éœ€è¦ full traceã€‚</p>
</blockquote>
<ul>
<li><b><font color="red">éš”ä¸€æ®µæ—¶é—´ ï¼ˆæ¯”å¦‚ä¸€æ¯«ç§’ï¼‰â€œæš‚åœâ€ ç¨‹åºã€è§‚å¯ŸçŠ¶æ€æœºçš„æ‰§è¡Œ</font></b>
<ul>
<li><b>ä¸­æ–­</b>å°±å¯ä»¥åšåˆ°</li>
<li>å°†çŠ¶æ€ [<em>s</em>â†’<em>s</em>â€²] â€œè®°è´¦â€
<ul>
<li>æ‰§è¡Œçš„è¯­å¥</li>
<li>å‡½æ•°è°ƒç”¨æ ˆ</li>
<li>æœåŠ¡çš„è¯·æ±‚</li>
</ul>
</li>
<li>å¾—åˆ°ç»Ÿè®¡æ„ä¹‰çš„æ€§èƒ½æ‘˜è¦</li>
</ul>
</li>
</ul>
<hr>
<p>ä¾‹å­ï¼šLinux Kernel perf (æ”¯æŒç¡¬ä»¶ PMU) - <a href="https://jyywiki.cn/pages/OS/2022/demos/ilp-demo.c" target="_blank" rel="noopener noreffer">ilp-demo.c</a></p>
<ul>
<li>perf list, perf stat (-e), perf record, perf report</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define LOOP 1000000000ul
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span> <span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">LOOP</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&#34;mov $1, %%rax;&#34;</span>
</span></span><span class="line"><span class="cl">                 <span class="s">&#34;mov $1, %%rdi;&#34;</span>
</span></span><span class="line"><span class="cl">                 <span class="s">&#34;mov $1, %%rsi;&#34;</span>
</span></span><span class="line"><span class="cl">                 <span class="s">&#34;mov $1, %%rdx;&#34;</span>
</span></span><span class="line"><span class="cl">                 <span class="s">&#34;mov $1, %%rcx;&#34;</span>
</span></span><span class="line"><span class="cl">                 <span class="s">&#34;mov $1, %%r10;&#34;</span>
</span></span><span class="line"><span class="cl">                 <span class="s">&#34;mov $1, %%r8;&#34;</span>
</span></span><span class="line"><span class="cl">                 <span class="s">&#34;mov $1, %%r9;&#34;</span> <span class="o">::</span>
</span></span><span class="line"><span class="cl">                     <span class="o">:</span> <span class="s">&#34;rax&#34;</span><span class="p">,</span> <span class="s">&#34;rdi&#34;</span><span class="p">,</span> <span class="s">&#34;rsi&#34;</span><span class="p">,</span> <span class="s">&#34;rdx&#34;</span><span class="p">,</span> <span class="s">&#34;rcx&#34;</span><span class="p">,</span> <span class="s">&#34;r10&#34;</span><span class="p">,</span> <span class="s">&#34;r8&#34;</span><span class="p">,</span> <span class="s">&#34;r9&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">clock_t</span> <span class="n">st</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">loop</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">clock_t</span> <span class="n">ed</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kt">double</span> <span class="n">inst</span> <span class="o">=</span> <span class="n">LOOP</span> <span class="o">*</span> <span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000000000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">double</span> <span class="n">ips</span> <span class="o">=</span> <span class="n">inst</span> <span class="o">/</span> <span class="p">((</span><span class="n">ed</span> <span class="o">-</span> <span class="n">st</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">CLOCKS_PER_SEC</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%.2lfG instructions/s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ips</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å®‰è£…<code>perf</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>jungleã‰¿LAPTOP-A7S3TAA4<span class="o">)</span>-<span class="o">[</span>/mnt/d/work <span class="k">for</span> vscode/chapter10<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ sudo apt install linux-tools-common
</span></span><span class="line"><span class="cl"><span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> jungle: 
</span></span><span class="line"><span class="cl">Reading package lists... Done
</span></span><span class="line"><span class="cl">Building dependency tree... Done
</span></span><span class="line"><span class="cl">Reading state information... Done
</span></span><span class="line"><span class="cl">The following NEW packages will be installed:
</span></span><span class="line"><span class="cl">  linux-tools-common
</span></span><span class="line"><span class="cl"><span class="m">0</span> upgraded, <span class="m">1</span> newly installed, <span class="m">0</span> to remove and <span class="m">48</span> not upgraded.
</span></span><span class="line"><span class="cl">Need to get <span class="m">295</span> kB of archives.
</span></span><span class="line"><span class="cl">After this operation, <span class="m">812</span> kB of additional disk space will be used.
</span></span><span class="line"><span class="cl">Get:1 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 linux-tools-common all 5.15.0-69.76 <span class="o">[</span><span class="m">295</span> kB<span class="o">]</span>
</span></span><span class="line"><span class="cl">Fetched <span class="m">295</span> kB in 0s <span class="o">(</span><span class="m">4448</span> kB/s<span class="o">)</span>           
</span></span><span class="line"><span class="cl">debconf: unable to initialize frontend: Dialog
</span></span><span class="line"><span class="cl">debconf: <span class="o">(</span>Dialog frontend requires a screen at least <span class="m">13</span> lines tall and <span class="m">31</span> columns wide.<span class="o">)</span>
</span></span><span class="line"><span class="cl">debconf: falling back to frontend: Readline
</span></span><span class="line"><span class="cl">Selecting previously unselected package linux-tools-common.
</span></span><span class="line"><span class="cl"><span class="o">(</span>Reading database ... <span class="m">81634</span> files and directories currently installed.<span class="o">)</span>
</span></span><span class="line"><span class="cl">Preparing to unpack .../linux-tools-common_5.15.0-69.76_all.deb ...
</span></span><span class="line"><span class="cl">Unpacking linux-tools-common <span class="o">(</span>5.15.0-69.76<span class="o">)</span> ...
</span></span><span class="line"><span class="cl">Setting up linux-tools-common <span class="o">(</span>5.15.0-69.76<span class="o">)</span> ...
</span></span><span class="line"><span class="cl">Processing triggers <span class="k">for</span> man-db <span class="o">(</span>2.10.2-1<span class="o">)</span> ...
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®é™…ä¸­çš„æ€§èƒ½ä¼˜åŒ–">å®é™…ä¸­çš„æ€§èƒ½ä¼˜åŒ–</h3>
<ul>
<li>
<p>ä½ ä»¬é‡åˆ°çš„å¤§éƒ¨åˆ†æƒ…å†µ</p>
<ul>
<li>
<p>äºŒå…«å®šå¾‹ï¼š80% çš„æ—¶é—´æ¶ˆè€—åœ¨éå¸¸é›†ä¸­çš„å‡ å¤„ä»£ç </p>
</li>
<li>
<p><code>L1 (pmm)</code>: å°å†…å­˜åˆ†é…æ—¶çš„ <code>lock contention</code></p>
<ul>
<li><code>profiler</code> ç›´æ¥å¸®ä½ è§£å†³é—®é¢˜</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>å·¥ä¸šç•Œé‡åˆ°çš„å¤§éƒ¨åˆ†æƒ…å†µ
<ul>
<li>æœ¨æ¡¶æ•ˆåº”ï¼šæ¯ä¸ªéƒ¨åˆ†éƒ½å·²ç» tune åˆ°å±€éƒ¨æœ€ä¼˜äº†
<ul>
<li>å‰©ä¸‹çš„éƒ¨åˆ†è¦ä¹ˆ profiler ä¿¡æ¯ä¸å®Œæ•´ï¼Œè¦ä¹ˆå°±ä¸å¥½è§£å†³</li>
<li>(å·¥ç¨‹å¸ˆæ•´å¤©éƒ½å¯¹ç€ profiler çœ‹å¾—å¤´éƒ½å¤§äº†)</li>
<li><a href="https://cacm.acm.org/magazines/2016/6/202665-the-flame-graph/fulltext" target="_blank" rel="noopener noreffer">The flame graphï¼ˆç«ç„°å›¾ï¼‰</a> (CACM'16)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="model-checkerverifier">Model Checker/Verifier</h2>
<h3 id="model-checker-çš„å¨åŠ›å¤§å®¶å·²ç»çŸ¥é“äº†">Model Checker çš„å¨åŠ›å¤§å®¶å·²ç»çŸ¥é“äº†</h3>
<ul>
<li>
<p>150 è¡Œä»£ç çš„ <a href="https://jyywiki.cn/pages/OS/2022/demos/model-checker.py" target="_blank" rel="noopener noreffer">model-checker.py</a></p>
<ul>
<li>
<p>è¯å®Œæ‰€æœ‰ã€Šæ“ä½œç³»ç»Ÿã€‹è¯¾ä¸Šæ¶‰åŠçš„å¹¶å‘ç¨‹åº</p>
</li>
<li>
<p>å¤ç° OSTEP æ•™ç§‘ä¹¦ä¸Šçš„å¹¶å‘ bug (æ¡ä»¶å˜é‡é”™è¯¯å”¤é†’)</p>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>
<p>ä¸€äº›çœŸæ­£çš„ model checkers</p>
<ul>
<li>
<p><a href="https://lamport.azurewebsites.net/tla/tla.html" target="_blank" rel="noopener noreffer">TLA+</a> by Leslie Lamport;</p>
</li>
<li>
<p><a href="https://ti.arc.nasa.gov/tech/rse/vandv/jpf/" target="_blank" rel="noopener noreffer">Java PathFinder (JFP)</a> å’Œ<a href="http://spinroot.com/" target="_blank" rel="noopener noreffer">SPIN</a></p>
<ul>
<li>å®ƒä»¬éƒ½å–œæ¬¢ç”¨ Peterson ç®—æ³•åš tutorial ğŸ˜</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="model-checker-ä¸ä»…æ˜¯å¹¶å‘">Model Checker: ä¸ä»…æ˜¯å¹¶å‘</h3>
<ul>
<li>ä»»ä½• â€œ<code>non-deterministic</code>â€ çš„çŠ¶æ€æœºéƒ½å¯ä»¥æ£€æŸ¥</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">u32</span> <span class="n">x</span> <span class="o">=</span> <span class="n">rdrand</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">u32</span> <span class="n">y</span> <span class="o">=</span> <span class="n">rdrand</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">65</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">bug</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">assert</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span> <span class="c1">// å¯èƒ½ç©ºæŒ‡é’ˆå—ï¼Ÿ
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ›´é«˜æ•ˆçš„ <code>Model Checker</code>: â€œå°†ç›¸ä¼¼çŠ¶æ€åˆå¹¶â€
<ul>
<li><a href="https://dl.acm.org/doi/10.5555/1855741.1855756" target="_blank" rel="noopener noreffer">KLEE: Unassisted and automatic generation of high-coverage tests for complex systems programs</a> (OSDI'08, Best Paper ğŸ…)</li>
<li>åŸºäº <code>LLVM bitcode</code> è§£é‡Šå™¨å®ç°</li>
</ul>
</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<ul>
<li>æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜
<ul>
<li><strong>Q</strong>: çŠ¶æ€æœºçš„è§†è§’ç»™äº†æˆ‘ä»¬ä»€ä¹ˆï¼Ÿ</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>
<p>Take-away messages</p>
<ul>
<li>
<p>ç¼–ç¨‹ (çŠ¶æ€æœº) å°±æ˜¯å…¨ä¸–ç•Œ</p>
</li>
<li>
<p>çŠ¶æ€æœºå¯ä»¥å¸®æˆ‘ä»¬</p>
<ul>
<li>å»ºç«‹ç‰©ç†ä¸–ç•Œçš„å…¬ç†ä½“ç³»
<ul>
<li>ç†è§£è°ƒè¯•å™¨ã€<code>Trace, profiler</code></li>
<li>è‡ªåŠ¨åˆ†æç¨‹åºçš„æ‰§è¡Œ (<code>model checker</code>)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><b>å£°æ˜ï¼šæœ¬æ–‡ç« å¼•ç”¨èµ„æ–™ä¸å›¾åƒå‡å·²åšæ ‡æ³¨ï¼Œå¦‚æœ‰ä¾µæƒæœ¬äººä¼šé©¬ä¸Šåˆ é™¤</b></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info"><div class="post-info-tag"><span><a href="/tags/operating-system/">Operating System</a>
                </span><span><a href="/tags/linux/">Linux</a>
                </span></div><div class="post-info-line"><div class="post-info-mod">
                <span>æ›´æ–°äº 2023-03-28</span>
            </div><div class="post-info-mod"></div>
        </div><div class="post-info-share">
            <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter10/" data-title="Operating System Chapter10 çŠ¶æ€æœºæ¨¡å‹çš„åº”ç”¨" data-hashtags="Operating System,Linux"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter10/" data-hashtag="Operating System"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Linkedin" data-sharer="linkedin" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter10/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° WhatsApp" data-sharer="whatsapp" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter10/" data-title="Operating System Chapter10 çŠ¶æ€æœºæ¨¡å‹çš„åº”ç”¨" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter10/" data-title="Operating System Chapter10 çŠ¶æ€æœºæ¨¡å‹çš„åº”ç”¨"><i class="fab fa-line fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter10/" data-title="Operating System Chapter10 çŠ¶æ€æœºæ¨¡å‹çš„åº”ç”¨"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Myspace" data-sharer="myspace" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter10/" data-title="Operating System Chapter10 çŠ¶æ€æœºæ¨¡å‹çš„åº”ç”¨" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Blogger" data-sharer="blogger" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter10/" data-title="Operating System Chapter10 çŠ¶æ€æœºæ¨¡å‹çš„åº”ç”¨" data-description=""><i class="fab fa-blogger fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° ç™¾åº¦" data-sharer="baidu" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter10/" data-title="Operating System Chapter10 çŠ¶æ€æœºæ¨¡å‹çš„åº”ç”¨"><i data-svg-src="/lib/simple-icons/icons/baidu.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Evernote" data-sharer="evernote" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter10/" data-title="Operating System Chapter10 çŠ¶æ€æœºæ¨¡å‹çš„åº”ç”¨"><i class="fab fa-evernote fa-fw"></i></a></span>
        </div></div><div class="post-nav"><a href="/posts/operating-system/operating-system-chapter9/" class="prev" rel="prev" title="Operating System Chapter9 æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹"><i class="fas fa-angle-left fa-fw"></i>Previous Post</a>
            <a href="/posts/operating-system/support3/" class="next" rel="next" title="æ“ä½œç³»ç»Ÿâ€”â€”å†…å­˜ç®¡ç†">Next Post<i class="fas fa-angle-right fa-fw"></i></a></div></div>
</div></article></div>
            </main>
            <footer class="footer"><div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.105.0">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/khusika/FeelIt" target="_blank" rel="noopener noreffer" title="FeelIt 1.0.1"><i class="fas fa-hand-holding-heart fa-fw"></i> FeelIt</a>
        </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/Jungle430">Jungle</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
</div>
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker
        .register('/sw.min.js?version=0.0.1', { scope: '/' })
        .then(() => {
            console.info('Jungle\u0027s Blog\u00A0Service Worker Registered');
        }, err => console.error('Jungle\u0027s Blog\u00A0Service Worker registration failed: ', err));

    navigator.serviceWorker
        .ready
        .then(() => {
            console.info('Jungle\u0027s Blog\u00A0Service Worker Ready');
        });
}
</script>
</footer>
        </div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-chevron-up fa-fw"></i>
            </a></div><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.fill%2CArray.prototype.find%2CArray.from%2CIntersectionObserver%2CMath.sign%2CObject.assign%2CPromise%2CObject.entries%2Chtml5shiv%2CObject.values%2Cfetch%2CElement.prototype.after"></script><script src="/lib/autocomplete/autocomplete.min.js"></script><script src="/lib/lunr/lunr.min.js"></script><script src="/lib/lunr/lunr.stemmer.support.min.js"></script><script src="/lib/lunr/lunr.zh.min.js"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script src="/lib/katex/katex.min.js"></script><script src="/lib/katex/auto-render.min.js"></script><script src="/lib/katex/copy-tex.min.js"></script><script src="/lib/katex/mhchem.min.js"></script><script>window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":100},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":50}};</script><script src="/js/theme.min.js"></script></body></html>
