<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Operating System Chapter9 æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹ - Jungle&#39;s Blog</title><meta name="description" content="Welcome to Jungle&#39;s blog."><meta property="og:title" content="Operating System Chapter9 æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹" />
<meta property="og:description" content="Operating System $Nanjing\ University\rightarrow Yanyan\ Jiang\newline$ Overview å¤ä¹  å¹¶å‘â€¦â€¦å°±è¿™ä¹ˆâ€¦â€¦è®²å®Œäº†â€¦â€¦ ç†è§£çš„æ–¹å¼ï¼šâ€œç©ä¸€ç©â€ ç¤ºä¾‹ä»£ç  æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜ Q: å¬è¯´æ“ä½œç³»ç»Ÿä¹Ÿæ˜¯ç¨‹åºã€‚é‚£åˆ°åº•æ˜¯é¸¡ç”Ÿè›‹è¿˜æ˜¯è›‹ç”Ÿé¸¡" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Jungle430.github.io/posts/operating-system/operating-system-chapter9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-25T23:21:44+08:00" />
<meta property="article:modified_time" content="2023-03-25T23:21:44+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Operating System Chapter9 æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹"/>
<meta name="twitter:description" content="Operating System $Nanjing\ University\rightarrow Yanyan\ Jiang\newline$ Overview å¤ä¹  å¹¶å‘â€¦â€¦å°±è¿™ä¹ˆâ€¦â€¦è®²å®Œäº†â€¦â€¦ ç†è§£çš„æ–¹å¼ï¼šâ€œç©ä¸€ç©â€ ç¤ºä¾‹ä»£ç  æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜ Q: å¬è¯´æ“ä½œç³»ç»Ÿä¹Ÿæ˜¯ç¨‹åºã€‚é‚£åˆ°åº•æ˜¯é¸¡ç”Ÿè›‹è¿˜æ˜¯è›‹ç”Ÿé¸¡"/>
<meta name="application-name" content="Jungle&#39;s blog">
<meta name="apple-mobile-web-app-title" content="Jungle&#39;s blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://Jungle430.github.io/posts/operating-system/operating-system-chapter9/" /><link rel="prev" href="https://Jungle430.github.io/posts/operating-system/operating-system-chapter8/" /><link rel="next" href="https://Jungle430.github.io/posts/operating-system/operating-system-chapter10/" /><link rel="stylesheet" href="/css/page.min.css"><link rel="stylesheet" href="/css/home.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Operating System Chapter9 æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/Jungle430.github.io\/posts\/operating-system\/operating-system-chapter9\/"
        },"genre": "posts","keywords": "Operating System","wordcount":  4548 ,
        "url": "https:\/\/Jungle430.github.io\/posts\/operating-system\/operating-system-chapter9\/","datePublished": "2023-03-25T23:21:44+08:00","dateModified": "2023-03-25T23:21:44+08:00","publisher": {
            "@type": "Organization",
            "name": "Jungle"},"author": {
                "@type": "Person",
                "name": "Jungle"
            },"description": ""
    }
    </script></head><body data-header-desktop="fixed" data-header-mobile="auto"><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Jungle&#39;s Blog">Jungle&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/">ğŸ“š æ–‡ç«  </a><a class="menu-item" href="/tags/">ğŸ·ï¸ æ ‡ç­¾ </a><a class="menu-item" href="/categories/">ğŸ—ƒï¸ åˆ†ç±» </a><a class="menu-item" href="/about/">ğŸ‘´ å…³äº </a><a class="menu-item" href="https://github.com/Jungle430" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Jungle&#39;s Blog">Jungle&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">ğŸ“šæ–‡ç« </a><a class="menu-item" href="/tags/" title="">ğŸ·ï¸æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">ğŸ—ƒï¸åˆ†ç±»</a><a class="menu-item" href="/about/" title="">ğŸ‘´å…³äº</a><a class="menu-item" href="https://github.com/Jungle430" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><div class="menu-item"><a href="javascript:void(0);" class="theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single" data-toc="enable"><div class="single-card" ><h2 class="single-title animated flipInX">Operating System Chapter9 æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹</h2><div class="post-meta">
                <div class="post-meta-line"><span class="post-author"><a href="https://github.com/Jungle430" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Jungle</a></span>&nbsp;<span class="post-category">å‡ºç‰ˆäº  <a href="/categories/operating-system/"><i class="far fa-folder fa-fw"></i>Operating System</a></span></div>
                <div class="post-meta-line"><span><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2023-03-25">2023-03-25</time></span>&nbsp;<span><i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 4548 å­—</span>&nbsp;
                    <span><i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 10 åˆ†é’Ÿ</span>&nbsp;</div>
            </div>
            
            <hr><div class="details toc" id="toc-static"  data-kept="">
                    <div class="details-summary toc-title">
                        <span>ç›®å½•</span>
                        <span><i class="details-icon fas fa-angle-right"></i></span>
                    </div>
                    <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#è‡ªå·±åŠ¨æ‰‹å†™æ“ä½œç³»ç»Ÿ">è‡ªå·±åŠ¨æ‰‹å†™æ“ä½œç³»ç»Ÿ</a>
      <ul>
        <li><a href="#æ—¶äº‹çƒ­è¯„">æ—¶äº‹çƒ­è¯„</a></li>
        <li><a href="#æœ¬å­¦æœŸçš„-oslabs">æœ¬å­¦æœŸçš„ OSLabs</a></li>
        <li><a href="#å¤§å­¦çš„çœŸæ­£æ„ä¹‰">å¤§å­¦çš„çœŸæ­£æ„ä¹‰</a></li>
        <li><a href="#ä¾‹å­">ä¾‹å­</a></li>
      </ul>
    </li>
    <li><a href="#ç¡¬ä»¶å’Œè½¯ä»¶çš„æ¡¥æ¢">ç¡¬ä»¶å’Œè½¯ä»¶çš„æ¡¥æ¢</a>
      <ul>
        <li><a href="#c-ç¨‹åº">C ç¨‹åº</a></li>
        <li><a href="#bare-metal-ä¸ç¨‹åºå‘˜çš„çº¦å®š">Bare-metal ä¸ç¨‹åºå‘˜çš„çº¦å®š</a></li>
        <li><a href="#x86-family-cpu-reset-è¡Œä¸º">x86 Family: CPU Reset è¡Œä¸º</a></li>
        <li><a href="#cpu-reset-ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆ">CPU Reset ä¹‹åï¼šå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</a></li>
        <li><a href="#legacy-bios-çº¦å®š">Legacy BIOS: çº¦å®š</a></li>
        <li><a href="#èƒ½ä¸èƒ½çœ‹ä¸€ä¸‹ä»£ç ">èƒ½ä¸èƒ½çœ‹ä¸€ä¸‹ä»£ç ï¼Ÿ</a></li>
        <li><a href="#è°ƒè¯•-qemu-ç¡®è®¤-firmware-çš„è¡Œä¸º">è°ƒè¯• QEMU: ç¡®è®¤ Firmware çš„è¡Œä¸º</a></li>
        <li><a href="#é¸¡å’Œè›‹çš„é—®é¢˜è§£å†³">é¸¡å’Œè›‹çš„é—®é¢˜è§£å†³</a></li>
        <li><a href="#å°æ’æ›²firmware-çš„ç—…æ¯’-1998">å°æ’æ›²ï¼šFirmware çš„ç—…æ¯’ (1998)</a></li>
        <li><a href="#ä»Šå¤©çš„-firmware-uefi">ä»Šå¤©çš„ Firmware: UEFI</a></li>
        <li><a href="#uefi-ä¸Šçš„æ“ä½œç³»ç»ŸåŠ è½½">UEFI ä¸Šçš„æ“ä½œç³»ç»ŸåŠ è½½</a></li>
      </ul>
    </li>
    <li><a href="#æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹">æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹</a>
      <ul>
        <li><a href="#æ“ä½œç³»ç»Ÿ-çš„çŠ¶æ€æœºå·²ç»å¯åŠ¨">â€œæ“ä½œç³»ç»Ÿâ€ çš„çŠ¶æ€æœºå·²ç»å¯åŠ¨</a></li>
        <li><a href="#æ“ä½œç³»ç»Ÿæ˜¯ä¸ª-c-ç¨‹åº">æ“ä½œç³»ç»Ÿï¼šæ˜¯ä¸ª C ç¨‹åº</a></li>
        <li><a href="#abstractmachine-å¯¹-c-ç¨‹åºè¯­ä¹‰-åšå‡ºçš„æ‰©å……">AbstractMachine å¯¹ â€œC ç¨‹åºè¯­ä¹‰â€ åšå‡ºçš„æ‰©å……</a></li>
      </ul>
    </li>
    <li><a href="#rtfsc-æ—¶é—´">RTFSC æ—¶é—´</a>
      <ul>
        <li><a href="#0-ç”Ÿæˆé•œåƒå’Œå¯åŠ¨è™šæ‹Ÿæœº">(0) ç”Ÿæˆé•œåƒå’Œå¯åŠ¨è™šæ‹Ÿæœº</a></li>
        <li><a href="#0-ç”Ÿæˆé•œåƒå’Œå¯åŠ¨è™šæ‹Ÿæœº-contd">(0) ç”Ÿæˆé•œåƒå’Œå¯åŠ¨è™šæ‹Ÿæœº (cont&rsquo;d)</a></li>
        <li><a href="#0-ç”Ÿæˆé•œåƒå’Œå¯åŠ¨è™šæ‹Ÿæœº-contd-1">(0) ç”Ÿæˆé•œåƒå’Œå¯åŠ¨è™šæ‹Ÿæœº (cont&rsquo;d)</a></li>
        <li><a href="#1-å¯åŠ¨åŠ è½½å™¨-boot-loader">(1) å¯åŠ¨åŠ è½½å™¨ (Boot Loader)</a></li>
      </ul>
    </li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
  </ul>
</nav></div>
                </div><div class="content" id="content"><h1 id="operating-system">Operating System</h1>
<p>$Nanjing\ University\rightarrow Yanyan\ Jiang\newline$</p>
<h2 id="overview">Overview</h2>
<p>å¤ä¹ </p>
<ul>
<li>å¹¶å‘â€¦â€¦å°±è¿™ä¹ˆâ€¦â€¦è®²å®Œäº†â€¦â€¦
<ul>
<li>ç†è§£çš„æ–¹å¼ï¼šâ€œç©ä¸€ç©â€ ç¤ºä¾‹ä»£ç </li>
</ul>
</li>
</ul>
<hr>
<p>æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜</p>
<ul>
<li><strong>Q</strong>: å¬è¯´æ“ä½œç³»ç»Ÿä¹Ÿæ˜¯ç¨‹åºã€‚é‚£åˆ°åº•æ˜¯é¸¡ç”Ÿè›‹è¿˜æ˜¯è›‹ç”Ÿé¸¡ï¼Ÿ</li>
</ul>
<hr>
<p>æœ¬æ¬¡è¯¾ä¸»è¦å†…å®¹</p>
<ul>
<li>è½¯ä»¶å’Œç¡¬ä»¶çš„æ¡¥æ¢</li>
<li>æ“ä½œç³»ç»Ÿçš„åŠ è½½å’Œåˆå§‹åŒ–</li>
<li>AbstractMachine ä»£ç å¯¼è¯»</li>
</ul>
<h2 id="è‡ªå·±åŠ¨æ‰‹å†™æ“ä½œç³»ç»Ÿ">è‡ªå·±åŠ¨æ‰‹å†™æ“ä½œç³»ç»Ÿ</h2>
<h3 id="æ—¶äº‹çƒ­è¯„">æ—¶äº‹çƒ­è¯„</h3>
<p><a href="https://www.bilibili.com/video/BV14T4y1D7y8" target="_blank" rel="noopener noreffer">å°å­¦ç”Ÿå†™äº†ä¸‰ä¸ªæœˆçš„æ“ä½œç³»ç»Ÿæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</a></p>
<ul>
<li>çœ‹åˆ° i386 å°±çŸ¥é“äº†å˜›</li>
</ul>
<h3 id="æœ¬å­¦æœŸçš„-oslabs">æœ¬å­¦æœŸçš„ OSLabs</h3>
<p>çƒ­èº«å®éªŒ</p>
<ul>
<li>Lab0 (amgame): ç†Ÿæ‚‰ä»£ç æ¡†æ¶</li>
</ul>
<hr>
<p>æ­£ç»å®éªŒ</p>
<ul>
<li>
<p>Lab1 (pmm): Physical memory management</p>
<ul>
<li>å¤šå¤„ç†å™¨ (bare-metal) ä¸Šçš„ kalloc/free</li>
</ul>
</li>
<li>
<p>Lab2 (kmt): Kernel multi-threading</p>
<ul>
<li>ä¸­æ–­å’Œå¼‚å¸¸é©±åŠ¨çš„ä¸Šä¸‹æ–‡ (çº¿ç¨‹) åˆ‡æ¢</li>
</ul>
</li>
<li>
<p>Lab3 (uproc): User processes</p>
<ul>
<li>è™šæ‹Ÿåœ°å€ç©ºé—´ã€ç”¨æˆ·æ€è¿›ç¨‹å’Œç³»ç»Ÿè°ƒç”¨</li>
</ul>
</li>
<li>
<p>Lab4 (vfs): Virtual file system</p>
<ul>
<li>devfs, procfs, ç®€å•çš„æ–‡ä»¶ç³»ç»Ÿï¼›ELF åŠ è½½å™¨</li>
</ul>
</li>
</ul>
<h3 id="å¤§å­¦çš„çœŸæ­£æ„ä¹‰">å¤§å­¦çš„çœŸæ­£æ„ä¹‰</h3>
<blockquote>
<p>å°†å·²æœ‰çš„çŸ¥è¯†å’Œæ–¹æ³•é‡æ–°æ¶ˆåŒ–ï¼Œä¸ºå¤§å®¶å»ºç«‹å¥½ â€œå°é˜¶â€ï¼Œåœ¨æœ‰é™çš„æ—¶é—´é‡Œè¿…é€Ÿ<font color="red">èµ¶ä¸Šæ•°åå¹´æ¥å»ºç«‹èµ·çš„å­¦ç§‘ä½“ç³»</font></p>
</blockquote>
<hr>
<ul>
<li>
<p>ä¾‹å­ï¼šç ´é™¤ â€œå†™æ“ä½œç³»ç»Ÿå¾ˆéš¾â€ã€â€œå†™æ“ä½œç³»ç»Ÿå¾ˆç‰›â€ çš„é”™è¯¯è®¤è¯†</p>
<ul>
<li>
<p>æ“ä½œç³»ç»ŸçœŸçš„å°±æ˜¯ä¸ª C ç¨‹åº</p>
</li>
<li>
<p>ä½ åªæ˜¯éœ€è¦ â€œè¢«æ­£ç¡®å‘ŠçŸ¥â€ ä¸€äº›é¢å¤–çš„çŸ¥è¯†</p>
<ul>
<li>ç„¶åå†™ä»£ç ã€åƒè‹¦å¤´</li>
<li>ä»è€Œå»ºç«‹æ­£ç¡®çš„ â€œä¸“ä¸šä¸–ç•Œè§‚â€</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="ä¾‹å­">ä¾‹å­</h3>
<ul>
<li>
<p>â€œä¸“ä¸šä¸–ç•Œè§‚â€ çš„ä¾‹å­ (è¿™äº›éƒ½æ²¡å•¥ï¼Œpaper éƒ½å‘ä¸äº†)</p>
<ul>
<li>
<p>å†™ x86 æ¨¡æ‹Ÿå™¨çš„æ—¶å€™ï¼Œä¸çŸ¥é“å“ªæ¡æŒ‡ä»¤é”™äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ</p>
</li>
<li>
<p>åšæ“ä½œç³»ç»Ÿå®éªŒçš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ°ç¥ç§˜ CPU Resetï¼Œæ€ä¹ˆåŠï¼Ÿ</p>
</li>
<li>
<p>åšå®éªŒåšä¸ä¸‹å»çš„æ—¶å€™ï¼Œè¯¥å®ç°ä»€ä¹ˆå·¥å…·ï¼Ÿ</p>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>
<p>â€œä¸“ä¸šä¸–ç•Œè§‚â€ çš„å­¦ä¹ æ–¹æ³•</p>
<ul>
<li>
<p>ç»å…¸ç ”ç©¶è®ºæ–‡ (OSDI, SOSP, ATC, EuroSys, &hellip;)</p>
</li>
<li>
<p>ä¹…ç»è€ƒéªŒçš„ç»å…¸æ•™å­¦ææ–™ (xv6, OSTEP, CSAPP, &hellip;)</p>
</li>
<li>
<p>æµ·é‡çš„å¼€æºå·¥å…· (GNU ç³»åˆ—, qemu, gdb, &hellip;)</p>
</li>
<li>
<p>ç¬¬ä¸‰æ–¹èµ„æ–™ï¼Œæ…ç”¨ (tutorials, osdev wiki, &hellip;)</p>
</li>
</ul>
</li>
</ul>
<h2 id="ç¡¬ä»¶å’Œè½¯ä»¶çš„æ¡¥æ¢">ç¡¬ä»¶å’Œè½¯ä»¶çš„æ¡¥æ¢</h2>
<h3 id="c-ç¨‹åº">C ç¨‹åº</h3>
<ul>
<li>
<p>æˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•å†™ä¸€ä¸ª â€œæœ€å°â€ çš„ C ç¨‹åºäº†ï¼š</p>
<ul>
<li>
<p><a href="https://jyywiki.cn/pages/OS/2022/demos/minimal.S" target="_blank" rel="noopener noreffer">minimal.S</a></p>
</li>
<li>
<p>ä¸éœ€è¦é“¾æ¥ä»»ä½•åº“ï¼Œå°±èƒ½åœ¨æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œ</p>
</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/syscall.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="n">globl</span> <span class="n">_start</span>
</span></span><span class="line"><span class="cl"><span class="nl">_start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="n">SYS_write</span><span class="p">,</span> <span class="o">%</span><span class="n">rax</span>   <span class="c1">// write(
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">movq</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span>         <span class="o">%</span><span class="n">rdi</span>   <span class="c1">//   fd=1,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">movq</span> <span class="err">$</span><span class="n">st</span><span class="p">,</span>        <span class="o">%</span><span class="n">rsi</span>   <span class="c1">//   buf=st,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">movq</span> <span class="err">$</span><span class="p">(</span><span class="n">ed</span> <span class="o">-</span> <span class="n">st</span><span class="p">),</span> <span class="o">%</span><span class="n">rdx</span>   <span class="c1">//   count=ed-st
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">syscall</span>                 <span class="c1">// );
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">movq</span> <span class="err">$</span><span class="n">SYS_exit</span><span class="p">,</span>  <span class="o">%</span><span class="n">rax</span>   <span class="c1">// exit(
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">movq</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span>         <span class="o">%</span><span class="n">rdi</span>   <span class="c1">//   status=1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">syscall</span>                 <span class="c1">// );
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nl">st</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="n">ascii</span> <span class="s">&#34;</span><span class="se">\033</span><span class="s">[01;31mHello, OS World</span><span class="se">\033</span><span class="s">[0m</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nl">ed</span><span class="p">:</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>â€œç¨‹åº = çŠ¶æ€æœºâ€ æ²¡é—®é¢˜</p>
</li>
<li>
<p>å¸¦æ¥æ›´å¤šçš„ç–‘é—®</p>
<ul>
<li><font color="red">ä½†è°åˆ›å»ºçš„è¿™ä¸ªçŠ¶æ€æœºï¼Ÿï¼Ÿï¼Ÿ</font>
<ul>
<li>å½“ç„¶æ˜¯æ“ä½œç³»ç»Ÿäº†â€¦â€¦å‘ƒâ€¦â€¦ $\Longrightarrow$ å‚è€ƒ<a href="https://jungle430.github.io/posts/operating-system/support2/#%E4%BB%8E%E6%88%91%E4%BB%AC%E7%BB%88%E7%AB%AF%E6%95%B2%E5%9B%9E%E8%BD%A6%E5%88%B0%E7%A8%8B%E5%BA%8F%E8%A2%AB%E8%BD%BD%E5%85%A5%E6%89%A7%E8%A1%8C%E7%9A%84%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88" target="_blank" rel="noopener noreffer">ä»æˆ‘ä»¬ç»ˆç«¯æ•²å›è½¦åˆ°ç¨‹åºè¢«è½½å…¥æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</a></li>
</ul>
</li>
<li><font color="red">è¿™ä¸ªç¨‹åºå¯ä»¥åœ¨æ²¡æœ‰æ“ä½œç³»ç»Ÿçš„ç¡¬ä»¶ä¸Šè¿è¡Œå—ï¼Ÿ</font>
<ul>
<li>â€œå¯åŠ¨â€ çŠ¶æ€æœºæ˜¯ç”± â€œåŠ è½½å™¨â€ å®Œæˆçš„</li>
<li>åŠ è½½å™¨ä¹Ÿæ˜¯ä¸€æ®µç¨‹åº (çŠ¶æ€æœº)</li>
<li>è¿™ä¸ªç¨‹åºç”±æ˜¯ç”±è°åŠ è½½çš„ï¼Ÿ</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-<span class="o">[</span>~/chapter9<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ file minimal
</span></span><span class="line"><span class="cl">minimal: ELF 64-bit LSB executable, x86-64, version <span class="m">1</span> <span class="o">(</span>SYSV<span class="o">)</span>, statically linked, not stripped
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="bare-metal-ä¸ç¨‹åºå‘˜çš„çº¦å®š">Bare-metal ä¸ç¨‹åºå‘˜çš„çº¦å®š</h3>
<ul>
<li>
<p>è®¡ç®—æœºç¡¬ä»¶è¿è¡Œçš„æ—¶å€™ä¹Ÿæ˜¯çŠ¶æ€æœº</p>
</li>
<li>
<p>ä¸ºäº†è®©è®¡ç®—æœºèƒ½<font color="red">è¿è¡Œä»»ä½•æˆ‘ä»¬çš„ç¨‹åº</font>ï¼Œä¸€å®šå­˜åœ¨è½¯ä»¶/ç¡¬ä»¶çš„çº¦å®š</p>
</li>
</ul>
<hr>
<ul>
<li>
<p><b>CPU reset</b> åï¼Œå¤„ç†å™¨å¤„äºæŸä¸ª<b>ç¡®å®šçš„çŠ¶æ€</b></p>
<ul>
<li><b>PC æŒ‡é’ˆ</b>ä¸€èˆ¬æŒ‡å‘ä¸€æ®µ <font color="blue">memory-mapped ROM</font>
<ul>
<li>ROM å­˜å‚¨äº†å‚å•†æä¾›çš„ firmware (å›ºä»¶)</li>
</ul>
</li>
<li>å¤„ç†å™¨çš„å¤§éƒ¨åˆ†ç‰¹æ€§å¤„äºå…³é—­çŠ¶æ€
<ul>
<li>ç¼“å­˜ã€è™šæ‹Ÿå­˜å‚¨ã€â€¦â€¦</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Firmware (å›ºä»¶ï¼Œå‚å•†æä¾›çš„ä»£ç )</p>
<ul>
<li>å°†ç”¨æˆ·æ•°æ®åŠ è½½åˆ°å†…å­˜
<ul>
<li>ä¾‹å¦‚å­˜å‚¨ä»‹è´¨ä¸Šçš„ç¬¬äºŒçº§ loader (åŠ è½½å™¨)</li>
<li>æˆ–è€…ç›´æ¥åŠ è½½æ“ä½œç³»ç»Ÿ (åµŒå…¥å¼ç³»ç»Ÿ)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="x86-family-cpu-reset-è¡Œä¸º">x86 Family: CPU Reset è¡Œä¸º</h3>
<ul>
<li>
<p>CPU Reset (<a href="https://software.intel.com/en-us/articles/intel-sdm" target="_blank" rel="noopener noreffer">IntelÂ® 64 and IA-32 Architectures Software Developerâ€™s Manual</a>, Volume 3A/3B)</p>
</li>
<li>
<p>å¯„å­˜å™¨ä¼šæœ‰åˆå§‹çŠ¶æ€</p>
<ul>
<li>
<p><code>EIP = 0x0000fff0</code></p>
</li>
<li>
<p><code>CR0 = 0x60000010</code></p>
<ul>
<li>16-bit æ¨¡å¼ $\Longrightarrow$ 2010å¹´å‰çš„è€ç”µè„‘ä¼šå…¼å®¹è€æ¥å£å’Œè€çš„æ“ä½œç³»ç»Ÿ</li>
</ul>
</li>
<li>
<p><code>EFLAGS = 0x00000002</code></p>
</li>
<li>
<p>interrupt disabledï¼ˆä¸­æ–­å…³é—­ï¼‰</p>
</li>
</ul>
</li>
<li>
<p>TFM (5,000 é¡µ by 2019)</p>
<ul>
<li>æœ€éœ€è¦çš„ Volume 3A åªæœ‰ 468 é¡µ</li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter9-1.png" title="/img/Operating System/chapter9-1.png" data-thumbnail="/img/Operating System/chapter9-1.png" data-sub-html="<h2>friendly manual</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/chapter9-1.png"
            data-srcset="/img/Operating%20System/chapter9-1.png, /img/Operating%20System/chapter9-1.png 1.5x, /img/Operating%20System/chapter9-1.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/chapter9-1.png" />
    </a><figcaption class="image-caption"><code>friendly manual</code></figcaption>
    </figure>
<ul>
<li>è®©<code>qemu</code>æ¨¡æ‹Ÿå™¨åœåœ¨ç¬¬ä¸€æ¡æŒ‡ä»¤ä¸Šï¼Œå’Œä¸Šé¢çš„æ‰‹å†Œå¯¹ç…§ï¼Œä¼šå‘ç°å’Œæ‰‹å†Œä¸€è‡´</li>
</ul>
<h3 id="cpu-reset-ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆ">CPU Reset ä¹‹åï¼šå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h3>
<ul>
<li>
<p>ã€Šè®¡ç®—æœºç³»ç»ŸåŸºç¡€ã€‹ï¼š<font color="red">ä¸ä»…æ˜¯ç¨‹åºï¼Œæ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿä¹Ÿæ˜¯ä¸€ä¸ªçŠ¶æ€æœº</font></p>
<ul>
<li>
<p>ä» PC (<code>CS:IP</code>) æŒ‡é’ˆå¤„å–æŒ‡ä»¤ã€è¯‘ç ã€æ‰§è¡Œâ€¦â€¦</p>
</li>
<li>
<p>ä» firmware å¼€å§‹æ‰§è¡Œ</p>
<ul>
<li><code>ffff0</code>(PCåˆå§‹åŒ–çš„å€¼) é€šå¸¸æ˜¯ä¸€æ¡å‘ firmware è·³è½¬çš„ jmp æŒ‡ä»¤</li>
</ul>
</li>
</ul>
</li>
<li>
<p>å‚å•†ä¼šåœ¨<code>ROW</code>é‡Œé¢æ”¾å¥½å†™æ­»çš„ä»£ç ï¼ˆOnly-readï¼‰</p>
</li>
<li>
<p>Firmware: <a href="https://www.zhihu.com/question/21672895" target="_blank" rel="noopener noreffer">BIOS vs. UEFI</a></p>
<ul>
<li>
<p>éƒ½æ˜¯ä¸»æ¿/ä¸»æ¿ä¸Šå¤–æ’è®¾å¤‡çš„è½¯ä»¶æŠ½è±¡</p>
<ul>
<li>æ”¯æŒç³»ç»Ÿç®¡ç†ç¨‹åºè¿è¡Œ</li>
</ul>
</li>
<li>
<p>Legacy BIOS (Basic I/O System)</p>
</li>
<li>
<p>UEFI (Unified Extensible Firmware Interface)</p>
</li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter9-2.png" title="/img/Operating System/chapter9-2.png" data-thumbnail="/img/Operating System/chapter9-2.png" data-sub-html="<h2>BIOS</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/chapter9-2.png"
            data-srcset="/img/Operating%20System/chapter9-2.png, /img/Operating%20System/chapter9-2.png 1.5x, /img/Operating%20System/chapter9-2.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/chapter9-2.png" />
    </a><figcaption class="image-caption"><code>BIOS</code></figcaption>
    </figure>
<h3 id="legacy-bios-çº¦å®š">Legacy BIOS: çº¦å®š</h3>
<p><b>Firmware å¿…é¡»æä¾›æœºåˆ¶ï¼Œå°†ç”¨æˆ·æ•°æ®è½½å…¥å†…å­˜</b></p>
<div class="mermaid" id="id-1"></div>
<ul>
<li>
<p>Legacy BIOS æŠŠ<b>ç¬¬ä¸€ä¸ªå¯å¼•å¯¼è®¾å¤‡çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºåŠ è½½åˆ°ç‰©ç†å†…å­˜çš„ <code>7c00</code> ä½ç½®</b>ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬Firewareå’ŒOSä¹‹é—´çš„ç¬¬ä¸€æ¬¡ï¼Œä¹Ÿæ˜¯å”¯ä¸€ä¸€æ¬¡æ¡æ‰‹</p>
<ul>
<li>
<p>æ­¤æ—¶å¤„ç†å™¨å¤„äº 16-bit æ¨¡å¼</p>
</li>
<li>
<p>è§„å®š <code>CS:IP = 0x7c00</code>, <code>(R[CS] &lt;&lt; 4) | R[IP] == 0x7c00</code></p>
<ul>
<li>
<p>å¯èƒ½æ€§1ï¼š<code>CS = 0x07c0, IP = 0</code></p>
</li>
<li>
<p>å¯èƒ½æ€§2ï¼š<code>CS = 0, IP = 0x7c00</code></p>
</li>
</ul>
</li>
<li>
<p>å…¶ä»–æ²¡æœ‰ä»»ä½•çº¦æŸ</p>
</li>
</ul>
</li>
<li>
<p>Windowså¯åŠ¨æ¨¡å¼ï¼šè€çš„Windowsçš„Aï¼ŒBç›˜éƒ½æ˜¯è½¯ç›˜ï¼ŒBIOSå…ˆå»è½¯ç›˜é‡Œé¢è¯»å‰512ä¸ª<code>bytes</code>ï¼Œçœ‹æœ€åä¸¤ä¸ªbyteæ˜¯å¦ä¸º<code>55aa</code>ï¼ˆå¤§ç«¯ï¼‰ï¼Œå¦‚æœæ˜¯å°±åŠ è½½è¿™å—ç£ç›˜ï¼Œå¦åˆ™è¯»ä¸‹ä¸€å—ï¼Œå¦‚æœéƒ½ä¸æ˜¯å°±å¯åŠ¨å¤±è´¥ã€‚è¯»å®ŒA/Bç›˜ä¹‹åå¼•å¯¼åˆ°Cç›˜ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä»Šå¤©çš„Windowsæ“ä½œç³»ç»ŸCç›˜æ˜¯ç³»ç»Ÿç›˜çš„åŸå› </p>
</li>
<li>
<p>Firmwareåšçš„äº‹æƒ…ï¼ˆä»¥BIOSä¸ºä¾‹ï¼‰</p>
</li>
</ul>
<div class="mermaid" id="id-2"></div>
<h3 id="èƒ½ä¸èƒ½çœ‹ä¸€ä¸‹ä»£ç ">èƒ½ä¸èƒ½çœ‹ä¸€ä¸‹ä»£ç ï¼Ÿ</h3>
<blockquote>
<p>Talk is cheap. Show me the code. â€”â€”Linus Torvalds</p>
</blockquote>
<ul>
<li>
<p>æœ‰æ²¡æœ‰å¯èƒ½æˆ‘ä»¬çœŸçš„å»çœ‹ä» CPU Reset ä»¥åæ¯ä¸€æ¡æŒ‡ä»¤çš„æ‰§è¡Œï¼Ÿ</p>
</li>
<li>
<p><font color="red">è®¡ç®—æœºç³»ç»Ÿå…¬ç†ï¼šä½ æƒ³åˆ°çš„å°±ä¸€å®šæœ‰äººåšåˆ°</font></p>
</li>
<li>
<p>æ¨¡æ‹Ÿæ–¹æ¡ˆï¼šQEMU</p>
<ul>
<li>ä¼ å¥‡é»‘å®¢ã€å¤©æ‰ç¨‹åºå‘˜ <a href="https://www.zhihu.com/question/28388113" target="_blank" rel="noopener noreffer">Fabrice Bellard</a> çš„æ°ä½œï¼ˆå…¶ä»–:ffmpeg)
<ul>
<li><a href="https://www.usenix.org/legacy/publications/library/proceedings/usenix05/tech/freenix/full_papers/bellard/bellard.pdf" target="_blank" rel="noopener noreffer">QEMU, A fast and portable dynamic translator</a> (USENIX ATC'05)</li>
<li>Android Virtual Device, VirtualBox, &hellip; èƒŒåéƒ½æ˜¯ QEMU</li>
</ul>
</li>
</ul>
</li>
<li>
<p>çœŸæœºæ–¹æ¡ˆï¼šJTAG (Joint Test Action Group) debugger</p>
<ul>
<li>ä¸€ç³»åˆ— (ç‰©ç†) è°ƒè¯•å¯„å­˜å™¨ï¼Œå¯ä»¥å®ç° gdb æ¥å£ (!!!)</li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter9-3.png" title="/img/Operating System/chapter9-3.png" data-thumbnail="/img/Operating System/chapter9-3.png" data-sub-html="<h2>ffmpeg</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/chapter9-3.png"
            data-srcset="/img/Operating%20System/chapter9-3.png, /img/Operating%20System/chapter9-3.png 1.5x, /img/Operating%20System/chapter9-3.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/chapter9-3.png" />
    </a><figcaption class="image-caption"><code>ffmpeg</code></figcaption>
    </figure>
<h3 id="è°ƒè¯•-qemu-ç¡®è®¤-firmware-çš„è¡Œä¸º">è°ƒè¯• QEMU: ç¡®è®¤ Firmware çš„è¡Œä¸º</h3>
<blockquote>
<p>äº²çœ¼ç¡®è®¤ Firmware åˆ°åº•æ˜¯ä¸æ˜¯ä¼šåŠ è½½å¯åŠ¨ç›˜ç¬¬ä¸€ä¸ªæ‰‡åŒºåˆ° <code>0x7c00</code> å†…å­˜ä½ç½®ï¼</p>
</blockquote>
<p>è°ƒè¯• QEMU æ¨¡æ‹Ÿå™¨</p>
<ul>
<li>
<p>æŸ¥çœ‹ CPU Reset åçš„å¯„å­˜å™¨</p>
<ul>
<li><code>info registers</code></li>
</ul>
</li>
<li>
<p>æŸ¥çœ‹<code>0x7c00</code>å†…å­˜çš„åŠ è½½</p>
<ul>
<li><code>watch *0x7c00</code> - ã€Šè®¡ç®—æœºç³»ç»ŸåŸºç¡€ã€‹çš„è‰¯è‹¦ç”¨å¿ƒ</li>
<li>æŸ¥çœ‹å½“å‰æŒ‡ä»¤ <code>x/i ($cs * 16 + $rip)</code></li>
<li>æ‰“å°å†…å­˜ <code>x/16xb 0x7c00</code></li>
</ul>
</li>
<li>
<p>è¿›å…¥<code>0x7c00</code>ä»£ç çš„æ‰§è¡Œ</p>
<ul>
<li><code>b *0x7c00</code>, <code>c</code> (æ’’èŠ±ï¼æˆ‘ä»¬ä¸€ä¼šå†å›æ¥)</li>
</ul>
</li>
</ul>
<h3 id="é¸¡å’Œè›‹çš„é—®é¢˜è§£å†³">é¸¡å’Œè›‹çš„é—®é¢˜è§£å†³</h3>
<ul>
<li>
<p>æœ‰ä¸ªåŸå§‹çš„é¸¡ï¼šFirmware</p>
<ul>
<li>
<p>ä»£ç ç›´æ¥å­˜åœ¨äºç¡¬ä»¶é‡Œ</p>
</li>
<li>
<p>CPU Reset å Firmware ä¼šæ‰§è¡Œ</p>
<ul>
<li>åŠ è½½ 512 å­—èŠ‚åˆ°å†…å­˜ (Legacy Boot)
<ul>
<li>ç„¶ååŠŸæˆèº«é€€</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Firmware çš„å¦ä¸€ç”¨å¤„</p>
<ul>
<li>æ”¾ç½®ä¸€äº› â€œç»å¯¹å®‰å…¨çš„ä»£ç â€
<ul>
<li><a href="https://jyywiki.cn/pages/OS/manuals/BIOS-interrupts.pdf" target="_blank" rel="noopener noreffer">BIOS ä¸­æ–­</a> (Hello World æ˜¯å¦‚ä½•è¢«æ‰“å°çš„)</li>
<li>å¦‚æœåŠ è½½å¤±è´¥å°†é”™è¯¯ä¿¡æ¯æ‰“å°å‡ºæ¥</li>
<li>ARM Trusted Firmware
<ul>
<li>Boot-Level 1, 2, 3.1, 3.2, 3.3</li>
<li><a href="https://www.denx.de/wiki/U-Boot" target="_blank" rel="noopener noreffer">U-Boot</a>: the universal boot loader</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="å°æ’æ›²firmware-çš„ç—…æ¯’-1998">å°æ’æ›²ï¼šFirmware çš„ç—…æ¯’ (1998)</h3>
<ul>
<li>
<p>Firmware é€šå¸¸æ˜¯åªè¯»çš„ (å½“ç„¶â€¦â€¦)</p>
</li>
<li>
<p>Intel 430TX (Pentium) èŠ¯ç‰‡ç»„å…è®¸<font color="red">å†™å…¥ Flash ROM</font></p>
<ul>
<li>
<p>åªè¦å‘ Flash BIOS å†™å…¥ç‰¹å®šåºåˆ—ï¼ŒFlash ROM å°±å˜ä¸ºå¯å†™</p>
<ul>
<li>ç•™ç»™ firmware æ›´æ–°çš„é€šé“</li>
</ul>
</li>
<li>
<p>è¦å¾—åˆ°è¿™ä¸ªåºåˆ—å…¶å®å¹¶ä¸å›°éš¾</p>
<ul>
<li>ä¼¼ä¹æ–‡æ¡£é‡Œå°±æœ‰ ğŸ¤” Boomâ€¦â€¦</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p><a href="https://zh.wikipedia.org/zh-tw/CIH%E7%97%85%E6%AF%92" target="_blank" rel="noopener noreffer">CIH</a> çš„ä½œè€…é™ˆç›ˆè±ªè¢«é€®æ•ï¼Œä½†å¹¶æœªè¢«å®šç½ª</p>
</blockquote>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter9-4.gif" title="/img/Operating System/chapter9-4.gif" data-thumbnail="/img/Operating System/chapter9-4.gif" data-sub-html="<h2>ç—…æ¯’ä»£ç ç»“å°¾çš„CIH</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/chapter9-4.gif"
            data-srcset="/img/Operating%20System/chapter9-4.gif, /img/Operating%20System/chapter9-4.gif 1.5x, /img/Operating%20System/chapter9-4.gif 2x"
            data-sizes="auto"
            alt="/img/Operating System/chapter9-4.gif" />
    </a><figcaption class="image-caption">ç—…æ¯’ä»£ç ç»“å°¾çš„<code>CIH</code></figcaption>
    </figure>
<h3 id="ä»Šå¤©çš„-firmware-uefi">ä»Šå¤©çš„ Firmware: UEFI</h3>
<ul>
<li>
<p>IBM PC æ‰€æœ‰è®¾å¤‡/BIOS ä¸­æ–­æ˜¯æœ‰ specification çš„ (æˆå°±äº† â€œå…¼å®¹æœºâ€)</p>
</li>
<li>
<p>ä»Šå¤©çš„ boot loader é¢ä¸´éº»çƒ¦å¾—å¤šçš„ç¡¬ä»¶ï¼š</p>
<ul>
<li>æŒ‡çº¹é”ã€ä¸çŸ¥åå‚å•†ç”Ÿäº§ç½‘å¡ä¸Šçš„ç½‘ç»œå¯åŠ¨ã€USB ä¸Šçš„è“ç‰™è½¬æ¥å™¨è¿æ¥çš„è“ç‰™é”®ç›˜ã€â€¦â€¦</li>
</ul>
</li>
</ul>
<figure><a class="lightgallery" href="/img/Operating%20System/chapter9-5.png" title="/img/Operating System/chapter9-5.png" data-thumbnail="/img/Operating System/chapter9-5.png" data-sub-html="<h2>UEFI</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/Operating%20System/chapter9-5.png"
            data-srcset="/img/Operating%20System/chapter9-5.png, /img/Operating%20System/chapter9-5.png 1.5x, /img/Operating%20System/chapter9-5.png 2x"
            data-sizes="auto"
            alt="/img/Operating System/chapter9-5.png" />
    </a><figcaption class="image-caption"><code>UEFI</code></figcaption>
    </figure>
<h3 id="uefi-ä¸Šçš„æ“ä½œç³»ç»ŸåŠ è½½">UEFI ä¸Šçš„æ“ä½œç³»ç»ŸåŠ è½½</h3>
<ul>
<li>
<p>æ ‡å‡†åŒ–çš„åŠ è½½æµç¨‹</p>
<ul>
<li>
<p>ç›˜å¿…é¡»æŒ‰ GPT (GUID Partition Table) æ–¹å¼æ ¼å¼åŒ–</p>
</li>
<li>
<p>é¢„ç•™ä¸€ä¸ª FAT32 åˆ†åŒº (lsblk/fdisk å¯ä»¥çœ‹åˆ°)</p>
</li>
<li>
<p>Firmware åŠ è½½ä»»æ„å¤§å°çš„ PE å¯æ‰§è¡Œæ–‡ä»¶<code>.efi</code></p>
<ul>
<li>
<p>æ²¡æœ‰ legacy boot 512 å­—èŠ‚é™åˆ¶</p>
</li>
<li>
<p>EFI åº”ç”¨å¯ä»¥è¿”å› firmware</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>æ›´å¥½çš„ç¨‹åºæ”¯æŒ</p>
<ul>
<li>
<p>è®¾å¤‡é©±åŠ¨æ¡†æ¶</p>
</li>
<li>
<p>æ›´å¤šçš„åŠŸèƒ½ï¼Œä¾‹å¦‚ Secure Bootï¼Œåªèƒ½å¯åŠ¨ â€œä¿¡ä»»â€ çš„æ“ä½œç³»ç»Ÿ</p>
</li>
</ul>
</li>
</ul>
<h2 id="æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹">æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹</h2>
<h3 id="æ“ä½œç³»ç»Ÿ-çš„çŠ¶æ€æœºå·²ç»å¯åŠ¨">â€œæ“ä½œç³»ç»Ÿâ€ çš„çŠ¶æ€æœºå·²ç»å¯åŠ¨</h3>
<ul>
<li>Firmware å’Œ boot loader å…±åŒå®Œæˆ â€œæ“ä½œç³»ç»Ÿçš„åŠ è½½â€
<ul>
<li>åˆå§‹åŒ–å…¨å±€å˜é‡å’Œæ ˆï¼›åˆ†é…å †åŒº (<code>heap</code>)</li>
<li>ä¸º <code>main</code> å‡½æ•°ä¼ é€’å‚æ•°
<ul>
<li>è°ç»™æ“ä½œç³»ç»Ÿä¼ é€’äº†å‚æ•°ï¼Ÿ</li>
<li>å¦‚ä½•å®ç°å‚æ•°ä¼ é€’ï¼Ÿ</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>
<p>è¿›å…¥ C ä»£ç ä¹‹å</p>
<ul>
<li>
<p>å®Œå…¨éµå¾ª C è¯­è¨€çš„å½¢å¼è¯­ä¹‰</p>
</li>
<li>
<p>ä½†æœ‰ä¸€äº›è¡Œä¸º â€œè¡¥å……â€ â€”â€” AbstractMachine API</p>
</li>
</ul>
</li>
</ul>
<div class="mermaid" id="id-3"></div>
<h3 id="æ“ä½œç³»ç»Ÿæ˜¯ä¸ª-c-ç¨‹åº">æ“ä½œç³»ç»Ÿï¼šæ˜¯ä¸ª C ç¨‹åº</h3>
<ul>
<li>ä¸€ä¸ªè¿·ä½  â€œæ“ä½œç³»ç»Ÿâ€ <a href="https://jyywiki.cn/pages/OS/2022/demos/thread-os.c" target="_blank" rel="noopener noreffer">thread-os.c</a>
<ul>
<li>make ä¼šå¾—åˆ°ä¸€ä¸ª â€œç£ç›˜é•œåƒâ€ï¼Œå¥½åƒé­”æ³•ä¸€æ ·
<ul>
<li>å°±è·Ÿä½ ä»¬ç¬¬ä¸€æ¬¡ç”¨ IDE çš„æ—¶å€™æŒ‰ä¸€ä¸ªé”®å°±å¯ä»¥ç¼–è¯‘è¿è¡Œä¸€æ ·</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">cte_init</span><span class="p">(</span><span class="n">on_interrupt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">LENGTH</span><span class="p">(</span><span class="n">tasks</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Task</span> <span class="o">*</span><span class="n">task</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">Area</span> <span class="n">stack</span>    <span class="o">=</span> <span class="p">(</span><span class="n">Area</span><span class="p">)</span> <span class="p">{</span> <span class="o">&amp;</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">context</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">task</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">task</span><span class="o">-&gt;</span><span class="n">context</span> <span class="o">=</span> <span class="n">kcontext</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">task</span><span class="o">-&gt;</span><span class="n">entry</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">task</span><span class="o">-&gt;</span><span class="n">next</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tasks</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">LENGTH</span><span class="p">(</span><span class="n">tasks</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">mpe_init</span><span class="p">(</span><span class="n">mp_entry</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>thread-os.c</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;am.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;klib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;klib-macros.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define MAX_CPU 8
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">union</span> <span class="n">task</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">union</span> <span class="n">task</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span>      <span class="p">(</span><span class="o">*</span><span class="n">entry</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Context</span>    <span class="o">*</span><span class="n">context</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="kt">uint8_t</span> <span class="n">stack</span><span class="p">[</span><span class="mi">8192</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">Task</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Task</span> <span class="o">*</span><span class="n">currents</span><span class="p">[</span><span class="n">MAX_CPU</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="cp">#define current currents[cpu_current()]
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// user-defined tasks
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">locked</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">lock</span><span class="p">()</span>   <span class="p">{</span> <span class="k">while</span> <span class="p">(</span><span class="n">atomic_xchg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">locked</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">unlock</span><span class="p">()</span> <span class="p">{</span> <span class="n">atomic_xchg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">locked</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">func</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">lock</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Thread-%s on CPU #%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">cpu_current</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">unlock</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="k">volatile</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Task</span> <span class="n">tasks</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="p">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">func</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;B&#34;</span><span class="p">,</span> <span class="p">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">func</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;C&#34;</span><span class="p">,</span> <span class="p">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">func</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;D&#34;</span><span class="p">,</span> <span class="p">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">func</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;E&#34;</span><span class="p">,</span> <span class="p">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">func</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">Context</span> <span class="o">*</span><span class="nf">on_interrupt</span><span class="p">(</span><span class="n">Event</span> <span class="n">ev</span><span class="p">,</span> <span class="n">Context</span> <span class="o">*</span><span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">extern</span> <span class="n">Task</span> <span class="n">tasks</span><span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">current</span><span class="p">)</span> <span class="n">current</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tasks</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>          <span class="n">current</span><span class="o">-&gt;</span><span class="n">context</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">while</span> <span class="p">((</span><span class="n">current</span> <span class="o">-</span> <span class="n">tasks</span><span class="p">)</span> <span class="o">%</span> <span class="n">cpu_count</span><span class="p">()</span> <span class="o">!=</span> <span class="n">cpu_current</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">context</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">mp_entry</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">iset</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">yield</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">cte_init</span><span class="p">(</span><span class="n">on_interrupt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">LENGTH</span><span class="p">(</span><span class="n">tasks</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Task</span> <span class="o">*</span><span class="n">task</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">Area</span> <span class="n">stack</span>    <span class="o">=</span> <span class="p">(</span><span class="n">Area</span><span class="p">)</span> <span class="p">{</span> <span class="o">&amp;</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">context</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">task</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">task</span><span class="o">-&gt;</span><span class="n">context</span> <span class="o">=</span> <span class="n">kcontext</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">task</span><span class="o">-&gt;</span><span class="n">entry</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">task</span><span class="o">-&gt;</span><span class="n">next</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tasks</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">LENGTH</span><span class="p">(</span><span class="n">tasks</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">mpe_init</span><span class="p">(</span><span class="n">mp_entry</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="abstractmachine-å¯¹-c-ç¨‹åºè¯­ä¹‰-åšå‡ºçš„æ‰©å……">AbstractMachine å¯¹ â€œC ç¨‹åºè¯­ä¹‰â€ åšå‡ºçš„æ‰©å……</h3>
<ul>
<li>
<p>TRM + MPE</p>
<ul>
<li>
<p>å®Œå…¨ç­‰åŒäºå¤šçº¿ç¨‹ (å¤„ç†å™¨ç›¸å½“äºçº¿ç¨‹) - L1/native</p>
</li>
<li>
<p>IOE API: å®Œå…¨æ˜¯æ™®é€šçš„åº“å‡½æ•°</p>
<ul>
<li>åŒä¸€è®¾å¤‡çš„æ•°æ®ç«äº‰ = undefined behavior</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>
<p>CTE</p>
<ul>
<li>
<p>å…è®¸åˆ›å»ºå¤šä¸ªæ‰§è¡Œæµ (ç±»æ¯”åç¨‹) - M2</p>
</li>
<li>
<p>yield ä¸»åŠ¨åˆ‡æ¢ï¼›ä¼šè¢«ä¸­æ–­è¢«åŠ¨æ‰“æ–­</p>
</li>
<li>
<p><code>on_interrupt</code> ä¼šæ‹¦æˆªåˆ°ä¸­æ–­äº‹ä»¶</p>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>
<p>VME</p>
<ul>
<li>
<p>å…è®¸åˆ›å»ºä¸€ä¸ª â€œç»è¿‡åœ°å€ç¿»è¯‘çš„æ‰§è¡Œæ¨¡å¼â€</p>
</li>
<li>
<p>é€šè¿‡ CTE API ç®¡ç†</p>
</li>
</ul>
</li>
<li>
<p>æœ‰å…³ä¸­æ–­ä»£ç </p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">Context</span> <span class="o">*</span><span class="nf">on_interrupt</span><span class="p">(</span><span class="n">Event</span> <span class="n">ev</span><span class="p">,</span> <span class="n">Context</span> <span class="o">*</span><span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">extern</span> <span class="n">Task</span> <span class="n">tasks</span><span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">current</span><span class="p">)</span> <span class="n">current</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tasks</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>          <span class="n">current</span><span class="o">-&gt;</span><span class="n">context</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">while</span> <span class="p">((</span><span class="n">current</span> <span class="o">-</span> <span class="n">tasks</span><span class="p">)</span> <span class="o">%</span> <span class="n">cpu_count</span><span class="p">()</span> <span class="o">!=</span> <span class="n">cpu_current</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">context</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">mp_entry</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">iset</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">yield</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">iset</span><span class="p">(</span><span class="kt">bool</span> <span class="n">enable</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">extern</span> <span class="n">sigset_t</span> <span class="n">__am_intr_sigmask</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// NOTE: sigprocmask does not supported in multithreading
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">sigprocmask</span><span class="p">(</span><span class="n">enable</span> <span class="o">?</span> <span class="nl">SIG_UNBLOCK</span> <span class="p">:</span> <span class="n">SIG_BLOCK</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">__am_intr_sigmask</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">assert</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="rtfsc-æ—¶é—´">RTFSC æ—¶é—´</h2>
<h3 id="0-ç”Ÿæˆé•œåƒå’Œå¯åŠ¨è™šæ‹Ÿæœº">(0) ç”Ÿæˆé•œåƒå’Œå¯åŠ¨è™šæ‹Ÿæœº</h3>
<blockquote>
<p>å¦‚æœä½¿ç”¨ â€œåœŸåŠæ³•â€ï¼Œä½ å¾ˆå¯èƒ½è¢«æ·¹æ²¡åœ¨ Makefile ä¸­</p>
<ul>
<li>è¯»æ‡‚ Makefile éœ€è¦ STFW, RTFMï¼Œå¤§é‡çš„ç²¾åŠ›</li>
<li>è™½ç„¶èŠ±ç‚¹æ—¶é—´è¯»æ˜¯å€¼å¾—çš„ï¼Œä½†å¾ˆå¯èƒ½è¯»äº†å¾ˆä¹…éƒ½æ²¡è¯»åˆ°é‡è¦çš„åœ°æ–¹</li>
</ul>
</blockquote>
<ul>
<li>
<p>èŠ±ä¸€ç‚¹æ—¶é—´æƒ³ â€œåº”è¯¥æ€ä¹ˆåšâ€</p>
<ul>
<li>
<p>èŠ±å‡ åˆ†é’Ÿåˆ›å»ºä¸€ä¸ªå°å·¥å…·ï¼šâ€œAbstractMachine æ„å»ºç†è§£å·¥å…·â€</p>
<ul>
<li>UNIX Philosophy: keep it simple, stupid</li>
<li>everything is a file; write things to work together using text interface</li>
</ul>
</li>
<li>
<p><em>Get out of your comfort zone</em></p>
</li>
</ul>
</li>
</ul>
<p>Abstract-Machine é€šè¿‡è„šæœ¬+é‡å®šå‘å¯ä»¥è½¬åŒ–ä¸º<a href="https://github.com/Jungle430/check-for-NJU-OS/blob/main/abstract-machine-Makefile.html" target="_blank" rel="noopener noreffer">HTMLä»£ç </a>è¿›è¡Œé˜…è¯»</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>jungleã‰¿jungle-virtual-machine<span class="o">)</span>-<span class="o">[</span>~/deom1/abstract-machine<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ sudo apt install python3-markdown
</span></span><span class="line"><span class="cl">â”Œâ”€â”€<span class="o">(</span>jungleã‰¿jungle-virtual-machine<span class="o">)</span>-<span class="o">[</span>~/deom1/abstract-machine<span class="o">]</span>
</span></span><span class="line"><span class="cl">â””â”€$ cat Makefile <span class="p">|</span> sed <span class="s1">&#39;s/^\([^#]\)/    \1/g&#39;</span> <span class="p">|</span> markdown_py &gt; Makefile.html
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨ï¼šä½¿ç”¨äº†è‡ªåŠ¨åŒ–å·¥å…·<a href="https://python-markdown.github.io" target="_blank" rel="noopener noreffer">python3-markdown</a></p>
<h3 id="0-ç”Ÿæˆé•œåƒå’Œå¯åŠ¨è™šæ‹Ÿæœº-contd">(0) ç”Ÿæˆé•œåƒå’Œå¯åŠ¨è™šæ‹Ÿæœº (cont&rsquo;d)</h3>
<ul>
<li>è§‚å¯Ÿ AbstractMachine ç¨‹åºç¼–è¯‘è¿‡ç¨‹çš„æ­£ç¡®æ–¹æ³•ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">make -nB <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="p">|</span> grep -ve <span class="s1">&#39;^\(\#\|echo\|mkdir\|make\)&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="p">|</span> sed <span class="s2">&#34;s#</span><span class="nv">$AM_HOME</span><span class="s2">#\$AM_HOME#g&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="p">|</span> sed <span class="s2">&#34;s#</span><span class="nv">$PWD</span><span class="s2">#.#g&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="p">|</span> vim -
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>Command line tricks</p>
<ul>
<li><code>make -nB</code> (RTFM)</li>
<li>grep: æ–‡æœ¬è¿‡æ»¤ï¼Œçœç•¥äº†ä¸€äº›å¹²æ‰°é¡¹
<ul>
<li>echo (æç¤ºä¿¡æ¯), mkdir (ç›®å½•å»ºç«‹), make (sub-goals)</li>
</ul>
</li>
<li>sed: è®©è¾“å‡ºæ›´æ˜“è¯»
<ul>
<li>å°†ç»å¯¹è·¯å¾„æ›¿æ¢æˆç›¸å¯¹è·¯å¾„</li>
</ul>
</li>
<li>vim: æ›´èˆ’é€‚çš„ç¼–è¾‘/æŸ¥çœ‹ä½“éªŒ</li>
</ul>
</li>
<li>
<p>éƒ¨åˆ†<code>make -nB</code>çš„è¾“å‡ºä¿¡æ¯</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="cl"><span class="gh"># Building hello-image [x86_64-qemu]
</span></span></span><span class="line"><span class="cl"><span class="gh"></span>mkdir -p /home/jungle/deom1/deom/build/x86_64-qemu/ <span class="err">&amp;&amp;</span> echo + CC main.c
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-gcc -std=gnu11 -O2 -MMD -Wall -Werror -I/home/jungle/deom1/deom/include -I/home/jungle/deom1/deom/../abstract-machine/am/include/ -I/home/jungle/deom1/deom/../abstract-machine/klib/include/ -D__ISA__=\&#34;x86_64\&#34; -D__ISA_X86_64__ -D__ARCH__=x86_64-qemu -D__ARCH_X86_64_QEMU -D__PLATFORM__=qemu -D__PLATFORM_QEMU -DARCH_H=\&#34;arch/x86_64-qemu.h\&#34; -fno-asynchronous-unwind-tables -fno-builtin -fno-stack-protector -Wno-main -U_FORTIFY_SOURCE -m64 -fPIC -mno-sse -c -o /home/jungle/deom1/deom/build/x86_64-qemu/main.o /home/jungle/deom1/deom/main.c
</span></span><span class="line"><span class="cl">mkdir -p /home/jungle/deom1/deom/build/x86_64-qemu/ <span class="err">&amp;&amp;</span> echo + CC say.c
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-gcc -std=gnu11 -O2 -MMD -Wall -Werror -I/home/jungle/deom1/deom/include -I/home/jungle/deom1/deom/../abstract-machine/am/include/ -I/home/jungle/deom1/deom/../abstract-machine/klib/include/ -D__ISA__=\&#34;x86_64\&#34; -D__ISA_X86_64__ -D__ARCH__=x86_64-qemu -D__ARCH_X86_64_QEMU -D__PLATFORM__=qemu -D__PLATFORM_QEMU -DARCH_H=\&#34;arch/x86_64-qemu.h\&#34; -fno-asynchronous-unwind-tables -fno-builtin -fno-stack-protector -Wno-main -U_FORTIFY_SOURCE -m64 -fPIC -mno-sse -c -o /home/jungle/deom1/deom/build/x86_64-qemu/say.o /home/jungle/deom1/deom/say.c
</span></span><span class="line"><span class="cl">make -s -C /home/jungle/deom1/deom/../abstract-machine/am archive
</span></span><span class="line"><span class="cl"><span class="gh"># Building am-archive [x86_64-qemu]
</span></span></span><span class="line"><span class="cl"><span class="gh"></span>mkdir -p /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/ <span class="err">&amp;&amp;</span> echo + AS src/x86/qemu/start64.S
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-gcc -MMD -I/home/jungle/deom1/deom/../abstract-machine/am/src -I/home/jungle/deom1/abstract-machine/am/include -I/home/jungle/deom1/deom/../abstract-machine/am/include/ -I/home/jungle/deom1/deom/../abstract-machine/klib/include/ -m64 -fPIC -c -o /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/start64.o /home/jungle/deom1/abstract-machine/am/src/x86/qemu/start64.S
</span></span><span class="line"><span class="cl">mkdir -p /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/ <span class="err">&amp;&amp;</span> echo + AS src/x86/qemu/trap64.S
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-gcc -MMD -I/home/jungle/deom1/deom/../abstract-machine/am/src -I/home/jungle/deom1/abstract-machine/am/include -I/home/jungle/deom1/deom/../abstract-machine/am/include/ -I/home/jungle/deom1/deom/../abstract-machine/klib/include/ -m64 -fPIC -c -o /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/trap64.o /home/jungle/deom1/abstract-machine/am/src/x86/qemu/trap64.S
</span></span><span class="line"><span class="cl">mkdir -p /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/ <span class="err">&amp;&amp;</span> echo + CC src/x86/qemu/trm.c
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-gcc -std=gnu11 -O2 -MMD -Wall -Werror -I/home/jungle/deom1/deom/../abstract-machine/am/src -I/home/jungle/deom1/abstract-machine/am/include -I/home/jungle/deom1/deom/../abstract-machine/am/include/ -I/home/jungle/deom1/deom/../abstract-machine/klib/include/ -D__ISA__=\&#34;x86_64\&#34; -D__ISA_X86_64__ -D__ARCH__=x86_64-qemu -D__ARCH_X86_64_QEMU -D__PLATFORM__=qemu -D__PLATFORM_QEMU -DARCH_H=\&#34;arch/x86_64-qemu.h\&#34; -fno-asynchronous-unwind-tables -fno-builtin -fno-stack-protector -Wno-main -U_FORTIFY_SOURCE -m64 -fPIC -mno-sse -c -o /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/trm.o /home/jungle/deom1/abstract-machine/am/src/x86/qemu/trm.c
</span></span><span class="line"><span class="cl">mkdir -p /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/ <span class="err">&amp;&amp;</span> echo + CC src/x86/qemu/cte.c
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-gcc -std=gnu11 -O2 -MMD -Wall -Werror -I/home/jungle/deom1/deom/../abstract-machine/am/src -I/home/jungle/deom1/abstract-machine/am/include -I/home/jungle/deom1/deom/../abstract-machine/am/include/ -I/home/jungle/deom1/deom/../abstract-machine/klib/include/ -D__ISA__=\&#34;x86_64\&#34; -D__ISA_X86_64__ -D__ARCH__=x86_64-qemu -D__ARCH_X86_64_QEMU -D__PLATFORM__=qemu -D__PLATFORM_QEMU -DARCH_H=\&#34;arch/x86_64-qemu.h\&#34; -fno-asynchronous-unwind-tables -fno-builtin -fno-stack-protector -Wno-main -U_FORTIFY_SOURCE -m64 -fPIC -mno-sse -c -o /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/cte.o /home/jungle/deom1/abstract-machine/am/src/x86/qemu/cte.c
</span></span><span class="line"><span class="cl">mkdir -p /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/ <span class="err">&amp;&amp;</span> echo + CC src/x86/qemu/ioe.c
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-gcc -std=gnu11 -O2 -MMD -Wall -Werror -I/home/jungle/deom1/deom/../abstract-machine/am/src -I/home/jungle/deom1/abstract-machine/am/include -I/home/jungle/deom1/deom/../abstract-machine/am/include/ -I/home/jungle/deom1/deom/../abstract-machine/klib/include/ -D__ISA__=\&#34;x86_64\&#34; -D__ISA_X86_64__ -D__ARCH__=x86_64-qemu -D__ARCH_X86_64_QEMU -D__PLATFORM__=qemu -D__PLATFORM_QEMU -DARCH_H=\&#34;arch/x86_64-qemu.h\&#34; -fno-asynchronous-unwind-tables -fno-builtin -fno-stack-protector -Wno-main -U_FORTIFY_SOURCE -m64 -fPIC -mno-sse -c -o /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/ioe.o /home/jungle/deom1/abstract-machine/am/src/x86/qemu/ioe.c
</span></span><span class="line"><span class="cl">mkdir -p /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/ <span class="err">&amp;&amp;</span> echo + CC src/x86/qemu/vme.c
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-gcc -std=gnu11 -O2 -MMD -Wall -Werror -I/home/jungle/deom1/deom/../abstract-machine/am/src -I/home/jungle/deom1/abstract-machine/am/include -I/home/jungle/deom1/deom/../abstract-machine/am/include/ -I/home/jungle/deom1/deom/../abstract-machine/klib/include/ -D__ISA__=\&#34;x86_64\&#34; -D__ISA_X86_64__ -D__ARCH__=x86_64-qemu -D__ARCH_X86_64_QEMU -D__PLATFORM__=qemu -D__PLATFORM_QEMU -DARCH_H=\&#34;arch/x86_64-qemu.h\&#34; -fno-asynchronous-unwind-tables -fno-builtin -fno-stack-protector -Wno-main -U_FORTIFY_SOURCE -m64 -fPIC -mno-sse -c -o /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/vme.o /home/jungle/deom1/abstract-machine/am/src/x86/qemu/vme.c
</span></span><span class="line"><span class="cl">mkdir -p /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/ <span class="err">&amp;&amp;</span> echo + CC src/x86/qemu/mpe.c
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-gcc -std=gnu11 -O2 -MMD -Wall -Werror -I/home/jungle/deom1/deom/../abstract-machine/am/src -I/home/jungle/deom1/abstract-machine/am/include -I/home/jungle/deom1/deom/../abstract-machine/am/include/ -I/home/jungle/deom1/deom/../abstract-machine/klib/include/ -D__ISA__=\&#34;x86_64\&#34; -D__ISA_X86_64__ -D__ARCH__=x86_64-qemu -D__ARCH_X86_64_QEMU -D__PLATFORM__=qemu -D__PLATFORM_QEMU -DARCH_H=\&#34;arch/x86_64-qemu.h\&#34; -fno-asynchronous-unwind-tables -fno-builtin -fno-stack-protector -Wno-main -U_FORTIFY_SOURCE -m64 -fPIC -mno-sse -c -o /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/mpe.o /home/jungle/deom1/abstract-machine/am/src/x86/qemu/mpe.c
</span></span><span class="line"><span class="cl">echo + AR &#34;-&gt;&#34; build/am-x86_64-qemu.a
</span></span><span class="line"><span class="cl">ar rcs /home/jungle/deom1/abstract-machine/am/build/am-x86_64-qemu.a /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/start64.o /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/trap64.o /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/trm.o /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/cte.o /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/ioe.o /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/vme.o /home/jungle/deom1/abstract-machine/am/build/x86_64-qemu/src/x86/qemu/mpe.o
</span></span><span class="line"><span class="cl">make -s -C /home/jungle/deom1/deom/../abstract-machine/klib archive
</span></span><span class="line"><span class="cl"><span class="gh"># Building klib-archive [x86_64-qemu]
</span></span></span><span class="line"><span class="cl"><span class="gh"></span>mkdir -p /home/jungle/deom1/abstract-machine/klib/build/x86_64-qemu/src/ <span class="err">&amp;&amp;</span> echo + CC src/stdio.c
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-gcc -std=gnu11 -O2 -MMD -Wall -Werror -I/home/jungle/deom1/abstract-machine/klib/include -I/home/jungle/deom1/deom/../abstract-machine/am/include/ -I/home/jungle/deom1/deom/../abstract-machine/klib/include/ -D__ISA__=\&#34;x86_64\&#34; -D__ISA_X86_64__ -D__ARCH__=x86_64-qemu -D__ARCH_X86_64_QEMU -D__PLATFORM__=qemu -D__PLATFORM_QEMU -DARCH_H=\&#34;arch/x86_64-qemu.h\&#34; -fno-asynchronous-unwind-tables -fno-builtin -fno-stack-protector -Wno-main -U_FORTIFY_SOURCE -m64 -fPIC -mno-sse -c -o /home/jungle/deom1/abstract-machine/klib/build/x86_64-qemu/src/stdio.o /home/jungle/deom1/abstract-machine/klib/src/stdio.c
</span></span><span class="line"><span class="cl">mkdir -p /home/jungle/deom1/abstract-machine/klib/build/x86_64-qemu/src/ <span class="err">&amp;&amp;</span> echo + CC src/int64.c
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-gcc -std=gnu11 -O2 -MMD -Wall -Werror -I/home/jungle/deom1/abstract-machine/klib/include -I/home/jungle/deom1/deom/../abstract-machine/am/include/ -I/home/jungle/deom1/deom/../abstract-machine/klib/include/ -D__ISA__=\&#34;x86_64\&#34; -D__ISA_X86_64__ -D__ARCH__=x86_64-qemu -D__ARCH_X86_64_QEMU -D__PLATFORM__=qemu -D__PLATFORM_QEMU -DARCH_H=\&#34;arch/x86_64-qemu.h\&#34; -fno-asynchronous-unwind-tables -fno-builtin -fno-stack-protector -Wno-main -U_FORTIFY_SOURCE -m64 -fPIC -mno-sse -c -o /home/jungle/deom1/abstract-machine/klib/build/x86_64-qemu/src/int64.o /home/jungle/deom1/abstract-machine/klib/src/int64.c
</span></span><span class="line"><span class="cl">mkdir -p /home/jungle/deom1/abstract-machine/klib/build/x86_64-qemu/src/ <span class="err">&amp;&amp;</span> echo + CC src/string.c
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-gcc -std=gnu11 -O2 -MMD -Wall -Werror -I/home/jungle/deom1/abstract-machine/klib/include -I/home/jungle/deom1/deom/../abstract-machine/am/include/ -I/home/jungle/deom1/deom/../abstract-machine/klib/include/ -D__ISA__=\&#34;x86_64\&#34; -D__ISA_X86_64__ -D__ARCH__=x86_64-qemu -D__ARCH_X86_64_QEMU -D__PLATFORM__=qemu -D__PLATFORM_QEMU -DARCH_H=\&#34;arch/x86_64-qemu.h\&#34; -fno-asynchronous-unwind-tables -fno-builtin -fno-stack-protector -Wno-main -U_FORTIFY_SOURCE -m64 -fPIC -mno-sse -c -o /home/jungle/deom1/abstract-machine/klib/build/x86_64-qemu/src/string.o /home/jungle/deom1/abstract-machine/klib/src/string.c
</span></span><span class="line"><span class="cl">mkdir -p /home/jungle/deom1/abstract-machine/klib/build/x86_64-qemu/src/ <span class="err">&amp;&amp;</span> echo + CC src/cpp.c
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-gcc -std=gnu11 -O2 -MMD -Wall -Werror -I/home/jungle/deom1/abstract-machine/klib/include -I/home/jungle/deom1/deom/../abstract-machine/am/include/ -I/home/jungle/deom1/deom/../abstract-machine/klib/include/ -D__ISA__=\&#34;x86_64\&#34; -D__ISA_X86_64__ -D__ARCH__=x86_64-qemu -D__ARCH_X86_64_QEMU -D__PLATFORM__=qemu -D__PLATFORM_QEMU -DARCH_H=\&#34;arch/x86_64-qemu.h\&#34; -fno-asynchronous-unwind-tables -fno-builtin -fno-stack-protector -Wno-main -U_FORTIFY_SOURCE -m64 -fPIC -mno-sse -c -o /home/jungle/deom1/abstract-machine/klib/build/x86_64-qemu/src/cpp.o /home/jungle/deom1/abstract-machine/klib/src/cpp.c
</span></span><span class="line"><span class="cl">mkdir -p /home/jungle/deom1/abstract-machine/klib/build/x86_64-qemu/src/ <span class="err">&amp;&amp;</span> echo + CC src/stdlib.c
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-gcc -std=gnu11 -O2 -MMD -Wall -Werror -I/home/jungle/deom1/abstract-machine/klib/include -I/home/jungle/deom1/deom/../abstract-machine/am/include/ -I/home/jungle/deom1/deom/../abstract-machine/klib/include/ -D__ISA__=\&#34;x86_64\&#34; -D__ISA_X86_64__ -D__ARCH__=x86_64-qemu -D__ARCH_X86_64_QEMU -D__PLATFORM__=qemu -D__PLATFORM_QEMU -DARCH_H=\&#34;arch/x86_64-qemu.h\&#34; -fno-asynchronous-unwind-tables -fno-builtin -fno-stack-protector -Wno-main -U_FORTIFY_SOURCE -m64 -fPIC -mno-sse -c -o /home/jungle/deom1/abstract-machine/klib/build/x86_64-qemu/src/stdlib.o /home/jungle/deom1/abstract-machine/klib/src/stdlib.c
</span></span><span class="line"><span class="cl">echo + AR &#34;-&gt;&#34; build/klib-x86_64-qemu.a
</span></span><span class="line"><span class="cl">ar rcs /home/jungle/deom1/abstract-machine/klib/build/klib-x86_64-qemu.a /home/jungle/deom1/abstract-machine/klib/build/x86_64-qemu/src/stdio.o /home/jungle/deom1/abstract-machine/klib/build/x86_64-qemu/src/int64.o /home/jungle/deom1/abstract-machine/klib/build/x86_64-qemu/src/string.o /home/jungle/deom1/abstract-machine/klib/build/x86_64-qemu/src/cpp.o /home/jungle/deom1/abstract-machine/klib/build/x86_64-qemu/src/stdlib.o
</span></span><span class="line"><span class="cl">echo + LD &#34;-&gt;&#34; build/hello-x86_64-qemu.elf
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-ld -melf_x86_64 -N -Ttext-segment=0x00100000 -o /home/jungle/deom1/deom/build/hello-x86_64-qemu.elf --start-group /home/jungle/deom1/deom/build/x86_64-qemu/main.o /home/jungle/deom1/deom/build/x86_64-qemu/say.o /home/jungle/deom1/deom/../abstract-machine/am/build/am-x86_64-qemu.a /home/jungle/deom1/deom/../abstract-machine/klib/build/klib-x86_64-qemu.a --end-group
</span></span><span class="line"><span class="cl">echo \# Creating image [x86_64-qemu]
</span></span><span class="line"><span class="cl">make -s -C /home/jungle/deom1/deom/../abstract-machine/am/src/x86/qemu/boot
</span></span><span class="line"><span class="cl">echo + CC start.S main.c
</span></span><span class="line"><span class="cl">x86_64-linux-gnu-gcc -static -m32 -fno-pic -Os -nostdlib -Ttext 0x7c00 -I/home/jungle/deom1/deom/../abstract-machine/am/src -o bootblock.o start.S main.c
</span></span><span class="line"><span class="cl">python3 genboot.py bootblock.o
</span></span><span class="line"><span class="cl">echo + CREATE &#34;-&gt;&#34; build/hello-x86_64-qemu
</span></span><span class="line"><span class="cl">( cat /home/jungle/deom1/deom/../abstract-machine/am/src/x86/qemu/boot/bootblock.o; head -c 1024 /dev/zero; cat /home/jungle/deom1/deom/build/hello-x86_64-qemu.elf ) &gt; /home/jungle/deom1/deom/build/hello-x86_64-qemu
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="0-ç”Ÿæˆé•œåƒå’Œå¯åŠ¨è™šæ‹Ÿæœº-contd-1">(0) ç”Ÿæˆé•œåƒå’Œå¯åŠ¨è™šæ‹Ÿæœº (cont&rsquo;d)</h3>
<p>æƒ³è¦çœ‹å¾—æ›´æ¸…æ¥šä¸€äº›ï¼Ÿ</p>
<ul>
<li><code>:%s/ /\r /g</code>
<ul>
<li>æ¯ä¸€ä¸ªå‘½ä»¤å°±åƒ â€œä¸€å¥è¯â€</li>
</ul>
</li>
</ul>
<hr>
<p>ç¼–è¯‘</p>
<ul>
<li><code>-std=gnu11</code>, <code>m64</code>, <code>-mno-sse</code>, <code>-I</code>, <code>-D</code>, &hellip; (è¿™å¯¹ä½ é…ç½® vscode å¾ˆé‡è¦)</li>
</ul>
<p>é“¾æ¥</p>
<ul>
<li><code>-melf_x86_64</code>, <code>-N</code>, <code>-Ttext-segment=0x00100000</code></li>
<li>é“¾æ¥äº†éœ€è¦çš„åº“ (<code>am-x86_64-qemu.a</code>, <code>klib-x86_64-qemu.a</code>)</li>
</ul>
<p>å½©è›‹</p>
<ul>
<li><code>make html</code></li>
</ul>
<h3 id="1-å¯åŠ¨åŠ è½½å™¨-boot-loader">(1) å¯åŠ¨åŠ è½½å™¨ (Boot Loader)</h3>
<p>512 å­—èŠ‚ä¸­çš„ä»£ç ï¼Œå‡è®¾äº†é•œåƒæ ¼å¼ (çœŸæ­£çš„çš„åŠ è½½å™¨æœ‰å¾ˆå¤š stages)</p>
<ul>
<li>16-bit â†’ 32-bit</li>
<li>ELF32/64 çš„åŠ è½½å™¨
<ul>
<li>æŒ‰ç…§çº¦å®šçš„ç£ç›˜é•œåƒæ ¼å¼åŠ è½½</li>
</ul>
</li>
</ul>
<p>ä»£ç è®²è§£ï¼š</p>
<ul>
<li><code>am/src/x86/qemu/boot/start.S</code>å’Œ<code>main.c</code>
<ul>
<li>å®ƒä»¬éƒ½å¯ä»¥è°ƒè¯•ï¼</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">elf32</span><span class="o">-&gt;</span><span class="n">e_machine</span> <span class="o">==</span> <span class="n">EM_X86_64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">((</span><span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="p">)())(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">elf64</span><span class="o">-&gt;</span><span class="n">e_entry</span><span class="p">)();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">((</span><span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="p">)())(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">elf32</span><span class="o">-&gt;</span><span class="n">e_entry</span><span class="p">)();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜</p>
<ul>
<li><strong>Q</strong>: æ“ä½œç³»ç»Ÿä¹Ÿæ˜¯ç¨‹åºï¼Œå®ƒå¦‚ä½•ç”¨çŠ¶æ€æœºå¦‚ä½•å®šä¹‰ï¼Ÿ</li>
</ul>
<hr>
<p>Take-away message</p>
<ul>
<li>ä¸€åˆ‡çš†å¯è°ƒè¯• (åŒ…æ‹¬ firmware)
<ul>
<li>ç†è§£æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•è¢«å¯åŠ¨çš„</li>
<li>å­¦ä¼šä½¿ç”¨ gdb (å¿…å¤‡ç”Ÿå­˜æŠ€èƒ½)</li>
</ul>
</li>
<li>æ“ä½œç³»ç»Ÿä¹Ÿæ˜¯ç¨‹åº
<ul>
<li>AbstractMachine æ‰©å±•äº†ç¨‹åºçš„è¯­ä¹‰ï¼Œä»…æ­¤è€Œå·²</li>
</ul>
</li>
</ul>
<p><b>å£°æ˜ï¼šæœ¬æ–‡ç« å¼•ç”¨èµ„æ–™ä¸å›¾åƒå‡å·²åšæ ‡æ³¨ï¼Œå¦‚æœ‰ä¾µæƒæœ¬äººä¼šé©¬ä¸Šåˆ é™¤</b></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info"><div class="post-info-tag"><span><a href="/tags/operating-system/">Operating System</a>
                </span></div><div class="post-info-line"><div class="post-info-mod">
                <span>æ›´æ–°äº 2023-03-25</span>
            </div><div class="post-info-mod"></div>
        </div><div class="post-info-share">
            <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter9/" data-title="Operating System Chapter9 æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹" data-hashtags="Operating System"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter9/" data-hashtag="Operating System"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Linkedin" data-sharer="linkedin" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter9/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° WhatsApp" data-sharer="whatsapp" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter9/" data-title="Operating System Chapter9 æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter9/" data-title="Operating System Chapter9 æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹"><i class="fab fa-line fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter9/" data-title="Operating System Chapter9 æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Myspace" data-sharer="myspace" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter9/" data-title="Operating System Chapter9 æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Blogger" data-sharer="blogger" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter9/" data-title="Operating System Chapter9 æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹" data-description=""><i class="fab fa-blogger fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° ç™¾åº¦" data-sharer="baidu" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter9/" data-title="Operating System Chapter9 æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹"><i data-svg-src="/lib/simple-icons/icons/baidu.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Evernote" data-sharer="evernote" data-url="https://Jungle430.github.io/posts/operating-system/operating-system-chapter9/" data-title="Operating System Chapter9 æ“ä½œç³»ç»Ÿçš„çŠ¶æ€æœºæ¨¡å‹"><i class="fab fa-evernote fa-fw"></i></a></span>
        </div></div><div class="post-nav"><a href="/posts/operating-system/operating-system-chapter8/" class="prev" rel="prev" title="Operating System Chapter8 å¹¶å‘ bug å’Œåº”å¯¹"><i class="fas fa-angle-left fa-fw"></i>Previous Post</a>
            <a href="/posts/operating-system/operating-system-chapter10/" class="next" rel="next" title="Operating System Chapter10 çŠ¶æ€æœºæ¨¡å‹çš„åº”ç”¨">Next Post<i class="fas fa-angle-right fa-fw"></i></a></div></div>
</div></article></div>
            </main>
            <footer class="footer"><div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.105.0">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/khusika/FeelIt" target="_blank" rel="noopener noreffer" title="FeelIt 1.0.1"><i class="fas fa-hand-holding-heart fa-fw"></i> FeelIt</a>
        </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/Jungle430">Jungle</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
</div>
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker
        .register('/sw.min.js?version=0.0.1', { scope: '/' })
        .then(() => {
            console.info('Jungle\u0027s Blog\u00A0Service Worker Registered');
        }, err => console.error('Jungle\u0027s Blog\u00A0Service Worker registration failed: ', err));

    navigator.serviceWorker
        .ready
        .then(() => {
            console.info('Jungle\u0027s Blog\u00A0Service Worker Ready');
        });
}
</script>
</footer>
        </div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-chevron-up fa-fw"></i>
            </a></div><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.fill%2CArray.prototype.find%2CArray.from%2CIntersectionObserver%2CMath.sign%2CObject.assign%2CPromise%2CObject.entries%2Chtml5shiv%2CObject.values%2Cfetch%2CElement.prototype.after"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script src="/lib/katex/katex.min.js"></script><script src="/lib/katex/auto-render.min.js"></script><script src="/lib/katex/copy-tex.min.js"></script><script src="/lib/katex/mhchem.min.js"></script><script src="/lib/mermaid/mermaid.min.js"></script><script>window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":100},"comment":{},"data":{"id-1":"graph LR\nA(\"å¯åŠ¨ç£ç›˜çš„ç¬¬ä¸€ä¸ª512bytes\")\nB(\"å¯åŠ¨ç£ç›˜çš„å…¶ä»–éƒ¨åˆ†\")\nA====B\nC(\"ä¸»å¼•å¯¼æ‰‡åŒº\")\nC--\u003eA\nD(\"å†…å­˜çš„ç¡®å®šåœ°å€7c00\")\nA--\"By Firmware to\"--\u003eD","id-2":"graph TB\nA(CPU)\nB(\"å†…å­˜çš„7c00æ˜¯ç£ç›˜çš„å‰512byte, pcæŒ‡å‘7c00ï¼Œå…¶ä»–å¯„å­˜å™¨ä¹Ÿæ˜¯å¦æœ‰è§„å®š, CPU:16 bit mode\")\nA--BIOS--\u003eB","id-3":"graph TB\nA(\"CPU Reset\")\nB(\"å†…å­˜çš„7c00æ˜¯ç£ç›˜çš„å‰512byte, pcæŒ‡å‘7c00ï¼Œå…¶ä»–å¯„å­˜å™¨ä¹Ÿæ˜¯å¦æœ‰è§„å®š, CPU:16 bit mode\")\nA--BIOS--\u003eB\nB--\"then\"--\u003eD\nC(\"å†…å­˜\")\nD(\"OS\")\nE(\"PC\")\nD--\"boot loader\"--\u003eC\nC--\"then\"--\u003eE\nE--\"point to\"--\u003eD\nF(\"OSå¼€å§‹è¿è¡Œ\")\nD--\u003eF"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script src="/js/theme.min.js"></script></body></html>
